<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coverage Report</title>
  <style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  color: #333;
  margin: 0;
  padding: 20px;
}

h1, h2, h3 {
  margin-top: 0;
}

.summary {
  background-color: #f5f5f5;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 20px;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
}

.summary-label {
  font-weight: bold;
  flex: 1;
}

.summary-value {
  flex: 1;
  text-align: right;
}

.files {
  margin-bottom: 20px;
}

.file-item {
  display: flex;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #eee;
}

.file-name {
  flex: 3;
}

.file-coverage {
  flex: 1;
  text-align: right;
}

.progress {
  background-color: #f5f5f5;
  border-radius: 3px;
  height: 20px;
  margin-left: 10px;
  margin-right: 10px;
  flex: 2;
  overflow: hidden;
}

.progress-bar {
  background-color: #4CAF50;
  height: 100%;
}

.low {
  background-color: #F44336;
}

.medium {
  background-color: #FF9800;
}

.high {
  background-color: #4CAF50;
}

.source-code {
  font-family: monospace;
  white-space: pre;
  margin-top: 20px;
  border: 1px solid #ddd;
  border-radius: 3px;
}

.line {
  display: flex;
}

.line-number {
  width: 50px;
  text-align: right;
  padding-right: 10px;
  border-right: 1px solid #ddd;
  color: #999;
  background-color: #f5f5f5;
}

.line-content {
  padding-left: 10px;
}

.covered {
  background-color: rgba(76, 175, 80, 0.1);
}

.not-covered {
  background-color: rgba(244, 67, 54, 0.1);
}

.not-executable {
  color: #999;
}

.execution-count {
  display: inline-block;
  min-width: 30px;
  text-align: right;
  color: #666;
  padding-right: 10px;
}

.file-summary {
  background-color: #f5f5f5;
  padding: 10px;
  margin-bottom: 20px;
  border-radius: 3px;
}

.function-list {
  margin: 20px 0;
}

.functions {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

.functions th, .functions td {
  padding: 8px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

.functions th {
  background-color: #f5f5f5;
  font-weight: bold;
  cursor: pointer;
}

.functions th:hover {
  background-color: #e5e5e5;
}

.functions th::after {
  content: "";
  margin-left: 5px;
}

.functions th.sort-asc::after {
  content: "▲";
}

.functions th.sort-desc::after {
  content: "▼";
}

.functions .executed {
  color: #4CAF50;
}

.functions .not-executed {
  color: #F44336;
}

.functions .covered {
  background-color: rgba(76, 175, 80, 0.1);
}

.functions .not-covered {
  background-color: rgba(244, 67, 54, 0.1);
}

.function-type-badge {
  display: inline-block;
  font-size: 0.8em;
  padding: 2px 6px;
  border-radius: 10px;
  background-color: #e0e0e0;
  color: #333;
  margin-left: 5px;
}

.function-type-global {
  background-color: #bbdefb;
  color: #0d47a1;
}

.function-type-local {
  background-color: #c8e6c9;
  color: #1b5e20;
}

.function-type-method {
  background-color: #d1c4e9;
  color: #4527a0;
}

.function-type-anonymous {
  background-color: #ffe0b2;
  color: #e65100;
}

.function-type-closure {
  background-color: #f8bbd0;
  color: #880e4f;
}

.function-filter {
  margin: 10px 0;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.function-filter-item {
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
  background-color: #f5f5f5;
}

.function-filter-item.active {
  background-color: #e0e0e0;
  font-weight: bold;
}

.function-filter-item input {
  margin-right: 5px;
}

.function-count {
  background-color: #f5f5f5;
  border-radius: 10px;
  padding: 2px 6px;
  font-size: 0.8em;
  margin-left: 5px;
}

.function-search {
  margin-bottom: 10px;
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-sizing: border-box;
}

.badge {
  display: inline-block;
  font-size: 0.8em;
  padding: 2px 6px;
  border-radius: 10px;
  margin-left: 5px;
}

.badge-success {
  background-color: #c8e6c9;
  color: #1b5e20;
}

.badge-danger {
  background-color: #ffcdd2;
  color: #b71c1c;
}

.badge-warning {
  background-color: #ffe0b2;
  color: #e65100;
}

.badge-info {
  background-color: #bbdefb;
  color: #0d47a1;
}

/* For JavaScript interaction */
.function-sort-script {
  display: none;
}
  </style>
</head>
<body>
  <h1>Coverage Report</h1>
<div class="summary">
  <h2>Coverage Summary</h2>
  
  <!-- Coverage visualization -->
  <div style="margin-bottom: 20px;">
    <div style="margin-bottom: 10px;">
      <strong>Line Coverage: 14%</strong>
      <div class="progress" style="margin: 5px 0; height: 15px;">
        <div class="progress-bar low" style="width: 14%;"></div>
      </div>
    </div>
    
    <div style="margin-bottom: 10px;">
      <strong>Function Coverage: 100%</strong>
      <div class="progress" style="margin: 5px 0; height: 15px;">
        <div class="progress-bar high" style="width: 100%;"></div>
      </div>
    </div>
  </div>
  
  <div class="summary-row">
    <span class="summary-label">Total Files:</span>
    <span class="summary-value">14</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">Covered Files:</span>
    <span class="summary-value">13 / 14 (92%)</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">Total Lines:</span>
    <span class="summary-value">14280</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">Executable Lines:</span>
    <span class="summary-value">8387</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">Executed Lines:</span>
    <span class="summary-value">1223 / 8387 (14%)</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">Covered Lines:</span>
    <span class="summary-value">1223 / 8387 (14%)</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">Total Functions:</span>
    <span class="summary-value">58</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">Executed Functions:</span>
    <span class="summary-value">58 / 58 (100%)</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">Covered Functions:</span>
    <span class="summary-value">58 / 58 (100%)</span>
  </div>
  
  <!-- Function type breakdown -->
  <div style="margin-top: 15px;" id="function-type-breakdown">
    <h3>Function Types</h3>
    <div id="function-type-chart" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <!-- This will be populated with JavaScript -->
    </div>
  </div>
</div>

<script>
// Function to collect and display function type statistics
(function() {
  document.addEventListener('DOMContentLoaded', function() {
    // Count types
    const typeCounts = {
      global: 0,
      local: 0,
      method: 0,
      anonymous: 0,
      closure: 0,
      total: 0,
      executed: 0
    };
    
    // Collect stats from all function rows
    document.querySelectorAll('tr[data-function-type]').forEach(row => {
      const type = row.dataset.functionType;
      const executed = row.dataset.executed === 'true';
      
      if (typeCounts[type] !== undefined) {
        typeCounts[type]++;
        typeCounts.total++;
        if (executed) typeCounts.executed++;
      }
    });
    
    // Create chart
    const chart = document.getElementById('function-type-chart');
    if (!chart) return;
    
    const typeColors = {
      global: { bg: '#bbdefb', text: '#0d47a1' },
      local: { bg: '#c8e6c9', text: '#1b5e20' },
      method: { bg: '#d1c4e9', text: '#4527a0' },
      anonymous: { bg: '#ffe0b2', text: '#e65100' },
      closure: { bg: '#f8bbd0', text: '#880e4f' }
    };
    
    // Add a box for each type
    Object.keys(typeColors).forEach(type => {
      if (typeCounts[type] > 0) {
        const box = document.createElement('div');
        const percent = ((typeCounts[type] / typeCounts.total) * 100).toFixed(1);
        box.className = 'function-type-box';
        box.style.padding = '8px 12px';
        box.style.borderRadius = '4px';
        box.style.backgroundColor = typeColors[type].bg;
        box.style.color = typeColors[type].text;
        box.style.fontWeight = 'bold';
        box.style.minWidth = '120px';
        box.innerHTML = `
          ${type}: <strong>${typeCounts[type]}</strong><br>
          <small>${percent}% of functions</small>
        `;
        chart.appendChild(box);
      }
    });
    
    // Add executed count
    if (typeCounts.total > 0) {
      const executedBox = document.createElement('div');
      const percent = ((typeCounts.executed / typeCounts.total) * 100).toFixed(1);
      executedBox.className = 'function-type-box';
      executedBox.style.padding = '8px 12px';
      executedBox.style.borderRadius = '4px';
      executedBox.style.backgroundColor = '#dcedc8';
      executedBox.style.color = '#33691e';
      executedBox.style.fontWeight = 'bold';
      executedBox.style.minWidth = '120px';
      executedBox.innerHTML = `
        Executed: <strong>${typeCounts.executed}</strong><br>
        <small>${percent}% of total</small>
      `;
      chart.appendChild(executedBox);
    }
  });
})();
</script>
<div class="files">
  <h2>Covered Files</h2>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-assertion-lua">./lib/assertion.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 12%;"></div>
    </div>
    <div class="file-coverage">12%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-core-central-config-lua">./lib/core/central_config.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 3%;"></div>
    </div>
    <div class="file-coverage">3%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-core-test-definition-lua">./lib/core/test_definition.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 1%;"></div>
    </div>
    <div class="file-coverage">1%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-coverage-data-structure-lua">./lib/coverage/data_structure.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 29%;"></div>
    </div>
    <div class="file-coverage">29%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-coverage-debug-hook-lua">./lib/coverage/debug_hook.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 36%;"></div>
    </div>
    <div class="file-coverage">36%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-coverage-init-lua">./lib/coverage/init.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 26%;"></div>
    </div>
    <div class="file-coverage">26%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-coverage-process-functions-lua">./lib/coverage/process_functions.lua</a></div>
    <div class="progress">
      <div class="progress-bar medium" style="width: 54%;"></div>
    </div>
    <div class="file-coverage">54%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-samples-calculator-lua">./lib/samples/calculator.lua</a></div>
    <div class="progress">
      <div class="progress-bar medium" style="width: 71%;"></div>
    </div>
    <div class="file-coverage">71%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-tools-error-handler-lua">./lib/tools/error_handler.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 7%;"></div>
    </div>
    <div class="file-coverage">7%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-tools-filesystem-lua">./lib/tools/filesystem.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 0%;"></div>
    </div>
    <div class="file-coverage">0%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file---lib-tools-logging-lua">./lib/tools/logging.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 32%;"></div>
    </div>
    <div class="file-coverage">32%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file-lib-samples-calculator-lua">lib/samples/calculator.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 0%;"></div>
    </div>
    <div class="file-coverage">0%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file-scripts-runner-lua">scripts/runner.lua</a></div>
    <div class="progress">
      <div class="progress-bar low" style="width: 0%;"></div>
    </div>
    <div class="file-coverage">0%</div>
  </div>
  <div class="file-item">
    <div class="file-name"><a href="#file-tests-coverage-block-relationship-fix-test-lua">tests/coverage/block_relationship_fix_test.lua</a></div>
    <div class="progress">
      <div class="progress-bar medium" style="width: 77%;"></div>
    </div>
    <div class="file-coverage">77%</div>
  </div>
</div>
<div class="source-code" id="file-tests-coverage-block-relationship-fix-test-lua">
  <h3>tests/coverage/block_relationship_fix_test.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">67 / 86 (77%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar medium" style="width: 77%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">2 / 2 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 145      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 86      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 2      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 2      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search-tests-coverage-block-relationship-fix-test-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter-tests-coverage-block-relationship-fix-test-lua" value="all" checked>
        All <span class="function-count">2</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter-tests-coverage-block-relationship-fix-test-lua" value="executed">
        Executed <span class="function-count badge-success">2</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter-tests-coverage-block-relationship-fix-test-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type-tests-coverage-block-relationship-fix-test-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type-tests-coverage-block-relationship-fix-test-lua" value="local">
        Local <span class="function-count function-type-local">1</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type-tests-coverage-block-relationship-fix-test-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type-tests-coverage-block-relationship-fix-test-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">0</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type-tests-coverage-block-relationship-fix-test-lua" value="closure">
        Closure <span class="function-count function-type-closure">1</span>
      </label>
    </div>
    
    <table class="functions" id="functions-tests-coverage-block-relationship-fix-test-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="local" data-executed="true">
          <td>hook <span class="function-type-badge function-type-local">local</span></td>
          <td>local</td>
          <td><a href="#L34">34-69</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>fn <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L71">71-145</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for block_relationship_fix_test.lua    const tableId = 'functions-tests-coverage-block-relationship-fix-test-lua';
    const searchId = 'func-search-tests-coverage-block-relationship-fix-test-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter-tests-coverage-block-relationship-fix-test-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type-tests-coverage-block-relationship-fix-test-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter-tests-coverage-block-relationship-fix-test-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type-tests-coverage-block-relationship-fix-test-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Block Relationship Fix Test</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Tests the block_relationship_fixing functionality in the coverage module</div>
  </div>
  <div class="line not-covered" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local firmo = require(&quot;firmo&quot;)</div>
  </div>
  <div class="line not-covered" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local describe, it, expect, before, after = firmo.describe, firmo.it, firmo.expect, firmo.before, firmo.after</div>
  </div>
  <div class="line not-covered" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count">0</div>    <div class="line-content">describe(&quot;Block Relationship Fix Test&quot;, function()</div>
  </div>
  <div class="line not-covered" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local calculator = require(&quot;lib.samples.calculator&quot;)</div>
  </div>
  <div class="line not-covered" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local coverage = require(&quot;lib.coverage&quot;)</div>
  </div>
  <div class="line not-covered" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local debug_hook = require(&quot;lib.coverage.debug_hook&quot;)</div>
  </div>
  <div class="line not-covered" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local fs = require(&quot;lib.tools.filesystem&quot;)</div>
  </div>
  <div class="line not-covered" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local reporting = require(&quot;lib.reporting&quot;)</div>
  </div>
  <div class="line not-executable" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the file path for the calculator module</div>
  </div>
  <div class="line not-covered" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local calculator_path = debug.getinfo(calculator.add, &quot;S&quot;).source:sub(2)</div>
  </div>
  <div class="line not-executable" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path to match what coverage module uses internally</div>
  </div>
  <div class="line not-covered" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  calculator_path = fs.normalize_path(calculator_path)</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  before(function()</div>
  </div>
  <div class="line not-executable" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Start coverage tracking with block tracking enabled</div>
  </div>
  <div class="line not-covered" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage.start({</div>
  </div>
  <div class="line not-covered" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      include_patterns = {calculator_path},</div>
  </div>
  <div class="line not-covered" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      include_framework_files = true, -- Include framework files</div>
  </div>
  <div class="line not-covered" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      track_blocks = true, -- Enable block tracking</div>
  </div>
  <div class="line not-covered" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      user_code_only = false, -- Don't limit to user code only</div>
  </div>
  <div class="line not-covered" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug = true -- Enable debug output</div>
  </div>
  <div class="line not-covered" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Ensure file is tracked</div>
  </div>
  <div class="line not-covered" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage.track_file(calculator_path)</div>
  </div>
  <div class="line not-executable" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- debug_hook.activate_file is no longer needed - file will be automatically tracked</div>
  </div>
  <div class="line covered" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line not-executable" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  after(function()</div>
  </div>
  <div class="line not-executable" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Stop coverage tracking, triggering block relationship fixing</div>
  </div>
  <div class="line covered" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    coverage.stop()</div>
  </div>
  <div class="line not-executable" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Get coverage data</div>
  </div>
  <div class="line covered" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local report_data = coverage.get_report_data()</div>
  </div>
  <div class="line not-executable" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Verify calculator file is in report</div>
  </div>
  <div class="line covered" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(report_data.files[calculator_path]).to.exist(&quot;Calculator file should be in report&quot;)</div>
  </div>
  <div class="line not-executable" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Save reports in different formats</div>
  </div>
  <div class="line covered" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local report_dir = &quot;reports&quot;</div>
  </div>
  <div class="line covered" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if not fs.directory_exists(report_dir) then</div>
  </div>
  <div class="line covered" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      fs.create_directory(report_dir)</div>
  </div>
  <div class="line covered" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Save HTML report</div>
  </div>
  <div class="line covered" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local html_report_path = report_dir .. &quot;/block-relationship-fix.html&quot;</div>
  </div>
  <div class="line covered" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local saved, err = reporting.save_coverage_report(html_report_path, report_data, &quot;html&quot;)</div>
  </div>
  <div class="line covered" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(saved).to.be_truthy(&quot;HTML report should save successfully: &quot; .. tostring(err))</div>
  </div>
  <div class="line not-executable" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Save JSON report</div>
  </div>
  <div class="line covered" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local json_report_path = report_dir .. &quot;/block-relationship-fix.json&quot;</div>
  </div>
  <div class="line covered" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local saved_json, err_json = reporting.save_coverage_report(json_report_path, report_data, &quot;json&quot;)</div>
  </div>
  <div class="line covered" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(saved_json).to.be_truthy(&quot;JSON report should save successfully: &quot; .. tostring(err_json))</div>
  </div>
  <div class="line not-executable" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Save LCOV report</div>
  </div>
  <div class="line covered" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local lcov_report_path = report_dir .. &quot;/block-relationship-fix.lcov&quot;</div>
  </div>
  <div class="line covered" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local saved_lcov, err_lcov = reporting.save_coverage_report(lcov_report_path, report_data, &quot;lcov&quot;)</div>
  </div>
  <div class="line covered" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(saved_lcov).to.be_truthy(&quot;LCOV report should save successfully: &quot; .. tostring(err_lcov))</div>
  </div>
  <div class="line not-executable" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Save Cobertura report</div>
  </div>
  <div class="line covered" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local cobertura_report_path = report_dir .. &quot;/block-relationship-fix.cobertura&quot;</div>
  </div>
  <div class="line covered" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local saved_cobertura, err_cobertura = reporting.save_coverage_report(cobertura_report_path, report_data, &quot;cobertura&quot;)</div>
  </div>
  <div class="line covered" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(saved_cobertura).to.be_truthy(&quot;Cobertura report should save successfully: &quot; .. tostring(err_cobertura))</div>
  </div>
  <div class="line covered" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line not-executable" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  it(&quot;should track block relationships for calculator functions&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Execute all calculator functions to ensure they're tracked</div>
  </div>
  <div class="line covered" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local add_result = calculator.add(5, 10)</div>
  </div>
  <div class="line covered" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(add_result).to.equal(15)</div>
  </div>
  <div class="line not-executable" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local subtract_result = calculator.subtract(15, 7)</div>
  </div>
  <div class="line covered" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(subtract_result).to.equal(8)</div>
  </div>
  <div class="line not-executable" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local multiply_result = calculator.multiply(4, 5)</div>
  </div>
  <div class="line covered" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(multiply_result).to.equal(20)</div>
  </div>
  <div class="line not-executable" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local divide_result = calculator.divide(20, 4)</div>
  </div>
  <div class="line covered" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(divide_result).to.equal(5)</div>
  </div>
  <div class="line not-executable" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Call the block relationship fixing function directly</div>
  </div>
  <div class="line covered" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local stats = debug_hook.fix_block_relationships()</div>
  </div>
  <div class="line not-executable" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Verify that the function returned statistics</div>
  </div>
  <div class="line covered" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(stats).to.exist(&quot;Block relationship fixing should return statistics&quot;)</div>
  </div>
  <div class="line covered" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(stats.files_processed).to.be_greater_than(0, &quot;Should have processed files&quot;)</div>
  </div>
  <div class="line not-executable" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Process functions from our new module</div>
  </div>
  <div class="line covered" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local process_functions = require(&quot;lib.coverage.process_functions&quot;)</div>
  </div>
  <div class="line covered" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local func_stats = process_functions.process_functions_from_file(calculator_path)</div>
  </div>
  <div class="line not-executable" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Verify functions were identified</div>
  </div>
  <div class="line covered" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(func_stats.functions_identified).to.be_greater_than(0, &quot;Should have identified functions&quot;)</div>
  </div>
  <div class="line not-executable" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Get the coverage data to check block relationships</div>
  </div>
  <div class="line covered" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local coverage_data = debug_hook.get_coverage_data()</div>
  </div>
  <div class="line not-executable" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Verify file is tracked</div>
  </div>
  <div class="line covered" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(coverage_data.files[calculator_path]).to.exist(&quot;Calculator file should be in coverage data&quot;)</div>
  </div>
  <div class="line not-executable" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Verify function blocks are in the logical chunks</div>
  </div>
  <div class="line covered" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local logical_chunks = coverage_data.files[calculator_path].logical_chunks or {}</div>
  </div>
  <div class="line not-executable" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Print debug info about logical chunks</div>
  </div>
  <div class="line covered" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    print(&quot;Logical chunks:&quot;)</div>
  </div>
  <div class="line covered" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    for block_id, block_data in pairs(logical_chunks) do</div>
  </div>
  <div class="line covered" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count">2</div>    <div class="line-content">      print(&quot;  - &quot; .. block_id .. &quot;: &quot; .. (block_data.type or &quot;unknown&quot;) .. </div>
  </div>
  <div class="line covered" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count">2</div>    <div class="line-content">            &quot; (line &quot; .. (block_data.start_line or &quot;unknown&quot;) .. &quot;)&quot;)</div>
  </div>
  <div class="line covered" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Get the functions data</div>
  </div>
  <div class="line covered" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local functions = coverage_data.files[calculator_path].functions or {}</div>
  </div>
  <div class="line not-executable" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Print debug info about functions</div>
  </div>
  <div class="line covered" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    print(&quot;Functions tracked:&quot;)</div>
  </div>
  <div class="line covered" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    for func_id, func_data in pairs(functions) do</div>
  </div>
  <div class="line covered" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count">2</div>    <div class="line-content">      print(&quot;  - &quot; .. func_id .. &quot;: &quot; .. (func_data.name or &quot;unnamed&quot;) .. </div>
  </div>
  <div class="line covered" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count">2</div>    <div class="line-content">            &quot; (line &quot; .. (func_data.line or &quot;unknown&quot;) .. &quot;)&quot;)</div>
  </div>
  <div class="line covered" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Get function statistics</div>
  </div>
  <div class="line covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local function_stats = process_functions.get_function_stats()</div>
  </div>
  <div class="line covered" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    print(&quot;Function coverage stats:&quot;)</div>
  </div>
  <div class="line covered" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    print(&quot;  - Total functions:&quot;, function_stats.total_functions)</div>
  </div>
  <div class="line covered" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    print(&quot;  - Executed functions:&quot;, function_stats.executed_functions)</div>
  </div>
  <div class="line covered" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    print(&quot;  - Function coverage:&quot;, function_stats.function_coverage_percent .. &quot;%&quot;)</div>
  </div>
  <div class="line not-executable" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Verify the add function is tracked</div>
  </div>
  <div class="line covered" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local add_function_found = false</div>
  </div>
  <div class="line covered" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    for _, func_data in pairs(func_stats.functions) do</div>
  </div>
  <div class="line covered" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count">2</div>    <div class="line-content">      if func_data.line == 7 or (func_data.name and func_data.name:find(&quot;add&quot;)) then</div>
  </div>
  <div class="line covered" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count">2</div>    <div class="line-content">        add_function_found = true</div>
  </div>
  <div class="line covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">2</div>    <div class="line-content">        break</div>
  </div>
  <div class="line covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">2</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    expect(add_function_found).to.be_truthy(&quot;Add function should be tracked&quot;)</div>
  </div>
  <div class="line not-executable" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Verify that we have at least 4 functions tracked (add, subtract, multiply, divide)</div>
  </div>
  <div class="line covered" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    expect(func_stats.functions_identified &gt;= 4).to.be_truthy(&quot;Should track at least 4 functions (add, subtract, multiply, divide)&quot;)</div>
  </div>
  <div class="line covered" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line covered" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count">2</div>    <div class="line-content">end)</div>
  </div>
  <div class="line not-executable" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 145</div>
  </div>
</div>
<div class="source-code" id="file---lib-tools-filesystem-lua">
  <h3>./lib/tools/filesystem.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">2 / 943 (0%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 0%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">1 / 1 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 2252      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 943      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 1      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 1      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-tools-filesystem-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-tools-filesystem-lua" value="all" checked>
        All <span class="function-count">1</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-tools-filesystem-lua" value="executed">
        Executed <span class="function-count badge-success">1</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-tools-filesystem-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-tools-filesystem-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-tools-filesystem-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-tools-filesystem-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-tools-filesystem-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">1</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-tools-filesystem-lua" value="closure">
        Closure <span class="function-count function-type-closure">0</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-tools-filesystem-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="anonymous" data-executed="true">
          <td>anonymous <span class="function-type-badge function-type-anonymous">anonymous</span></td>
          <td>anonymous</td>
          <td><a href="#L221">221-228</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>2</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for filesystem.lua    const tableId = 'functions---lib-tools-filesystem-lua';
    const searchId = 'func-search---lib-tools-filesystem-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-tools-filesystem-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-tools-filesystem-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-tools-filesystem-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-tools-filesystem-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">--[[</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">    Filesystem - Platform-independent file and directory operations module</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">    A comprehensive, standalone filesystem module for Lua with minimal dependencies.</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">    This module provides a consistent, cross-platform interface for file and directory</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">    operations with robust error handling, path manipulation capabilities, and discovery</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">    functions.</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count"></div>    <div class="line-content">    Features:</div>
  </div>
  <div class="line not-executable" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - File operations: read, write, append, copy, move, delete</div>
  </div>
  <div class="line not-executable" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Directory operations: create, delete, list, scan recursively</div>
  </div>
  <div class="line not-executable" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Path manipulation: join, normalize, get components</div>
  </div>
  <div class="line not-executable" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - File discovery: pattern matching, glob support, recursive search</div>
  </div>
  <div class="line not-executable" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - File metadata: size, timestamps, existence checks</div>
  </div>
  <div class="line not-executable" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Error handling: consistent nil/error return pattern</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Platform independence: works on Windows, macOS, Linux</div>
  </div>
  <div class="line not-executable" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count"></div>    <div class="line-content">    Design principles:</div>
  </div>
  <div class="line not-executable" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Complete independence: Minimal imports from other modules</div>
  </div>
  <div class="line not-executable" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Generic interface: All functions usable in any Lua project</div>
  </div>
  <div class="line not-executable" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Minimal dependencies: Only relies on Lua standard library</div>
  </div>
  <div class="line not-executable" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Platform neutral: Works identically on all platforms</div>
  </div>
  <div class="line not-executable" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Comprehensive error handling: All functions return nil/error pairs on failure</div>
  </div>
  <div class="line not-executable" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Cross-version compatibility: Works with Lua 5.1+ and LuaJIT</div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @module filesystem</div>
  </div>
  <div class="line not-executable" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @author Firmo Team</div>
  </div>
  <div class="line not-executable" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @license MIT</div>
  </div>
  <div class="line not-executable" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @copyright 2023-2025</div>
  </div>
  <div class="line not-executable" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @version 0.2.5</div>
  </div>
  <div class="line not-executable" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count"></div>    <div class="line-content">]]</div>
  </div>
  <div class="line not-executable" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Filesystem module for cross-platform file and directory operations</div>
  </div>
  <div class="line not-executable" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Provides a comprehensive set of file operations with proper error handling:</div>
  </div>
  <div class="line not-executable" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - File operations: reading, writing, appending, copying, moving, and deleting files</div>
  </div>
  <div class="line not-executable" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Directory operations: creating, listing, scanning, and recursive removal</div>
  </div>
  <div class="line not-executable" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Path manipulation: joining, normalizing, extracting components</div>
  </div>
  <div class="line not-executable" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - File discovery: pattern matching, glob support, recursive search  </div>
  </div>
  <div class="line not-executable" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - File metadata: size, timestamps, existence checks</div>
  </div>
  <div class="line not-executable" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Platform independence: consistent behavior across Windows, macOS, and Linux</div>
  </div>
  <div class="line not-executable" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- All functions follow a consistent error handling pattern:</div>
  </div>
  <div class="line not-executable" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Success case: return result</div>
  </div>
  <div class="line not-executable" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Failure case: return nil, error_message</div>
  </div>
  <div class="line not-executable" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @class filesystem</div>
  </div>
  <div class="line not-executable" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field _VERSION string Module version</div>
  </div>
  <div class="line not-executable" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field read_file fun(file_path: string): string|nil, string? Read a file's entire contents as a string</div>
  </div>
  <div class="line not-executable" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field write_file fun(file_path: string, content: string): boolean|nil, string? Write a string to a file, creating parent directories if needed</div>
  </div>
  <div class="line not-executable" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field append_file fun(file_path: string, content: string): boolean|nil, string? Append a string to an existing file</div>
  </div>
  <div class="line not-executable" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field file_exists fun(file_path: string): boolean Check if a file exists and is readable</div>
  </div>
  <div class="line not-executable" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field directory_exists fun(dir_path: string): boolean Check if a directory exists and is accessible</div>
  </div>
  <div class="line not-executable" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field create_directory fun(dir_path: string): boolean|nil, string? Create a directory (and parent directories if needed)</div>
  </div>
  <div class="line not-executable" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field ensure_directory_exists fun(dir_path: string): boolean|nil, string? Create a directory if it doesn't exist</div>
  </div>
  <div class="line not-executable" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field remove_directory fun(dir_path: string, recursive?: boolean): boolean|nil, string? Remove a directory, with optional recursive deletion</div>
  </div>
  <div class="line not-executable" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field delete_directory fun(dir_path: string, recursive?: boolean): boolean|nil, string? Alias for remove_directory </div>
  </div>
  <div class="line not-executable" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field remove_file fun(file_path: string): boolean|nil, string? Remove a file</div>
  </div>
  <div class="line not-executable" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field delete_file fun(file_path: string): boolean|nil, string? Alias for remove_file</div>
  </div>
  <div class="line not-executable" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_directory_contents fun(dir_path: string): table|nil, string? Get all items in a directory</div>
  </div>
  <div class="line not-executable" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_directory_items fun(dir_path: string, include_hidden?: boolean): table&lt;number, string&gt;|nil, string? Get items in a directory</div>
  </div>
  <div class="line not-executable" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field list_files fun(dir_path: string, include_hidden?: boolean): string[]|nil, string? List files in a directory (non-recursive)</div>
  </div>
  <div class="line not-executable" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field list_files_recursive fun(dir_path: string, include_hidden?: boolean): string[]|nil, string? List files recursively in a directory and its subdirectories</div>
  </div>
  <div class="line not-executable" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field list_directories fun(dir_path: string, include_hidden?: boolean): table&lt;number, string&gt;|nil, string? List directories in a directory</div>
  </div>
  <div class="line not-executable" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_file_info fun(file_path: string): {size: number, modified: number, type: string, is_directory: boolean, is_file: boolean, is_link: boolean, permissions: string}|nil, string? Get detailed information about a file</div>
  </div>
  <div class="line not-executable" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_file_size fun(file_path: string): number|nil, string? Get the size of a file in bytes</div>
  </div>
  <div class="line not-executable" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_file_modified_time fun(file_path: string): number|nil, string? Get the last modified time of a file</div>
  </div>
  <div class="line not-executable" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_modified_time fun(file_path: string): number|nil, string? Alias for get_file_modified_time</div>
  </div>
  <div class="line not-executable" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_creation_time fun(file_path: string): number|nil, string? Get the creation time of a file (when available)</div>
  </div>
  <div class="line not-executable" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field copy_file fun(source_path: string, dest_path: string, overwrite?: boolean): boolean|nil, string? Copy a file from source to destination</div>
  </div>
  <div class="line not-executable" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field move_file fun(source_path: string, dest_path: string, overwrite?: boolean): boolean|nil, string? Move a file from source to destination</div>
  </div>
  <div class="line not-executable" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field rename fun(old_path: string, new_path: string): boolean|nil, string? Rename a file or directory</div>
  </div>
  <div class="line not-executable" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field normalize_path fun(path: string): string|nil Normalize a path (remove .., ., duplicate separators)</div>
  </div>
  <div class="line not-executable" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field join_paths fun(...: string): string|nil, string? Join multiple path components</div>
  </div>
  <div class="line not-executable" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_directory_name fun(file_path: string): string|nil Get the directory part of a path</div>
  </div>
  <div class="line not-executable" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_directory fun(file_path: string): string|nil Alias for get_directory_name</div>
  </div>
  <div class="line not-executable" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_file_name fun(file_path: string): string|nil, string? Get the filename part of a path</div>
  </div>
  <div class="line not-executable" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_filename fun(file_path: string): string|nil, string? Alias for get_file_name</div>
  </div>
  <div class="line not-executable" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_extension fun(file_path: string): string|nil, string? Get the extension of a file without the dot</div>
  </div>
  <div class="line not-executable" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_absolute_path fun(path: string): string|nil, string? Convert relative path to absolute path</div>
  </div>
  <div class="line not-executable" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_relative_path fun(path: string, base: string): string|nil Convert absolute path to relative path from base</div>
  </div>
  <div class="line not-executable" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_current_directory fun(): string|nil, string? Get the current working directory</div>
  </div>
  <div class="line not-executable" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field set_current_directory fun(dir_path: string): boolean|nil, string? Set the current working directory</div>
  </div>
  <div class="line not-executable" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field get_temp_directory fun(): string Get the system's temporary directory</div>
  </div>
  <div class="line not-executable" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field create_temp_file fun(prefix?: string, suffix?: string): string|nil, string? Create a temporary file</div>
  </div>
  <div class="line not-executable" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field create_temp_directory fun(prefix?: string): string|nil, string? Create a temporary directory</div>
  </div>
  <div class="line not-executable" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field glob fun(pattern: string, base_dir?: string): table&lt;number, string&gt;|nil, string? Find files matching a glob pattern</div>
  </div>
  <div class="line not-executable" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field glob_to_pattern fun(glob: string): string|nil Convert a glob pattern to a Lua pattern</div>
  </div>
  <div class="line not-executable" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field matches_pattern fun(path: string, pattern: string): boolean|nil, string? Check if a path matches a pattern</div>
  </div>
  <div class="line not-executable" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field find_files fun(dir_path: string, pattern: string, recursive?: boolean): table&lt;number, string&gt;|nil, string? Find files matching a pattern</div>
  </div>
  <div class="line not-executable" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field find_directories fun(dir_path: string, pattern: string, recursive?: boolean): table&lt;number, string&gt;|nil, string? Find directories matching a pattern</div>
  </div>
  <div class="line not-executable" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field discover_files fun(directories: table, patterns: table, exclude_patterns: table): table|nil, string? Advanced file discovery with include/exclude patterns</div>
  </div>
  <div class="line not-executable" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field scan_directory fun(path: string, recursive: boolean): table Scan a directory for files</div>
  </div>
  <div class="line not-executable" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field find_matches fun(files: table, pattern: string): table Filter a list of files by pattern</div>
  </div>
  <div class="line not-executable" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field is_file fun(path: string): boolean Check if a path is a file</div>
  </div>
  <div class="line not-executable" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field is_directory fun(path: string): boolean Check if a path is a directory</div>
  </div>
  <div class="line not-executable" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @field is_absolute_path fun(path: string): boolean Check if a path is absolute</div>
  </div>
  <div class="line not-executable" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @version 0.2.5</div>
  </div>
  <div class="line not-executable" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @author Firmo Team</div>
  </div>
  <div class="line not-executable" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class filesystem</div>
  </div>
  <div class="line not-executable" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field _VERSION string Module version</div>
  </div>
  <div class="line not-executable" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field read_file fun(file_path: string): string|nil, string? Read a file's contents as a string</div>
  </div>
  <div class="line not-executable" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field write_file fun(file_path: string, content: string): boolean, string? Write a string to a file</div>
  </div>
  <div class="line not-executable" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field append_file fun(file_path: string, content: string): boolean, string? Append a string to a file</div>
  </div>
  <div class="line not-executable" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field file_exists fun(file_path: string): boolean Check if a file exists</div>
  </div>
  <div class="line not-executable" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field directory_exists fun(dir_path: string): boolean Check if a directory exists</div>
  </div>
  <div class="line not-executable" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field create_directory fun(dir_path: string): boolean, string? Create a directory (and parent directories if needed)</div>
  </div>
  <div class="line not-executable" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field remove_directory fun(dir_path: string, recursive?: boolean): boolean, string? Remove a directory</div>
  </div>
  <div class="line not-executable" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field remove_file fun(file_path: string): boolean, string? Remove a file</div>
  </div>
  <div class="line not-executable" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_directory_items fun(dir_path: string, include_hidden?: boolean): table&lt;number, string&gt;, string? Get items in a directory</div>
  </div>
  <div class="line not-executable" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field list_files fun(dir_path: string, include_hidden?: boolean): string[]|nil, string? List files in a directory (non-recursive)</div>
  </div>
  <div class="line not-executable" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field list_files_recursive fun(dir_path: string, include_hidden?: boolean): string[]|nil, string? List files recursively in a directory and its subdirectories</div>
  </div>
  <div class="line not-executable" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field list_directories fun(dir_path: string, include_hidden?: boolean): table&lt;number, string&gt;, string? List directories in a directory</div>
  </div>
  <div class="line not-executable" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_file_info fun(file_path: string): {size: number, modified: number, type: string, is_directory: boolean, is_file: boolean, is_link: boolean, permissions: string}|nil, string? Get information about a file</div>
  </div>
  <div class="line not-executable" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_file_size fun(file_path: string): number|nil, string? Get the size of a file in bytes</div>
  </div>
  <div class="line not-executable" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_file_modified_time fun(file_path: string): number|nil, string? Get the last modified time of a file</div>
  </div>
  <div class="line not-executable" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field copy_file fun(source_path: string, dest_path: string, overwrite?: boolean): boolean, string? Copy a file</div>
  </div>
  <div class="line not-executable" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field move_file fun(source_path: string, dest_path: string, overwrite?: boolean): boolean, string? Move a file</div>
  </div>
  <div class="line not-executable" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field rename fun(old_path: string, new_path: string): boolean, string? Rename a file or directory</div>
  </div>
  <div class="line not-executable" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field normalize_path fun(path: string): string Normalize a path (remove .., ., duplicate separators)</div>
  </div>
  <div class="line not-executable" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field join_paths fun(...: string): string Join path components</div>
  </div>
  <div class="line not-executable" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_directory fun(file_path: string): string Get the directory part of a path</div>
  </div>
  <div class="line not-executable" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_filename fun(file_path: string): string Get the filename part of a path</div>
  </div>
  <div class="line not-executable" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_extension fun(file_path: string): string Get the extension of a file</div>
  </div>
  <div class="line not-executable" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field change_extension fun(file_path: string, new_ext: string): string Change the extension of a file</div>
  </div>
  <div class="line not-executable" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_current_directory fun(): string|nil, string? Get the current working directory</div>
  </div>
  <div class="line not-executable" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field set_current_directory fun(dir_path: string): boolean, string? Set the current working directory</div>
  </div>
  <div class="line not-executable" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_temp_directory fun(): string Get the system's temporary directory</div>
  </div>
  <div class="line not-executable" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field create_temp_file fun(prefix?: string, suffix?: string): string|nil, string? Create a temporary file</div>
  </div>
  <div class="line not-executable" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field create_temp_directory fun(prefix?: string): string|nil, string? Create a temporary directory</div>
  </div>
  <div class="line not-executable" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field glob fun(pattern: string, base_dir?: string): table&lt;number, string&gt;, string? Find files matching a glob pattern</div>
  </div>
  <div class="line not-executable" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field find_files fun(dir_path: string, pattern: string, recursive?: boolean): table&lt;number, string&gt;, string? Find files matching a pattern</div>
  </div>
  <div class="line not-executable" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field find_directories fun(dir_path: string, pattern: string, recursive?: boolean): table&lt;number, string&gt;, string? Find directories matching a pattern</div>
  </div>
  <div class="line not-executable" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_absolute_path fun(path: string): boolean Check if a path is absolute</div>
  </div>
  <div class="line not-executable" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Import error_handler for proper error handling</div>
  </div>
  <div class="line not-covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local error_handler = require(&quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line not-executable" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Implementation of the filesystem module</div>
  </div>
  <div class="line not-executable" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- This local table will hold all the filesystem functions and be returned at the end of the file</div>
  </div>
  <div class="line not-executable" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- All JSDoc annotations are provided in the class definition at the top of the file</div>
  </div>
  <div class="line not-covered" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local fs = {}</div>
  </div>
  <div class="line not-executable" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Module version</div>
  </div>
  <div class="line not-covered" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count">0</div>    <div class="line-content">fs._VERSION = &quot;0.2.5&quot;</div>
  </div>
  <div class="line not-executable" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Internal utility functions</div>
  </div>
  <div class="line not-executable" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Detect if running on Windows operating system</div>
  </div>
  <div class="line not-executable" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function checks the Lua environment to determine if the code</div>
  </div>
  <div class="line not-executable" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- is running on Windows by examining the path separator character</div>
  </div>
  <div class="line not-executable" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- in package.config, which is OS-specific.</div>
  </div>
  <div class="line not-executable" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean True if running on Windows, false otherwise</div>
  </div>
  <div class="line not-covered" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function is_windows()</div>
  </div>
  <div class="line not-covered" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return package.config:sub(1,1) == '\\'</div>
  </div>
  <div class="line not-covered" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Platform-specific path separator character</div>
  </div>
  <div class="line not-executable" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @type string</div>
  </div>
  <div class="line not-covered" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local path_separator = is_windows() and '\\' or '/'</div>
  </div>
  <div class="line not-executable" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Safely execute an I/O operation with error handling</div>
  </div>
  <div class="line not-executable" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This utility function wraps I/O operations in a pcall to catch errors,</div>
  </div>
  <div class="line not-executable" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- provides consistent error handling, and filters out common permission</div>
  </div>
  <div class="line not-executable" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- denied errors to avoid flooding logs. All filesystem module functions</div>
  </div>
  <div class="line not-executable" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- should use this wrapper for consistent error handling.</div>
  </div>
  <div class="line not-executable" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @generic T</div>
  </div>
  <div class="line not-executable" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param action fun(...): T The I/O operation function to execute safely</div>
  </div>
  <div class="line not-executable" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param ... any Additional arguments to pass to the action function</div>
  </div>
  <div class="line not-executable" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return T|nil result The result of the action function or nil on error</div>
  </div>
  <div class="line not-executable" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error An error message if the action failed</div>
  </div>
  <div class="line not-covered" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function safe_io_action(action, ...)</div>
  </div>
  <div class="line not-covered" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local status, result, err = pcall(action, ...)</div>
  </div>
  <div class="line not-covered" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not status then</div>
  </div>
  <div class="line not-executable" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Don't output &quot;Permission denied&quot; errors as they flood the output</div>
  </div>
  <div class="line not-covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not result:match(&quot;Permission denied&quot;) then</div>
  </div>
  <div class="line not-covered" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, result</div>
  </div>
  <div class="line not-covered" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, nil -- Return nil, nil for permission denied errors</div>
  </div>
  <div class="line not-covered" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    if not result and err then</div>
  </div>
  <div class="line not-executable" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Don't output &quot;Permission denied&quot; errors</div>
  </div>
  <div class="line not-covered" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not (err and err:match(&quot;Permission denied&quot;)) then</div>
  </div>
  <div class="line not-covered" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, err</div>
  </div>
  <div class="line not-covered" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, nil -- Return nil, nil for permission denied errors</div>
  </div>
  <div class="line not-covered" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line covered" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count">2</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Core File Operations</div>
  </div>
  <div class="line not-executable" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Read a file's entire contents as a string</div>
  </div>
  <div class="line not-executable" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function reads the entire contents of the specified file and returns it as a string.</div>
  </div>
  <div class="line not-executable" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It handles error checking and proper file closing even in error cases.</div>
  </div>
  <div class="line not-executable" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the file to read</div>
  </div>
  <div class="line not-executable" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil content File contents or nil if an error occurred</div>
  </div>
  <div class="line not-executable" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if reading failed</div>
  </div>
  <div class="line not-executable" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Read a configuration file</div>
  </div>
  <div class="line not-executable" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local content, err = fs.read_file(&quot;/path/to/config.json&quot;)</div>
  </div>
  <div class="line not-executable" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not content then</div>
  </div>
  <div class="line not-executable" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error reading file: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Process the content</div>
  </div>
  <div class="line not-executable" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local config = json.decode(content)</div>
  </div>
  <div class="line not-covered" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.read_file(path)</div>
  </div>
  <div class="line not-covered" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return safe_io_action(function(file_path)</div>
  </div>
  <div class="line not-covered" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local file, err = io.open(file_path, &quot;r&quot;)</div>
  </div>
  <div class="line not-covered" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not file then return nil, err end</div>
  </div>
  <div class="line not-executable" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local content = file:read(&quot;*a&quot;)</div>
  </div>
  <div class="line not-covered" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file:close()</div>
  </div>
  <div class="line not-covered" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return content</div>
  </div>
  <div class="line not-covered" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end, path)</div>
  </div>
  <div class="line not-covered" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Write string content to a file, creating it if it doesn't exist</div>
  </div>
  <div class="line not-executable" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function writes a string to the specified file, creating any necessary</div>
  </div>
  <div class="line not-executable" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- parent directories automatically. If the file already exists, it will be overwritten.</div>
  </div>
  <div class="line not-executable" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the file to write</div>
  </div>
  <div class="line not-executable" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param content string Content to write to the file</div>
  </div>
  <div class="line not-executable" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean|nil success True if write was successful, nil on error</div>
  </div>
  <div class="line not-executable" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if writing failed</div>
  </div>
  <div class="line not-executable" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Write a configuration file</div>
  </div>
  <div class="line not-executable" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = fs.write_file(&quot;/path/to/config.json&quot;, json.encode(config_data))</div>
  </div>
  <div class="line not-executable" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error writing file: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Create a new file in a directory that might not exist yet</div>
  </div>
  <div class="line not-executable" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fs.write_file(&quot;/new/directory/structure/file.txt&quot;, &quot;This will create all needed directories&quot;)</div>
  </div>
  <div class="line not-covered" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.write_file(path, content)</div>
  </div>
  <div class="line not-covered" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return safe_io_action(function(file_path, data)</div>
  </div>
  <div class="line not-executable" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Validate file path</div>
  </div>
  <div class="line not-covered" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not file_path or file_path == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Invalid file path: path cannot be empty&quot;</div>
  </div>
  <div class="line not-covered" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Check for invalid characters in path that might cause issues</div>
  </div>
  <div class="line not-covered" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if file_path:match(&quot;[*?&lt;&gt;|]&quot;) then</div>
  </div>
  <div class="line not-covered" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Invalid directory path: contains invalid characters&quot;</div>
  </div>
  <div class="line not-covered" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Ensure parent directory exists</div>
  </div>
  <div class="line not-covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local dir = fs.get_directory_name(file_path)</div>
  </div>
  <div class="line not-covered" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if dir and dir ~= &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local success, err = fs.ensure_directory_exists(dir)</div>
  </div>
  <div class="line not-covered" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not success then return nil, err end</div>
  </div>
  <div class="line not-covered" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local file, err = io.open(file_path, &quot;w&quot;)</div>
  </div>
  <div class="line not-covered" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not file then return nil, err end</div>
  </div>
  <div class="line not-executable" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file:write(data)</div>
  </div>
  <div class="line not-covered" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file:close()</div>
  </div>
  <div class="line not-covered" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end, path, content)</div>
  </div>
  <div class="line not-covered" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Append string content to the end of a file</div>
  </div>
  <div class="line not-executable" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function appends a string to the end of the specified file. If the file</div>
  </div>
  <div class="line not-executable" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- doesn't exist, it will be created along with any necessary parent directories.</div>
  </div>
  <div class="line not-executable" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the file to append to</div>
  </div>
  <div class="line not-executable" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param content string Content to append to the file</div>
  </div>
  <div class="line not-executable" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean|nil success True if append was successful, nil on error</div>
  </div>
  <div class="line not-executable" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if appending failed</div>
  </div>
  <div class="line not-executable" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Append a line to a log file</div>
  </div>
  <div class="line not-executable" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = fs.append_file(&quot;/var/log/myapp.log&quot;, &quot;INFO [2023-12-31]: Application started\n&quot;)</div>
  </div>
  <div class="line not-executable" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error appending to log: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Collect data over time</div>
  </div>
  <div class="line not-executable" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fs.append_file(&quot;data_collection.csv&quot;, new_data_point .. &quot;\n&quot;)</div>
  </div>
  <div class="line not-covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.append_file(path, content)</div>
  </div>
  <div class="line not-covered" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return safe_io_action(function(file_path, data)</div>
  </div>
  <div class="line not-executable" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Ensure parent directory exists</div>
  </div>
  <div class="line not-covered" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local dir = fs.get_directory_name(file_path)</div>
  </div>
  <div class="line not-covered" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if dir and dir ~= &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local success, err = fs.ensure_directory_exists(dir)</div>
  </div>
  <div class="line not-covered" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not success then return nil, err end</div>
  </div>
  <div class="line not-covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local file, err = io.open(file_path, &quot;a&quot;)</div>
  </div>
  <div class="line not-covered" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not file then return nil, err end</div>
  </div>
  <div class="line not-executable" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file:write(data)</div>
  </div>
  <div class="line not-covered" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file:close()</div>
  </div>
  <div class="line not-covered" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end, path, content)</div>
  </div>
  <div class="line not-covered" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Copy a file from source to destination path</div>
  </div>
  <div class="line not-executable" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function copies a file from one location to another, creating any</div>
  </div>
  <div class="line not-executable" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- necessary parent directories for the destination. It verifies that the</div>
  </div>
  <div class="line not-executable" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- source file exists and that the copy operation is successful by checking</div>
  </div>
  <div class="line not-executable" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- content integrity.</div>
  </div>
  <div class="line not-executable" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param source string Path to the source file</div>
  </div>
  <div class="line not-executable" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param destination string Path to the destination file</div>
  </div>
  <div class="line not-executable" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean|nil success True if copy was successful, nil on error</div>
  </div>
  <div class="line not-executable" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if copying failed</div>
  </div>
  <div class="line not-executable" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Copy a configuration file to a backup location</div>
  </div>
  <div class="line not-executable" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = fs.copy_file(&quot;/etc/app/config.json&quot;, &quot;/etc/app/backups/config.json.bak&quot;)</div>
  </div>
  <div class="line not-executable" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Backup failed: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Copy a template file to a new user's directory</div>
  </div>
  <div class="line not-executable" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fs.copy_file(&quot;/templates/default_profile.json&quot;, &quot;/users/new_user/profile.json&quot;)</div>
  </div>
  <div class="line not-covered" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.copy_file(source, destination)</div>
  </div>
  <div class="line not-covered" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return safe_io_action(function(src, dst)</div>
  </div>
  <div class="line not-covered" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not fs.file_exists(src) then</div>
  </div>
  <div class="line not-covered" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Source file does not exist: &quot; .. src</div>
  </div>
  <div class="line not-covered" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Read source content</div>
  </div>
  <div class="line not-covered" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local content, err = fs.read_file(src)</div>
  </div>
  <div class="line not-covered" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not content then</div>
  </div>
  <div class="line not-covered" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Failed to read source file: &quot; .. (err or &quot;unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Write to destination</div>
  </div>
  <div class="line not-covered" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local success, write_err = fs.write_file(dst, content)</div>
  </div>
  <div class="line not-covered" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not success then</div>
  </div>
  <div class="line not-covered" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Failed to write destination file: &quot; .. (write_err or &quot;unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end, source, destination)</div>
  </div>
  <div class="line not-covered" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Move or rename a file from source to destination path</div>
  </div>
  <div class="line not-executable" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function moves a file from one location to another. It first attempts </div>
  </div>
  <div class="line not-executable" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- to use the efficient os.rename operation, but if that fails (e.g., when moving</div>
  </div>
  <div class="line not-executable" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- across filesystems), it falls back to a copy-and-delete approach. Any necessary</div>
  </div>
  <div class="line not-executable" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- parent directories for the destination will be created automatically.</div>
  </div>
  <div class="line not-executable" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param source string Path to the source file</div>
  </div>
  <div class="line not-executable" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param destination string Path to the destination file</div>
  </div>
  <div class="line not-executable" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean|nil success True if move was successful, nil on error</div>
  </div>
  <div class="line not-executable" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if moving failed</div>
  </div>
  <div class="line not-executable" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Move a temporary file to its final location</div>
  </div>
  <div class="line not-executable" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = fs.move_file(&quot;/tmp/uploaded_file.dat&quot;, &quot;/data/processed/file001.dat&quot;)</div>
  </div>
  <div class="line not-executable" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Failed to move file: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Rename a file in the same directory</div>
  </div>
  <div class="line not-executable" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fs.move_file(&quot;old_name.txt&quot;, &quot;new_name.txt&quot;)</div>
  </div>
  <div class="line not-covered" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.move_file(source, destination)</div>
  </div>
  <div class="line not-covered" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return safe_io_action(function(src, dst)</div>
  </div>
  <div class="line not-covered" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not fs.file_exists(src) then</div>
  </div>
  <div class="line not-covered" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Source file does not exist: &quot; .. src</div>
  </div>
  <div class="line not-covered" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Ensure parent directory exists for destination</div>
  </div>
  <div class="line not-covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local dir = fs.get_directory_name(dst)</div>
  </div>
  <div class="line not-covered" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if dir and dir ~= &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local success, err = fs.ensure_directory_exists(dir)</div>
  </div>
  <div class="line not-covered" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not success then return nil, err end</div>
  </div>
  <div class="line not-covered" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Try using os.rename first (most efficient)</div>
  </div>
  <div class="line not-covered" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local ok, err = os.rename(src, dst)</div>
  </div>
  <div class="line not-covered" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if ok then return true end</div>
  </div>
  <div class="line not-executable" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- If rename fails (potentially across filesystems), fall back to copy+delete</div>
  </div>
  <div class="line not-covered" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local success, copy_err = fs.copy_file(src, dst)</div>
  </div>
  <div class="line not-covered" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not success then</div>
  </div>
  <div class="line not-covered" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Failed to move file (fallback copy): &quot; .. (copy_err or &quot;unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local del_success, del_err = fs.delete_file(src)</div>
  </div>
  <div class="line not-covered" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not del_success then</div>
  </div>
  <div class="line not-executable" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- We copied successfully but couldn't delete source</div>
  </div>
  <div class="line not-covered" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;File copied but failed to delete source: &quot; .. (del_err or &quot;unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end, source, destination)</div>
  </div>
  <div class="line not-covered" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Delete a file with error checking</div>
  </div>
  <div class="line not-executable" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function deletes the specified file from the filesystem. If the file</div>
  </div>
  <div class="line not-executable" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- doesn't exist, the operation is considered successful. The function provides</div>
  </div>
  <div class="line not-executable" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- proper error handling for permissions and other common deletion issues.</div>
  </div>
  <div class="line not-executable" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the file to delete</div>
  </div>
  <div class="line not-executable" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean|nil success True if deletion was successful, nil on error</div>
  </div>
  <div class="line not-executable" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if deletion failed</div>
  </div>
  <div class="line not-executable" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Delete a temporary file</div>
  </div>
  <div class="line not-executable" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = fs.delete_file(&quot;/tmp/temp_data.txt&quot;)</div>
  </div>
  <div class="line not-executable" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Failed to delete file: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Clean up after processing</div>
  </div>
  <div class="line not-executable" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if process_complete then</div>
  </div>
  <div class="line not-executable" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   fs.delete_file(temp_file_path)</div>
  </div>
  <div class="line not-executable" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.delete_file(path)</div>
  </div>
  <div class="line not-covered" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return safe_io_action(function(file_path)</div>
  </div>
  <div class="line not-covered" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not fs.file_exists(file_path) then</div>
  </div>
  <div class="line not-covered" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return true -- Already gone, consider it a success</div>
  </div>
  <div class="line not-covered" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local ok, err = os.remove(file_path)</div>
  </div>
  <div class="line not-covered" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not ok then</div>
  </div>
  <div class="line not-covered" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, err or &quot;Failed to delete file&quot;</div>
  </div>
  <div class="line not-covered" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end, path)</div>
  </div>
  <div class="line not-covered" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Directory Operations</div>
  </div>
  <div class="line not-executable" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a directory with recursive parent directory creation</div>
  </div>
  <div class="line not-executable" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function creates a directory at the specified path. If parent directories</div>
  </div>
  <div class="line not-executable" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- in the path don't exist, they will be created automatically. This function</div>
  </div>
  <div class="line not-executable" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- handles validation, normalization, and platform-specific directory creation.</div>
  </div>
  <div class="line not-executable" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the directory to create</div>
  </div>
  <div class="line not-executable" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean|nil success True if creation was successful, nil on error</div>
  </div>
  <div class="line not-executable" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if creation failed</div>
  </div>
  <div class="line not-executable" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Create a nested directory structure</div>
  </div>
  <div class="line not-executable" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = fs.create_directory(&quot;/data/application/logs/daily&quot;)</div>
  </div>
  <div class="line not-executable" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Failed to create directory: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Create a directory for user data</div>
  </div>
  <div class="line not-executable" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fs.create_directory(home_dir .. &quot;/app_data/user_profiles&quot;)</div>
  </div>
  <div class="line not-covered" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.create_directory(path)</div>
  </div>
  <div class="line not-covered" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return safe_io_action(function(dir_path)</div>
  </div>
  <div class="line not-executable" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Validate path</div>
  </div>
  <div class="line not-covered" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not dir_path or dir_path == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Invalid directory path: path cannot be empty&quot;</div>
  </div>
  <div class="line not-covered" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Check for invalid characters in path that might cause issues</div>
  </div>
  <div class="line not-covered" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if dir_path:match(&quot;[*?&lt;&gt;|]&quot;) then</div>
  </div>
  <div class="line not-covered" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Invalid directory path: contains invalid characters&quot;</div>
  </div>
  <div class="line not-covered" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if fs.directory_exists(dir_path) then</div>
  </div>
  <div class="line not-covered" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return true -- Already exists</div>
  </div>
  <div class="line not-covered" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Normalize path first to handle trailing slashes</div>
  </div>
  <div class="line not-covered" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local normalized_path = fs.normalize_path(dir_path)</div>
  </div>
  <div class="line not-executable" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Handle recursive creation</div>
  </div>
  <div class="line not-covered" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local parent = fs.get_directory_name(normalized_path)</div>
  </div>
  <div class="line not-covered" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if parent and parent ~= &quot;&quot; and not fs.directory_exists(parent) then</div>
  </div>
  <div class="line not-covered" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local success, err = fs.create_directory(parent)</div>
  </div>
  <div class="line not-covered" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not success then</div>
  </div>
  <div class="line not-covered" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return nil, &quot;Failed to create parent directory: &quot; .. (err or &quot;unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L478">
    <div class="line-number"><a href="#L478">478</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Create this directory</div>
  </div>
  <div class="line not-covered" id="L479">
    <div class="line-number"><a href="#L479">479</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local result, err = nil, nil</div>
  </div>
  <div class="line not-covered" id="L480">
    <div class="line-number"><a href="#L480">480</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if is_windows() then</div>
  </div>
  <div class="line not-executable" id="L481">
    <div class="line-number"><a href="#L481">481</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Use mkdir command on Windows</div>
  </div>
  <div class="line not-covered" id="L482">
    <div class="line-number"><a href="#L482">482</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            result = os.execute('mkdir &quot;' .. normalized_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L483">
    <div class="line-number"><a href="#L483">483</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not result then</div>
  </div>
  <div class="line not-covered" id="L484">
    <div class="line-number"><a href="#L484">484</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                err = &quot;Failed to create directory using command: mkdir&quot;</div>
  </div>
  <div class="line not-covered" id="L485">
    <div class="line-number"><a href="#L485">485</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L486">
    <div class="line-number"><a href="#L486">486</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L487">
    <div class="line-number"><a href="#L487">487</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Use mkdir command on Unix-like systems</div>
  </div>
  <div class="line not-covered" id="L488">
    <div class="line-number"><a href="#L488">488</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            result = os.execute('mkdir -p &quot;' .. normalized_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L489">
    <div class="line-number"><a href="#L489">489</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not result then</div>
  </div>
  <div class="line not-covered" id="L490">
    <div class="line-number"><a href="#L490">490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                err = &quot;Failed to create directory using command: mkdir -p&quot;</div>
  </div>
  <div class="line not-covered" id="L491">
    <div class="line-number"><a href="#L491">491</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L492">
    <div class="line-number"><a href="#L492">492</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L493">
    <div class="line-number"><a href="#L493">493</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L494">
    <div class="line-number"><a href="#L494">494</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not result then</div>
  </div>
  <div class="line not-covered" id="L495">
    <div class="line-number"><a href="#L495">495</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, err or &quot;Unknown error creating directory&quot;</div>
  </div>
  <div class="line not-covered" id="L496">
    <div class="line-number"><a href="#L496">496</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L497">
    <div class="line-number"><a href="#L497">497</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L498">
    <div class="line-number"><a href="#L498">498</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L499">
    <div class="line-number"><a href="#L499">499</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end, path)</div>
  </div>
  <div class="line not-covered" id="L500">
    <div class="line-number"><a href="#L500">500</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L501">
    <div class="line-number"><a href="#L501">501</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Ensure a directory exists, creating it if necessary</div>
  </div>
  <div class="line not-executable" id="L502">
    <div class="line-number"><a href="#L502">502</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This is a convenience function that checks if a directory exists and creates</div>
  </div>
  <div class="line not-executable" id="L503">
    <div class="line-number"><a href="#L503">503</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- it if it doesn't. It's useful for ensuring that a directory is available before</div>
  </div>
  <div class="line not-executable" id="L504">
    <div class="line-number"><a href="#L504">504</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- performing operations that require it.</div>
  </div>
  <div class="line not-executable" id="L505">
    <div class="line-number"><a href="#L505">505</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L506">
    <div class="line-number"><a href="#L506">506</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to ensure exists</div>
  </div>
  <div class="line not-executable" id="L507">
    <div class="line-number"><a href="#L507">507</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean|nil success True if directory exists or was created, nil on error</div>
  </div>
  <div class="line not-executable" id="L508">
    <div class="line-number"><a href="#L508">508</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if creation failed</div>
  </div>
  <div class="line not-executable" id="L509">
    <div class="line-number"><a href="#L509">509</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L510">
    <div class="line-number"><a href="#L510">510</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L511">
    <div class="line-number"><a href="#L511">511</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Make sure a data directory exists before writing files</div>
  </div>
  <div class="line not-executable" id="L512">
    <div class="line-number"><a href="#L512">512</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = fs.ensure_directory_exists(&quot;/var/data/app_logs&quot;)</div>
  </div>
  <div class="line not-executable" id="L513">
    <div class="line-number"><a href="#L513">513</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L514">
    <div class="line-number"><a href="#L514">514</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Cannot access or create log directory: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L515">
    <div class="line-number"><a href="#L515">515</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L516">
    <div class="line-number"><a href="#L516">516</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L517">
    <div class="line-number"><a href="#L517">517</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L518">
    <div class="line-number"><a href="#L518">518</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Write file only if the directory exists or can be created</div>
  </div>
  <div class="line not-executable" id="L519">
    <div class="line-number"><a href="#L519">519</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if fs.ensure_directory_exists(output_dir) then</div>
  </div>
  <div class="line not-executable" id="L520">
    <div class="line-number"><a href="#L520">520</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   fs.write_file(output_dir .. &quot;/output.txt&quot;, &quot;Content&quot;)</div>
  </div>
  <div class="line not-executable" id="L521">
    <div class="line-number"><a href="#L521">521</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L522">
    <div class="line-number"><a href="#L522">522</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.ensure_directory_exists(path)</div>
  </div>
  <div class="line not-executable" id="L523">
    <div class="line-number"><a href="#L523">523</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Validate path</div>
  </div>
  <div class="line not-covered" id="L524">
    <div class="line-number"><a href="#L524">524</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path or path == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L525">
    <div class="line-number"><a href="#L525">525</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Invalid directory path: path cannot be empty&quot;</div>
  </div>
  <div class="line not-covered" id="L526">
    <div class="line-number"><a href="#L526">526</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L527">
    <div class="line-number"><a href="#L527">527</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L528">
    <div class="line-number"><a href="#L528">528</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if fs.directory_exists(path) then</div>
  </div>
  <div class="line not-covered" id="L529">
    <div class="line-number"><a href="#L529">529</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L530">
    <div class="line-number"><a href="#L530">530</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L531">
    <div class="line-number"><a href="#L531">531</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return fs.create_directory(path)</div>
  </div>
  <div class="line not-covered" id="L532">
    <div class="line-number"><a href="#L532">532</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L533">
    <div class="line-number"><a href="#L533">533</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Delete a directory, with optional recursive deletion</div>
  </div>
  <div class="line not-executable" id="L534">
    <div class="line-number"><a href="#L534">534</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function removes a directory from the filesystem. If recursive is true,</div>
  </div>
  <div class="line not-executable" id="L535">
    <div class="line-number"><a href="#L535">535</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- the directory and all its contents (files and subdirectories) will be deleted.</div>
  </div>
  <div class="line not-executable" id="L536">
    <div class="line-number"><a href="#L536">536</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- If recursive is false, the directory must be empty for deletion to succeed.</div>
  </div>
  <div class="line not-executable" id="L537">
    <div class="line-number"><a href="#L537">537</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L538">
    <div class="line-number"><a href="#L538">538</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the directory to delete</div>
  </div>
  <div class="line not-executable" id="L539">
    <div class="line-number"><a href="#L539">539</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param recursive boolean If true, recursively delete contents</div>
  </div>
  <div class="line not-executable" id="L540">
    <div class="line-number"><a href="#L540">540</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean|nil success True if deletion was successful, nil on error</div>
  </div>
  <div class="line not-executable" id="L541">
    <div class="line-number"><a href="#L541">541</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if deletion failed</div>
  </div>
  <div class="line not-executable" id="L542">
    <div class="line-number"><a href="#L542">542</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L543">
    <div class="line-number"><a href="#L543">543</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L544">
    <div class="line-number"><a href="#L544">544</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Safely remove an empty directory</div>
  </div>
  <div class="line not-executable" id="L545">
    <div class="line-number"><a href="#L545">545</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = fs.delete_directory(&quot;/tmp/empty_dir&quot;, false)</div>
  </div>
  <div class="line not-executable" id="L546">
    <div class="line-number"><a href="#L546">546</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L547">
    <div class="line-number"><a href="#L547">547</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Failed to delete directory: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L548">
    <div class="line-number"><a href="#L548">548</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L549">
    <div class="line-number"><a href="#L549">549</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L550">
    <div class="line-number"><a href="#L550">550</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Recursively delete a directory and all its contents</div>
  </div>
  <div class="line not-executable" id="L551">
    <div class="line-number"><a href="#L551">551</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fs.delete_directory(&quot;/tmp/build_artifacts&quot;, true)</div>
  </div>
  <div class="line not-covered" id="L552">
    <div class="line-number"><a href="#L552">552</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.delete_directory(path, recursive)</div>
  </div>
  <div class="line not-covered" id="L553">
    <div class="line-number"><a href="#L553">553</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return safe_io_action(function(dir_path, recurse)</div>
  </div>
  <div class="line not-covered" id="L554">
    <div class="line-number"><a href="#L554">554</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not fs.directory_exists(dir_path) then</div>
  </div>
  <div class="line not-covered" id="L555">
    <div class="line-number"><a href="#L555">555</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return true -- Already gone, consider it a success</div>
  </div>
  <div class="line not-covered" id="L556">
    <div class="line-number"><a href="#L556">556</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L557">
    <div class="line-number"><a href="#L557">557</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L558">
    <div class="line-number"><a href="#L558">558</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if recurse then</div>
  </div>
  <div class="line not-covered" id="L559">
    <div class="line-number"><a href="#L559">559</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local result, err = nil, nil</div>
  </div>
  <div class="line not-covered" id="L560">
    <div class="line-number"><a href="#L560">560</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if is_windows() then</div>
  </div>
  <div class="line not-executable" id="L561">
    <div class="line-number"><a href="#L561">561</a></div>
    <div class="execution-count"></div>    <div class="line-content">                -- Use rmdir /s /q command on Windows</div>
  </div>
  <div class="line not-covered" id="L562">
    <div class="line-number"><a href="#L562">562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                result = os.execute('rmdir /s /q &quot;' .. dir_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L563">
    <div class="line-number"><a href="#L563">563</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if not result then</div>
  </div>
  <div class="line not-covered" id="L564">
    <div class="line-number"><a href="#L564">564</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    err = &quot;Failed to remove directory using command: rmdir /s /q&quot;</div>
  </div>
  <div class="line not-covered" id="L565">
    <div class="line-number"><a href="#L565">565</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L566">
    <div class="line-number"><a href="#L566">566</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            else</div>
  </div>
  <div class="line not-executable" id="L567">
    <div class="line-number"><a href="#L567">567</a></div>
    <div class="execution-count"></div>    <div class="line-content">                -- Use rm -rf command on Unix-like systems</div>
  </div>
  <div class="line not-covered" id="L568">
    <div class="line-number"><a href="#L568">568</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                result = os.execute('rm -rf &quot;' .. dir_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L569">
    <div class="line-number"><a href="#L569">569</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if not result then</div>
  </div>
  <div class="line not-covered" id="L570">
    <div class="line-number"><a href="#L570">570</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    err = &quot;Failed to remove directory using command: rm -rf&quot;</div>
  </div>
  <div class="line not-covered" id="L571">
    <div class="line-number"><a href="#L571">571</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L572">
    <div class="line-number"><a href="#L572">572</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L573">
    <div class="line-number"><a href="#L573">573</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L574">
    <div class="line-number"><a href="#L574">574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not result then</div>
  </div>
  <div class="line not-covered" id="L575">
    <div class="line-number"><a href="#L575">575</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return nil, err or &quot;Unknown error removing directory&quot;</div>
  </div>
  <div class="line not-covered" id="L576">
    <div class="line-number"><a href="#L576">576</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L577">
    <div class="line-number"><a href="#L577">577</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L578">
    <div class="line-number"><a href="#L578">578</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Non-recursive deletion</div>
  </div>
  <div class="line not-covered" id="L579">
    <div class="line-number"><a href="#L579">579</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local contents = fs.get_directory_contents(dir_path)</div>
  </div>
  <div class="line not-covered" id="L580">
    <div class="line-number"><a href="#L580">580</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if #contents &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L581">
    <div class="line-number"><a href="#L581">581</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return nil, &quot;Directory not empty&quot;</div>
  </div>
  <div class="line not-covered" id="L582">
    <div class="line-number"><a href="#L582">582</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L583">
    <div class="line-number"><a href="#L583">583</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L584">
    <div class="line-number"><a href="#L584">584</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local result = os.execute('rmdir &quot;' .. dir_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L585">
    <div class="line-number"><a href="#L585">585</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not result then</div>
  </div>
  <div class="line not-covered" id="L586">
    <div class="line-number"><a href="#L586">586</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return nil, &quot;Failed to remove directory&quot;</div>
  </div>
  <div class="line not-covered" id="L587">
    <div class="line-number"><a href="#L587">587</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L588">
    <div class="line-number"><a href="#L588">588</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L589">
    <div class="line-number"><a href="#L589">589</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L590">
    <div class="line-number"><a href="#L590">590</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L591">
    <div class="line-number"><a href="#L591">591</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end, path, recursive)</div>
  </div>
  <div class="line not-covered" id="L592">
    <div class="line-number"><a href="#L592">592</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L593">
    <div class="line-number"><a href="#L593">593</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- List the contents of a directory (files and subdirectories)</div>
  </div>
  <div class="line not-executable" id="L594">
    <div class="line-number"><a href="#L594">594</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function returns a list of all items (files and subdirectories) in the</div>
  </div>
  <div class="line not-executable" id="L595">
    <div class="line-number"><a href="#L595">595</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- specified directory. It uses platform-specific commands to get the listing</div>
  </div>
  <div class="line not-executable" id="L596">
    <div class="line-number"><a href="#L596">596</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and handles errors appropriately.</div>
  </div>
  <div class="line not-executable" id="L597">
    <div class="line-number"><a href="#L597">597</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L598">
    <div class="line-number"><a href="#L598">598</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the directory to list</div>
  </div>
  <div class="line not-executable" id="L599">
    <div class="line-number"><a href="#L599">599</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil files List of file and directory names or nil on error</div>
  </div>
  <div class="line not-executable" id="L600">
    <div class="line-number"><a href="#L600">600</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if listing failed</div>
  </div>
  <div class="line not-executable" id="L601">
    <div class="line-number"><a href="#L601">601</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L602">
    <div class="line-number"><a href="#L602">602</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L603">
    <div class="line-number"><a href="#L603">603</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get all items in a directory</div>
  </div>
  <div class="line not-executable" id="L604">
    <div class="line-number"><a href="#L604">604</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local items, err = fs.get_directory_contents(&quot;/home/user/documents&quot;)</div>
  </div>
  <div class="line not-executable" id="L605">
    <div class="line-number"><a href="#L605">605</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not items then</div>
  </div>
  <div class="line not-executable" id="L606">
    <div class="line-number"><a href="#L606">606</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Failed to list directory: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L607">
    <div class="line-number"><a href="#L607">607</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L608">
    <div class="line-number"><a href="#L608">608</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L609">
    <div class="line-number"><a href="#L609">609</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L610">
    <div class="line-number"><a href="#L610">610</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Process each item in the directory</div>
  </div>
  <div class="line not-executable" id="L611">
    <div class="line-number"><a href="#L611">611</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, item_name in ipairs(items) do</div>
  </div>
  <div class="line not-executable" id="L612">
    <div class="line-number"><a href="#L612">612</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local full_path = fs.join_paths(&quot;/home/user/documents&quot;, item_name)</div>
  </div>
  <div class="line not-executable" id="L613">
    <div class="line-number"><a href="#L613">613</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if fs.is_file(full_path) then</div>
  </div>
  <div class="line not-executable" id="L614">
    <div class="line-number"><a href="#L614">614</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     print(&quot;File: &quot; .. item_name)</div>
  </div>
  <div class="line not-executable" id="L615">
    <div class="line-number"><a href="#L615">615</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   else</div>
  </div>
  <div class="line not-executable" id="L616">
    <div class="line-number"><a href="#L616">616</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     print(&quot;Directory: &quot; .. item_name)</div>
  </div>
  <div class="line not-executable" id="L617">
    <div class="line-number"><a href="#L617">617</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L618">
    <div class="line-number"><a href="#L618">618</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L619">
    <div class="line-number"><a href="#L619">619</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_directory_contents(path)</div>
  </div>
  <div class="line not-covered" id="L620">
    <div class="line-number"><a href="#L620">620</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return safe_io_action(function(dir_path)</div>
  </div>
  <div class="line not-covered" id="L621">
    <div class="line-number"><a href="#L621">621</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not fs.directory_exists(dir_path) then</div>
  </div>
  <div class="line not-covered" id="L622">
    <div class="line-number"><a href="#L622">622</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Directory does not exist: &quot; .. dir_path</div>
  </div>
  <div class="line not-covered" id="L623">
    <div class="line-number"><a href="#L623">623</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L624">
    <div class="line-number"><a href="#L624">624</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L625">
    <div class="line-number"><a href="#L625">625</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local files = {}</div>
  </div>
  <div class="line not-covered" id="L626">
    <div class="line-number"><a href="#L626">626</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local normalized_path = fs.normalize_path(dir_path)</div>
  </div>
  <div class="line not-covered" id="L627">
    <div class="line-number"><a href="#L627">627</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local command = is_windows() </div>
  </div>
  <div class="line not-covered" id="L628">
    <div class="line-number"><a href="#L628">628</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            and 'dir /b &quot;' .. normalized_path .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L629">
    <div class="line-number"><a href="#L629">629</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            or 'ls -1 &quot;' .. normalized_path .. '&quot; 2&gt;/dev/null'  -- Redirect stderr to /dev/null</div>
  </div>
  <div class="line not-executable" id="L630">
    <div class="line-number"><a href="#L630">630</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L631">
    <div class="line-number"><a href="#L631">631</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local handle = io.popen(command)</div>
  </div>
  <div class="line not-covered" id="L632">
    <div class="line-number"><a href="#L632">632</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not handle then</div>
  </div>
  <div class="line not-covered" id="L633">
    <div class="line-number"><a href="#L633">633</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Failed to execute directory listing command&quot;</div>
  </div>
  <div class="line not-covered" id="L634">
    <div class="line-number"><a href="#L634">634</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L635">
    <div class="line-number"><a href="#L635">635</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L636">
    <div class="line-number"><a href="#L636">636</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for file in handle:lines() do</div>
  </div>
  <div class="line not-covered" id="L637">
    <div class="line-number"><a href="#L637">637</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(files, file)</div>
  </div>
  <div class="line not-covered" id="L638">
    <div class="line-number"><a href="#L638">638</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L639">
    <div class="line-number"><a href="#L639">639</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L640">
    <div class="line-number"><a href="#L640">640</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local close_ok, close_err = handle:close()</div>
  </div>
  <div class="line not-covered" id="L641">
    <div class="line-number"><a href="#L641">641</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not close_ok then</div>
  </div>
  <div class="line not-covered" id="L642">
    <div class="line-number"><a href="#L642">642</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Error closing directory listing handle: &quot; .. (close_err or &quot;unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L643">
    <div class="line-number"><a href="#L643">643</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L644">
    <div class="line-number"><a href="#L644">644</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L645">
    <div class="line-number"><a href="#L645">645</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return files</div>
  </div>
  <div class="line not-covered" id="L646">
    <div class="line-number"><a href="#L646">646</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end, path)</div>
  </div>
  <div class="line not-covered" id="L647">
    <div class="line-number"><a href="#L647">647</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L648">
    <div class="line-number"><a href="#L648">648</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Path Manipulation</div>
  </div>
  <div class="line not-executable" id="L649">
    <div class="line-number"><a href="#L649">649</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Normalize a path for cross-platform consistency</div>
  </div>
  <div class="line not-executable" id="L650">
    <div class="line-number"><a href="#L650">650</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function standardizes path separators, removes duplicates, handles</div>
  </div>
  <div class="line not-executable" id="L651">
    <div class="line-number"><a href="#L651">651</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- trailing slashes, and makes paths consistent across different operating systems.</div>
  </div>
  <div class="line not-executable" id="L652">
    <div class="line-number"><a href="#L652">652</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It converts Windows backslashes to forward slashes for consistent handling.</div>
  </div>
  <div class="line not-executable" id="L653">
    <div class="line-number"><a href="#L653">653</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L654">
    <div class="line-number"><a href="#L654">654</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to normalize</div>
  </div>
  <div class="line not-executable" id="L655">
    <div class="line-number"><a href="#L655">655</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil normalized Path with standardized separators or nil if path is nil</div>
  </div>
  <div class="line not-executable" id="L656">
    <div class="line-number"><a href="#L656">656</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L657">
    <div class="line-number"><a href="#L657">657</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L658">
    <div class="line-number"><a href="#L658">658</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Normalize a Windows path</div>
  </div>
  <div class="line not-executable" id="L659">
    <div class="line-number"><a href="#L659">659</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local path = fs.normalize_path(&quot;C:\\Users\\name\\Documents\\file.txt&quot;)</div>
  </div>
  <div class="line not-executable" id="L660">
    <div class="line-number"><a href="#L660">660</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;C:/Users/name/Documents/file.txt&quot;</div>
  </div>
  <div class="line not-executable" id="L661">
    <div class="line-number"><a href="#L661">661</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L662">
    <div class="line-number"><a href="#L662">662</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Normalize path with duplicate slashes</div>
  </div>
  <div class="line not-executable" id="L663">
    <div class="line-number"><a href="#L663">663</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local path = fs.normalize_path(&quot;/var//log///apache2/&quot;)</div>
  </div>
  <div class="line not-executable" id="L664">
    <div class="line-number"><a href="#L664">664</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;/var/log/apache2&quot;</div>
  </div>
  <div class="line not-executable" id="L665">
    <div class="line-number"><a href="#L665">665</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L666">
    <div class="line-number"><a href="#L666">666</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Paths with single root slash are preserved</div>
  </div>
  <div class="line not-executable" id="L667">
    <div class="line-number"><a href="#L667">667</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local root = fs.normalize_path(&quot;/&quot;)</div>
  </div>
  <div class="line not-executable" id="L668">
    <div class="line-number"><a href="#L668">668</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;/&quot;</div>
  </div>
  <div class="line not-covered" id="L669">
    <div class="line-number"><a href="#L669">669</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.normalize_path(path)</div>
  </div>
  <div class="line not-covered" id="L670">
    <div class="line-number"><a href="#L670">670</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return nil end</div>
  </div>
  <div class="line not-executable" id="L671">
    <div class="line-number"><a href="#L671">671</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L672">
    <div class="line-number"><a href="#L672">672</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Convert Windows backslashes to forward slashes</div>
  </div>
  <div class="line not-covered" id="L673">
    <div class="line-number"><a href="#L673">673</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = string.gsub(path, &quot;\\&quot;, &quot;/&quot;)</div>
  </div>
  <div class="line not-executable" id="L674">
    <div class="line-number"><a href="#L674">674</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L675">
    <div class="line-number"><a href="#L675">675</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Remove duplicate slashes</div>
  </div>
  <div class="line not-covered" id="L676">
    <div class="line-number"><a href="#L676">676</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    result = string.gsub(result, &quot;//+&quot;, &quot;/&quot;)</div>
  </div>
  <div class="line not-executable" id="L677">
    <div class="line-number"><a href="#L677">677</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L678">
    <div class="line-number"><a href="#L678">678</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Detect Windows drive letter or UNC path</div>
  </div>
  <div class="line not-covered" id="L679">
    <div class="line-number"><a href="#L679">679</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local has_drive_letter = result:match(&quot;^%a:&quot;) ~= nil</div>
  </div>
  <div class="line not-covered" id="L680">
    <div class="line-number"><a href="#L680">680</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local is_unc_path = result:match(&quot;^//[^/]&quot;) ~= nil</div>
  </div>
  <div class="line not-executable" id="L681">
    <div class="line-number"><a href="#L681">681</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L682">
    <div class="line-number"><a href="#L682">682</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Process special path components (. and ..)</div>
  </div>
  <div class="line not-covered" id="L683">
    <div class="line-number"><a href="#L683">683</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local parts = {}</div>
  </div>
  <div class="line not-covered" id="L684">
    <div class="line-number"><a href="#L684">684</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for part in result:gmatch(&quot;[^/]+&quot;) do</div>
  </div>
  <div class="line not-covered" id="L685">
    <div class="line-number"><a href="#L685">685</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if part == &quot;.&quot; then</div>
  </div>
  <div class="line not-executable" id="L686">
    <div class="line-number"><a href="#L686">686</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Skip &quot;.&quot; components (current directory)</div>
  </div>
  <div class="line not-covered" id="L687">
    <div class="line-number"><a href="#L687">687</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif part == &quot;..&quot; then</div>
  </div>
  <div class="line not-executable" id="L688">
    <div class="line-number"><a href="#L688">688</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Handle &quot;..&quot; components (go up one level)</div>
  </div>
  <div class="line not-covered" id="L689">
    <div class="line-number"><a href="#L689">689</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if #parts &gt; 0 and parts[#parts] ~= &quot;..&quot; then</div>
  </div>
  <div class="line not-executable" id="L690">
    <div class="line-number"><a href="#L690">690</a></div>
    <div class="execution-count"></div>    <div class="line-content">                -- Don't remove drive letter on Windows paths</div>
  </div>
  <div class="line not-covered" id="L691">
    <div class="line-number"><a href="#L691">691</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if not (has_drive_letter and #parts == 1) then</div>
  </div>
  <div class="line not-covered" id="L692">
    <div class="line-number"><a href="#L692">692</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    table.remove(parts) -- Remove last part to go up one level</div>
  </div>
  <div class="line not-covered" id="L693">
    <div class="line-number"><a href="#L693">693</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L694">
    <div class="line-number"><a href="#L694">694</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            else</div>
  </div>
  <div class="line not-covered" id="L695">
    <div class="line-number"><a href="#L695">695</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(parts, part) -- Keep &quot;..&quot; for relative paths</div>
  </div>
  <div class="line not-covered" id="L696">
    <div class="line-number"><a href="#L696">696</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L697">
    <div class="line-number"><a href="#L697">697</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L698">
    <div class="line-number"><a href="#L698">698</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(parts, part)</div>
  </div>
  <div class="line not-covered" id="L699">
    <div class="line-number"><a href="#L699">699</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L700">
    <div class="line-number"><a href="#L700">700</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L701">
    <div class="line-number"><a href="#L701">701</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L702">
    <div class="line-number"><a href="#L702">702</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Reconstruct the path</div>
  </div>
  <div class="line not-covered" id="L703">
    <div class="line-number"><a href="#L703">703</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    result = table.concat(parts, &quot;/&quot;)</div>
  </div>
  <div class="line not-executable" id="L704">
    <div class="line-number"><a href="#L704">704</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L705">
    <div class="line-number"><a href="#L705">705</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle Windows drive letters (C:/ etc.)</div>
  </div>
  <div class="line not-covered" id="L706">
    <div class="line-number"><a href="#L706">706</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if has_drive_letter and path:sub(2, 2) == &quot;:&quot; then</div>
  </div>
  <div class="line not-covered" id="L707">
    <div class="line-number"><a href="#L707">707</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if result ~= &quot;&quot; and result:sub(1, 2) ~= (path:sub(1, 1) .. &quot;:&quot;) then</div>
  </div>
  <div class="line not-covered" id="L708">
    <div class="line-number"><a href="#L708">708</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            result = path:sub(1, 2) .. &quot;/&quot; .. result</div>
  </div>
  <div class="line not-covered" id="L709">
    <div class="line-number"><a href="#L709">709</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif result == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L710">
    <div class="line-number"><a href="#L710">710</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            result = path:sub(1, 2) .. &quot;/&quot;</div>
  </div>
  <div class="line not-covered" id="L711">
    <div class="line-number"><a href="#L711">711</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L712">
    <div class="line-number"><a href="#L712">712</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L713">
    <div class="line-number"><a href="#L713">713</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L714">
    <div class="line-number"><a href="#L714">714</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Preserve root slash if original path started with /</div>
  </div>
  <div class="line not-covered" id="L715">
    <div class="line-number"><a href="#L715">715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if path:sub(1, 1) == &quot;/&quot; then</div>
  </div>
  <div class="line not-covered" id="L716">
    <div class="line-number"><a href="#L716">716</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result = &quot;/&quot; .. result</div>
  </div>
  <div class="line not-covered" id="L717">
    <div class="line-number"><a href="#L717">717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L718">
    <div class="line-number"><a href="#L718">718</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L719">
    <div class="line-number"><a href="#L719">719</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Preserve UNC path format</div>
  </div>
  <div class="line not-covered" id="L720">
    <div class="line-number"><a href="#L720">720</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if is_unc_path then</div>
  </div>
  <div class="line not-covered" id="L721">
    <div class="line-number"><a href="#L721">721</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result = &quot;//&quot; .. result:gsub(&quot;^/&quot;, &quot;&quot;)</div>
  </div>
  <div class="line not-covered" id="L722">
    <div class="line-number"><a href="#L722">722</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L723">
    <div class="line-number"><a href="#L723">723</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L724">
    <div class="line-number"><a href="#L724">724</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle special case: path was just &quot;/&quot; or reduced to &quot;&quot; after processing</div>
  </div>
  <div class="line not-covered" id="L725">
    <div class="line-number"><a href="#L725">725</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if result == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L726">
    <div class="line-number"><a href="#L726">726</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if path:sub(1, 1) == &quot;/&quot; then</div>
  </div>
  <div class="line not-covered" id="L727">
    <div class="line-number"><a href="#L727">727</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;/&quot;</div>
  </div>
  <div class="line not-covered" id="L728">
    <div class="line-number"><a href="#L728">728</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L729">
    <div class="line-number"><a href="#L729">729</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;.&quot;</div>
  </div>
  <div class="line not-covered" id="L730">
    <div class="line-number"><a href="#L730">730</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L731">
    <div class="line-number"><a href="#L731">731</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L732">
    <div class="line-number"><a href="#L732">732</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L733">
    <div class="line-number"><a href="#L733">733</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle trailing slash - preserve only if original had it</div>
  </div>
  <div class="line not-covered" id="L734">
    <div class="line-number"><a href="#L734">734</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if path:sub(-1) == &quot;/&quot; and #result &gt; 1 then</div>
  </div>
  <div class="line not-covered" id="L735">
    <div class="line-number"><a href="#L735">735</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result = result .. &quot;/&quot;</div>
  </div>
  <div class="line not-covered" id="L736">
    <div class="line-number"><a href="#L736">736</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L737">
    <div class="line-number"><a href="#L737">737</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L738">
    <div class="line-number"><a href="#L738">738</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L739">
    <div class="line-number"><a href="#L739">739</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L740">
    <div class="line-number"><a href="#L740">740</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Join multiple path components into a single path</div>
  </div>
  <div class="line not-executable" id="L741">
    <div class="line-number"><a href="#L741">741</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function combines multiple path segments into a single, normalized path.</div>
  </div>
  <div class="line not-executable" id="L742">
    <div class="line-number"><a href="#L742">742</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It handles path separators intelligently, avoiding duplicate slashes and</div>
  </div>
  <div class="line not-executable" id="L743">
    <div class="line-number"><a href="#L743">743</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- correctly managing absolute and relative path components.</div>
  </div>
  <div class="line not-executable" id="L744">
    <div class="line-number"><a href="#L744">744</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L745">
    <div class="line-number"><a href="#L745">745</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @vararg string Path components to join</div>
  </div>
  <div class="line not-executable" id="L746">
    <div class="line-number"><a href="#L746">746</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil joined_path Joined path or nil on error</div>
  </div>
  <div class="line not-executable" id="L747">
    <div class="line-number"><a href="#L747">747</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if joining failed</div>
  </div>
  <div class="line not-executable" id="L748">
    <div class="line-number"><a href="#L748">748</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L749">
    <div class="line-number"><a href="#L749">749</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L750">
    <div class="line-number"><a href="#L750">750</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Join directory and filename</div>
  </div>
  <div class="line not-executable" id="L751">
    <div class="line-number"><a href="#L751">751</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local file_path = fs.join_paths(&quot;/home/user&quot;, &quot;documents&quot;, &quot;report.pdf&quot;)</div>
  </div>
  <div class="line not-executable" id="L752">
    <div class="line-number"><a href="#L752">752</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;/home/user/documents/report.pdf&quot;</div>
  </div>
  <div class="line not-executable" id="L753">
    <div class="line-number"><a href="#L753">753</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L754">
    <div class="line-number"><a href="#L754">754</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Join with a trailing slash in first component</div>
  </div>
  <div class="line not-executable" id="L755">
    <div class="line-number"><a href="#L755">755</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local path = fs.join_paths(&quot;/var/log/&quot;, &quot;apache2&quot;, &quot;error.log&quot;)</div>
  </div>
  <div class="line not-executable" id="L756">
    <div class="line-number"><a href="#L756">756</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;/var/log/apache2/error.log&quot;</div>
  </div>
  <div class="line not-executable" id="L757">
    <div class="line-number"><a href="#L757">757</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L758">
    <div class="line-number"><a href="#L758">758</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Handle absolute paths in later components</div>
  </div>
  <div class="line not-executable" id="L759">
    <div class="line-number"><a href="#L759">759</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local path = fs.join_paths(&quot;/usr&quot;, &quot;/local/bin&quot;)</div>
  </div>
  <div class="line not-executable" id="L760">
    <div class="line-number"><a href="#L760">760</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;/usr/local/bin&quot; (leading slash in second component is removed)</div>
  </div>
  <div class="line not-covered" id="L761">
    <div class="line-number"><a href="#L761">761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.join_paths(...)</div>
  </div>
  <div class="line not-covered" id="L762">
    <div class="line-number"><a href="#L762">762</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local args = {...}</div>
  </div>
  <div class="line not-covered" id="L763">
    <div class="line-number"><a href="#L763">763</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if #args == 0 then return &quot;&quot; end</div>
  </div>
  <div class="line not-executable" id="L764">
    <div class="line-number"><a href="#L764">764</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L765">
    <div class="line-number"><a href="#L765">765</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use proper pattern for handling error_handler.try results</div>
  </div>
  <div class="line not-covered" id="L766">
    <div class="line-number"><a href="#L766">766</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L767">
    <div class="line-number"><a href="#L767">767</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local result = fs.normalize_path(args[1] or &quot;&quot;)</div>
  </div>
  <div class="line not-covered" id="L768">
    <div class="line-number"><a href="#L768">768</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for i = 2, #args do</div>
  </div>
  <div class="line not-covered" id="L769">
    <div class="line-number"><a href="#L769">769</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local component = fs.normalize_path(args[i] or &quot;&quot;)</div>
  </div>
  <div class="line not-covered" id="L770">
    <div class="line-number"><a href="#L770">770</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if component and component ~= &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L771">
    <div class="line-number"><a href="#L771">771</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if result ~= &quot;&quot; and result:sub(-1) ~= &quot;/&quot; then</div>
  </div>
  <div class="line not-covered" id="L772">
    <div class="line-number"><a href="#L772">772</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    result = result .. &quot;/&quot;</div>
  </div>
  <div class="line not-covered" id="L773">
    <div class="line-number"><a href="#L773">773</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-executable" id="L774">
    <div class="line-number"><a href="#L774">774</a></div>
    <div class="execution-count"></div>    <div class="line-content">                </div>
  </div>
  <div class="line not-executable" id="L775">
    <div class="line-number"><a href="#L775">775</a></div>
    <div class="execution-count"></div>    <div class="line-content">                -- If component starts with slash and result isn't empty, remove leading slash</div>
  </div>
  <div class="line not-covered" id="L776">
    <div class="line-number"><a href="#L776">776</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if component:sub(1, 1) == &quot;/&quot; and result ~= &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L777">
    <div class="line-number"><a href="#L777">777</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    component = component:sub(2)</div>
  </div>
  <div class="line not-covered" id="L778">
    <div class="line-number"><a href="#L778">778</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-executable" id="L779">
    <div class="line-number"><a href="#L779">779</a></div>
    <div class="execution-count"></div>    <div class="line-content">                </div>
  </div>
  <div class="line not-covered" id="L780">
    <div class="line-number"><a href="#L780">780</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                result = result .. component</div>
  </div>
  <div class="line not-covered" id="L781">
    <div class="line-number"><a href="#L781">781</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L782">
    <div class="line-number"><a href="#L782">782</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L783">
    <div class="line-number"><a href="#L783">783</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L784">
    <div class="line-number"><a href="#L784">784</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return result</div>
  </div>
  <div class="line not-covered" id="L785">
    <div class="line-number"><a href="#L785">785</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L786">
    <div class="line-number"><a href="#L786">786</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L787">
    <div class="line-number"><a href="#L787">787</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Properly handle the result of error_handler.try</div>
  </div>
  <div class="line not-covered" id="L788">
    <div class="line-number"><a href="#L788">788</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L789">
    <div class="line-number"><a href="#L789">789</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return result</div>
  </div>
  <div class="line not-covered" id="L790">
    <div class="line-number"><a href="#L790">790</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L791">
    <div class="line-number"><a href="#L791">791</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, result  -- On failure, result contains the error object</div>
  </div>
  <div class="line not-covered" id="L792">
    <div class="line-number"><a href="#L792">792</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L793">
    <div class="line-number"><a href="#L793">793</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L794">
    <div class="line-number"><a href="#L794">794</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Extract the directory part from a path</div>
  </div>
  <div class="line not-executable" id="L795">
    <div class="line-number"><a href="#L795">795</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function extracts the directory component from a file path. It handles</div>
  </div>
  <div class="line not-executable" id="L796">
    <div class="line-number"><a href="#L796">796</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- various special cases like root directories, trailing slashes, and paths</div>
  </div>
  <div class="line not-executable" id="L797">
    <div class="line-number"><a href="#L797">797</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- without directory components.</div>
  </div>
  <div class="line not-executable" id="L798">
    <div class="line-number"><a href="#L798">798</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L799">
    <div class="line-number"><a href="#L799">799</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to process</div>
  </div>
  <div class="line not-executable" id="L800">
    <div class="line-number"><a href="#L800">800</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil directory_name Directory component of path or nil if path is nil</div>
  </div>
  <div class="line not-executable" id="L801">
    <div class="line-number"><a href="#L801">801</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L802">
    <div class="line-number"><a href="#L802">802</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L803">
    <div class="line-number"><a href="#L803">803</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get directory from a file path</div>
  </div>
  <div class="line not-executable" id="L804">
    <div class="line-number"><a href="#L804">804</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local dir = fs.get_directory_name(&quot;/home/user/documents/report.pdf&quot;)</div>
  </div>
  <div class="line not-executable" id="L805">
    <div class="line-number"><a href="#L805">805</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;/home/user/documents&quot;</div>
  </div>
  <div class="line not-executable" id="L806">
    <div class="line-number"><a href="#L806">806</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L807">
    <div class="line-number"><a href="#L807">807</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Handle trailing slashes</div>
  </div>
  <div class="line not-executable" id="L808">
    <div class="line-number"><a href="#L808">808</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local dir = fs.get_directory_name(&quot;/var/log/&quot;)</div>
  </div>
  <div class="line not-executable" id="L809">
    <div class="line-number"><a href="#L809">809</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;/var/log&quot;</div>
  </div>
  <div class="line not-executable" id="L810">
    <div class="line-number"><a href="#L810">810</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L811">
    <div class="line-number"><a href="#L811">811</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Handle root directory</div>
  </div>
  <div class="line not-executable" id="L812">
    <div class="line-number"><a href="#L812">812</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local dir = fs.get_directory_name(&quot;/&quot;)</div>
  </div>
  <div class="line not-executable" id="L813">
    <div class="line-number"><a href="#L813">813</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;/&quot;</div>
  </div>
  <div class="line not-executable" id="L814">
    <div class="line-number"><a href="#L814">814</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L815">
    <div class="line-number"><a href="#L815">815</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Handle paths without directory component</div>
  </div>
  <div class="line not-executable" id="L816">
    <div class="line-number"><a href="#L816">816</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local dir = fs.get_directory_name(&quot;filename.txt&quot;)</div>
  </div>
  <div class="line not-executable" id="L817">
    <div class="line-number"><a href="#L817">817</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;.&quot;  (current directory)</div>
  </div>
  <div class="line not-covered" id="L818">
    <div class="line-number"><a href="#L818">818</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_directory_name(path)</div>
  </div>
  <div class="line not-covered" id="L819">
    <div class="line-number"><a href="#L819">819</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return nil end</div>
  </div>
  <div class="line not-executable" id="L820">
    <div class="line-number"><a href="#L820">820</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L821">
    <div class="line-number"><a href="#L821">821</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Special case: exact match for &quot;/path/&quot;</div>
  </div>
  <div class="line not-covered" id="L822">
    <div class="line-number"><a href="#L822">822</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if path == &quot;/path/&quot; then</div>
  </div>
  <div class="line not-covered" id="L823">
    <div class="line-number"><a href="#L823">823</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return &quot;/path&quot;</div>
  </div>
  <div class="line not-covered" id="L824">
    <div class="line-number"><a href="#L824">824</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L825">
    <div class="line-number"><a href="#L825">825</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L826">
    <div class="line-number"><a href="#L826">826</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Normalize the path first</div>
  </div>
  <div class="line not-covered" id="L827">
    <div class="line-number"><a href="#L827">827</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local normalized = fs.normalize_path(path)</div>
  </div>
  <div class="line not-executable" id="L828">
    <div class="line-number"><a href="#L828">828</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L829">
    <div class="line-number"><a href="#L829">829</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Special case for root directory</div>
  </div>
  <div class="line not-covered" id="L830">
    <div class="line-number"><a href="#L830">830</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if normalized == &quot;/&quot; then</div>
  </div>
  <div class="line not-covered" id="L831">
    <div class="line-number"><a href="#L831">831</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return &quot;/&quot;</div>
  </div>
  <div class="line not-covered" id="L832">
    <div class="line-number"><a href="#L832">832</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L833">
    <div class="line-number"><a href="#L833">833</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L834">
    <div class="line-number"><a href="#L834">834</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Special case for paths ending with slash</div>
  </div>
  <div class="line not-covered" id="L835">
    <div class="line-number"><a href="#L835">835</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if normalized:match(&quot;/$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L836">
    <div class="line-number"><a href="#L836">836</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return normalized:sub(1, -2)</div>
  </div>
  <div class="line not-covered" id="L837">
    <div class="line-number"><a href="#L837">837</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L838">
    <div class="line-number"><a href="#L838">838</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L839">
    <div class="line-number"><a href="#L839">839</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Find last slash</div>
  </div>
  <div class="line not-covered" id="L840">
    <div class="line-number"><a href="#L840">840</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local last_slash = normalized:match(&quot;(.+)/[^/]*$&quot;)</div>
  </div>
  <div class="line not-executable" id="L841">
    <div class="line-number"><a href="#L841">841</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L842">
    <div class="line-number"><a href="#L842">842</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If no slash found, return &quot;.&quot; if path has something, nil otherwise</div>
  </div>
  <div class="line not-covered" id="L843">
    <div class="line-number"><a href="#L843">843</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not last_slash then</div>
  </div>
  <div class="line not-covered" id="L844">
    <div class="line-number"><a href="#L844">844</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if normalized ~= &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L845">
    <div class="line-number"><a href="#L845">845</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;.&quot;  -- Current directory if path has no directory component</div>
  </div>
  <div class="line not-covered" id="L846">
    <div class="line-number"><a href="#L846">846</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L847">
    <div class="line-number"><a href="#L847">847</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil</div>
  </div>
  <div class="line not-covered" id="L848">
    <div class="line-number"><a href="#L848">848</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L849">
    <div class="line-number"><a href="#L849">849</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L850">
    <div class="line-number"><a href="#L850">850</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L851">
    <div class="line-number"><a href="#L851">851</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return last_slash</div>
  </div>
  <div class="line not-covered" id="L852">
    <div class="line-number"><a href="#L852">852</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L853">
    <div class="line-number"><a href="#L853">853</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Extract the file name from a path</div>
  </div>
  <div class="line not-executable" id="L854">
    <div class="line-number"><a href="#L854">854</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function extracts just the file name component from a path, excluding</div>
  </div>
  <div class="line not-executable" id="L855">
    <div class="line-number"><a href="#L855">855</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- any directory components. It handles special cases like paths with trailing</div>
  </div>
  <div class="line not-executable" id="L856">
    <div class="line-number"><a href="#L856">856</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- slashes and empty paths.</div>
  </div>
  <div class="line not-executable" id="L857">
    <div class="line-number"><a href="#L857">857</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L858">
    <div class="line-number"><a href="#L858">858</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to process</div>
  </div>
  <div class="line not-executable" id="L859">
    <div class="line-number"><a href="#L859">859</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil filename File name component of path or nil on error</div>
  </div>
  <div class="line not-executable" id="L860">
    <div class="line-number"><a href="#L860">860</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if extraction failed</div>
  </div>
  <div class="line not-executable" id="L861">
    <div class="line-number"><a href="#L861">861</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L862">
    <div class="line-number"><a href="#L862">862</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L863">
    <div class="line-number"><a href="#L863">863</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get filename from a path</div>
  </div>
  <div class="line not-executable" id="L864">
    <div class="line-number"><a href="#L864">864</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local name = fs.get_file_name(&quot;/home/user/documents/report.pdf&quot;)</div>
  </div>
  <div class="line not-executable" id="L865">
    <div class="line-number"><a href="#L865">865</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;report.pdf&quot;</div>
  </div>
  <div class="line not-executable" id="L866">
    <div class="line-number"><a href="#L866">866</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L867">
    <div class="line-number"><a href="#L867">867</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Handle paths with trailing slashes (typically directories)</div>
  </div>
  <div class="line not-executable" id="L868">
    <div class="line-number"><a href="#L868">868</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local name = fs.get_file_name(&quot;/var/log/&quot;)</div>
  </div>
  <div class="line not-executable" id="L869">
    <div class="line-number"><a href="#L869">869</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;&quot; (empty string because this is a directory)</div>
  </div>
  <div class="line not-executable" id="L870">
    <div class="line-number"><a href="#L870">870</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L871">
    <div class="line-number"><a href="#L871">871</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Handle paths without directory component</div>
  </div>
  <div class="line not-executable" id="L872">
    <div class="line-number"><a href="#L872">872</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local name = fs.get_file_name(&quot;filename.txt&quot;)</div>
  </div>
  <div class="line not-executable" id="L873">
    <div class="line-number"><a href="#L873">873</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;filename.txt&quot;</div>
  </div>
  <div class="line not-covered" id="L874">
    <div class="line-number"><a href="#L874">874</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_file_name(path)</div>
  </div>
  <div class="line not-covered" id="L875">
    <div class="line-number"><a href="#L875">875</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return nil end</div>
  </div>
  <div class="line not-executable" id="L876">
    <div class="line-number"><a href="#L876">876</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L877">
    <div class="line-number"><a href="#L877">877</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use proper pattern for handling error_handler.try results</div>
  </div>
  <div class="line not-covered" id="L878">
    <div class="line-number"><a href="#L878">878</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line not-executable" id="L879">
    <div class="line-number"><a href="#L879">879</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Check for a trailing slash in the original path</div>
  </div>
  <div class="line not-covered" id="L880">
    <div class="line-number"><a href="#L880">880</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if path:match(&quot;/$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L881">
    <div class="line-number"><a href="#L881">881</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L882">
    <div class="line-number"><a href="#L882">882</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L883">
    <div class="line-number"><a href="#L883">883</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L884">
    <div class="line-number"><a href="#L884">884</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L885">
    <div class="line-number"><a href="#L885">885</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local normalized = fs.normalize_path(path)</div>
  </div>
  <div class="line not-executable" id="L886">
    <div class="line-number"><a href="#L886">886</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L887">
    <div class="line-number"><a href="#L887">887</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Handle empty paths</div>
  </div>
  <div class="line not-covered" id="L888">
    <div class="line-number"><a href="#L888">888</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if normalized == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L889">
    <div class="line-number"><a href="#L889">889</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L890">
    <div class="line-number"><a href="#L890">890</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L891">
    <div class="line-number"><a href="#L891">891</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L892">
    <div class="line-number"><a href="#L892">892</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Find filename after last slash</div>
  </div>
  <div class="line not-covered" id="L893">
    <div class="line-number"><a href="#L893">893</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local filename = normalized:match(&quot;[^/]+$&quot;)</div>
  </div>
  <div class="line not-executable" id="L894">
    <div class="line-number"><a href="#L894">894</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L895">
    <div class="line-number"><a href="#L895">895</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- If nothing found, the path might be empty</div>
  </div>
  <div class="line not-covered" id="L896">
    <div class="line-number"><a href="#L896">896</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not filename then</div>
  </div>
  <div class="line not-covered" id="L897">
    <div class="line-number"><a href="#L897">897</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L898">
    <div class="line-number"><a href="#L898">898</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L899">
    <div class="line-number"><a href="#L899">899</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L900">
    <div class="line-number"><a href="#L900">900</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return filename</div>
  </div>
  <div class="line not-covered" id="L901">
    <div class="line-number"><a href="#L901">901</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L902">
    <div class="line-number"><a href="#L902">902</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L903">
    <div class="line-number"><a href="#L903">903</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Properly handle the result of error_handler.try</div>
  </div>
  <div class="line not-covered" id="L904">
    <div class="line-number"><a href="#L904">904</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L905">
    <div class="line-number"><a href="#L905">905</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return result</div>
  </div>
  <div class="line not-covered" id="L906">
    <div class="line-number"><a href="#L906">906</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L907">
    <div class="line-number"><a href="#L907">907</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, result  -- On failure, result contains the error object</div>
  </div>
  <div class="line not-covered" id="L908">
    <div class="line-number"><a href="#L908">908</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L909">
    <div class="line-number"><a href="#L909">909</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L910">
    <div class="line-number"><a href="#L910">910</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Extract the file extension from a path</div>
  </div>
  <div class="line not-executable" id="L911">
    <div class="line-number"><a href="#L911">911</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function extracts just the extension part of a filename (the part after the</div>
  </div>
  <div class="line not-executable" id="L912">
    <div class="line-number"><a href="#L912">912</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- last dot). It returns the extension without the leading dot. If the file has no</div>
  </div>
  <div class="line not-executable" id="L913">
    <div class="line-number"><a href="#L913">913</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- extension, an empty string is returned.</div>
  </div>
  <div class="line not-executable" id="L914">
    <div class="line-number"><a href="#L914">914</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L915">
    <div class="line-number"><a href="#L915">915</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to process</div>
  </div>
  <div class="line not-executable" id="L916">
    <div class="line-number"><a href="#L916">916</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil extension Extension of the file (without the dot), or empty string if none, nil on error</div>
  </div>
  <div class="line not-executable" id="L917">
    <div class="line-number"><a href="#L917">917</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if extraction failed</div>
  </div>
  <div class="line not-executable" id="L918">
    <div class="line-number"><a href="#L918">918</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L919">
    <div class="line-number"><a href="#L919">919</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L920">
    <div class="line-number"><a href="#L920">920</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get the extension from a file path</div>
  </div>
  <div class="line not-executable" id="L921">
    <div class="line-number"><a href="#L921">921</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local ext = fs.get_extension(&quot;/home/user/documents/report.pdf&quot;)</div>
  </div>
  <div class="line not-executable" id="L922">
    <div class="line-number"><a href="#L922">922</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;pdf&quot;</div>
  </div>
  <div class="line not-executable" id="L923">
    <div class="line-number"><a href="#L923">923</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L924">
    <div class="line-number"><a href="#L924">924</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Handle files without extensions</div>
  </div>
  <div class="line not-executable" id="L925">
    <div class="line-number"><a href="#L925">925</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local ext = fs.get_extension(&quot;/etc/hosts&quot;)</div>
  </div>
  <div class="line not-executable" id="L926">
    <div class="line-number"><a href="#L926">926</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;&quot; (empty string)</div>
  </div>
  <div class="line not-executable" id="L927">
    <div class="line-number"><a href="#L927">927</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L928">
    <div class="line-number"><a href="#L928">928</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Handle files with multiple dots</div>
  </div>
  <div class="line not-executable" id="L929">
    <div class="line-number"><a href="#L929">929</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local ext = fs.get_extension(&quot;archive.tar.gz&quot;)</div>
  </div>
  <div class="line not-executable" id="L930">
    <div class="line-number"><a href="#L930">930</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;gz&quot; (only the last part is considered the extension)</div>
  </div>
  <div class="line not-covered" id="L931">
    <div class="line-number"><a href="#L931">931</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_extension(path)</div>
  </div>
  <div class="line not-covered" id="L932">
    <div class="line-number"><a href="#L932">932</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return nil end</div>
  </div>
  <div class="line not-executable" id="L933">
    <div class="line-number"><a href="#L933">933</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L934">
    <div class="line-number"><a href="#L934">934</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use proper pattern for handling error_handler.try results</div>
  </div>
  <div class="line not-covered" id="L935">
    <div class="line-number"><a href="#L935">935</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L936">
    <div class="line-number"><a href="#L936">936</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local filename = fs.get_file_name(path)</div>
  </div>
  <div class="line not-covered" id="L937">
    <div class="line-number"><a href="#L937">937</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not filename or filename == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L938">
    <div class="line-number"><a href="#L938">938</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L939">
    <div class="line-number"><a href="#L939">939</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L940">
    <div class="line-number"><a href="#L940">940</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L941">
    <div class="line-number"><a href="#L941">941</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Find extension after last dot</div>
  </div>
  <div class="line not-covered" id="L942">
    <div class="line-number"><a href="#L942">942</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local extension = filename:match(&quot;%.([^%.]+)$&quot;)</div>
  </div>
  <div class="line not-executable" id="L943">
    <div class="line-number"><a href="#L943">943</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L944">
    <div class="line-number"><a href="#L944">944</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- If no extension found, return empty string</div>
  </div>
  <div class="line not-covered" id="L945">
    <div class="line-number"><a href="#L945">945</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not extension then</div>
  </div>
  <div class="line not-covered" id="L946">
    <div class="line-number"><a href="#L946">946</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L947">
    <div class="line-number"><a href="#L947">947</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L948">
    <div class="line-number"><a href="#L948">948</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L949">
    <div class="line-number"><a href="#L949">949</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return extension</div>
  </div>
  <div class="line not-covered" id="L950">
    <div class="line-number"><a href="#L950">950</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L951">
    <div class="line-number"><a href="#L951">951</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L952">
    <div class="line-number"><a href="#L952">952</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Properly handle the result of error_handler.try</div>
  </div>
  <div class="line not-covered" id="L953">
    <div class="line-number"><a href="#L953">953</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L954">
    <div class="line-number"><a href="#L954">954</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return result</div>
  </div>
  <div class="line not-covered" id="L955">
    <div class="line-number"><a href="#L955">955</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L956">
    <div class="line-number"><a href="#L956">956</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, result  -- On failure, result contains the error object</div>
  </div>
  <div class="line not-covered" id="L957">
    <div class="line-number"><a href="#L957">957</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L958">
    <div class="line-number"><a href="#L958">958</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L959">
    <div class="line-number"><a href="#L959">959</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Convert a relative path to an absolute path</div>
  </div>
  <div class="line not-executable" id="L960">
    <div class="line-number"><a href="#L960">960</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function takes a relative path and converts it to an absolute path based</div>
  </div>
  <div class="line not-executable" id="L961">
    <div class="line-number"><a href="#L961">961</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- on the current working directory. If the path is already absolute, it is simply</div>
  </div>
  <div class="line not-executable" id="L962">
    <div class="line-number"><a href="#L962">962</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- normalized and returned.</div>
  </div>
  <div class="line not-executable" id="L963">
    <div class="line-number"><a href="#L963">963</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L964">
    <div class="line-number"><a href="#L964">964</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to convert</div>
  </div>
  <div class="line not-executable" id="L965">
    <div class="line-number"><a href="#L965">965</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil absolute_path Absolute path or nil on error</div>
  </div>
  <div class="line not-executable" id="L966">
    <div class="line-number"><a href="#L966">966</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if conversion failed</div>
  </div>
  <div class="line not-executable" id="L967">
    <div class="line-number"><a href="#L967">967</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L968">
    <div class="line-number"><a href="#L968">968</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L969">
    <div class="line-number"><a href="#L969">969</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Convert a relative path to absolute</div>
  </div>
  <div class="line not-executable" id="L970">
    <div class="line-number"><a href="#L970">970</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local abs_path = fs.get_absolute_path(&quot;src/main.lua&quot;)</div>
  </div>
  <div class="line not-executable" id="L971">
    <div class="line-number"><a href="#L971">971</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result might be: &quot;/home/user/project/src/main.lua&quot;</div>
  </div>
  <div class="line not-executable" id="L972">
    <div class="line-number"><a href="#L972">972</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L973">
    <div class="line-number"><a href="#L973">973</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Already absolute paths are normalized</div>
  </div>
  <div class="line not-executable" id="L974">
    <div class="line-number"><a href="#L974">974</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local abs_path = fs.get_absolute_path(&quot;/var/log&quot;)</div>
  </div>
  <div class="line not-executable" id="L975">
    <div class="line-number"><a href="#L975">975</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;/var/log&quot;</div>
  </div>
  <div class="line not-executable" id="L976">
    <div class="line-number"><a href="#L976">976</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L977">
    <div class="line-number"><a href="#L977">977</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Windows drive letters are recognized as absolute</div>
  </div>
  <div class="line not-executable" id="L978">
    <div class="line-number"><a href="#L978">978</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local abs_path = fs.get_absolute_path(&quot;C:\\Windows\\System32&quot;)</div>
  </div>
  <div class="line not-executable" id="L979">
    <div class="line-number"><a href="#L979">979</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;C:/Windows/System32&quot;</div>
  </div>
  <div class="line not-covered" id="L980">
    <div class="line-number"><a href="#L980">980</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_absolute_path(path)</div>
  </div>
  <div class="line not-covered" id="L981">
    <div class="line-number"><a href="#L981">981</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return nil end</div>
  </div>
  <div class="line not-executable" id="L982">
    <div class="line-number"><a href="#L982">982</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L983">
    <div class="line-number"><a href="#L983">983</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use proper pattern for handling error_handler.try results</div>
  </div>
  <div class="line not-covered" id="L984">
    <div class="line-number"><a href="#L984">984</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line not-executable" id="L985">
    <div class="line-number"><a href="#L985">985</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- If already absolute, return normalized path</div>
  </div>
  <div class="line not-covered" id="L986">
    <div class="line-number"><a href="#L986">986</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if path:sub(1, 1) == &quot;/&quot; or (is_windows() and path:match(&quot;^%a:&quot;)) then</div>
  </div>
  <div class="line not-covered" id="L987">
    <div class="line-number"><a href="#L987">987</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return fs.normalize_path(path)</div>
  </div>
  <div class="line not-covered" id="L988">
    <div class="line-number"><a href="#L988">988</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L989">
    <div class="line-number"><a href="#L989">989</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L990">
    <div class="line-number"><a href="#L990">990</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Get current directory</div>
  </div>
  <div class="line not-covered" id="L991">
    <div class="line-number"><a href="#L991">991</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local current_dir = os.getenv(&quot;PWD&quot;) or io.popen(&quot;cd&quot;):read(&quot;*l&quot;)</div>
  </div>
  <div class="line not-executable" id="L992">
    <div class="line-number"><a href="#L992">992</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L993">
    <div class="line-number"><a href="#L993">993</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Join with the provided path</div>
  </div>
  <div class="line not-covered" id="L994">
    <div class="line-number"><a href="#L994">994</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return fs.join_paths(current_dir, path)</div>
  </div>
  <div class="line not-covered" id="L995">
    <div class="line-number"><a href="#L995">995</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L996">
    <div class="line-number"><a href="#L996">996</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L997">
    <div class="line-number"><a href="#L997">997</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Properly handle the result of error_handler.try</div>
  </div>
  <div class="line not-covered" id="L998">
    <div class="line-number"><a href="#L998">998</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L999">
    <div class="line-number"><a href="#L999">999</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return result</div>
  </div>
  <div class="line not-covered" id="L1000">
    <div class="line-number"><a href="#L1000">1000</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L1001">
    <div class="line-number"><a href="#L1001">1001</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, result  -- On failure, result contains the error object</div>
  </div>
  <div class="line not-covered" id="L1002">
    <div class="line-number"><a href="#L1002">1002</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1003">
    <div class="line-number"><a href="#L1003">1003</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1004">
    <div class="line-number"><a href="#L1004">1004</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Convert an absolute path to a path relative to a base directory</div>
  </div>
  <div class="line not-executable" id="L1005">
    <div class="line-number"><a href="#L1005">1005</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function computes a relative path from a base directory to a target path.</div>
  </div>
  <div class="line not-executable" id="L1006">
    <div class="line-number"><a href="#L1006">1006</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It finds the common prefix between the paths and replaces the non-common parts</div>
  </div>
  <div class="line not-executable" id="L1007">
    <div class="line-number"><a href="#L1007">1007</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- with the appropriate &quot;../&quot; sequences.</div>
  </div>
  <div class="line not-executable" id="L1008">
    <div class="line-number"><a href="#L1008">1008</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1009">
    <div class="line-number"><a href="#L1009">1009</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to convert</div>
  </div>
  <div class="line not-executable" id="L1010">
    <div class="line-number"><a href="#L1010">1010</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param base string Base path to make relative to</div>
  </div>
  <div class="line not-executable" id="L1011">
    <div class="line-number"><a href="#L1011">1011</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil relative_path Path relative to base or nil if path or base is nil</div>
  </div>
  <div class="line not-executable" id="L1012">
    <div class="line-number"><a href="#L1012">1012</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1013">
    <div class="line-number"><a href="#L1013">1013</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1014">
    <div class="line-number"><a href="#L1014">1014</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get a path relative to a base directory</div>
  </div>
  <div class="line not-executable" id="L1015">
    <div class="line-number"><a href="#L1015">1015</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local rel_path = fs.get_relative_path(&quot;/home/user/projects/app/src/main.lua&quot;, &quot;/home/user/projects&quot;)</div>
  </div>
  <div class="line not-executable" id="L1016">
    <div class="line-number"><a href="#L1016">1016</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;app/src/main.lua&quot;</div>
  </div>
  <div class="line not-executable" id="L1017">
    <div class="line-number"><a href="#L1017">1017</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1018">
    <div class="line-number"><a href="#L1018">1018</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Path that requires going up directories</div>
  </div>
  <div class="line not-executable" id="L1019">
    <div class="line-number"><a href="#L1019">1019</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local rel_path = fs.get_relative_path(&quot;/home/user/projects/app/config&quot;, &quot;/home/user/projects/app/src&quot;)</div>
  </div>
  <div class="line not-executable" id="L1020">
    <div class="line-number"><a href="#L1020">1020</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;../config&quot;</div>
  </div>
  <div class="line not-executable" id="L1021">
    <div class="line-number"><a href="#L1021">1021</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1022">
    <div class="line-number"><a href="#L1022">1022</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Same directory case</div>
  </div>
  <div class="line not-executable" id="L1023">
    <div class="line-number"><a href="#L1023">1023</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local rel_path = fs.get_relative_path(&quot;/home/user/projects&quot;, &quot;/home/user/projects&quot;)</div>
  </div>
  <div class="line not-executable" id="L1024">
    <div class="line-number"><a href="#L1024">1024</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;.&quot; (current directory)</div>
  </div>
  <div class="line not-covered" id="L1025">
    <div class="line-number"><a href="#L1025">1025</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_relative_path(path, base)</div>
  </div>
  <div class="line not-covered" id="L1026">
    <div class="line-number"><a href="#L1026">1026</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path or not base then return nil end</div>
  </div>
  <div class="line not-executable" id="L1027">
    <div class="line-number"><a href="#L1027">1027</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1028">
    <div class="line-number"><a href="#L1028">1028</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Normalize both paths</div>
  </div>
  <div class="line not-covered" id="L1029">
    <div class="line-number"><a href="#L1029">1029</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local norm_path = fs.normalize_path(path)</div>
  </div>
  <div class="line not-covered" id="L1030">
    <div class="line-number"><a href="#L1030">1030</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local norm_base = fs.normalize_path(base)</div>
  </div>
  <div class="line not-executable" id="L1031">
    <div class="line-number"><a href="#L1031">1031</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1032">
    <div class="line-number"><a href="#L1032">1032</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Make both absolute</div>
  </div>
  <div class="line not-covered" id="L1033">
    <div class="line-number"><a href="#L1033">1033</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local abs_path = fs.get_absolute_path(norm_path)</div>
  </div>
  <div class="line not-covered" id="L1034">
    <div class="line-number"><a href="#L1034">1034</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local abs_base = fs.get_absolute_path(norm_base)</div>
  </div>
  <div class="line not-executable" id="L1035">
    <div class="line-number"><a href="#L1035">1035</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1036">
    <div class="line-number"><a href="#L1036">1036</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Split paths into segments</div>
  </div>
  <div class="line not-covered" id="L1037">
    <div class="line-number"><a href="#L1037">1037</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local path_segments = {}</div>
  </div>
  <div class="line not-covered" id="L1038">
    <div class="line-number"><a href="#L1038">1038</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for segment in abs_path:gmatch(&quot;[^/]+&quot;) do</div>
  </div>
  <div class="line not-covered" id="L1039">
    <div class="line-number"><a href="#L1039">1039</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(path_segments, segment)</div>
  </div>
  <div class="line not-covered" id="L1040">
    <div class="line-number"><a href="#L1040">1040</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1041">
    <div class="line-number"><a href="#L1041">1041</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1042">
    <div class="line-number"><a href="#L1042">1042</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local base_segments = {}</div>
  </div>
  <div class="line not-covered" id="L1043">
    <div class="line-number"><a href="#L1043">1043</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for segment in abs_base:gmatch(&quot;[^/]+&quot;) do</div>
  </div>
  <div class="line not-covered" id="L1044">
    <div class="line-number"><a href="#L1044">1044</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(base_segments, segment)</div>
  </div>
  <div class="line not-covered" id="L1045">
    <div class="line-number"><a href="#L1045">1045</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1046">
    <div class="line-number"><a href="#L1046">1046</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1047">
    <div class="line-number"><a href="#L1047">1047</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Find common prefix</div>
  </div>
  <div class="line not-covered" id="L1048">
    <div class="line-number"><a href="#L1048">1048</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local common_length = 0</div>
  </div>
  <div class="line not-covered" id="L1049">
    <div class="line-number"><a href="#L1049">1049</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local min_length = math.min(#path_segments, #base_segments)</div>
  </div>
  <div class="line not-executable" id="L1050">
    <div class="line-number"><a href="#L1050">1050</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1051">
    <div class="line-number"><a href="#L1051">1051</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i = 1, min_length do</div>
  </div>
  <div class="line not-covered" id="L1052">
    <div class="line-number"><a href="#L1052">1052</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if path_segments[i] == base_segments[i] then</div>
  </div>
  <div class="line not-covered" id="L1053">
    <div class="line-number"><a href="#L1053">1053</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            common_length = i</div>
  </div>
  <div class="line not-covered" id="L1054">
    <div class="line-number"><a href="#L1054">1054</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L1055">
    <div class="line-number"><a href="#L1055">1055</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            break</div>
  </div>
  <div class="line not-covered" id="L1056">
    <div class="line-number"><a href="#L1056">1056</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1057">
    <div class="line-number"><a href="#L1057">1057</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1058">
    <div class="line-number"><a href="#L1058">1058</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1059">
    <div class="line-number"><a href="#L1059">1059</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Build relative path</div>
  </div>
  <div class="line not-covered" id="L1060">
    <div class="line-number"><a href="#L1060">1060</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = {}</div>
  </div>
  <div class="line not-executable" id="L1061">
    <div class="line-number"><a href="#L1061">1061</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1062">
    <div class="line-number"><a href="#L1062">1062</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Add &quot;../&quot; for each segment in base after common prefix</div>
  </div>
  <div class="line not-covered" id="L1063">
    <div class="line-number"><a href="#L1063">1063</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i = common_length + 1, #base_segments do</div>
  </div>
  <div class="line not-covered" id="L1064">
    <div class="line-number"><a href="#L1064">1064</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(result, &quot;..&quot;)</div>
  </div>
  <div class="line not-covered" id="L1065">
    <div class="line-number"><a href="#L1065">1065</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1066">
    <div class="line-number"><a href="#L1066">1066</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1067">
    <div class="line-number"><a href="#L1067">1067</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Add remaining segments from path</div>
  </div>
  <div class="line not-covered" id="L1068">
    <div class="line-number"><a href="#L1068">1068</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i = common_length + 1, #path_segments do</div>
  </div>
  <div class="line not-covered" id="L1069">
    <div class="line-number"><a href="#L1069">1069</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(result, path_segments[i])</div>
  </div>
  <div class="line not-covered" id="L1070">
    <div class="line-number"><a href="#L1070">1070</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1071">
    <div class="line-number"><a href="#L1071">1071</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1072">
    <div class="line-number"><a href="#L1072">1072</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle empty result (same directory)</div>
  </div>
  <div class="line not-covered" id="L1073">
    <div class="line-number"><a href="#L1073">1073</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if #result == 0 then</div>
  </div>
  <div class="line not-covered" id="L1074">
    <div class="line-number"><a href="#L1074">1074</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return &quot;.&quot;</div>
  </div>
  <div class="line not-covered" id="L1075">
    <div class="line-number"><a href="#L1075">1075</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1076">
    <div class="line-number"><a href="#L1076">1076</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1077">
    <div class="line-number"><a href="#L1077">1077</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Join segments</div>
  </div>
  <div class="line not-covered" id="L1078">
    <div class="line-number"><a href="#L1078">1078</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return table.concat(result, &quot;/&quot;)</div>
  </div>
  <div class="line not-covered" id="L1079">
    <div class="line-number"><a href="#L1079">1079</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1080">
    <div class="line-number"><a href="#L1080">1080</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- File Discovery</div>
  </div>
  <div class="line not-executable" id="L1081">
    <div class="line-number"><a href="#L1081">1081</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Convert a glob pattern to a Lua pattern for matching</div>
  </div>
  <div class="line not-executable" id="L1082">
    <div class="line-number"><a href="#L1082">1082</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function converts shell-style glob patterns like &quot;*.lua&quot; or &quot;src/**/*.js&quot;</div>
  </div>
  <div class="line not-executable" id="L1083">
    <div class="line-number"><a href="#L1083">1083</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- to Lua pattern strings that can be used with string.match() and similar functions.</div>
  </div>
  <div class="line not-executable" id="L1084">
    <div class="line-number"><a href="#L1084">1084</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It supports standard glob features including * (any characters), ? (single character),</div>
  </div>
  <div class="line not-executable" id="L1085">
    <div class="line-number"><a href="#L1085">1085</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and ** (recursive directory matching).</div>
  </div>
  <div class="line not-executable" id="L1086">
    <div class="line-number"><a href="#L1086">1086</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1087">
    <div class="line-number"><a href="#L1087">1087</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param glob string Glob pattern to convert</div>
  </div>
  <div class="line not-executable" id="L1088">
    <div class="line-number"><a href="#L1088">1088</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil pattern Lua pattern equivalent or nil if glob is nil</div>
  </div>
  <div class="line not-executable" id="L1089">
    <div class="line-number"><a href="#L1089">1089</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1090">
    <div class="line-number"><a href="#L1090">1090</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1091">
    <div class="line-number"><a href="#L1091">1091</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Convert simple file extension glob</div>
  </div>
  <div class="line not-executable" id="L1092">
    <div class="line-number"><a href="#L1092">1092</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local pattern = fs.glob_to_pattern(&quot;*.lua&quot;)</div>
  </div>
  <div class="line not-executable" id="L1093">
    <div class="line-number"><a href="#L1093">1093</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result: &quot;^.+%.lua$&quot;</div>
  </div>
  <div class="line not-executable" id="L1094">
    <div class="line-number"><a href="#L1094">1094</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1095">
    <div class="line-number"><a href="#L1095">1095</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Convert pattern with ? wildcard</div>
  </div>
  <div class="line not-executable" id="L1096">
    <div class="line-number"><a href="#L1096">1096</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local pattern = fs.glob_to_pattern(&quot;file?.txt&quot;)</div>
  </div>
  <div class="line not-executable" id="L1097">
    <div class="line-number"><a href="#L1097">1097</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- This will match file1.txt, fileA.txt, etc.</div>
  </div>
  <div class="line not-executable" id="L1098">
    <div class="line-number"><a href="#L1098">1098</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1099">
    <div class="line-number"><a href="#L1099">1099</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Convert pattern with ** (recursive) wildcard</div>
  </div>
  <div class="line not-executable" id="L1100">
    <div class="line-number"><a href="#L1100">1100</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local pattern = fs.glob_to_pattern(&quot;src/**/*.js&quot;)</div>
  </div>
  <div class="line not-executable" id="L1101">
    <div class="line-number"><a href="#L1101">1101</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- This will match any .js file in src or any subdirectory</div>
  </div>
  <div class="line not-covered" id="L1102">
    <div class="line-number"><a href="#L1102">1102</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.glob_to_pattern(glob)</div>
  </div>
  <div class="line not-covered" id="L1103">
    <div class="line-number"><a href="#L1103">1103</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not glob then return nil end</div>
  </div>
  <div class="line not-executable" id="L1104">
    <div class="line-number"><a href="#L1104">1104</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1105">
    <div class="line-number"><a href="#L1105">1105</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- First, handle common extension patterns like *.lua</div>
  </div>
  <div class="line not-covered" id="L1106">
    <div class="line-number"><a href="#L1106">1106</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if glob == &quot;*.lua&quot; then</div>
  </div>
  <div class="line not-covered" id="L1107">
    <div class="line-number"><a href="#L1107">1107</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return &quot;^.+%.lua$&quot;</div>
  </div>
  <div class="line not-covered" id="L1108">
    <div class="line-number"><a href="#L1108">1108</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif glob == &quot;*.txt&quot; then</div>
  </div>
  <div class="line not-covered" id="L1109">
    <div class="line-number"><a href="#L1109">1109</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return &quot;^.+%.txt$&quot;</div>
  </div>
  <div class="line not-covered" id="L1110">
    <div class="line-number"><a href="#L1110">1110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1111">
    <div class="line-number"><a href="#L1111">1111</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1112">
    <div class="line-number"><a href="#L1112">1112</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle special case: if pattern starts with '**/' (for recursive directory search)</div>
  </div>
  <div class="line not-executable" id="L1113">
    <div class="line-number"><a href="#L1113">1113</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- This is a common pattern like &quot;**/*.lua&quot; to match any Lua file in any subdirectory</div>
  </div>
  <div class="line not-covered" id="L1114">
    <div class="line-number"><a href="#L1114">1114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if glob:match(&quot;^%*%*/&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1115">
    <div class="line-number"><a href="#L1115">1115</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Separate handling for leading **/ pattern</div>
  </div>
  <div class="line not-covered" id="L1116">
    <div class="line-number"><a href="#L1116">1116</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local remainder = glob:gsub(&quot;^%*%*/&quot;, &quot;&quot;)</div>
  </div>
  <div class="line not-executable" id="L1117">
    <div class="line-number"><a href="#L1117">1117</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1118">
    <div class="line-number"><a href="#L1118">1118</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- If remainder is just a file extension pattern like &quot;*.lua&quot;</div>
  </div>
  <div class="line not-covered" id="L1119">
    <div class="line-number"><a href="#L1119">1119</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if remainder == &quot;*.lua&quot; then</div>
  </div>
  <div class="line not-covered" id="L1120">
    <div class="line-number"><a href="#L1120">1120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;^.+%.lua$&quot; -- Match any Lua file</div>
  </div>
  <div class="line not-covered" id="L1121">
    <div class="line-number"><a href="#L1121">1121</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif remainder == &quot;*.js&quot; then</div>
  </div>
  <div class="line not-covered" id="L1122">
    <div class="line-number"><a href="#L1122">1122</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return &quot;^.+%.js$&quot;  -- Match any JS file</div>
  </div>
  <div class="line not-covered" id="L1123">
    <div class="line-number"><a href="#L1123">1123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1124">
    <div class="line-number"><a href="#L1124">1124</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1125">
    <div class="line-number"><a href="#L1125">1125</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- For other patterns, convert remainder to pattern</div>
  </div>
  <div class="line not-covered" id="L1126">
    <div class="line-number"><a href="#L1126">1126</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        remainder = remainder:gsub(&quot;([%^%$%(%)%%%.%[%]%+%-])&quot;, &quot;%%%1&quot;)</div>
  </div>
  <div class="line not-covered" id="L1127">
    <div class="line-number"><a href="#L1127">1127</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        remainder = remainder:gsub(&quot;%*%*&quot;, &quot;**GLOBSTAR**&quot;)</div>
  </div>
  <div class="line not-covered" id="L1128">
    <div class="line-number"><a href="#L1128">1128</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        remainder = remainder:gsub(&quot;%*&quot;, &quot;[^/]*&quot;)</div>
  </div>
  <div class="line not-covered" id="L1129">
    <div class="line-number"><a href="#L1129">1129</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        remainder = remainder:gsub(&quot;%?&quot;, &quot;[^/]&quot;)</div>
  </div>
  <div class="line not-covered" id="L1130">
    <div class="line-number"><a href="#L1130">1130</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        remainder = remainder:gsub(&quot;%*%*GLOBSTAR%*%*&quot;, &quot;.*&quot;)</div>
  </div>
  <div class="line not-executable" id="L1131">
    <div class="line-number"><a href="#L1131">1131</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1132">
    <div class="line-number"><a href="#L1132">1132</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Create a pattern that matches any path ending with the remainder</div>
  </div>
  <div class="line not-covered" id="L1133">
    <div class="line-number"><a href="#L1133">1133</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return &quot;^.*/&quot; .. remainder .. &quot;$&quot;</div>
  </div>
  <div class="line not-covered" id="L1134">
    <div class="line-number"><a href="#L1134">1134</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1135">
    <div class="line-number"><a href="#L1135">1135</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1136">
    <div class="line-number"><a href="#L1136">1136</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Start with a clean pattern</div>
  </div>
  <div class="line not-covered" id="L1137">
    <div class="line-number"><a href="#L1137">1137</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local pattern = glob</div>
  </div>
  <div class="line not-executable" id="L1138">
    <div class="line-number"><a href="#L1138">1138</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1139">
    <div class="line-number"><a href="#L1139">1139</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Escape magic characters except * and ?</div>
  </div>
  <div class="line not-covered" id="L1140">
    <div class="line-number"><a href="#L1140">1140</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pattern = pattern:gsub(&quot;([%^%$%(%)%%%.%[%]%+%-])&quot;, &quot;%%%1&quot;)</div>
  </div>
  <div class="line not-executable" id="L1141">
    <div class="line-number"><a href="#L1141">1141</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1142">
    <div class="line-number"><a href="#L1142">1142</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Replace ** with a special marker (must be done before *)</div>
  </div>
  <div class="line not-covered" id="L1143">
    <div class="line-number"><a href="#L1143">1143</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pattern = pattern:gsub(&quot;%*%*&quot;, &quot;**GLOBSTAR**&quot;)</div>
  </div>
  <div class="line not-executable" id="L1144">
    <div class="line-number"><a href="#L1144">1144</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1145">
    <div class="line-number"><a href="#L1145">1145</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Replace * with match any except / pattern</div>
  </div>
  <div class="line not-covered" id="L1146">
    <div class="line-number"><a href="#L1146">1146</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pattern = pattern:gsub(&quot;%*&quot;, &quot;[^/]*&quot;)</div>
  </div>
  <div class="line not-executable" id="L1147">
    <div class="line-number"><a href="#L1147">1147</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1148">
    <div class="line-number"><a href="#L1148">1148</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Replace ? with match any single character except /</div>
  </div>
  <div class="line not-covered" id="L1149">
    <div class="line-number"><a href="#L1149">1149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pattern = pattern:gsub(&quot;%?&quot;, &quot;[^/]&quot;)</div>
  </div>
  <div class="line not-executable" id="L1150">
    <div class="line-number"><a href="#L1150">1150</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1151">
    <div class="line-number"><a href="#L1151">1151</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Put back the globstar and replace with match anything pattern</div>
  </div>
  <div class="line not-executable" id="L1152">
    <div class="line-number"><a href="#L1152">1152</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Enhanced to properly handle path traversal</div>
  </div>
  <div class="line not-covered" id="L1153">
    <div class="line-number"><a href="#L1153">1153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pattern = pattern:gsub(&quot;%*%*GLOBSTAR%*%*&quot;, &quot;.*&quot;)</div>
  </div>
  <div class="line not-executable" id="L1154">
    <div class="line-number"><a href="#L1154">1154</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1155">
    <div class="line-number"><a href="#L1155">1155</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Ensure pattern matches the entire string</div>
  </div>
  <div class="line not-covered" id="L1156">
    <div class="line-number"><a href="#L1156">1156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pattern = &quot;^&quot; .. pattern .. &quot;$&quot;</div>
  </div>
  <div class="line not-executable" id="L1157">
    <div class="line-number"><a href="#L1157">1157</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1158">
    <div class="line-number"><a href="#L1158">1158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return pattern</div>
  </div>
  <div class="line not-covered" id="L1159">
    <div class="line-number"><a href="#L1159">1159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1160">
    <div class="line-number"><a href="#L1160">1160</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Test if a path matches a glob pattern</div>
  </div>
  <div class="line not-executable" id="L1161">
    <div class="line-number"><a href="#L1161">1161</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function checks if a given path matches a specified glob pattern.</div>
  </div>
  <div class="line not-executable" id="L1162">
    <div class="line-number"><a href="#L1162">1162</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It handles both simple exact matching and complex glob patterns with</div>
  </div>
  <div class="line not-executable" id="L1163">
    <div class="line-number"><a href="#L1163">1163</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- wildcards. This is used for file filtering and discovery operations.</div>
  </div>
  <div class="line not-executable" id="L1164">
    <div class="line-number"><a href="#L1164">1164</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1165">
    <div class="line-number"><a href="#L1165">1165</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to test</div>
  </div>
  <div class="line not-executable" id="L1166">
    <div class="line-number"><a href="#L1166">1166</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param pattern string Glob pattern to match against</div>
  </div>
  <div class="line not-executable" id="L1167">
    <div class="line-number"><a href="#L1167">1167</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean|nil matches True if path matches pattern, nil on error</div>
  </div>
  <div class="line not-executable" id="L1168">
    <div class="line-number"><a href="#L1168">1168</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if matching failed</div>
  </div>
  <div class="line not-executable" id="L1169">
    <div class="line-number"><a href="#L1169">1169</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1170">
    <div class="line-number"><a href="#L1170">1170</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1171">
    <div class="line-number"><a href="#L1171">1171</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check if a file matches an extension pattern</div>
  </div>
  <div class="line not-executable" id="L1172">
    <div class="line-number"><a href="#L1172">1172</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if fs.matches_pattern(&quot;script.lua&quot;, &quot;*.lua&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1173">
    <div class="line-number"><a href="#L1173">1173</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Lua file detected&quot;)</div>
  </div>
  <div class="line not-executable" id="L1174">
    <div class="line-number"><a href="#L1174">1174</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1175">
    <div class="line-number"><a href="#L1175">1175</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1176">
    <div class="line-number"><a href="#L1176">1176</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check if a path matches a complex pattern</div>
  </div>
  <div class="line not-executable" id="L1177">
    <div class="line-number"><a href="#L1177">1177</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if fs.matches_pattern(&quot;src/components/Button.jsx&quot;, &quot;src/**/*.jsx&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1178">
    <div class="line-number"><a href="#L1178">1178</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;React component file detected&quot;)</div>
  </div>
  <div class="line not-executable" id="L1179">
    <div class="line-number"><a href="#L1179">1179</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1180">
    <div class="line-number"><a href="#L1180">1180</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1181">
    <div class="line-number"><a href="#L1181">1181</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Simple exact matching still works</div>
  </div>
  <div class="line not-executable" id="L1182">
    <div class="line-number"><a href="#L1182">1182</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fs.matches_pattern(&quot;LICENSE&quot;, &quot;LICENSE&quot;) -- returns true</div>
  </div>
  <div class="line not-covered" id="L1183">
    <div class="line-number"><a href="#L1183">1183</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.matches_pattern(path, pattern)</div>
  </div>
  <div class="line not-covered" id="L1184">
    <div class="line-number"><a href="#L1184">1184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path or not pattern then return false end</div>
  </div>
  <div class="line not-executable" id="L1185">
    <div class="line-number"><a href="#L1185">1185</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1186">
    <div class="line-number"><a href="#L1186">1186</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use proper pattern for handling error_handler.try results</div>
  </div>
  <div class="line not-covered" id="L1187">
    <div class="line-number"><a href="#L1187">1187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line not-executable" id="L1188">
    <div class="line-number"><a href="#L1188">1188</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- For debugging pattern matching issues</div>
  </div>
  <div class="line not-covered" id="L1189">
    <div class="line-number"><a href="#L1189">1189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local debug_mode = os.getenv(&quot;FIRMO_DEBUG_PATTERNS&quot;)</div>
  </div>
  <div class="line not-covered" id="L1190">
    <div class="line-number"><a href="#L1190">1190</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if debug_mode then</div>
  </div>
  <div class="line not-covered" id="L1191">
    <div class="line-number"><a href="#L1191">1191</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            print(&quot;PATTERN_DEBUG: Testing pattern '&quot; .. pattern .. &quot;' against path '&quot; .. path .. &quot;'&quot;)</div>
  </div>
  <div class="line not-covered" id="L1192">
    <div class="line-number"><a href="#L1192">1192</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1193">
    <div class="line-number"><a href="#L1193">1193</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1194">
    <div class="line-number"><a href="#L1194">1194</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Direct match for simple cases</div>
  </div>
  <div class="line not-covered" id="L1195">
    <div class="line-number"><a href="#L1195">1195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if pattern == path then</div>
  </div>
  <div class="line not-covered" id="L1196">
    <div class="line-number"><a href="#L1196">1196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if debug_mode then print(&quot;PATTERN_DEBUG: Direct match&quot;) end</div>
  </div>
  <div class="line not-covered" id="L1197">
    <div class="line-number"><a href="#L1197">1197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return true</div>
  </div>
  <div class="line not-covered" id="L1198">
    <div class="line-number"><a href="#L1198">1198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1199">
    <div class="line-number"><a href="#L1199">1199</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1200">
    <div class="line-number"><a href="#L1200">1200</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- HOTFIX: Handle specific coverage patterns we commonly use</div>
  </div>
  <div class="line not-executable" id="L1201">
    <div class="line-number"><a href="#L1201">1201</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Match &quot;**/*.lua&quot; - any Lua file in any directory</div>
  </div>
  <div class="line not-covered" id="L1202">
    <div class="line-number"><a href="#L1202">1202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if pattern == &quot;**/*.lua&quot; and path:match(&quot;%.lua$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1203">
    <div class="line-number"><a href="#L1203">1203</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if debug_mode then print(&quot;PATTERN_DEBUG: Match **/*.lua pattern&quot;) end</div>
  </div>
  <div class="line not-covered" id="L1204">
    <div class="line-number"><a href="#L1204">1204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return true</div>
  </div>
  <div class="line not-covered" id="L1205">
    <div class="line-number"><a href="#L1205">1205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1206">
    <div class="line-number"><a href="#L1206">1206</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1207">
    <div class="line-number"><a href="#L1207">1207</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Match &quot;examples/*.lua&quot; - any Lua file in examples directory</div>
  </div>
  <div class="line not-covered" id="L1208">
    <div class="line-number"><a href="#L1208">1208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if pattern == &quot;examples/*.lua&quot; and path:match(&quot;/examples/[^/]+%.lua$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1209">
    <div class="line-number"><a href="#L1209">1209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if debug_mode then print(&quot;PATTERN_DEBUG: Match examples/*.lua pattern&quot;) end</div>
  </div>
  <div class="line not-covered" id="L1210">
    <div class="line-number"><a href="#L1210">1210</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return true</div>
  </div>
  <div class="line not-covered" id="L1211">
    <div class="line-number"><a href="#L1211">1211</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1212">
    <div class="line-number"><a href="#L1212">1212</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1213">
    <div class="line-number"><a href="#L1213">1213</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Match &quot;*coverage*&quot; - any file with coverage in the name</div>
  </div>
  <div class="line not-covered" id="L1214">
    <div class="line-number"><a href="#L1214">1214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if pattern == &quot;*coverage*&quot; and path:match(&quot;coverage&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1215">
    <div class="line-number"><a href="#L1215">1215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if debug_mode then print(&quot;PATTERN_DEBUG: Match *coverage* pattern&quot;) end</div>
  </div>
  <div class="line not-covered" id="L1216">
    <div class="line-number"><a href="#L1216">1216</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return true</div>
  </div>
  <div class="line not-covered" id="L1217">
    <div class="line-number"><a href="#L1217">1217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1218">
    <div class="line-number"><a href="#L1218">1218</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1219">
    <div class="line-number"><a href="#L1219">1219</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Check if it's a glob pattern that needs conversion</div>
  </div>
  <div class="line not-covered" id="L1220">
    <div class="line-number"><a href="#L1220">1220</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local contains_glob = pattern:match(&quot;%*&quot;) or pattern:match(&quot;%?&quot;) or pattern:match(&quot;%[&quot;)</div>
  </div>
  <div class="line not-executable" id="L1221">
    <div class="line-number"><a href="#L1221">1221</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1222">
    <div class="line-number"><a href="#L1222">1222</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if contains_glob then</div>
  </div>
  <div class="line not-executable" id="L1223">
    <div class="line-number"><a href="#L1223">1223</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Convert glob to Lua pattern and perform matching</div>
  </div>
  <div class="line not-covered" id="L1224">
    <div class="line-number"><a href="#L1224">1224</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local lua_pattern = fs.glob_to_pattern(pattern)</div>
  </div>
  <div class="line not-executable" id="L1225">
    <div class="line-number"><a href="#L1225">1225</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-executable" id="L1226">
    <div class="line-number"><a href="#L1226">1226</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- For simple extension matching (e.g., *.lua)</div>
  </div>
  <div class="line not-covered" id="L1227">
    <div class="line-number"><a href="#L1227">1227</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if pattern == &quot;*.lua&quot; and path:match(&quot;%.lua$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1228">
    <div class="line-number"><a href="#L1228">1228</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if debug_mode then print(&quot;PATTERN_DEBUG: Match *.lua pattern&quot;) end</div>
  </div>
  <div class="line not-covered" id="L1229">
    <div class="line-number"><a href="#L1229">1229</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return true</div>
  </div>
  <div class="line not-covered" id="L1230">
    <div class="line-number"><a href="#L1230">1230</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L1231">
    <div class="line-number"><a href="#L1231">1231</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-executable" id="L1232">
    <div class="line-number"><a href="#L1232">1232</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Test the pattern match</div>
  </div>
  <div class="line not-covered" id="L1233">
    <div class="line-number"><a href="#L1233">1233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local match = path:match(lua_pattern) ~= nil</div>
  </div>
  <div class="line not-covered" id="L1234">
    <div class="line-number"><a href="#L1234">1234</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if debug_mode then </div>
  </div>
  <div class="line not-covered" id="L1235">
    <div class="line-number"><a href="#L1235">1235</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                print(&quot;PATTERN_DEBUG: Converted glob pattern to Lua pattern: &quot; .. lua_pattern)</div>
  </div>
  <div class="line not-covered" id="L1236">
    <div class="line-number"><a href="#L1236">1236</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                print(&quot;PATTERN_DEBUG: Match result: &quot; .. tostring(match)) </div>
  </div>
  <div class="line not-covered" id="L1237">
    <div class="line-number"><a href="#L1237">1237</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1238">
    <div class="line-number"><a href="#L1238">1238</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return match</div>
  </div>
  <div class="line not-covered" id="L1239">
    <div class="line-number"><a href="#L1239">1239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L1240">
    <div class="line-number"><a href="#L1240">1240</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Direct string comparison for non-glob patterns</div>
  </div>
  <div class="line not-covered" id="L1241">
    <div class="line-number"><a href="#L1241">1241</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if debug_mode then print(&quot;PATTERN_DEBUG: Non-glob comparison: &quot; .. tostring(path == pattern)) end</div>
  </div>
  <div class="line not-covered" id="L1242">
    <div class="line-number"><a href="#L1242">1242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return path == pattern</div>
  </div>
  <div class="line not-covered" id="L1243">
    <div class="line-number"><a href="#L1243">1243</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1244">
    <div class="line-number"><a href="#L1244">1244</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1245">
    <div class="line-number"><a href="#L1245">1245</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1246">
    <div class="line-number"><a href="#L1246">1246</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Properly handle the result of error_handler.try</div>
  </div>
  <div class="line not-covered" id="L1247">
    <div class="line-number"><a href="#L1247">1247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L1248">
    <div class="line-number"><a href="#L1248">1248</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return result</div>
  </div>
  <div class="line not-covered" id="L1249">
    <div class="line-number"><a href="#L1249">1249</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L1250">
    <div class="line-number"><a href="#L1250">1250</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, result  -- On failure, result contains the error object</div>
  </div>
  <div class="line not-covered" id="L1251">
    <div class="line-number"><a href="#L1251">1251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1252">
    <div class="line-number"><a href="#L1252">1252</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1253">
    <div class="line-number"><a href="#L1253">1253</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Find files matching patterns in specified directories</div>
  </div>
  <div class="line not-executable" id="L1254">
    <div class="line-number"><a href="#L1254">1254</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This advanced function performs recursive file discovery across multiple directories,</div>
  </div>
  <div class="line not-executable" id="L1255">
    <div class="line-number"><a href="#L1255">1255</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- applying include and exclude patterns to filter the results. It handles circular</div>
  </div>
  <div class="line not-executable" id="L1256">
    <div class="line-number"><a href="#L1256">1256</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- symlinks and provides a comprehensive file discovery mechanism.</div>
  </div>
  <div class="line not-executable" id="L1257">
    <div class="line-number"><a href="#L1257">1257</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1258">
    <div class="line-number"><a href="#L1258">1258</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param directories table List of root directories to search in</div>
  </div>
  <div class="line not-executable" id="L1259">
    <div class="line-number"><a href="#L1259">1259</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param patterns? table List of glob patterns to include (default: {&quot;*&quot;})</div>
  </div>
  <div class="line not-executable" id="L1260">
    <div class="line-number"><a href="#L1260">1260</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param exclude_patterns? table List of glob patterns to exclude</div>
  </div>
  <div class="line not-executable" id="L1261">
    <div class="line-number"><a href="#L1261">1261</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil matches List of matching file paths or nil on error</div>
  </div>
  <div class="line not-executable" id="L1262">
    <div class="line-number"><a href="#L1262">1262</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if discovery failed</div>
  </div>
  <div class="line not-executable" id="L1263">
    <div class="line-number"><a href="#L1263">1263</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1264">
    <div class="line-number"><a href="#L1264">1264</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1265">
    <div class="line-number"><a href="#L1265">1265</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Find all Lua files in the current project</div>
  </div>
  <div class="line not-executable" id="L1266">
    <div class="line-number"><a href="#L1266">1266</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local lua_files = fs.discover_files({&quot;/home/user/project&quot;}, {&quot;*.lua&quot;})</div>
  </div>
  <div class="line not-executable" id="L1267">
    <div class="line-number"><a href="#L1267">1267</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1268">
    <div class="line-number"><a href="#L1268">1268</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Find specific file types while excluding test files</div>
  </div>
  <div class="line not-executable" id="L1269">
    <div class="line-number"><a href="#L1269">1269</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local src_files = fs.discover_files(</div>
  </div>
  <div class="line not-executable" id="L1270">
    <div class="line-number"><a href="#L1270">1270</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   {&quot;/home/user/project/src&quot;, &quot;/home/user/project/lib&quot;},</div>
  </div>
  <div class="line not-executable" id="L1271">
    <div class="line-number"><a href="#L1271">1271</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   {&quot;*.lua&quot;, &quot;*.c&quot;, &quot;*.h&quot;},</div>
  </div>
  <div class="line not-executable" id="L1272">
    <div class="line-number"><a href="#L1272">1272</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   {&quot;*test*&quot;, &quot;*_spec.lua&quot;}</div>
  </div>
  <div class="line not-executable" id="L1273">
    <div class="line-number"><a href="#L1273">1273</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- )</div>
  </div>
  <div class="line not-executable" id="L1274">
    <div class="line-number"><a href="#L1274">1274</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1275">
    <div class="line-number"><a href="#L1275">1275</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Use with include/exclude patterns to find specific files</div>
  </div>
  <div class="line not-executable" id="L1276">
    <div class="line-number"><a href="#L1276">1276</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local config_files = fs.discover_files(</div>
  </div>
  <div class="line not-executable" id="L1277">
    <div class="line-number"><a href="#L1277">1277</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   {&quot;/etc&quot;, &quot;/home/user/.config&quot;},</div>
  </div>
  <div class="line not-executable" id="L1278">
    <div class="line-number"><a href="#L1278">1278</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   {&quot;*.json&quot;, &quot;*.yml&quot;, &quot;*.conf&quot;},</div>
  </div>
  <div class="line not-executable" id="L1279">
    <div class="line-number"><a href="#L1279">1279</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   {&quot;*backup*&quot;, &quot;*~&quot;}</div>
  </div>
  <div class="line not-executable" id="L1280">
    <div class="line-number"><a href="#L1280">1280</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- )</div>
  </div>
  <div class="line not-covered" id="L1281">
    <div class="line-number"><a href="#L1281">1281</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.discover_files(directories, patterns, exclude_patterns)</div>
  </div>
  <div class="line not-covered" id="L1282">
    <div class="line-number"><a href="#L1282">1282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not directories or #directories == 0 then return {} end</div>
  </div>
  <div class="line not-executable" id="L1283">
    <div class="line-number"><a href="#L1283">1283</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1284">
    <div class="line-number"><a href="#L1284">1284</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use proper pattern for handling error_handler.try results</div>
  </div>
  <div class="line not-covered" id="L1285">
    <div class="line-number"><a href="#L1285">1285</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line not-executable" id="L1286">
    <div class="line-number"><a href="#L1286">1286</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Default patterns if none provided</div>
  </div>
  <div class="line not-covered" id="L1287">
    <div class="line-number"><a href="#L1287">1287</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        patterns = patterns or {&quot;*&quot;}</div>
  </div>
  <div class="line not-covered" id="L1288">
    <div class="line-number"><a href="#L1288">1288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        exclude_patterns = exclude_patterns or {}</div>
  </div>
  <div class="line not-executable" id="L1289">
    <div class="line-number"><a href="#L1289">1289</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1290">
    <div class="line-number"><a href="#L1290">1290</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local matches = {}</div>
  </div>
  <div class="line not-covered" id="L1291">
    <div class="line-number"><a href="#L1291">1291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local processed = {}</div>
  </div>
  <div class="line not-executable" id="L1292">
    <div class="line-number"><a href="#L1292">1292</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1293">
    <div class="line-number"><a href="#L1293">1293</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Process a single directory</div>
  </div>
  <div class="line not-covered" id="L1294">
    <div class="line-number"><a href="#L1294">1294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local function process_directory(dir, current_path)</div>
  </div>
  <div class="line not-executable" id="L1295">
    <div class="line-number"><a href="#L1295">1295</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Avoid infinite loops from symlinks</div>
  </div>
  <div class="line not-covered" id="L1296">
    <div class="line-number"><a href="#L1296">1296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local absolute_path = fs.get_absolute_path(current_path)</div>
  </div>
  <div class="line not-covered" id="L1297">
    <div class="line-number"><a href="#L1297">1297</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if processed[absolute_path] then return end</div>
  </div>
  <div class="line not-covered" id="L1298">
    <div class="line-number"><a href="#L1298">1298</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            processed[absolute_path] = true</div>
  </div>
  <div class="line not-executable" id="L1299">
    <div class="line-number"><a href="#L1299">1299</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-executable" id="L1300">
    <div class="line-number"><a href="#L1300">1300</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Get directory contents</div>
  </div>
  <div class="line not-covered" id="L1301">
    <div class="line-number"><a href="#L1301">1301</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local contents, err = fs.get_directory_contents(current_path)</div>
  </div>
  <div class="line not-covered" id="L1302">
    <div class="line-number"><a href="#L1302">1302</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not contents then return end</div>
  </div>
  <div class="line not-executable" id="L1303">
    <div class="line-number"><a href="#L1303">1303</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L1304">
    <div class="line-number"><a href="#L1304">1304</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            for _, item in ipairs(contents) do</div>
  </div>
  <div class="line not-covered" id="L1305">
    <div class="line-number"><a href="#L1305">1305</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                local item_path = fs.join_paths(current_path, item)</div>
  </div>
  <div class="line not-executable" id="L1306">
    <div class="line-number"><a href="#L1306">1306</a></div>
    <div class="execution-count"></div>    <div class="line-content">                </div>
  </div>
  <div class="line not-executable" id="L1307">
    <div class="line-number"><a href="#L1307">1307</a></div>
    <div class="execution-count"></div>    <div class="line-content">                -- Skip if we can't access the path</div>
  </div>
  <div class="line not-covered" id="L1308">
    <div class="line-number"><a href="#L1308">1308</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                local is_dir = fs.is_directory(item_path)</div>
  </div>
  <div class="line not-covered" id="L1309">
    <div class="line-number"><a href="#L1309">1309</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                local is_file = not is_dir and fs.file_exists(item_path)</div>
  </div>
  <div class="line not-executable" id="L1310">
    <div class="line-number"><a href="#L1310">1310</a></div>
    <div class="execution-count"></div>    <div class="line-content">                </div>
  </div>
  <div class="line not-executable" id="L1311">
    <div class="line-number"><a href="#L1311">1311</a></div>
    <div class="execution-count"></div>    <div class="line-content">                -- Recursively process directories</div>
  </div>
  <div class="line not-covered" id="L1312">
    <div class="line-number"><a href="#L1312">1312</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if is_dir then</div>
  </div>
  <div class="line not-covered" id="L1313">
    <div class="line-number"><a href="#L1313">1313</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    process_directory(dir, item_path)</div>
  </div>
  <div class="line not-covered" id="L1314">
    <div class="line-number"><a href="#L1314">1314</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                elseif is_file then  -- Only process if it's a valid file we can access</div>
  </div>
  <div class="line not-executable" id="L1315">
    <div class="line-number"><a href="#L1315">1315</a></div>
    <div class="execution-count"></div>    <div class="line-content">                    -- Special handling for exact file extension matches</div>
  </div>
  <div class="line not-covered" id="L1316">
    <div class="line-number"><a href="#L1316">1316</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    local file_ext = fs.get_extension(item_path)</div>
  </div>
  <div class="line not-executable" id="L1317">
    <div class="line-number"><a href="#L1317">1317</a></div>
    <div class="execution-count"></div>    <div class="line-content">                    </div>
  </div>
  <div class="line not-executable" id="L1318">
    <div class="line-number"><a href="#L1318">1318</a></div>
    <div class="execution-count"></div>    <div class="line-content">                    -- Check if file matches any include pattern</div>
  </div>
  <div class="line not-covered" id="L1319">
    <div class="line-number"><a href="#L1319">1319</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    local match = false</div>
  </div>
  <div class="line not-covered" id="L1320">
    <div class="line-number"><a href="#L1320">1320</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    for _, pattern in ipairs(patterns) do</div>
  </div>
  <div class="line not-executable" id="L1321">
    <div class="line-number"><a href="#L1321">1321</a></div>
    <div class="execution-count"></div>    <div class="line-content">                        -- Simple extension pattern matching (common case)</div>
  </div>
  <div class="line not-covered" id="L1322">
    <div class="line-number"><a href="#L1322">1322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                        if pattern == &quot;*.&quot; .. file_ext then</div>
  </div>
  <div class="line not-covered" id="L1323">
    <div class="line-number"><a href="#L1323">1323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                            match = true</div>
  </div>
  <div class="line not-covered" id="L1324">
    <div class="line-number"><a href="#L1324">1324</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                            break</div>
  </div>
  <div class="line not-covered" id="L1325">
    <div class="line-number"><a href="#L1325">1325</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                        end</div>
  </div>
  <div class="line not-executable" id="L1326">
    <div class="line-number"><a href="#L1326">1326</a></div>
    <div class="execution-count"></div>    <div class="line-content">                        </div>
  </div>
  <div class="line not-executable" id="L1327">
    <div class="line-number"><a href="#L1327">1327</a></div>
    <div class="execution-count"></div>    <div class="line-content">                        -- More complex pattern matching</div>
  </div>
  <div class="line not-covered" id="L1328">
    <div class="line-number"><a href="#L1328">1328</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                        local item_name = fs.get_file_name(item_path)</div>
  </div>
  <div class="line not-covered" id="L1329">
    <div class="line-number"><a href="#L1329">1329</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                        if fs.matches_pattern(item_name, pattern) then</div>
  </div>
  <div class="line not-covered" id="L1330">
    <div class="line-number"><a href="#L1330">1330</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                            match = true</div>
  </div>
  <div class="line not-covered" id="L1331">
    <div class="line-number"><a href="#L1331">1331</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                            break</div>
  </div>
  <div class="line not-covered" id="L1332">
    <div class="line-number"><a href="#L1332">1332</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                        end</div>
  </div>
  <div class="line not-covered" id="L1333">
    <div class="line-number"><a href="#L1333">1333</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    end</div>
  </div>
  <div class="line not-executable" id="L1334">
    <div class="line-number"><a href="#L1334">1334</a></div>
    <div class="execution-count"></div>    <div class="line-content">                    </div>
  </div>
  <div class="line not-executable" id="L1335">
    <div class="line-number"><a href="#L1335">1335</a></div>
    <div class="execution-count"></div>    <div class="line-content">                    -- Check if file matches any exclude pattern</div>
  </div>
  <div class="line not-covered" id="L1336">
    <div class="line-number"><a href="#L1336">1336</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    if match then</div>
  </div>
  <div class="line not-covered" id="L1337">
    <div class="line-number"><a href="#L1337">1337</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                        for _, ex_pattern in ipairs(exclude_patterns) do</div>
  </div>
  <div class="line not-covered" id="L1338">
    <div class="line-number"><a href="#L1338">1338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                            local rel_path = fs.get_relative_path(item_path, dir)</div>
  </div>
  <div class="line not-covered" id="L1339">
    <div class="line-number"><a href="#L1339">1339</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                            if rel_path and fs.matches_pattern(rel_path, ex_pattern) then</div>
  </div>
  <div class="line not-covered" id="L1340">
    <div class="line-number"><a href="#L1340">1340</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                                match = false</div>
  </div>
  <div class="line not-covered" id="L1341">
    <div class="line-number"><a href="#L1341">1341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                                break</div>
  </div>
  <div class="line not-covered" id="L1342">
    <div class="line-number"><a href="#L1342">1342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                            end</div>
  </div>
  <div class="line not-covered" id="L1343">
    <div class="line-number"><a href="#L1343">1343</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                        end</div>
  </div>
  <div class="line not-covered" id="L1344">
    <div class="line-number"><a href="#L1344">1344</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    end</div>
  </div>
  <div class="line not-executable" id="L1345">
    <div class="line-number"><a href="#L1345">1345</a></div>
    <div class="execution-count"></div>    <div class="line-content">                    </div>
  </div>
  <div class="line not-executable" id="L1346">
    <div class="line-number"><a href="#L1346">1346</a></div>
    <div class="execution-count"></div>    <div class="line-content">                    -- Add matching file to results</div>
  </div>
  <div class="line not-covered" id="L1347">
    <div class="line-number"><a href="#L1347">1347</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    if match then</div>
  </div>
  <div class="line not-covered" id="L1348">
    <div class="line-number"><a href="#L1348">1348</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                        table.insert(matches, item_path)</div>
  </div>
  <div class="line not-covered" id="L1349">
    <div class="line-number"><a href="#L1349">1349</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    end</div>
  </div>
  <div class="line not-covered" id="L1350">
    <div class="line-number"><a href="#L1350">1350</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L1351">
    <div class="line-number"><a href="#L1351">1351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1352">
    <div class="line-number"><a href="#L1352">1352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1353">
    <div class="line-number"><a href="#L1353">1353</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1354">
    <div class="line-number"><a href="#L1354">1354</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Process each starting directory</div>
  </div>
  <div class="line not-covered" id="L1355">
    <div class="line-number"><a href="#L1355">1355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _, dir in ipairs(directories) do</div>
  </div>
  <div class="line not-covered" id="L1356">
    <div class="line-number"><a href="#L1356">1356</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if fs.directory_exists(dir) then</div>
  </div>
  <div class="line not-covered" id="L1357">
    <div class="line-number"><a href="#L1357">1357</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                process_directory(dir, dir)</div>
  </div>
  <div class="line not-covered" id="L1358">
    <div class="line-number"><a href="#L1358">1358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1359">
    <div class="line-number"><a href="#L1359">1359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1360">
    <div class="line-number"><a href="#L1360">1360</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1361">
    <div class="line-number"><a href="#L1361">1361</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return matches</div>
  </div>
  <div class="line not-covered" id="L1362">
    <div class="line-number"><a href="#L1362">1362</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1363">
    <div class="line-number"><a href="#L1363">1363</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1364">
    <div class="line-number"><a href="#L1364">1364</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Properly handle the result of error_handler.try</div>
  </div>
  <div class="line not-covered" id="L1365">
    <div class="line-number"><a href="#L1365">1365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L1366">
    <div class="line-number"><a href="#L1366">1366</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return result</div>
  </div>
  <div class="line not-covered" id="L1367">
    <div class="line-number"><a href="#L1367">1367</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L1368">
    <div class="line-number"><a href="#L1368">1368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, result  -- On failure, result contains the error object</div>
  </div>
  <div class="line not-covered" id="L1369">
    <div class="line-number"><a href="#L1369">1369</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1370">
    <div class="line-number"><a href="#L1370">1370</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1371">
    <div class="line-number"><a href="#L1371">1371</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Scan a directory for files with optional recursive behavior</div>
  </div>
  <div class="line not-executable" id="L1372">
    <div class="line-number"><a href="#L1372">1372</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function scans a directory and returns a flat list of all files it contains.</div>
  </div>
  <div class="line not-executable" id="L1373">
    <div class="line-number"><a href="#L1373">1373</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- If the recursive parameter is true, it will scan all subdirectories as well.</div>
  </div>
  <div class="line not-executable" id="L1374">
    <div class="line-number"><a href="#L1374">1374</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function safely handles circular symlinks and permission issues.</div>
  </div>
  <div class="line not-executable" id="L1375">
    <div class="line-number"><a href="#L1375">1375</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1376">
    <div class="line-number"><a href="#L1376">1376</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Directory path to scan</div>
  </div>
  <div class="line not-executable" id="L1377">
    <div class="line-number"><a href="#L1377">1377</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param recursive boolean Whether to scan recursively into subdirectories</div>
  </div>
  <div class="line not-executable" id="L1378">
    <div class="line-number"><a href="#L1378">1378</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table files List of absolute file paths found in the directory</div>
  </div>
  <div class="line not-executable" id="L1379">
    <div class="line-number"><a href="#L1379">1379</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1380">
    <div class="line-number"><a href="#L1380">1380</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1381">
    <div class="line-number"><a href="#L1381">1381</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get all files in the current directory (non-recursive)</div>
  </div>
  <div class="line not-executable" id="L1382">
    <div class="line-number"><a href="#L1382">1382</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local files = fs.scan_directory(&quot;/home/user/docs&quot;, false)</div>
  </div>
  <div class="line not-executable" id="L1383">
    <div class="line-number"><a href="#L1383">1383</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, file_path in ipairs(files) do</div>
  </div>
  <div class="line not-executable" id="L1384">
    <div class="line-number"><a href="#L1384">1384</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Found file: &quot; .. file_path)</div>
  </div>
  <div class="line not-executable" id="L1385">
    <div class="line-number"><a href="#L1385">1385</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1386">
    <div class="line-number"><a href="#L1386">1386</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1387">
    <div class="line-number"><a href="#L1387">1387</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Recursively scan a project directory</div>
  </div>
  <div class="line not-executable" id="L1388">
    <div class="line-number"><a href="#L1388">1388</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local all_files = fs.scan_directory(&quot;/path/to/project&quot;, true)</div>
  </div>
  <div class="line not-executable" id="L1389">
    <div class="line-number"><a href="#L1389">1389</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(&quot;Project contains &quot; .. #all_files .. &quot; files&quot;)</div>
  </div>
  <div class="line not-covered" id="L1390">
    <div class="line-number"><a href="#L1390">1390</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.scan_directory(path, recursive)</div>
  </div>
  <div class="line not-covered" id="L1391">
    <div class="line-number"><a href="#L1391">1391</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return {} end</div>
  </div>
  <div class="line not-covered" id="L1392">
    <div class="line-number"><a href="#L1392">1392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not fs.directory_exists(path) then return {} end</div>
  </div>
  <div class="line not-executable" id="L1393">
    <div class="line-number"><a href="#L1393">1393</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1394">
    <div class="line-number"><a href="#L1394">1394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local results = {}</div>
  </div>
  <div class="line not-covered" id="L1395">
    <div class="line-number"><a href="#L1395">1395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local processed = {}</div>
  </div>
  <div class="line not-executable" id="L1396">
    <div class="line-number"><a href="#L1396">1396</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1397">
    <div class="line-number"><a href="#L1397">1397</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Scan a single directory</div>
  </div>
  <div class="line not-covered" id="L1398">
    <div class="line-number"><a href="#L1398">1398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local function scan(current_path)</div>
  </div>
  <div class="line not-executable" id="L1399">
    <div class="line-number"><a href="#L1399">1399</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Avoid infinite loops from symlinks</div>
  </div>
  <div class="line not-covered" id="L1400">
    <div class="line-number"><a href="#L1400">1400</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local absolute_path = fs.get_absolute_path(current_path)</div>
  </div>
  <div class="line not-covered" id="L1401">
    <div class="line-number"><a href="#L1401">1401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if processed[absolute_path] then return end</div>
  </div>
  <div class="line not-covered" id="L1402">
    <div class="line-number"><a href="#L1402">1402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        processed[absolute_path] = true</div>
  </div>
  <div class="line not-executable" id="L1403">
    <div class="line-number"><a href="#L1403">1403</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1404">
    <div class="line-number"><a href="#L1404">1404</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Get directory contents</div>
  </div>
  <div class="line not-covered" id="L1405">
    <div class="line-number"><a href="#L1405">1405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local contents, err = fs.get_directory_contents(current_path)</div>
  </div>
  <div class="line not-covered" id="L1406">
    <div class="line-number"><a href="#L1406">1406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not contents then return end</div>
  </div>
  <div class="line not-executable" id="L1407">
    <div class="line-number"><a href="#L1407">1407</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1408">
    <div class="line-number"><a href="#L1408">1408</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _, item in ipairs(contents) do</div>
  </div>
  <div class="line not-covered" id="L1409">
    <div class="line-number"><a href="#L1409">1409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local item_path = fs.join_paths(current_path, item)</div>
  </div>
  <div class="line not-executable" id="L1410">
    <div class="line-number"><a href="#L1410">1410</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-executable" id="L1411">
    <div class="line-number"><a href="#L1411">1411</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Skip if we can't access the path</div>
  </div>
  <div class="line not-covered" id="L1412">
    <div class="line-number"><a href="#L1412">1412</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local is_dir = fs.is_directory(item_path)</div>
  </div>
  <div class="line not-covered" id="L1413">
    <div class="line-number"><a href="#L1413">1413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local is_file = not is_dir and fs.file_exists(item_path)</div>
  </div>
  <div class="line not-executable" id="L1414">
    <div class="line-number"><a href="#L1414">1414</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L1415">
    <div class="line-number"><a href="#L1415">1415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if is_dir then</div>
  </div>
  <div class="line not-covered" id="L1416">
    <div class="line-number"><a href="#L1416">1416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if recursive then</div>
  </div>
  <div class="line not-covered" id="L1417">
    <div class="line-number"><a href="#L1417">1417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    scan(item_path)</div>
  </div>
  <div class="line not-covered" id="L1418">
    <div class="line-number"><a href="#L1418">1418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L1419">
    <div class="line-number"><a href="#L1419">1419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            elseif is_file then  -- Only add if it's a valid file we can access</div>
  </div>
  <div class="line not-covered" id="L1420">
    <div class="line-number"><a href="#L1420">1420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(results, item_path)</div>
  </div>
  <div class="line not-covered" id="L1421">
    <div class="line-number"><a href="#L1421">1421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1422">
    <div class="line-number"><a href="#L1422">1422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1423">
    <div class="line-number"><a href="#L1423">1423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1424">
    <div class="line-number"><a href="#L1424">1424</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1425">
    <div class="line-number"><a href="#L1425">1425</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    scan(path)</div>
  </div>
  <div class="line not-covered" id="L1426">
    <div class="line-number"><a href="#L1426">1426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return results</div>
  </div>
  <div class="line not-covered" id="L1427">
    <div class="line-number"><a href="#L1427">1427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1428">
    <div class="line-number"><a href="#L1428">1428</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Filter a list of files based on a pattern</div>
  </div>
  <div class="line not-executable" id="L1429">
    <div class="line-number"><a href="#L1429">1429</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function takes a list of file paths and returns only those that match</div>
  </div>
  <div class="line not-executable" id="L1430">
    <div class="line-number"><a href="#L1430">1430</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- the specified pattern. It supports both file extension patterns (*.lua) and</div>
  </div>
  <div class="line not-executable" id="L1431">
    <div class="line-number"><a href="#L1431">1431</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- more complex glob patterns. The matching is performed on the filename only,</div>
  </div>
  <div class="line not-executable" id="L1432">
    <div class="line-number"><a href="#L1432">1432</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- not the full path, making it easy to filter by file types or naming conventions.</div>
  </div>
  <div class="line not-executable" id="L1433">
    <div class="line-number"><a href="#L1433">1433</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1434">
    <div class="line-number"><a href="#L1434">1434</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param files table List of file paths to filter</div>
  </div>
  <div class="line not-executable" id="L1435">
    <div class="line-number"><a href="#L1435">1435</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param pattern string Pattern to match against (glob pattern or Lua pattern)</div>
  </div>
  <div class="line not-executable" id="L1436">
    <div class="line-number"><a href="#L1436">1436</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table matches List of matching file paths</div>
  </div>
  <div class="line not-executable" id="L1437">
    <div class="line-number"><a href="#L1437">1437</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1438">
    <div class="line-number"><a href="#L1438">1438</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1439">
    <div class="line-number"><a href="#L1439">1439</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Find all Lua files from a directory scan</div>
  </div>
  <div class="line not-executable" id="L1440">
    <div class="line-number"><a href="#L1440">1440</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local all_files = fs.scan_directory(&quot;/path/to/project&quot;, true)</div>
  </div>
  <div class="line not-executable" id="L1441">
    <div class="line-number"><a href="#L1441">1441</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local lua_files = fs.find_matches(all_files, &quot;*.lua&quot;)</div>
  </div>
  <div class="line not-executable" id="L1442">
    <div class="line-number"><a href="#L1442">1442</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L1443">
    <div class="line-number"><a href="#L1443">1443</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Filter files by a specific naming pattern</div>
  </div>
  <div class="line not-executable" id="L1444">
    <div class="line-number"><a href="#L1444">1444</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local all_files = fs.scan_directory(&quot;/path/to/project&quot;, true)</div>
  </div>
  <div class="line not-executable" id="L1445">
    <div class="line-number"><a href="#L1445">1445</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local test_files = fs.find_matches(all_files, &quot;*_test.lua&quot;)</div>
  </div>
  <div class="line not-executable" id="L1446">
    <div class="line-number"><a href="#L1446">1446</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1447">
    <div class="line-number"><a href="#L1447">1447</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Chain operations to find specific files</div>
  </div>
  <div class="line not-executable" id="L1448">
    <div class="line-number"><a href="#L1448">1448</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local all_files = fs.scan_directory(&quot;/path/to/project&quot;, true)</div>
  </div>
  <div class="line not-executable" id="L1449">
    <div class="line-number"><a href="#L1449">1449</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local config_files = fs.find_matches(all_files, &quot;*.json&quot;)</div>
  </div>
  <div class="line not-executable" id="L1450">
    <div class="line-number"><a href="#L1450">1450</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local user_configs = fs.find_matches(config_files, &quot;user_*&quot;)</div>
  </div>
  <div class="line not-executable" id="L1451">
    <div class="line-number"><a href="#L1451">1451</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the file extension from a file path</div>
  </div>
  <div class="line not-executable" id="L1452">
    <div class="line-number"><a href="#L1452">1452</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Returns the file extension (without the dot) or an empty string if no extension</div>
  </div>
  <div class="line not-executable" id="L1453">
    <div class="line-number"><a href="#L1453">1453</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string The file path</div>
  </div>
  <div class="line not-executable" id="L1454">
    <div class="line-number"><a href="#L1454">1454</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string extension The file extension (without the dot)</div>
  </div>
  <div class="line not-covered" id="L1455">
    <div class="line-number"><a href="#L1455">1455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_extension(path)</div>
  </div>
  <div class="line not-covered" id="L1456">
    <div class="line-number"><a href="#L1456">1456</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return &quot;&quot; end</div>
  </div>
  <div class="line not-executable" id="L1457">
    <div class="line-number"><a href="#L1457">1457</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1458">
    <div class="line-number"><a href="#L1458">1458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local filename = fs.get_file_name(path)</div>
  </div>
  <div class="line not-covered" id="L1459">
    <div class="line-number"><a href="#L1459">1459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local ext = filename:match(&quot;%.([^%.]+)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1460">
    <div class="line-number"><a href="#L1460">1460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return ext or &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L1461">
    <div class="line-number"><a href="#L1461">1461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1462">
    <div class="line-number"><a href="#L1462">1462</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get just the filename from a path</div>
  </div>
  <div class="line not-executable" id="L1463">
    <div class="line-number"><a href="#L1463">1463</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Returns the filename component (without directory path)</div>
  </div>
  <div class="line not-executable" id="L1464">
    <div class="line-number"><a href="#L1464">1464</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string The file path</div>
  </div>
  <div class="line not-executable" id="L1465">
    <div class="line-number"><a href="#L1465">1465</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string filename Just the filename part</div>
  </div>
  <div class="line not-covered" id="L1466">
    <div class="line-number"><a href="#L1466">1466</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_file_name(path)</div>
  </div>
  <div class="line not-covered" id="L1467">
    <div class="line-number"><a href="#L1467">1467</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return &quot;&quot; end</div>
  </div>
  <div class="line not-executable" id="L1468">
    <div class="line-number"><a href="#L1468">1468</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1469">
    <div class="line-number"><a href="#L1469">1469</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle both forward and backward slashes</div>
  </div>
  <div class="line not-covered" id="L1470">
    <div class="line-number"><a href="#L1470">1470</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local filename = path:match(&quot;[^\\/]*$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1471">
    <div class="line-number"><a href="#L1471">1471</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return filename or &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L1472">
    <div class="line-number"><a href="#L1472">1472</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1473">
    <div class="line-number"><a href="#L1473">1473</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Matches a filename against a glob or Lua pattern</div>
  </div>
  <div class="line not-executable" id="L1474">
    <div class="line-number"><a href="#L1474">1474</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Helper function used by find_matches and other pattern matching functions.</div>
  </div>
  <div class="line not-executable" id="L1475">
    <div class="line-number"><a href="#L1475">1475</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param filename string The filename to test</div>
  </div>
  <div class="line not-executable" id="L1476">
    <div class="line-number"><a href="#L1476">1476</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param pattern string The pattern to match against</div>
  </div>
  <div class="line not-executable" id="L1477">
    <div class="line-number"><a href="#L1477">1477</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean matches True if the filename matches the pattern</div>
  </div>
  <div class="line not-covered" id="L1478">
    <div class="line-number"><a href="#L1478">1478</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.matches_pattern(filename, pattern)</div>
  </div>
  <div class="line not-covered" id="L1479">
    <div class="line-number"><a href="#L1479">1479</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not filename or not pattern then return false end</div>
  </div>
  <div class="line not-executable" id="L1480">
    <div class="line-number"><a href="#L1480">1480</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1481">
    <div class="line-number"><a href="#L1481">1481</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Simple extension pattern (e.g., &quot;*.lua&quot;)</div>
  </div>
  <div class="line not-covered" id="L1482">
    <div class="line-number"><a href="#L1482">1482</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if pattern:match(&quot;^%*%.%w+$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1483">
    <div class="line-number"><a href="#L1483">1483</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local ext = pattern:match(&quot;^%*%.(%w+)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1484">
    <div class="line-number"><a href="#L1484">1484</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return fs.get_extension(filename) == ext</div>
  </div>
  <div class="line not-covered" id="L1485">
    <div class="line-number"><a href="#L1485">1485</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1486">
    <div class="line-number"><a href="#L1486">1486</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1487">
    <div class="line-number"><a href="#L1487">1487</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Simple wildcard test for &quot;*.lua&quot; pattern form</div>
  </div>
  <div class="line not-covered" id="L1488">
    <div class="line-number"><a href="#L1488">1488</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if pattern == &quot;*.lua&quot; and filename:sub(-4) == &quot;.lua&quot; then</div>
  </div>
  <div class="line not-covered" id="L1489">
    <div class="line-number"><a href="#L1489">1489</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L1490">
    <div class="line-number"><a href="#L1490">1490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1491">
    <div class="line-number"><a href="#L1491">1491</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1492">
    <div class="line-number"><a href="#L1492">1492</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Translate basic glob patterns to Lua patterns</div>
  </div>
  <div class="line not-covered" id="L1493">
    <div class="line-number"><a href="#L1493">1493</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local lua_pattern = pattern</div>
  </div>
  <div class="line not-covered" id="L1494">
    <div class="line-number"><a href="#L1494">1494</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    lua_pattern = lua_pattern:gsub(&quot;%.&quot;, &quot;%%.&quot;)  -- Escape dots</div>
  </div>
  <div class="line not-covered" id="L1495">
    <div class="line-number"><a href="#L1495">1495</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    lua_pattern = lua_pattern:gsub(&quot;%*&quot;, &quot;.*&quot;)   -- * becomes .*</div>
  </div>
  <div class="line not-covered" id="L1496">
    <div class="line-number"><a href="#L1496">1496</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    lua_pattern = lua_pattern:gsub(&quot;%?&quot;, &quot;.&quot;)    -- ? becomes .</div>
  </div>
  <div class="line not-executable" id="L1497">
    <div class="line-number"><a href="#L1497">1497</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1498">
    <div class="line-number"><a href="#L1498">1498</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Add start and end anchors</div>
  </div>
  <div class="line not-covered" id="L1499">
    <div class="line-number"><a href="#L1499">1499</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    lua_pattern = &quot;^&quot; .. lua_pattern .. &quot;$&quot;</div>
  </div>
  <div class="line not-executable" id="L1500">
    <div class="line-number"><a href="#L1500">1500</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1501">
    <div class="line-number"><a href="#L1501">1501</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Do the pattern match</div>
  </div>
  <div class="line not-covered" id="L1502">
    <div class="line-number"><a href="#L1502">1502</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return filename:match(lua_pattern) ~= nil</div>
  </div>
  <div class="line not-covered" id="L1503">
    <div class="line-number"><a href="#L1503">1503</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L1504">
    <div class="line-number"><a href="#L1504">1504</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.find_matches(files, pattern)</div>
  </div>
  <div class="line not-covered" id="L1505">
    <div class="line-number"><a href="#L1505">1505</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not files or not pattern then return {} end</div>
  </div>
  <div class="line not-executable" id="L1506">
    <div class="line-number"><a href="#L1506">1506</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1507">
    <div class="line-number"><a href="#L1507">1507</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local matches = {}</div>
  </div>
  <div class="line not-covered" id="L1508">
    <div class="line-number"><a href="#L1508">1508</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, file in ipairs(files) do</div>
  </div>
  <div class="line not-executable" id="L1509">
    <div class="line-number"><a href="#L1509">1509</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Get just the filename for pattern matching (not the full path)</div>
  </div>
  <div class="line not-covered" id="L1510">
    <div class="line-number"><a href="#L1510">1510</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local filename = fs.get_file_name(file)</div>
  </div>
  <div class="line not-executable" id="L1511">
    <div class="line-number"><a href="#L1511">1511</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1512">
    <div class="line-number"><a href="#L1512">1512</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Special case for file extension patterns</div>
  </div>
  <div class="line not-covered" id="L1513">
    <div class="line-number"><a href="#L1513">1513</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if pattern:match(&quot;^%*%.%w+$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1514">
    <div class="line-number"><a href="#L1514">1514</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local ext = pattern:match(&quot;^%*%.(%w+)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1515">
    <div class="line-number"><a href="#L1515">1515</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if fs.get_extension(file) == ext then</div>
  </div>
  <div class="line not-covered" id="L1516">
    <div class="line-number"><a href="#L1516">1516</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(matches, file)</div>
  </div>
  <div class="line not-covered" id="L1517">
    <div class="line-number"><a href="#L1517">1517</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L1518">
    <div class="line-number"><a href="#L1518">1518</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- General pattern matching</div>
  </div>
  <div class="line not-covered" id="L1519">
    <div class="line-number"><a href="#L1519">1519</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif fs.matches_pattern(filename, pattern) then</div>
  </div>
  <div class="line not-covered" id="L1520">
    <div class="line-number"><a href="#L1520">1520</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(matches, file)</div>
  </div>
  <div class="line not-covered" id="L1521">
    <div class="line-number"><a href="#L1521">1521</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1522">
    <div class="line-number"><a href="#L1522">1522</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1523">
    <div class="line-number"><a href="#L1523">1523</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1524">
    <div class="line-number"><a href="#L1524">1524</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return matches</div>
  </div>
  <div class="line not-covered" id="L1525">
    <div class="line-number"><a href="#L1525">1525</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1526">
    <div class="line-number"><a href="#L1526">1526</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get files matching a pattern in a directory (non-recursive)</div>
  </div>
  <div class="line not-executable" id="L1527">
    <div class="line-number"><a href="#L1527">1527</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function gets all files in a directory that match a specified pattern.</div>
  </div>
  <div class="line not-executable" id="L1528">
    <div class="line-number"><a href="#L1528">1528</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It filters the results to include only files (not directories).</div>
  </div>
  <div class="line not-executable" id="L1529">
    <div class="line-number"><a href="#L1529">1529</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1530">
    <div class="line-number"><a href="#L1530">1530</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param dir_path string Directory to search for files</div>
  </div>
  <div class="line not-executable" id="L1531">
    <div class="line-number"><a href="#L1531">1531</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param pattern? string Optional file matching pattern (e.g., &quot;*.lua&quot;)</div>
  </div>
  <div class="line not-executable" id="L1532">
    <div class="line-number"><a href="#L1532">1532</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string[]|nil files Array of matching file paths or nil on error</div>
  </div>
  <div class="line not-executable" id="L1533">
    <div class="line-number"><a href="#L1533">1533</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if the operation failed</div>
  </div>
  <div class="line not-executable" id="L1534">
    <div class="line-number"><a href="#L1534">1534</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1535">
    <div class="line-number"><a href="#L1535">1535</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1536">
    <div class="line-number"><a href="#L1536">1536</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get all Lua files in a directory</div>
  </div>
  <div class="line not-executable" id="L1537">
    <div class="line-number"><a href="#L1537">1537</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local files, err = fs.get_files(&quot;/path/to/dir&quot;, &quot;*.lua&quot;) </div>
  </div>
  <div class="line not-executable" id="L1538">
    <div class="line-number"><a href="#L1538">1538</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not files then</div>
  </div>
  <div class="line not-executable" id="L1539">
    <div class="line-number"><a href="#L1539">1539</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L1540">
    <div class="line-number"><a href="#L1540">1540</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L1541">
    <div class="line-number"><a href="#L1541">1541</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1542">
    <div class="line-number"><a href="#L1542">1542</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1543">
    <div class="line-number"><a href="#L1543">1543</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, file_path in ipairs(files) do</div>
  </div>
  <div class="line not-executable" id="L1544">
    <div class="line-number"><a href="#L1544">1544</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Found Lua file: &quot; .. file_path)</div>
  </div>
  <div class="line not-executable" id="L1545">
    <div class="line-number"><a href="#L1545">1545</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1546">
    <div class="line-number"><a href="#L1546">1546</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- List all files and directories in a directory</div>
  </div>
  <div class="line not-executable" id="L1547">
    <div class="line-number"><a href="#L1547">1547</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function returns a list of all files and directories in the specified path.</div>
  </div>
  <div class="line not-executable" id="L1548">
    <div class="line-number"><a href="#L1548">1548</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It does not distinguish between files and directories in the returned list.</div>
  </div>
  <div class="line not-executable" id="L1549">
    <div class="line-number"><a href="#L1549">1549</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1550">
    <div class="line-number"><a href="#L1550">1550</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param dir_path string Directory to list</div>
  </div>
  <div class="line not-executable" id="L1551">
    <div class="line-number"><a href="#L1551">1551</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil entries Array of file/directory names or nil on error</div>
  </div>
  <div class="line not-executable" id="L1552">
    <div class="line-number"><a href="#L1552">1552</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if the operation failed</div>
  </div>
  <div class="line not-covered" id="L1553">
    <div class="line-number"><a href="#L1553">1553</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.list_directory(dir_path)</div>
  </div>
  <div class="line not-covered" id="L1554">
    <div class="line-number"><a href="#L1554">1554</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not dir_path then</div>
  </div>
  <div class="line not-covered" id="L1555">
    <div class="line-number"><a href="#L1555">1555</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;No directory path provided&quot;</div>
  </div>
  <div class="line not-covered" id="L1556">
    <div class="line-number"><a href="#L1556">1556</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1557">
    <div class="line-number"><a href="#L1557">1557</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1558">
    <div class="line-number"><a href="#L1558">1558</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not fs.directory_exists(dir_path) then</div>
  </div>
  <div class="line not-covered" id="L1559">
    <div class="line-number"><a href="#L1559">1559</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Directory does not exist: &quot; .. dir_path</div>
  </div>
  <div class="line not-covered" id="L1560">
    <div class="line-number"><a href="#L1560">1560</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1561">
    <div class="line-number"><a href="#L1561">1561</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1562">
    <div class="line-number"><a href="#L1562">1562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local entries = {}</div>
  </div>
  <div class="line not-covered" id="L1563">
    <div class="line-number"><a href="#L1563">1563</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local command</div>
  </div>
  <div class="line not-executable" id="L1564">
    <div class="line-number"><a href="#L1564">1564</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1565">
    <div class="line-number"><a href="#L1565">1565</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if is_windows() then</div>
  </div>
  <div class="line not-executable" id="L1566">
    <div class="line-number"><a href="#L1566">1566</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Use PowerShell on Windows for consistent output</div>
  </div>
  <div class="line not-covered" id="L1567">
    <div class="line-number"><a href="#L1567">1567</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        command = string.format('powershell -Command &quot;Get-ChildItem -Path &quot;%s&quot; | Select-Object -ExpandProperty Name&quot;', dir_path)</div>
  </div>
  <div class="line not-covered" id="L1568">
    <div class="line-number"><a href="#L1568">1568</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L1569">
    <div class="line-number"><a href="#L1569">1569</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Use ls command on Unix systems</div>
  </div>
  <div class="line not-covered" id="L1570">
    <div class="line-number"><a href="#L1570">1570</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        command = string.format('ls -A &quot;%s&quot;', dir_path)</div>
  </div>
  <div class="line not-covered" id="L1571">
    <div class="line-number"><a href="#L1571">1571</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1572">
    <div class="line-number"><a href="#L1572">1572</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1573">
    <div class="line-number"><a href="#L1573">1573</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local handle = io.popen(command)</div>
  </div>
  <div class="line not-covered" id="L1574">
    <div class="line-number"><a href="#L1574">1574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not handle then</div>
  </div>
  <div class="line not-covered" id="L1575">
    <div class="line-number"><a href="#L1575">1575</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Failed to list directory&quot;</div>
  </div>
  <div class="line not-covered" id="L1576">
    <div class="line-number"><a href="#L1576">1576</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1577">
    <div class="line-number"><a href="#L1577">1577</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1578">
    <div class="line-number"><a href="#L1578">1578</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for line in handle:lines() do</div>
  </div>
  <div class="line not-executable" id="L1579">
    <div class="line-number"><a href="#L1579">1579</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Skip current and parent directory entries</div>
  </div>
  <div class="line not-covered" id="L1580">
    <div class="line-number"><a href="#L1580">1580</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if line ~= &quot;.&quot; and line ~= &quot;..&quot; then</div>
  </div>
  <div class="line not-covered" id="L1581">
    <div class="line-number"><a href="#L1581">1581</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(entries, line)</div>
  </div>
  <div class="line not-covered" id="L1582">
    <div class="line-number"><a href="#L1582">1582</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1583">
    <div class="line-number"><a href="#L1583">1583</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1584">
    <div class="line-number"><a href="#L1584">1584</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1585">
    <div class="line-number"><a href="#L1585">1585</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    handle:close()</div>
  </div>
  <div class="line not-covered" id="L1586">
    <div class="line-number"><a href="#L1586">1586</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return entries</div>
  </div>
  <div class="line not-covered" id="L1587">
    <div class="line-number"><a href="#L1587">1587</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L1588">
    <div class="line-number"><a href="#L1588">1588</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_files(dir_path, pattern)</div>
  </div>
  <div class="line not-covered" id="L1589">
    <div class="line-number"><a href="#L1589">1589</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not dir_path then</div>
  </div>
  <div class="line not-covered" id="L1590">
    <div class="line-number"><a href="#L1590">1590</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;No directory path provided&quot;</div>
  </div>
  <div class="line not-covered" id="L1591">
    <div class="line-number"><a href="#L1591">1591</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1592">
    <div class="line-number"><a href="#L1592">1592</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1593">
    <div class="line-number"><a href="#L1593">1593</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not fs.directory_exists(dir_path) then</div>
  </div>
  <div class="line not-covered" id="L1594">
    <div class="line-number"><a href="#L1594">1594</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Directory does not exist: &quot; .. dir_path</div>
  </div>
  <div class="line not-covered" id="L1595">
    <div class="line-number"><a href="#L1595">1595</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1596">
    <div class="line-number"><a href="#L1596">1596</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1597">
    <div class="line-number"><a href="#L1597">1597</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use list_directory to get all entries in the directory</div>
  </div>
  <div class="line not-covered" id="L1598">
    <div class="line-number"><a href="#L1598">1598</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local entries, err = fs.list_directory(dir_path)</div>
  </div>
  <div class="line not-covered" id="L1599">
    <div class="line-number"><a href="#L1599">1599</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not entries then</div>
  </div>
  <div class="line not-covered" id="L1600">
    <div class="line-number"><a href="#L1600">1600</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Failed to list directory: &quot; .. (err or &quot;unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L1601">
    <div class="line-number"><a href="#L1601">1601</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1602">
    <div class="line-number"><a href="#L1602">1602</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1603">
    <div class="line-number"><a href="#L1603">1603</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local files = {}</div>
  </div>
  <div class="line not-covered" id="L1604">
    <div class="line-number"><a href="#L1604">1604</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, entry in ipairs(entries) do</div>
  </div>
  <div class="line not-covered" id="L1605">
    <div class="line-number"><a href="#L1605">1605</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local full_path = fs.join_paths(dir_path, entry)</div>
  </div>
  <div class="line not-executable" id="L1606">
    <div class="line-number"><a href="#L1606">1606</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1607">
    <div class="line-number"><a href="#L1607">1607</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Only include files, not directories</div>
  </div>
  <div class="line not-covered" id="L1608">
    <div class="line-number"><a href="#L1608">1608</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if fs.file_exists(full_path) then</div>
  </div>
  <div class="line not-executable" id="L1609">
    <div class="line-number"><a href="#L1609">1609</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- If a pattern is provided, filter by it</div>
  </div>
  <div class="line not-covered" id="L1610">
    <div class="line-number"><a href="#L1610">1610</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not pattern or fs.matches_pattern(entry, pattern) then</div>
  </div>
  <div class="line not-covered" id="L1611">
    <div class="line-number"><a href="#L1611">1611</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(files, full_path)</div>
  </div>
  <div class="line not-covered" id="L1612">
    <div class="line-number"><a href="#L1612">1612</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1613">
    <div class="line-number"><a href="#L1613">1613</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1614">
    <div class="line-number"><a href="#L1614">1614</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1615">
    <div class="line-number"><a href="#L1615">1615</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1616">
    <div class="line-number"><a href="#L1616">1616</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return files</div>
  </div>
  <div class="line not-covered" id="L1617">
    <div class="line-number"><a href="#L1617">1617</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1618">
    <div class="line-number"><a href="#L1618">1618</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Information Functions</div>
  </div>
  <div class="line not-executable" id="L1619">
    <div class="line-number"><a href="#L1619">1619</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if a file exists and is accessible</div>
  </div>
  <div class="line not-executable" id="L1620">
    <div class="line-number"><a href="#L1620">1620</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function verifies that the specified path exists as a readable file.</div>
  </div>
  <div class="line not-executable" id="L1621">
    <div class="line-number"><a href="#L1621">1621</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It attempts to open the file for reading, which confirms both existence</div>
  </div>
  <div class="line not-executable" id="L1622">
    <div class="line-number"><a href="#L1622">1622</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and read permissions. This is useful for validating file paths before</div>
  </div>
  <div class="line not-executable" id="L1623">
    <div class="line-number"><a href="#L1623">1623</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- performing operations on them.</div>
  </div>
  <div class="line not-executable" id="L1624">
    <div class="line-number"><a href="#L1624">1624</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1625">
    <div class="line-number"><a href="#L1625">1625</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the file to check</div>
  </div>
  <div class="line not-executable" id="L1626">
    <div class="line-number"><a href="#L1626">1626</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean exists True if the file exists and is readable</div>
  </div>
  <div class="line not-executable" id="L1627">
    <div class="line-number"><a href="#L1627">1627</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1628">
    <div class="line-number"><a href="#L1628">1628</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1629">
    <div class="line-number"><a href="#L1629">1629</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check before reading a configuration file</div>
  </div>
  <div class="line not-executable" id="L1630">
    <div class="line-number"><a href="#L1630">1630</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if fs.file_exists(&quot;/etc/app/config.json&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1631">
    <div class="line-number"><a href="#L1631">1631</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local content = fs.read_file(&quot;/etc/app/config.json&quot;)</div>
  </div>
  <div class="line not-executable" id="L1632">
    <div class="line-number"><a href="#L1632">1632</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- else</div>
  </div>
  <div class="line not-executable" id="L1633">
    <div class="line-number"><a href="#L1633">1633</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Configuration file not found&quot;)</div>
  </div>
  <div class="line not-executable" id="L1634">
    <div class="line-number"><a href="#L1634">1634</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1635">
    <div class="line-number"><a href="#L1635">1635</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1636">
    <div class="line-number"><a href="#L1636">1636</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Use with error handling pattern</div>
  </div>
  <div class="line not-executable" id="L1637">
    <div class="line-number"><a href="#L1637">1637</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = some_function()</div>
  </div>
  <div class="line not-executable" id="L1638">
    <div class="line-number"><a href="#L1638">1638</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success and fs.file_exists(backup_file_path) then</div>
  </div>
  <div class="line not-executable" id="L1639">
    <div class="line-number"><a href="#L1639">1639</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Restore from backup</div>
  </div>
  <div class="line not-executable" id="L1640">
    <div class="line-number"><a href="#L1640">1640</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   fs.copy_file(backup_file_path, original_file_path)</div>
  </div>
  <div class="line not-executable" id="L1641">
    <div class="line-number"><a href="#L1641">1641</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1642">
    <div class="line-number"><a href="#L1642">1642</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.file_exists(path)</div>
  </div>
  <div class="line not-covered" id="L1643">
    <div class="line-number"><a href="#L1643">1643</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return false end</div>
  </div>
  <div class="line not-executable" id="L1644">
    <div class="line-number"><a href="#L1644">1644</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1645">
    <div class="line-number"><a href="#L1645">1645</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local file = io.open(path, &quot;rb&quot;)</div>
  </div>
  <div class="line not-covered" id="L1646">
    <div class="line-number"><a href="#L1646">1646</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if file then</div>
  </div>
  <div class="line not-covered" id="L1647">
    <div class="line-number"><a href="#L1647">1647</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file:close()</div>
  </div>
  <div class="line not-covered" id="L1648">
    <div class="line-number"><a href="#L1648">1648</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L1649">
    <div class="line-number"><a href="#L1649">1649</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1650">
    <div class="line-number"><a href="#L1650">1650</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1651">
    <div class="line-number"><a href="#L1651">1651</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1652">
    <div class="line-number"><a href="#L1652">1652</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if a directory exists and is accessible</div>
  </div>
  <div class="line not-executable" id="L1653">
    <div class="line-number"><a href="#L1653">1653</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function verifies that the specified path exists as an accessible directory.</div>
  </div>
  <div class="line not-executable" id="L1654">
    <div class="line-number"><a href="#L1654">1654</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It uses platform-specific commands to ensure accurate results on both Windows</div>
  </div>
  <div class="line not-executable" id="L1655">
    <div class="line-number"><a href="#L1655">1655</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and Unix-like systems. The function properly handles special cases like root</div>
  </div>
  <div class="line not-executable" id="L1656">
    <div class="line-number"><a href="#L1656">1656</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- directories and paths with trailing slashes.</div>
  </div>
  <div class="line not-executable" id="L1657">
    <div class="line-number"><a href="#L1657">1657</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1658">
    <div class="line-number"><a href="#L1658">1658</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the directory to check</div>
  </div>
  <div class="line not-executable" id="L1659">
    <div class="line-number"><a href="#L1659">1659</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean exists True if the directory exists and is accessible</div>
  </div>
  <div class="line not-executable" id="L1660">
    <div class="line-number"><a href="#L1660">1660</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1661">
    <div class="line-number"><a href="#L1661">1661</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1662">
    <div class="line-number"><a href="#L1662">1662</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check before saving files to a directory</div>
  </div>
  <div class="line not-executable" id="L1663">
    <div class="line-number"><a href="#L1663">1663</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if fs.directory_exists(&quot;/var/app/data&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1664">
    <div class="line-number"><a href="#L1664">1664</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   fs.write_file(&quot;/var/app/data/output.txt&quot;, &quot;Content&quot;)</div>
  </div>
  <div class="line not-executable" id="L1665">
    <div class="line-number"><a href="#L1665">1665</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- else</div>
  </div>
  <div class="line not-executable" id="L1666">
    <div class="line-number"><a href="#L1666">1666</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Data directory not found&quot;)</div>
  </div>
  <div class="line not-executable" id="L1667">
    <div class="line-number"><a href="#L1667">1667</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1668">
    <div class="line-number"><a href="#L1668">1668</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1669">
    <div class="line-number"><a href="#L1669">1669</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Conditionally create a directory if it doesn't exist</div>
  </div>
  <div class="line not-executable" id="L1670">
    <div class="line-number"><a href="#L1670">1670</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not fs.directory_exists(log_dir) then</div>
  </div>
  <div class="line not-executable" id="L1671">
    <div class="line-number"><a href="#L1671">1671</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   fs.create_directory(log_dir)</div>
  </div>
  <div class="line not-executable" id="L1672">
    <div class="line-number"><a href="#L1672">1672</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1673">
    <div class="line-number"><a href="#L1673">1673</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.directory_exists(path)</div>
  </div>
  <div class="line not-covered" id="L1674">
    <div class="line-number"><a href="#L1674">1674</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path or path == &quot;&quot; then return false end</div>
  </div>
  <div class="line not-executable" id="L1675">
    <div class="line-number"><a href="#L1675">1675</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1676">
    <div class="line-number"><a href="#L1676">1676</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check for invalid characters in path that might cause issues</div>
  </div>
  <div class="line not-covered" id="L1677">
    <div class="line-number"><a href="#L1677">1677</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if path:match(&quot;[*?&lt;&gt;|]&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1678">
    <div class="line-number"><a href="#L1678">1678</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false</div>
  </div>
  <div class="line not-covered" id="L1679">
    <div class="line-number"><a href="#L1679">1679</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1680">
    <div class="line-number"><a href="#L1680">1680</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1681">
    <div class="line-number"><a href="#L1681">1681</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Normalize path to handle trailing slashes</div>
  </div>
  <div class="line not-covered" id="L1682">
    <div class="line-number"><a href="#L1682">1682</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local normalized_path = fs.normalize_path(path)</div>
  </div>
  <div class="line not-executable" id="L1683">
    <div class="line-number"><a href="#L1683">1683</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1684">
    <div class="line-number"><a href="#L1684">1684</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle root directory special case</div>
  </div>
  <div class="line not-covered" id="L1685">
    <div class="line-number"><a href="#L1685">1685</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if normalized_path == &quot;/&quot; then</div>
  </div>
  <div class="line not-covered" id="L1686">
    <div class="line-number"><a href="#L1686">1686</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L1687">
    <div class="line-number"><a href="#L1687">1687</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1688">
    <div class="line-number"><a href="#L1688">1688</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1689">
    <div class="line-number"><a href="#L1689">1689</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if the path exists and is a directory</div>
  </div>
  <div class="line not-covered" id="L1690">
    <div class="line-number"><a href="#L1690">1690</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local attributes</div>
  </div>
  <div class="line not-covered" id="L1691">
    <div class="line-number"><a href="#L1691">1691</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if is_windows() then</div>
  </div>
  <div class="line not-executable" id="L1692">
    <div class="line-number"><a href="#L1692">1692</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- On Windows, use dir command to check if directory exists</div>
  </div>
  <div class="line not-covered" id="L1693">
    <div class="line-number"><a href="#L1693">1693</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local result = os.execute('if exist &quot;' .. normalized_path .. '\\*&quot; (exit 0) else (exit 1)')</div>
  </div>
  <div class="line not-covered" id="L1694">
    <div class="line-number"><a href="#L1694">1694</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return result == true or result == 0</div>
  </div>
  <div class="line not-covered" id="L1695">
    <div class="line-number"><a href="#L1695">1695</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L1696">
    <div class="line-number"><a href="#L1696">1696</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- On Unix-like systems, use stat command</div>
  </div>
  <div class="line not-covered" id="L1697">
    <div class="line-number"><a href="#L1697">1697</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local result = os.execute('test -d &quot;' .. normalized_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L1698">
    <div class="line-number"><a href="#L1698">1698</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return result == true or result == 0</div>
  </div>
  <div class="line not-covered" id="L1699">
    <div class="line-number"><a href="#L1699">1699</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1700">
    <div class="line-number"><a href="#L1700">1700</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1701">
    <div class="line-number"><a href="#L1701">1701</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the size of a file in bytes</div>
  </div>
  <div class="line not-executable" id="L1702">
    <div class="line-number"><a href="#L1702">1702</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function retrieves the size of a file in bytes. It works by opening the file,</div>
  </div>
  <div class="line not-executable" id="L1703">
    <div class="line-number"><a href="#L1703">1703</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- seeking to the end to determine its size, and then closing it. The function</div>
  </div>
  <div class="line not-executable" id="L1704">
    <div class="line-number"><a href="#L1704">1704</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- includes proper error checking and validation to handle various edge cases.</div>
  </div>
  <div class="line not-executable" id="L1705">
    <div class="line-number"><a href="#L1705">1705</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1706">
    <div class="line-number"><a href="#L1706">1706</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the file to check</div>
  </div>
  <div class="line not-executable" id="L1707">
    <div class="line-number"><a href="#L1707">1707</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return number|nil size File size in bytes or nil on error</div>
  </div>
  <div class="line not-executable" id="L1708">
    <div class="line-number"><a href="#L1708">1708</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if getting the size failed</div>
  </div>
  <div class="line not-executable" id="L1709">
    <div class="line-number"><a href="#L1709">1709</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1710">
    <div class="line-number"><a href="#L1710">1710</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1711">
    <div class="line-number"><a href="#L1711">1711</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check file size before processing</div>
  </div>
  <div class="line not-executable" id="L1712">
    <div class="line-number"><a href="#L1712">1712</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local size, err = fs.get_file_size(&quot;/path/to/data.bin&quot;)</div>
  </div>
  <div class="line not-executable" id="L1713">
    <div class="line-number"><a href="#L1713">1713</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not size then</div>
  </div>
  <div class="line not-executable" id="L1714">
    <div class="line-number"><a href="#L1714">1714</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error getting file size: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L1715">
    <div class="line-number"><a href="#L1715">1715</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L1716">
    <div class="line-number"><a href="#L1716">1716</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1717">
    <div class="line-number"><a href="#L1717">1717</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1718">
    <div class="line-number"><a href="#L1718">1718</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Determine if a file exceeds a size limit</div>
  </div>
  <div class="line not-executable" id="L1719">
    <div class="line-number"><a href="#L1719">1719</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local max_size = 10 * 1024 * 1024 -- 10 MB</div>
  </div>
  <div class="line not-executable" id="L1720">
    <div class="line-number"><a href="#L1720">1720</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local size = fs.get_file_size(file_path)</div>
  </div>
  <div class="line not-executable" id="L1721">
    <div class="line-number"><a href="#L1721">1721</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if size and size &gt; max_size then</div>
  </div>
  <div class="line not-executable" id="L1722">
    <div class="line-number"><a href="#L1722">1722</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;File too large: &quot; .. (size / 1024 / 1024) .. &quot; MB&quot;)</div>
  </div>
  <div class="line not-executable" id="L1723">
    <div class="line-number"><a href="#L1723">1723</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1724">
    <div class="line-number"><a href="#L1724">1724</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_file_size(path)</div>
  </div>
  <div class="line not-covered" id="L1725">
    <div class="line-number"><a href="#L1725">1725</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not fs.file_exists(path) then</div>
  </div>
  <div class="line not-covered" id="L1726">
    <div class="line-number"><a href="#L1726">1726</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;File does not exist: &quot; .. (path or &quot;nil&quot;)</div>
  </div>
  <div class="line not-covered" id="L1727">
    <div class="line-number"><a href="#L1727">1727</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1728">
    <div class="line-number"><a href="#L1728">1728</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1729">
    <div class="line-number"><a href="#L1729">1729</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local file, err = io.open(path, &quot;rb&quot;)</div>
  </div>
  <div class="line not-covered" id="L1730">
    <div class="line-number"><a href="#L1730">1730</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not file then</div>
  </div>
  <div class="line not-covered" id="L1731">
    <div class="line-number"><a href="#L1731">1731</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Could not open file: &quot; .. (err or &quot;unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L1732">
    <div class="line-number"><a href="#L1732">1732</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1733">
    <div class="line-number"><a href="#L1733">1733</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1734">
    <div class="line-number"><a href="#L1734">1734</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local size = file:seek(&quot;end&quot;)</div>
  </div>
  <div class="line not-covered" id="L1735">
    <div class="line-number"><a href="#L1735">1735</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file:close()</div>
  </div>
  <div class="line not-executable" id="L1736">
    <div class="line-number"><a href="#L1736">1736</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1737">
    <div class="line-number"><a href="#L1737">1737</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return size</div>
  </div>
  <div class="line not-covered" id="L1738">
    <div class="line-number"><a href="#L1738">1738</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1739">
    <div class="line-number"><a href="#L1739">1739</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the last modified timestamp of a file or directory</div>
  </div>
  <div class="line not-executable" id="L1740">
    <div class="line-number"><a href="#L1740">1740</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function retrieves the last modification time of a file or directory as a </div>
  </div>
  <div class="line not-executable" id="L1741">
    <div class="line-number"><a href="#L1741">1741</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Unix timestamp (seconds since epoch). It uses platform-specific commands to</div>
  </div>
  <div class="line not-executable" id="L1742">
    <div class="line-number"><a href="#L1742">1742</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- ensure accurate results on both Windows and Unix-like systems. The function</div>
  </div>
  <div class="line not-executable" id="L1743">
    <div class="line-number"><a href="#L1743">1743</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- properly validates that the path exists before attempting to get its timestamp.</div>
  </div>
  <div class="line not-executable" id="L1744">
    <div class="line-number"><a href="#L1744">1744</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1745">
    <div class="line-number"><a href="#L1745">1745</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the file or directory</div>
  </div>
  <div class="line not-executable" id="L1746">
    <div class="line-number"><a href="#L1746">1746</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return number|nil timestamp Modification time as Unix timestamp or nil on error</div>
  </div>
  <div class="line not-executable" id="L1747">
    <div class="line-number"><a href="#L1747">1747</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if getting the time failed</div>
  </div>
  <div class="line not-executable" id="L1748">
    <div class="line-number"><a href="#L1748">1748</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1749">
    <div class="line-number"><a href="#L1749">1749</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1750">
    <div class="line-number"><a href="#L1750">1750</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check when a file was last modified</div>
  </div>
  <div class="line not-executable" id="L1751">
    <div class="line-number"><a href="#L1751">1751</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local timestamp, err = fs.get_modified_time(&quot;/path/to/config.json&quot;)</div>
  </div>
  <div class="line not-executable" id="L1752">
    <div class="line-number"><a href="#L1752">1752</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not timestamp then</div>
  </div>
  <div class="line not-executable" id="L1753">
    <div class="line-number"><a href="#L1753">1753</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error getting modification time: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L1754">
    <div class="line-number"><a href="#L1754">1754</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L1755">
    <div class="line-number"><a href="#L1755">1755</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1756">
    <div class="line-number"><a href="#L1756">1756</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local date_string = os.date(&quot;%Y-%m-%d %H:%M:%S&quot;, timestamp)</div>
  </div>
  <div class="line not-executable" id="L1757">
    <div class="line-number"><a href="#L1757">1757</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(&quot;File was last modified: &quot; .. date_string)</div>
  </div>
  <div class="line not-executable" id="L1758">
    <div class="line-number"><a href="#L1758">1758</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1759">
    <div class="line-number"><a href="#L1759">1759</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Determine if a file is older than a certain time</div>
  </div>
  <div class="line not-executable" id="L1760">
    <div class="line-number"><a href="#L1760">1760</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local now = os.time()</div>
  </div>
  <div class="line not-executable" id="L1761">
    <div class="line-number"><a href="#L1761">1761</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local mod_time = fs.get_modified_time(file_path)</div>
  </div>
  <div class="line not-executable" id="L1762">
    <div class="line-number"><a href="#L1762">1762</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local one_day = 24 * 60 * 60 -- Seconds in a day</div>
  </div>
  <div class="line not-executable" id="L1763">
    <div class="line-number"><a href="#L1763">1763</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if mod_time and (now - mod_time) &gt; one_day then</div>
  </div>
  <div class="line not-executable" id="L1764">
    <div class="line-number"><a href="#L1764">1764</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;File is more than one day old&quot;)</div>
  </div>
  <div class="line not-executable" id="L1765">
    <div class="line-number"><a href="#L1765">1765</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1766">
    <div class="line-number"><a href="#L1766">1766</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_modified_time(path)</div>
  </div>
  <div class="line not-covered" id="L1767">
    <div class="line-number"><a href="#L1767">1767</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return nil, &quot;No path provided&quot; end</div>
  </div>
  <div class="line not-covered" id="L1768">
    <div class="line-number"><a href="#L1768">1768</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not (fs.file_exists(path) or fs.directory_exists(path)) then</div>
  </div>
  <div class="line not-covered" id="L1769">
    <div class="line-number"><a href="#L1769">1769</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Path does not exist: &quot; .. path</div>
  </div>
  <div class="line not-covered" id="L1770">
    <div class="line-number"><a href="#L1770">1770</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1771">
    <div class="line-number"><a href="#L1771">1771</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1772">
    <div class="line-number"><a href="#L1772">1772</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local command</div>
  </div>
  <div class="line not-covered" id="L1773">
    <div class="line-number"><a href="#L1773">1773</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if is_windows() then</div>
  </div>
  <div class="line not-executable" id="L1774">
    <div class="line-number"><a href="#L1774">1774</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- PowerShell command for Windows</div>
  </div>
  <div class="line not-covered" id="L1775">
    <div class="line-number"><a href="#L1775">1775</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        command = string.format(</div>
  </div>
  <div class="line not-covered" id="L1776">
    <div class="line-number"><a href="#L1776">1776</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            'powershell -Command &quot;(Get-Item -Path \&quot;%s\&quot;).LastWriteTime.ToFileTime()&quot;',</div>
  </div>
  <div class="line not-covered" id="L1777">
    <div class="line-number"><a href="#L1777">1777</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            path</div>
  </div>
  <div class="line not-covered" id="L1778">
    <div class="line-number"><a href="#L1778">1778</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        )</div>
  </div>
  <div class="line not-covered" id="L1779">
    <div class="line-number"><a href="#L1779">1779</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L1780">
    <div class="line-number"><a href="#L1780">1780</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- stat command for Unix-like systems</div>
  </div>
  <div class="line not-covered" id="L1781">
    <div class="line-number"><a href="#L1781">1781</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        command = string.format('stat -c %%Y &quot;%s&quot;', path)</div>
  </div>
  <div class="line not-covered" id="L1782">
    <div class="line-number"><a href="#L1782">1782</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1783">
    <div class="line-number"><a href="#L1783">1783</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1784">
    <div class="line-number"><a href="#L1784">1784</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local handle = io.popen(command)</div>
  </div>
  <div class="line not-covered" id="L1785">
    <div class="line-number"><a href="#L1785">1785</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not handle then</div>
  </div>
  <div class="line not-covered" id="L1786">
    <div class="line-number"><a href="#L1786">1786</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Failed to execute command to get modified time&quot;</div>
  </div>
  <div class="line not-covered" id="L1787">
    <div class="line-number"><a href="#L1787">1787</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1788">
    <div class="line-number"><a href="#L1788">1788</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1789">
    <div class="line-number"><a href="#L1789">1789</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = handle:read(&quot;*a&quot;)</div>
  </div>
  <div class="line not-covered" id="L1790">
    <div class="line-number"><a href="#L1790">1790</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    handle:close()</div>
  </div>
  <div class="line not-executable" id="L1791">
    <div class="line-number"><a href="#L1791">1791</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1792">
    <div class="line-number"><a href="#L1792">1792</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try to convert result to number</div>
  </div>
  <div class="line not-covered" id="L1793">
    <div class="line-number"><a href="#L1793">1793</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local timestamp = tonumber(result)</div>
  </div>
  <div class="line not-covered" id="L1794">
    <div class="line-number"><a href="#L1794">1794</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not timestamp then</div>
  </div>
  <div class="line not-covered" id="L1795">
    <div class="line-number"><a href="#L1795">1795</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Failed to parse timestamp: &quot; .. result</div>
  </div>
  <div class="line not-covered" id="L1796">
    <div class="line-number"><a href="#L1796">1796</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1797">
    <div class="line-number"><a href="#L1797">1797</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1798">
    <div class="line-number"><a href="#L1798">1798</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return timestamp</div>
  </div>
  <div class="line not-covered" id="L1799">
    <div class="line-number"><a href="#L1799">1799</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1800">
    <div class="line-number"><a href="#L1800">1800</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the creation timestamp of a file or directory</div>
  </div>
  <div class="line not-executable" id="L1801">
    <div class="line-number"><a href="#L1801">1801</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function retrieves the creation time of a file or directory as a Unix</div>
  </div>
  <div class="line not-executable" id="L1802">
    <div class="line-number"><a href="#L1802">1802</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- timestamp (seconds since epoch). It uses platform-specific commands to retrieve</div>
  </div>
  <div class="line not-executable" id="L1803">
    <div class="line-number"><a href="#L1803">1803</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- this information, with special handling for Unix-like systems where creation time</div>
  </div>
  <div class="line not-executable" id="L1804">
    <div class="line-number"><a href="#L1804">1804</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- might not be available (falls back to modification time in that case).</div>
  </div>
  <div class="line not-executable" id="L1805">
    <div class="line-number"><a href="#L1805">1805</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1806">
    <div class="line-number"><a href="#L1806">1806</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to the file or directory</div>
  </div>
  <div class="line not-executable" id="L1807">
    <div class="line-number"><a href="#L1807">1807</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return number|nil timestamp Creation time as Unix timestamp or nil on error</div>
  </div>
  <div class="line not-executable" id="L1808">
    <div class="line-number"><a href="#L1808">1808</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if getting the time failed</div>
  </div>
  <div class="line not-executable" id="L1809">
    <div class="line-number"><a href="#L1809">1809</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1810">
    <div class="line-number"><a href="#L1810">1810</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1811">
    <div class="line-number"><a href="#L1811">1811</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get and display a file's creation date</div>
  </div>
  <div class="line not-executable" id="L1812">
    <div class="line-number"><a href="#L1812">1812</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local timestamp, err = fs.get_creation_time(&quot;/path/to/document.pdf&quot;)</div>
  </div>
  <div class="line not-executable" id="L1813">
    <div class="line-number"><a href="#L1813">1813</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not timestamp then</div>
  </div>
  <div class="line not-executable" id="L1814">
    <div class="line-number"><a href="#L1814">1814</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error getting creation time: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L1815">
    <div class="line-number"><a href="#L1815">1815</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L1816">
    <div class="line-number"><a href="#L1816">1816</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1817">
    <div class="line-number"><a href="#L1817">1817</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local date_string = os.date(&quot;%Y-%m-%d&quot;, timestamp)</div>
  </div>
  <div class="line not-executable" id="L1818">
    <div class="line-number"><a href="#L1818">1818</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(&quot;File was created on: &quot; .. date_string)</div>
  </div>
  <div class="line not-executable" id="L1819">
    <div class="line-number"><a href="#L1819">1819</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1820">
    <div class="line-number"><a href="#L1820">1820</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Determine if a file was created recently</div>
  </div>
  <div class="line not-executable" id="L1821">
    <div class="line-number"><a href="#L1821">1821</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local now = os.time()</div>
  </div>
  <div class="line not-executable" id="L1822">
    <div class="line-number"><a href="#L1822">1822</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local creation_time = fs.get_creation_time(file_path)</div>
  </div>
  <div class="line not-executable" id="L1823">
    <div class="line-number"><a href="#L1823">1823</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local one_week = 7 * 24 * 60 * 60 -- Seconds in a week</div>
  </div>
  <div class="line not-executable" id="L1824">
    <div class="line-number"><a href="#L1824">1824</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if creation_time and (now - creation_time) &lt; one_week then</div>
  </div>
  <div class="line not-executable" id="L1825">
    <div class="line-number"><a href="#L1825">1825</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;File was created within the last week&quot;)</div>
  </div>
  <div class="line not-executable" id="L1826">
    <div class="line-number"><a href="#L1826">1826</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1827">
    <div class="line-number"><a href="#L1827">1827</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_creation_time(path)</div>
  </div>
  <div class="line not-covered" id="L1828">
    <div class="line-number"><a href="#L1828">1828</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return nil, &quot;No path provided&quot; end</div>
  </div>
  <div class="line not-covered" id="L1829">
    <div class="line-number"><a href="#L1829">1829</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not (fs.file_exists(path) or fs.directory_exists(path)) then</div>
  </div>
  <div class="line not-covered" id="L1830">
    <div class="line-number"><a href="#L1830">1830</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Path does not exist: &quot; .. path</div>
  </div>
  <div class="line not-covered" id="L1831">
    <div class="line-number"><a href="#L1831">1831</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1832">
    <div class="line-number"><a href="#L1832">1832</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1833">
    <div class="line-number"><a href="#L1833">1833</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local command</div>
  </div>
  <div class="line not-covered" id="L1834">
    <div class="line-number"><a href="#L1834">1834</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if is_windows() then</div>
  </div>
  <div class="line not-executable" id="L1835">
    <div class="line-number"><a href="#L1835">1835</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- PowerShell command for Windows</div>
  </div>
  <div class="line not-covered" id="L1836">
    <div class="line-number"><a href="#L1836">1836</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        command = string.format(</div>
  </div>
  <div class="line not-covered" id="L1837">
    <div class="line-number"><a href="#L1837">1837</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            'powershell -Command &quot;(Get-Item -Path \&quot;%s\&quot;).CreationTime.ToFileTime()&quot;',</div>
  </div>
  <div class="line not-covered" id="L1838">
    <div class="line-number"><a href="#L1838">1838</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            path</div>
  </div>
  <div class="line not-covered" id="L1839">
    <div class="line-number"><a href="#L1839">1839</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        )</div>
  </div>
  <div class="line not-covered" id="L1840">
    <div class="line-number"><a href="#L1840">1840</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L1841">
    <div class="line-number"><a href="#L1841">1841</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- stat command for Unix-like systems (birth time if available, otherwise modified time)</div>
  </div>
  <div class="line not-covered" id="L1842">
    <div class="line-number"><a href="#L1842">1842</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        command = string.format('stat -c %%W 2&gt;/dev/null &quot;%s&quot; || stat -c %%Y &quot;%s&quot;', path, path)</div>
  </div>
  <div class="line not-covered" id="L1843">
    <div class="line-number"><a href="#L1843">1843</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1844">
    <div class="line-number"><a href="#L1844">1844</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1845">
    <div class="line-number"><a href="#L1845">1845</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local handle = io.popen(command)</div>
  </div>
  <div class="line not-covered" id="L1846">
    <div class="line-number"><a href="#L1846">1846</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not handle then</div>
  </div>
  <div class="line not-covered" id="L1847">
    <div class="line-number"><a href="#L1847">1847</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Failed to execute command to get creation time&quot;</div>
  </div>
  <div class="line not-covered" id="L1848">
    <div class="line-number"><a href="#L1848">1848</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1849">
    <div class="line-number"><a href="#L1849">1849</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1850">
    <div class="line-number"><a href="#L1850">1850</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = handle:read(&quot;*a&quot;)</div>
  </div>
  <div class="line not-covered" id="L1851">
    <div class="line-number"><a href="#L1851">1851</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    handle:close()</div>
  </div>
  <div class="line not-executable" id="L1852">
    <div class="line-number"><a href="#L1852">1852</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1853">
    <div class="line-number"><a href="#L1853">1853</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try to convert result to number</div>
  </div>
  <div class="line not-covered" id="L1854">
    <div class="line-number"><a href="#L1854">1854</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local timestamp = tonumber(result)</div>
  </div>
  <div class="line not-covered" id="L1855">
    <div class="line-number"><a href="#L1855">1855</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not timestamp then</div>
  </div>
  <div class="line not-covered" id="L1856">
    <div class="line-number"><a href="#L1856">1856</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Failed to parse timestamp: &quot; .. result</div>
  </div>
  <div class="line not-covered" id="L1857">
    <div class="line-number"><a href="#L1857">1857</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1858">
    <div class="line-number"><a href="#L1858">1858</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1859">
    <div class="line-number"><a href="#L1859">1859</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return timestamp</div>
  </div>
  <div class="line not-covered" id="L1860">
    <div class="line-number"><a href="#L1860">1860</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1861">
    <div class="line-number"><a href="#L1861">1861</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if a path refers to a file (not a directory)</div>
  </div>
  <div class="line not-executable" id="L1862">
    <div class="line-number"><a href="#L1862">1862</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function checks if the specified path exists and is a file (not a directory).</div>
  </div>
  <div class="line not-executable" id="L1863">
    <div class="line-number"><a href="#L1863">1863</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It combines checks from file_exists and directory_exists to determine the</div>
  </div>
  <div class="line not-executable" id="L1864">
    <div class="line-number"><a href="#L1864">1864</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- correct file type. This is useful when you need to specifically identify files</div>
  </div>
  <div class="line not-executable" id="L1865">
    <div class="line-number"><a href="#L1865">1865</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- versus directories.</div>
  </div>
  <div class="line not-executable" id="L1866">
    <div class="line-number"><a href="#L1866">1866</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1867">
    <div class="line-number"><a href="#L1867">1867</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to check</div>
  </div>
  <div class="line not-executable" id="L1868">
    <div class="line-number"><a href="#L1868">1868</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean is_file True if the path exists and is a file</div>
  </div>
  <div class="line not-executable" id="L1869">
    <div class="line-number"><a href="#L1869">1869</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1870">
    <div class="line-number"><a href="#L1870">1870</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1871">
    <div class="line-number"><a href="#L1871">1871</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get all items in a directory and process files only</div>
  </div>
  <div class="line not-executable" id="L1872">
    <div class="line-number"><a href="#L1872">1872</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local items = fs.get_directory_contents(&quot;/path/to/dir&quot;)</div>
  </div>
  <div class="line not-executable" id="L1873">
    <div class="line-number"><a href="#L1873">1873</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, item_name in ipairs(items) do</div>
  </div>
  <div class="line not-executable" id="L1874">
    <div class="line-number"><a href="#L1874">1874</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local full_path = fs.join_paths(&quot;/path/to/dir&quot;, item_name)</div>
  </div>
  <div class="line not-executable" id="L1875">
    <div class="line-number"><a href="#L1875">1875</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if fs.is_file(full_path) then</div>
  </div>
  <div class="line not-executable" id="L1876">
    <div class="line-number"><a href="#L1876">1876</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     process_file(full_path)</div>
  </div>
  <div class="line not-executable" id="L1877">
    <div class="line-number"><a href="#L1877">1877</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L1878">
    <div class="line-number"><a href="#L1878">1878</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1879">
    <div class="line-number"><a href="#L1879">1879</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1880">
    <div class="line-number"><a href="#L1880">1880</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check a path's type before performing an operation</div>
  </div>
  <div class="line not-executable" id="L1881">
    <div class="line-number"><a href="#L1881">1881</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if fs.is_file(path) then</div>
  </div>
  <div class="line not-executable" id="L1882">
    <div class="line-number"><a href="#L1882">1882</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local content = fs.read_file(path)</div>
  </div>
  <div class="line not-executable" id="L1883">
    <div class="line-number"><a href="#L1883">1883</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- else</div>
  </div>
  <div class="line not-executable" id="L1884">
    <div class="line-number"><a href="#L1884">1884</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Not a file: &quot; .. path)</div>
  </div>
  <div class="line not-executable" id="L1885">
    <div class="line-number"><a href="#L1885">1885</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1886">
    <div class="line-number"><a href="#L1886">1886</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.is_file(path)</div>
  </div>
  <div class="line not-covered" id="L1887">
    <div class="line-number"><a href="#L1887">1887</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return false end</div>
  </div>
  <div class="line not-covered" id="L1888">
    <div class="line-number"><a href="#L1888">1888</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if fs.directory_exists(path) then return false end</div>
  </div>
  <div class="line not-covered" id="L1889">
    <div class="line-number"><a href="#L1889">1889</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return fs.file_exists(path)</div>
  </div>
  <div class="line not-covered" id="L1890">
    <div class="line-number"><a href="#L1890">1890</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1891">
    <div class="line-number"><a href="#L1891">1891</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if a path refers to a directory (not a file)</div>
  </div>
  <div class="line not-executable" id="L1892">
    <div class="line-number"><a href="#L1892">1892</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function checks if the specified path exists and is a directory (not a file).</div>
  </div>
  <div class="line not-executable" id="L1893">
    <div class="line-number"><a href="#L1893">1893</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It combines checks from file_exists and directory_exists to determine the</div>
  </div>
  <div class="line not-executable" id="L1894">
    <div class="line-number"><a href="#L1894">1894</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- correct file type. This is useful when you need to specifically identify directories</div>
  </div>
  <div class="line not-executable" id="L1895">
    <div class="line-number"><a href="#L1895">1895</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- versus files.</div>
  </div>
  <div class="line not-executable" id="L1896">
    <div class="line-number"><a href="#L1896">1896</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1897">
    <div class="line-number"><a href="#L1897">1897</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string Path to check</div>
  </div>
  <div class="line not-executable" id="L1898">
    <div class="line-number"><a href="#L1898">1898</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean is_directory True if the path exists and is a directory</div>
  </div>
  <div class="line not-executable" id="L1899">
    <div class="line-number"><a href="#L1899">1899</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1900">
    <div class="line-number"><a href="#L1900">1900</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1901">
    <div class="line-number"><a href="#L1901">1901</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get all items in a directory and process subdirectories only</div>
  </div>
  <div class="line not-executable" id="L1902">
    <div class="line-number"><a href="#L1902">1902</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local items = fs.get_directory_contents(&quot;/path/to/dir&quot;)</div>
  </div>
  <div class="line not-executable" id="L1903">
    <div class="line-number"><a href="#L1903">1903</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, item_name in ipairs(items) do</div>
  </div>
  <div class="line not-executable" id="L1904">
    <div class="line-number"><a href="#L1904">1904</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local full_path = fs.join_paths(&quot;/path/to/dir&quot;, item_name)</div>
  </div>
  <div class="line not-executable" id="L1905">
    <div class="line-number"><a href="#L1905">1905</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if fs.is_directory(full_path) then</div>
  </div>
  <div class="line not-executable" id="L1906">
    <div class="line-number"><a href="#L1906">1906</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     process_subdirectory(full_path)</div>
  </div>
  <div class="line not-executable" id="L1907">
    <div class="line-number"><a href="#L1907">1907</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L1908">
    <div class="line-number"><a href="#L1908">1908</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1909">
    <div class="line-number"><a href="#L1909">1909</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1910">
    <div class="line-number"><a href="#L1910">1910</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Recursively process only directories</div>
  </div>
  <div class="line not-executable" id="L1911">
    <div class="line-number"><a href="#L1911">1911</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if fs.is_directory(path) then</div>
  </div>
  <div class="line not-executable" id="L1912">
    <div class="line-number"><a href="#L1912">1912</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   for _, subdir in ipairs(fs.list_directories(path)) do</div>
  </div>
  <div class="line not-executable" id="L1913">
    <div class="line-number"><a href="#L1913">1913</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     process_directory(subdir)</div>
  </div>
  <div class="line not-executable" id="L1914">
    <div class="line-number"><a href="#L1914">1914</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L1915">
    <div class="line-number"><a href="#L1915">1915</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1916">
    <div class="line-number"><a href="#L1916">1916</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.is_directory(path)</div>
  </div>
  <div class="line not-covered" id="L1917">
    <div class="line-number"><a href="#L1917">1917</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not path then return false end</div>
  </div>
  <div class="line not-covered" id="L1918">
    <div class="line-number"><a href="#L1918">1918</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if fs.file_exists(path) and not fs.directory_exists(path) then return false end</div>
  </div>
  <div class="line not-covered" id="L1919">
    <div class="line-number"><a href="#L1919">1919</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return fs.directory_exists(path)</div>
  </div>
  <div class="line not-covered" id="L1920">
    <div class="line-number"><a href="#L1920">1920</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1921">
    <div class="line-number"><a href="#L1921">1921</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- List all files in a directory (non-recursive)</div>
  </div>
  <div class="line not-executable" id="L1922">
    <div class="line-number"><a href="#L1922">1922</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function returns a list of all files (not directories) in the specified directory.</div>
  </div>
  <div class="line not-executable" id="L1923">
    <div class="line-number"><a href="#L1923">1923</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- By default, it excludes hidden files (those starting with a dot), but they can be</div>
  </div>
  <div class="line not-executable" id="L1924">
    <div class="line-number"><a href="#L1924">1924</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- included by setting the include_hidden parameter to true. This function uses</div>
  </div>
  <div class="line not-executable" id="L1925">
    <div class="line-number"><a href="#L1925">1925</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- platform-specific commands for optimal performance on both Windows and Unix-like systems.</div>
  </div>
  <div class="line not-executable" id="L1926">
    <div class="line-number"><a href="#L1926">1926</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1927">
    <div class="line-number"><a href="#L1927">1927</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param dir_path string Directory path to list files from</div>
  </div>
  <div class="line not-executable" id="L1928">
    <div class="line-number"><a href="#L1928">1928</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param include_hidden? boolean Whether to include hidden files (default: false)</div>
  </div>
  <div class="line not-executable" id="L1929">
    <div class="line-number"><a href="#L1929">1929</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string[]|nil files List of absolute file paths or nil on error</div>
  </div>
  <div class="line not-executable" id="L1930">
    <div class="line-number"><a href="#L1930">1930</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if listing failed</div>
  </div>
  <div class="line not-executable" id="L1931">
    <div class="line-number"><a href="#L1931">1931</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1932">
    <div class="line-number"><a href="#L1932">1932</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1933">
    <div class="line-number"><a href="#L1933">1933</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get all Lua files in a directory</div>
  </div>
  <div class="line not-executable" id="L1934">
    <div class="line-number"><a href="#L1934">1934</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local files, err = fs.list_files(&quot;/path/to/project/src&quot;)</div>
  </div>
  <div class="line not-executable" id="L1935">
    <div class="line-number"><a href="#L1935">1935</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not files then</div>
  </div>
  <div class="line not-executable" id="L1936">
    <div class="line-number"><a href="#L1936">1936</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error listing files: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L1937">
    <div class="line-number"><a href="#L1937">1937</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L1938">
    <div class="line-number"><a href="#L1938">1938</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1939">
    <div class="line-number"><a href="#L1939">1939</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L1940">
    <div class="line-number"><a href="#L1940">1940</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, file_path in ipairs(files) do</div>
  </div>
  <div class="line not-executable" id="L1941">
    <div class="line-number"><a href="#L1941">1941</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if fs.get_extension(file_path) == &quot;lua&quot; then</div>
  </div>
  <div class="line not-executable" id="L1942">
    <div class="line-number"><a href="#L1942">1942</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     process_lua_file(file_path)</div>
  </div>
  <div class="line not-executable" id="L1943">
    <div class="line-number"><a href="#L1943">1943</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L1944">
    <div class="line-number"><a href="#L1944">1944</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1945">
    <div class="line-number"><a href="#L1945">1945</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1946">
    <div class="line-number"><a href="#L1946">1946</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Include hidden files in listing</div>
  </div>
  <div class="line not-executable" id="L1947">
    <div class="line-number"><a href="#L1947">1947</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local all_files = fs.list_files(&quot;/home/user&quot;, true)</div>
  </div>
  <div class="line not-executable" id="L1948">
    <div class="line-number"><a href="#L1948">1948</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(&quot;Total files (including hidden): &quot; .. #all_files)</div>
  </div>
  <div class="line not-covered" id="L1949">
    <div class="line-number"><a href="#L1949">1949</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.list_files(dir_path, include_hidden)</div>
  </div>
  <div class="line not-covered" id="L1950">
    <div class="line-number"><a href="#L1950">1950</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not dir_path then return nil, &quot;No directory path provided&quot; end</div>
  </div>
  <div class="line not-covered" id="L1951">
    <div class="line-number"><a href="#L1951">1951</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not fs.directory_exists(dir_path) then</div>
  </div>
  <div class="line not-covered" id="L1952">
    <div class="line-number"><a href="#L1952">1952</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Directory does not exist: &quot; .. dir_path</div>
  </div>
  <div class="line not-covered" id="L1953">
    <div class="line-number"><a href="#L1953">1953</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1954">
    <div class="line-number"><a href="#L1954">1954</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1955">
    <div class="line-number"><a href="#L1955">1955</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local files = {}</div>
  </div>
  <div class="line not-executable" id="L1956">
    <div class="line-number"><a href="#L1956">1956</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1957">
    <div class="line-number"><a href="#L1957">1957</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use different approach depending on platform</div>
  </div>
  <div class="line not-covered" id="L1958">
    <div class="line-number"><a href="#L1958">1958</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if is_windows() then</div>
  </div>
  <div class="line not-covered" id="L1959">
    <div class="line-number"><a href="#L1959">1959</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local handle = io.popen('dir /b &quot;' .. dir_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L1960">
    <div class="line-number"><a href="#L1960">1960</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not handle then</div>
  </div>
  <div class="line not-covered" id="L1961">
    <div class="line-number"><a href="#L1961">1961</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Failed to execute dir command&quot;</div>
  </div>
  <div class="line not-covered" id="L1962">
    <div class="line-number"><a href="#L1962">1962</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1963">
    <div class="line-number"><a href="#L1963">1963</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1964">
    <div class="line-number"><a href="#L1964">1964</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for file in handle:lines() do</div>
  </div>
  <div class="line not-executable" id="L1965">
    <div class="line-number"><a href="#L1965">1965</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Skip hidden files if not including them</div>
  </div>
  <div class="line not-covered" id="L1966">
    <div class="line-number"><a href="#L1966">1966</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if include_hidden or file:sub(1, 1) ~= &quot;.&quot; then</div>
  </div>
  <div class="line not-covered" id="L1967">
    <div class="line-number"><a href="#L1967">1967</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                local full_path = fs.join_paths(dir_path, file)</div>
  </div>
  <div class="line not-covered" id="L1968">
    <div class="line-number"><a href="#L1968">1968</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if fs.is_file(full_path) then</div>
  </div>
  <div class="line not-covered" id="L1969">
    <div class="line-number"><a href="#L1969">1969</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    table.insert(files, full_path)</div>
  </div>
  <div class="line not-covered" id="L1970">
    <div class="line-number"><a href="#L1970">1970</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L1971">
    <div class="line-number"><a href="#L1971">1971</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1972">
    <div class="line-number"><a href="#L1972">1972</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1973">
    <div class="line-number"><a href="#L1973">1973</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1974">
    <div class="line-number"><a href="#L1974">1974</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        handle:close()</div>
  </div>
  <div class="line not-covered" id="L1975">
    <div class="line-number"><a href="#L1975">1975</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L1976">
    <div class="line-number"><a href="#L1976">1976</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Unix-like systems</div>
  </div>
  <div class="line not-covered" id="L1977">
    <div class="line-number"><a href="#L1977">1977</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local handle = io.popen('ls -a &quot;' .. dir_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L1978">
    <div class="line-number"><a href="#L1978">1978</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not handle then</div>
  </div>
  <div class="line not-covered" id="L1979">
    <div class="line-number"><a href="#L1979">1979</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return nil, &quot;Failed to execute ls command&quot;</div>
  </div>
  <div class="line not-covered" id="L1980">
    <div class="line-number"><a href="#L1980">1980</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1981">
    <div class="line-number"><a href="#L1981">1981</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1982">
    <div class="line-number"><a href="#L1982">1982</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for file in handle:lines() do</div>
  </div>
  <div class="line not-executable" id="L1983">
    <div class="line-number"><a href="#L1983">1983</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Skip . and .. directories and hidden files if not including them</div>
  </div>
  <div class="line not-covered" id="L1984">
    <div class="line-number"><a href="#L1984">1984</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if file ~= &quot;.&quot; and file ~= &quot;..&quot; and (include_hidden or file:sub(1, 1) ~= &quot;.&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1985">
    <div class="line-number"><a href="#L1985">1985</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                local full_path = fs.join_paths(dir_path, file)</div>
  </div>
  <div class="line not-covered" id="L1986">
    <div class="line-number"><a href="#L1986">1986</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if fs.is_file(full_path) then</div>
  </div>
  <div class="line not-covered" id="L1987">
    <div class="line-number"><a href="#L1987">1987</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    table.insert(files, full_path)</div>
  </div>
  <div class="line not-covered" id="L1988">
    <div class="line-number"><a href="#L1988">1988</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L1989">
    <div class="line-number"><a href="#L1989">1989</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1990">
    <div class="line-number"><a href="#L1990">1990</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1991">
    <div class="line-number"><a href="#L1991">1991</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1992">
    <div class="line-number"><a href="#L1992">1992</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        handle:close()</div>
  </div>
  <div class="line not-covered" id="L1993">
    <div class="line-number"><a href="#L1993">1993</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1994">
    <div class="line-number"><a href="#L1994">1994</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1995">
    <div class="line-number"><a href="#L1995">1995</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return files</div>
  </div>
  <div class="line not-covered" id="L1996">
    <div class="line-number"><a href="#L1996">1996</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1997">
    <div class="line-number"><a href="#L1997">1997</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- List files recursively in a directory and all its subdirectories</div>
  </div>
  <div class="line not-executable" id="L1998">
    <div class="line-number"><a href="#L1998">1998</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function returns a flat list of all files (not directories) found in the</div>
  </div>
  <div class="line not-executable" id="L1999">
    <div class="line-number"><a href="#L1999">1999</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- specified directory and all of its subdirectories, traversing the directory tree </div>
  </div>
  <div class="line not-executable" id="L2000">
    <div class="line-number"><a href="#L2000">2000</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- recursively. By default, it excludes hidden files and directories (those starting with </div>
  </div>
  <div class="line not-executable" id="L2001">
    <div class="line-number"><a href="#L2001">2001</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- a dot), but they can be included by setting the include_hidden parameter to true.</div>
  </div>
  <div class="line not-executable" id="L2002">
    <div class="line-number"><a href="#L2002">2002</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- The function safely handles circular symlinks to prevent infinite recursion.</div>
  </div>
  <div class="line not-executable" id="L2003">
    <div class="line-number"><a href="#L2003">2003</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L2004">
    <div class="line-number"><a href="#L2004">2004</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param dir_path string Root directory path to start recursive search from</div>
  </div>
  <div class="line not-executable" id="L2005">
    <div class="line-number"><a href="#L2005">2005</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param include_hidden? boolean Whether to include hidden files and directories (default: false)</div>
  </div>
  <div class="line not-executable" id="L2006">
    <div class="line-number"><a href="#L2006">2006</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string[]|nil files List of absolute file paths or nil on error</div>
  </div>
  <div class="line not-executable" id="L2007">
    <div class="line-number"><a href="#L2007">2007</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if listing failed</div>
  </div>
  <div class="line not-executable" id="L2008">
    <div class="line-number"><a href="#L2008">2008</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L2009">
    <div class="line-number"><a href="#L2009">2009</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L2010">
    <div class="line-number"><a href="#L2010">2010</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get all files in a project, including subdirectories</div>
  </div>
  <div class="line not-executable" id="L2011">
    <div class="line-number"><a href="#L2011">2011</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local all_files, err = fs.list_files_recursive(&quot;/path/to/project&quot;)</div>
  </div>
  <div class="line not-executable" id="L2012">
    <div class="line-number"><a href="#L2012">2012</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not all_files then</div>
  </div>
  <div class="line not-executable" id="L2013">
    <div class="line-number"><a href="#L2013">2013</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error listing files: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L2014">
    <div class="line-number"><a href="#L2014">2014</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return</div>
  </div>
  <div class="line not-executable" id="L2015">
    <div class="line-number"><a href="#L2015">2015</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L2016">
    <div class="line-number"><a href="#L2016">2016</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(&quot;Total files in project: &quot; .. #all_files)</div>
  </div>
  <div class="line not-executable" id="L2017">
    <div class="line-number"><a href="#L2017">2017</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L2018">
    <div class="line-number"><a href="#L2018">2018</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Find specific file types recursively</div>
  </div>
  <div class="line not-executable" id="L2019">
    <div class="line-number"><a href="#L2019">2019</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local all_files = fs.list_files_recursive(&quot;/path/to/project&quot;)</div>
  </div>
  <div class="line not-executable" id="L2020">
    <div class="line-number"><a href="#L2020">2020</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local image_files = {}</div>
  </div>
  <div class="line not-executable" id="L2021">
    <div class="line-number"><a href="#L2021">2021</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, file_path in ipairs(all_files) do</div>
  </div>
  <div class="line not-executable" id="L2022">
    <div class="line-number"><a href="#L2022">2022</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local ext = fs.get_extension(file_path)</div>
  </div>
  <div class="line not-executable" id="L2023">
    <div class="line-number"><a href="#L2023">2023</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if ext == &quot;jpg&quot; or ext == &quot;png&quot; or ext == &quot;gif&quot; then</div>
  </div>
  <div class="line not-executable" id="L2024">
    <div class="line-number"><a href="#L2024">2024</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     table.insert(image_files, file_path)</div>
  </div>
  <div class="line not-executable" id="L2025">
    <div class="line-number"><a href="#L2025">2025</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L2026">
    <div class="line-number"><a href="#L2026">2026</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L2027">
    <div class="line-number"><a href="#L2027">2027</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(&quot;Found &quot; .. #image_files .. &quot; image files&quot;)</div>
  </div>
  <div class="line not-covered" id="L2028">
    <div class="line-number"><a href="#L2028">2028</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.list_files_recursive(dir_path, include_hidden)</div>
  </div>
  <div class="line not-covered" id="L2029">
    <div class="line-number"><a href="#L2029">2029</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not dir_path then return nil, &quot;No directory path provided&quot; end</div>
  </div>
  <div class="line not-covered" id="L2030">
    <div class="line-number"><a href="#L2030">2030</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not fs.directory_exists(dir_path) then</div>
  </div>
  <div class="line not-covered" id="L2031">
    <div class="line-number"><a href="#L2031">2031</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Directory does not exist: &quot; .. dir_path</div>
  </div>
  <div class="line not-covered" id="L2032">
    <div class="line-number"><a href="#L2032">2032</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2033">
    <div class="line-number"><a href="#L2033">2033</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L2034">
    <div class="line-number"><a href="#L2034">2034</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local results = {}</div>
  </div>
  <div class="line not-executable" id="L2035">
    <div class="line-number"><a href="#L2035">2035</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L2036">
    <div class="line-number"><a href="#L2036">2036</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Helper function to recursively scan directories</div>
  </div>
  <div class="line not-covered" id="L2037">
    <div class="line-number"><a href="#L2037">2037</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local function scan(current_path)</div>
  </div>
  <div class="line not-executable" id="L2038">
    <div class="line-number"><a href="#L2038">2038</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Get all items in current directory</div>
  </div>
  <div class="line not-covered" id="L2039">
    <div class="line-number"><a href="#L2039">2039</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local items</div>
  </div>
  <div class="line not-executable" id="L2040">
    <div class="line-number"><a href="#L2040">2040</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L2041">
    <div class="line-number"><a href="#L2041">2041</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Use different approach depending on platform</div>
  </div>
  <div class="line not-covered" id="L2042">
    <div class="line-number"><a href="#L2042">2042</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if is_windows() then</div>
  </div>
  <div class="line not-covered" id="L2043">
    <div class="line-number"><a href="#L2043">2043</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local handle = io.popen('dir /b &quot;' .. current_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L2044">
    <div class="line-number"><a href="#L2044">2044</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not handle then return end</div>
  </div>
  <div class="line not-executable" id="L2045">
    <div class="line-number"><a href="#L2045">2045</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L2046">
    <div class="line-number"><a href="#L2046">2046</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            items = {}</div>
  </div>
  <div class="line not-covered" id="L2047">
    <div class="line-number"><a href="#L2047">2047</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            for item in handle:lines() do</div>
  </div>
  <div class="line not-covered" id="L2048">
    <div class="line-number"><a href="#L2048">2048</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(items, item)</div>
  </div>
  <div class="line not-covered" id="L2049">
    <div class="line-number"><a href="#L2049">2049</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L2050">
    <div class="line-number"><a href="#L2050">2050</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L2051">
    <div class="line-number"><a href="#L2051">2051</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            handle:close()</div>
  </div>
  <div class="line not-covered" id="L2052">
    <div class="line-number"><a href="#L2052">2052</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L2053">
    <div class="line-number"><a href="#L2053">2053</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Unix-like systems</div>
  </div>
  <div class="line not-covered" id="L2054">
    <div class="line-number"><a href="#L2054">2054</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local handle = io.popen('ls -a &quot;' .. current_path .. '&quot;')</div>
  </div>
  <div class="line not-covered" id="L2055">
    <div class="line-number"><a href="#L2055">2055</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not handle then return end</div>
  </div>
  <div class="line not-executable" id="L2056">
    <div class="line-number"><a href="#L2056">2056</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L2057">
    <div class="line-number"><a href="#L2057">2057</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            items = {}</div>
  </div>
  <div class="line not-covered" id="L2058">
    <div class="line-number"><a href="#L2058">2058</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            for item in handle:lines() do</div>
  </div>
  <div class="line not-executable" id="L2059">
    <div class="line-number"><a href="#L2059">2059</a></div>
    <div class="execution-count"></div>    <div class="line-content">                -- Skip . and ..</div>
  </div>
  <div class="line not-covered" id="L2060">
    <div class="line-number"><a href="#L2060">2060</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if item ~= &quot;.&quot; and item ~= &quot;..&quot; then</div>
  </div>
  <div class="line not-covered" id="L2061">
    <div class="line-number"><a href="#L2061">2061</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    table.insert(items, item)</div>
  </div>
  <div class="line not-covered" id="L2062">
    <div class="line-number"><a href="#L2062">2062</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L2063">
    <div class="line-number"><a href="#L2063">2063</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L2064">
    <div class="line-number"><a href="#L2064">2064</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L2065">
    <div class="line-number"><a href="#L2065">2065</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            handle:close()</div>
  </div>
  <div class="line not-covered" id="L2066">
    <div class="line-number"><a href="#L2066">2066</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L2067">
    <div class="line-number"><a href="#L2067">2067</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L2068">
    <div class="line-number"><a href="#L2068">2068</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Process each item</div>
  </div>
  <div class="line not-covered" id="L2069">
    <div class="line-number"><a href="#L2069">2069</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _, item in ipairs(items) do</div>
  </div>
  <div class="line not-executable" id="L2070">
    <div class="line-number"><a href="#L2070">2070</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Skip hidden files/directories if not including them</div>
  </div>
  <div class="line not-covered" id="L2071">
    <div class="line-number"><a href="#L2071">2071</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if include_hidden or item:sub(1, 1) ~= &quot;.&quot; then</div>
  </div>
  <div class="line not-covered" id="L2072">
    <div class="line-number"><a href="#L2072">2072</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                local item_path = fs.join_paths(current_path, item)</div>
  </div>
  <div class="line not-executable" id="L2073">
    <div class="line-number"><a href="#L2073">2073</a></div>
    <div class="execution-count"></div>    <div class="line-content">                </div>
  </div>
  <div class="line not-covered" id="L2074">
    <div class="line-number"><a href="#L2074">2074</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if fs.is_file(item_path) then</div>
  </div>
  <div class="line not-covered" id="L2075">
    <div class="line-number"><a href="#L2075">2075</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    table.insert(results, item_path)</div>
  </div>
  <div class="line not-covered" id="L2076">
    <div class="line-number"><a href="#L2076">2076</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                elseif fs.is_directory(item_path) then</div>
  </div>
  <div class="line not-executable" id="L2077">
    <div class="line-number"><a href="#L2077">2077</a></div>
    <div class="execution-count"></div>    <div class="line-content">                    -- Recursively scan subdirectories</div>
  </div>
  <div class="line not-covered" id="L2078">
    <div class="line-number"><a href="#L2078">2078</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    scan(item_path)</div>
  </div>
  <div class="line not-covered" id="L2079">
    <div class="line-number"><a href="#L2079">2079</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L2080">
    <div class="line-number"><a href="#L2080">2080</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L2081">
    <div class="line-number"><a href="#L2081">2081</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L2082">
    <div class="line-number"><a href="#L2082">2082</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2083">
    <div class="line-number"><a href="#L2083">2083</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L2084">
    <div class="line-number"><a href="#L2084">2084</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Start scanning from the root directory</div>
  </div>
  <div class="line not-covered" id="L2085">
    <div class="line-number"><a href="#L2085">2085</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    scan(dir_path)</div>
  </div>
  <div class="line not-executable" id="L2086">
    <div class="line-number"><a href="#L2086">2086</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L2087">
    <div class="line-number"><a href="#L2087">2087</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return results</div>
  </div>
  <div class="line not-covered" id="L2088">
    <div class="line-number"><a href="#L2088">2088</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L2089">
    <div class="line-number"><a href="#L2089">2089</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Detect the project root directory</div>
  </div>
  <div class="line not-executable" id="L2090">
    <div class="line-number"><a href="#L2090">2090</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function attempts to find the root directory of a project by looking for</div>
  </div>
  <div class="line not-executable" id="L2091">
    <div class="line-number"><a href="#L2091">2091</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- common project marker files like .git, package.json, etc. from the current directory</div>
  </div>
  <div class="line not-executable" id="L2092">
    <div class="line-number"><a href="#L2092">2092</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- upwards. It's useful for making file operations relative to the project root.</div>
  </div>
  <div class="line not-executable" id="L2093">
    <div class="line-number"><a href="#L2093">2093</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L2094">
    <div class="line-number"><a href="#L2094">2094</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param start_dir? string The directory to start searching from (defaults to current directory)</div>
  </div>
  <div class="line not-executable" id="L2095">
    <div class="line-number"><a href="#L2095">2095</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param markers? table List of marker files/directories to look for (defaults to common ones)</div>
  </div>
  <div class="line not-executable" id="L2096">
    <div class="line-number"><a href="#L2096">2096</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil root_dir The detected project root directory or nil if not found</div>
  </div>
  <div class="line not-executable" id="L2097">
    <div class="line-number"><a href="#L2097">2097</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if an error occurred</div>
  </div>
  <div class="line not-executable" id="L2098">
    <div class="line-number"><a href="#L2098">2098</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L2099">
    <div class="line-number"><a href="#L2099">2099</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L2100">
    <div class="line-number"><a href="#L2100">2100</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Detect project root from current directory</div>
  </div>
  <div class="line not-executable" id="L2101">
    <div class="line-number"><a href="#L2101">2101</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local root_dir = fs.detect_project_root()</div>
  </div>
  <div class="line not-executable" id="L2102">
    <div class="line-number"><a href="#L2102">2102</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if root_dir then</div>
  </div>
  <div class="line not-executable" id="L2103">
    <div class="line-number"><a href="#L2103">2103</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Project root: &quot; .. root_dir)</div>
  </div>
  <div class="line not-executable" id="L2104">
    <div class="line-number"><a href="#L2104">2104</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L2105">
    <div class="line-number"><a href="#L2105">2105</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L2106">
    <div class="line-number"><a href="#L2106">2106</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Detect project root from a specific directory with custom markers</div>
  </div>
  <div class="line not-executable" id="L2107">
    <div class="line-number"><a href="#L2107">2107</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local root_dir = fs.detect_project_root(&quot;/path/to/start&quot;, {&quot;.project&quot;, &quot;Makefile&quot;})</div>
  </div>
  <div class="line not-covered" id="L2108">
    <div class="line-number"><a href="#L2108">2108</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.detect_project_root(start_dir, markers)</div>
  </div>
  <div class="line not-executable" id="L2109">
    <div class="line-number"><a href="#L2109">2109</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Default to current directory if not specified</div>
  </div>
  <div class="line not-covered" id="L2110">
    <div class="line-number"><a href="#L2110">2110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    start_dir = start_dir or fs.get_current_directory()</div>
  </div>
  <div class="line not-covered" id="L2111">
    <div class="line-number"><a href="#L2111">2111</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not start_dir then</div>
  </div>
  <div class="line not-covered" id="L2112">
    <div class="line-number"><a href="#L2112">2112</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Failed to get current directory&quot;</div>
  </div>
  <div class="line not-covered" id="L2113">
    <div class="line-number"><a href="#L2113">2113</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2114">
    <div class="line-number"><a href="#L2114">2114</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L2115">
    <div class="line-number"><a href="#L2115">2115</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Common project root markers</div>
  </div>
  <div class="line not-covered" id="L2116">
    <div class="line-number"><a href="#L2116">2116</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    markers = markers or {</div>
  </div>
  <div class="line not-covered" id="L2117">
    <div class="line-number"><a href="#L2117">2117</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;.git&quot;,         -- Git repositories</div>
  </div>
  <div class="line not-covered" id="L2118">
    <div class="line-number"><a href="#L2118">2118</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;package.json&quot;, -- Node.js projects</div>
  </div>
  <div class="line not-covered" id="L2119">
    <div class="line-number"><a href="#L2119">2119</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Cargo.toml&quot;,   -- Rust projects</div>
  </div>
  <div class="line not-covered" id="L2120">
    <div class="line-number"><a href="#L2120">2120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;setup.py&quot;,     -- Python projects</div>
  </div>
  <div class="line not-covered" id="L2121">
    <div class="line-number"><a href="#L2121">2121</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;pom.xml&quot;,      -- Maven projects</div>
  </div>
  <div class="line not-covered" id="L2122">
    <div class="line-number"><a href="#L2122">2122</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;build.gradle&quot;, -- Gradle projects</div>
  </div>
  <div class="line not-covered" id="L2123">
    <div class="line-number"><a href="#L2123">2123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;.svn&quot;,         -- SVN repositories</div>
  </div>
  <div class="line not-covered" id="L2124">
    <div class="line-number"><a href="#L2124">2124</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Gemfile&quot;,      -- Ruby projects</div>
  </div>
  <div class="line not-covered" id="L2125">
    <div class="line-number"><a href="#L2125">2125</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;composer.json&quot;, -- PHP projects</div>
  </div>
  <div class="line not-covered" id="L2126">
    <div class="line-number"><a href="#L2126">2126</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Makefile&quot;,     -- Make-based projects</div>
  </div>
  <div class="line not-covered" id="L2127">
    <div class="line-number"><a href="#L2127">2127</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;CMakeLists.txt&quot;, -- CMake projects</div>
  </div>
  <div class="line not-covered" id="L2128">
    <div class="line-number"><a href="#L2128">2128</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;.hg&quot;,          -- Mercurial repositories</div>
  </div>
  <div class="line not-covered" id="L2129">
    <div class="line-number"><a href="#L2129">2129</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;LICENSE&quot;,      -- Common in project roots</div>
  </div>
  <div class="line not-covered" id="L2130">
    <div class="line-number"><a href="#L2130">2130</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;README.md&quot;,    -- Common in project roots</div>
  </div>
  <div class="line not-covered" id="L2131">
    <div class="line-number"><a href="#L2131">2131</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;.project&quot;,     -- Eclipse projects</div>
  </div>
  <div class="line not-covered" id="L2132">
    <div class="line-number"><a href="#L2132">2132</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;firmo.lua&quot;     -- Firmo projects</div>
  </div>
  <div class="line not-covered" id="L2133">
    <div class="line-number"><a href="#L2133">2133</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    }</div>
  </div>
  <div class="line not-executable" id="L2134">
    <div class="line-number"><a href="#L2134">2134</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L2135">
    <div class="line-number"><a href="#L2135">2135</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Normalize start directory</div>
  </div>
  <div class="line not-covered" id="L2136">
    <div class="line-number"><a href="#L2136">2136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local dir = fs.normalize_path(start_dir)</div>
  </div>
  <div class="line not-executable" id="L2137">
    <div class="line-number"><a href="#L2137">2137</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L2138">
    <div class="line-number"><a href="#L2138">2138</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Search upwards from start_dir</div>
  </div>
  <div class="line not-covered" id="L2139">
    <div class="line-number"><a href="#L2139">2139</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    while dir and dir ~= &quot;&quot; do</div>
  </div>
  <div class="line not-executable" id="L2140">
    <div class="line-number"><a href="#L2140">2140</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Check for each marker</div>
  </div>
  <div class="line not-covered" id="L2141">
    <div class="line-number"><a href="#L2141">2141</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _, marker in ipairs(markers) do</div>
  </div>
  <div class="line not-covered" id="L2142">
    <div class="line-number"><a href="#L2142">2142</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local marker_path = fs.join_paths(dir, marker)</div>
  </div>
  <div class="line not-covered" id="L2143">
    <div class="line-number"><a href="#L2143">2143</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if fs.file_exists(marker_path) or fs.directory_exists(marker_path) then</div>
  </div>
  <div class="line not-covered" id="L2144">
    <div class="line-number"><a href="#L2144">2144</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return dir</div>
  </div>
  <div class="line not-covered" id="L2145">
    <div class="line-number"><a href="#L2145">2145</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L2146">
    <div class="line-number"><a href="#L2146">2146</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L2147">
    <div class="line-number"><a href="#L2147">2147</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L2148">
    <div class="line-number"><a href="#L2148">2148</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Move up to parent directory</div>
  </div>
  <div class="line not-covered" id="L2149">
    <div class="line-number"><a href="#L2149">2149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local parent_dir = fs.get_directory_name(dir)</div>
  </div>
  <div class="line not-executable" id="L2150">
    <div class="line-number"><a href="#L2150">2150</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L2151">
    <div class="line-number"><a href="#L2151">2151</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Break if we can't go higher or we're at the root</div>
  </div>
  <div class="line not-covered" id="L2152">
    <div class="line-number"><a href="#L2152">2152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not parent_dir or parent_dir == dir or parent_dir == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L2153">
    <div class="line-number"><a href="#L2153">2153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            break</div>
  </div>
  <div class="line not-covered" id="L2154">
    <div class="line-number"><a href="#L2154">2154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L2155">
    <div class="line-number"><a href="#L2155">2155</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L2156">
    <div class="line-number"><a href="#L2156">2156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        dir = parent_dir</div>
  </div>
  <div class="line not-covered" id="L2157">
    <div class="line-number"><a href="#L2157">2157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2158">
    <div class="line-number"><a href="#L2158">2158</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L2159">
    <div class="line-number"><a href="#L2159">2159</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If we didn't find a project root, return the starting directory</div>
  </div>
  <div class="line not-covered" id="L2160">
    <div class="line-number"><a href="#L2160">2160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return start_dir</div>
  </div>
  <div class="line not-covered" id="L2161">
    <div class="line-number"><a href="#L2161">2161</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L2162">
    <div class="line-number"><a href="#L2162">2162</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the current working directory</div>
  </div>
  <div class="line not-executable" id="L2163">
    <div class="line-number"><a href="#L2163">2163</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string|nil current_dir The current working directory or nil on error</div>
  </div>
  <div class="line not-executable" id="L2164">
    <div class="line-number"><a href="#L2164">2164</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string|nil error Error message if operation failed</div>
  </div>
  <div class="line not-covered" id="L2165">
    <div class="line-number"><a href="#L2165">2165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.get_current_directory()</div>
  </div>
  <div class="line not-covered" id="L2166">
    <div class="line-number"><a href="#L2166">2166</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L2167">
    <div class="line-number"><a href="#L2167">2167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if lfs then</div>
  </div>
  <div class="line not-covered" id="L2168">
    <div class="line-number"><a href="#L2168">2168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return lfs.currentdir()</div>
  </div>
  <div class="line not-covered" id="L2169">
    <div class="line-number"><a href="#L2169">2169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L2170">
    <div class="line-number"><a href="#L2170">2170</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Fallback method if lfs is not available</div>
  </div>
  <div class="line not-covered" id="L2171">
    <div class="line-number"><a href="#L2171">2171</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local handle, err</div>
  </div>
  <div class="line not-covered" id="L2172">
    <div class="line-number"><a href="#L2172">2172</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if is_windows() then</div>
  </div>
  <div class="line not-covered" id="L2173">
    <div class="line-number"><a href="#L2173">2173</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                handle, err = io.popen(&quot;cd&quot;)</div>
  </div>
  <div class="line not-covered" id="L2174">
    <div class="line-number"><a href="#L2174">2174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            else</div>
  </div>
  <div class="line not-covered" id="L2175">
    <div class="line-number"><a href="#L2175">2175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                handle, err = io.popen(&quot;pwd&quot;)</div>
  </div>
  <div class="line not-covered" id="L2176">
    <div class="line-number"><a href="#L2176">2176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L2177">
    <div class="line-number"><a href="#L2177">2177</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L2178">
    <div class="line-number"><a href="#L2178">2178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not handle then</div>
  </div>
  <div class="line not-covered" id="L2179">
    <div class="line-number"><a href="#L2179">2179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return nil, &quot;Failed to execute current directory command: &quot; .. (err or &quot;unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L2180">
    <div class="line-number"><a href="#L2180">2180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L2181">
    <div class="line-number"><a href="#L2181">2181</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L2182">
    <div class="line-number"><a href="#L2182">2182</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local current_dir = handle:read(&quot;*l&quot;)</div>
  </div>
  <div class="line not-covered" id="L2183">
    <div class="line-number"><a href="#L2183">2183</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            handle:close()</div>
  </div>
  <div class="line not-executable" id="L2184">
    <div class="line-number"><a href="#L2184">2184</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L2185">
    <div class="line-number"><a href="#L2185">2185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not current_dir or current_dir == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L2186">
    <div class="line-number"><a href="#L2186">2186</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return nil, &quot;Failed to get current directory output&quot;</div>
  </div>
  <div class="line not-covered" id="L2187">
    <div class="line-number"><a href="#L2187">2187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L2188">
    <div class="line-number"><a href="#L2188">2188</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L2189">
    <div class="line-number"><a href="#L2189">2189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return current_dir</div>
  </div>
  <div class="line not-covered" id="L2190">
    <div class="line-number"><a href="#L2190">2190</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L2191">
    <div class="line-number"><a href="#L2191">2191</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L2192">
    <div class="line-number"><a href="#L2192">2192</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L2193">
    <div class="line-number"><a href="#L2193">2193</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line not-covered" id="L2194">
    <div class="line-number"><a href="#L2194">2194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Error getting current directory: &quot; .. tostring(result)</div>
  </div>
  <div class="line not-covered" id="L2195">
    <div class="line-number"><a href="#L2195">2195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2196">
    <div class="line-number"><a href="#L2196">2196</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L2197">
    <div class="line-number"><a href="#L2197">2197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if err then</div>
  </div>
  <div class="line not-covered" id="L2198">
    <div class="line-number"><a href="#L2198">2198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, err</div>
  </div>
  <div class="line not-covered" id="L2199">
    <div class="line-number"><a href="#L2199">2199</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2200">
    <div class="line-number"><a href="#L2200">2200</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L2201">
    <div class="line-number"><a href="#L2201">2201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L2202">
    <div class="line-number"><a href="#L2202">2202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L2203">
    <div class="line-number"><a href="#L2203">2203</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Find files in a directory that match a pattern.</div>
  </div>
  <div class="line not-executable" id="L2204">
    <div class="line-number"><a href="#L2204">2204</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function searches for files in the specified directory that match</div>
  </div>
  <div class="line not-executable" id="L2205">
    <div class="line-number"><a href="#L2205">2205</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- the given Lua pattern. It can optionally search recursively into subdirectories.</div>
  </div>
  <div class="line not-executable" id="L2206">
    <div class="line-number"><a href="#L2206">2206</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L2207">
    <div class="line-number"><a href="#L2207">2207</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param dir_path string The directory to search in</div>
  </div>
  <div class="line not-executable" id="L2208">
    <div class="line-number"><a href="#L2208">2208</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param pattern string The Lua pattern to match against file names</div>
  </div>
  <div class="line not-executable" id="L2209">
    <div class="line-number"><a href="#L2209">2209</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param recursive boolean Whether to search recursively in subdirectories (default: false)</div>
  </div>
  <div class="line not-executable" id="L2210">
    <div class="line-number"><a href="#L2210">2210</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table&lt;number, string&gt;|nil files List of matching file paths or nil on error</div>
  </div>
  <div class="line not-executable" id="L2211">
    <div class="line-number"><a href="#L2211">2211</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil error Error message if the search failed</div>
  </div>
  <div class="line not-covered" id="L2212">
    <div class="line-number"><a href="#L2212">2212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function fs.find_files(dir_path, pattern, recursive)</div>
  </div>
  <div class="line not-covered" id="L2213">
    <div class="line-number"><a href="#L2213">2213</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not dir_path then</div>
  </div>
  <div class="line not-covered" id="L2214">
    <div class="line-number"><a href="#L2214">2214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Directory path is required&quot;</div>
  </div>
  <div class="line not-covered" id="L2215">
    <div class="line-number"><a href="#L2215">2215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2216">
    <div class="line-number"><a href="#L2216">2216</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L2217">
    <div class="line-number"><a href="#L2217">2217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not pattern then</div>
  </div>
  <div class="line not-covered" id="L2218">
    <div class="line-number"><a href="#L2218">2218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Pattern is required&quot;</div>
  </div>
  <div class="line not-covered" id="L2219">
    <div class="line-number"><a href="#L2219">2219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L2220">
    <div class="line-number"><a href="#L2220">2220</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not fs.directory_exists(dir_path) then</div>
  </div>
  <div class="line not-covered" id="L2221">
    <div class="line-number"><a href="#L2221">2221</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, &quot;Directory does not exist: &quot; .. dir_path</div>
  </div>
  <div class="line not-covered" id="L2222">
    <div class="line-number"><a href="#L2222">2222</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2223">
    <div class="line-number"><a href="#L2223">2223</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L2224">
    <div class="line-number"><a href="#L2224">2224</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Default to non-recursive</div>
  </div>
  <div class="line not-covered" id="L2225">
    <div class="line-number"><a href="#L2225">2225</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    recursive = recursive or false</div>
  </div>
  <div class="line not-executable" id="L2226">
    <div class="line-number"><a href="#L2226">2226</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L2227">
    <div class="line-number"><a href="#L2227">2227</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use list_files or list_files_recursive based on recursive flag</div>
  </div>
  <div class="line not-covered" id="L2228">
    <div class="line-number"><a href="#L2228">2228</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local files</div>
  </div>
  <div class="line not-covered" id="L2229">
    <div class="line-number"><a href="#L2229">2229</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err</div>
  </div>
  <div class="line not-executable" id="L2230">
    <div class="line-number"><a href="#L2230">2230</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L2231">
    <div class="line-number"><a href="#L2231">2231</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if recursive then</div>
  </div>
  <div class="line not-covered" id="L2232">
    <div class="line-number"><a href="#L2232">2232</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        files, err = fs.list_files_recursive(dir_path)</div>
  </div>
  <div class="line not-covered" id="L2233">
    <div class="line-number"><a href="#L2233">2233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L2234">
    <div class="line-number"><a href="#L2234">2234</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        files, err = fs.list_files(dir_path)</div>
  </div>
  <div class="line not-covered" id="L2235">
    <div class="line-number"><a href="#L2235">2235</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2236">
    <div class="line-number"><a href="#L2236">2236</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L2237">
    <div class="line-number"><a href="#L2237">2237</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not files then</div>
  </div>
  <div class="line not-covered" id="L2238">
    <div class="line-number"><a href="#L2238">2238</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil, err or &quot;Failed to list files&quot;</div>
  </div>
  <div class="line not-covered" id="L2239">
    <div class="line-number"><a href="#L2239">2239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2240">
    <div class="line-number"><a href="#L2240">2240</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L2241">
    <div class="line-number"><a href="#L2241">2241</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Filter files by pattern</div>
  </div>
  <div class="line not-covered" id="L2242">
    <div class="line-number"><a href="#L2242">2242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local matching_files = {}</div>
  </div>
  <div class="line not-covered" id="L2243">
    <div class="line-number"><a href="#L2243">2243</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, file_path in ipairs(files) do</div>
  </div>
  <div class="line not-covered" id="L2244">
    <div class="line-number"><a href="#L2244">2244</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local filename = fs.get_file_name(file_path)</div>
  </div>
  <div class="line not-covered" id="L2245">
    <div class="line-number"><a href="#L2245">2245</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if filename and filename:match(pattern) then</div>
  </div>
  <div class="line not-covered" id="L2246">
    <div class="line-number"><a href="#L2246">2246</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(matching_files, file_path)</div>
  </div>
  <div class="line not-covered" id="L2247">
    <div class="line-number"><a href="#L2247">2247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L2248">
    <div class="line-number"><a href="#L2248">2248</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L2249">
    <div class="line-number"><a href="#L2249">2249</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L2250">
    <div class="line-number"><a href="#L2250">2250</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return matching_files</div>
  </div>
  <div class="line not-covered" id="L2251">
    <div class="line-number"><a href="#L2251">2251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L2252">
    <div class="line-number"><a href="#L2252">2252</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return fs</div>
  </div>
</div>
<div class="source-code" id="file-scripts-runner-lua">
  <h3>scripts/runner.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">7 / 1289 (0%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 0%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">1 / 1 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 1685      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 1289      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 1      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 1      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search-scripts-runner-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter-scripts-runner-lua" value="all" checked>
        All <span class="function-count">1</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter-scripts-runner-lua" value="executed">
        Executed <span class="function-count badge-success">1</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter-scripts-runner-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type-scripts-runner-lua" value="global">
        Global <span class="function-count function-type-global">1</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type-scripts-runner-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type-scripts-runner-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type-scripts-runner-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">0</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type-scripts-runner-lua" value="closure">
        Closure <span class="function-count function-type-closure">0</span>
      </label>
    </div>
    
    <table class="functions" id="functions-scripts-runner-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="global" data-executed="true">
          <td>print <span class="function-type-badge function-type-global">global</span></td>
          <td>global</td>
          <td><a href="#L92">92-106</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>16</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for runner.lua    const tableId = 'functions-scripts-runner-lua';
    const searchId = 'func-search-scripts-runner-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter-scripts-runner-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type-scripts-runner-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter-scripts-runner-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type-scripts-runner-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Test runner for firmo</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- A universal test runner that can:</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- 1. Run a single test file</div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- 2. Run all tests in a directory (recursively)</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- 3. Run tests matching a pattern</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- 4. Support a standardized set of command-line arguments</div>
  </div>
  <div class="line not-covered" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local runner = {}</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Import required modules</div>
  </div>
  <div class="line not-covered" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local fs = require(&quot;lib.tools.filesystem&quot;)</div>
  </div>
  <div class="line not-covered" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local error_handler = require(&quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line not-covered" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local logging = require(&quot;lib.tools.logging&quot;)</div>
  </div>
  <div class="line not-executable" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Set error handler to test mode since we're running tests</div>
  </div>
  <div class="line not-covered" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count">0</div>    <div class="line-content">error_handler.set_test_mode(true)</div>
  </div>
  <div class="line not-executable" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Try to load watcher module if available</div>
  </div>
  <div class="line not-covered" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local watcher</div>
  </div>
  <div class="line not-covered" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local has_watcher = pcall(function()</div>
  </div>
  <div class="line not-covered" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  watcher = require(&quot;lib.tools.watcher&quot;)</div>
  </div>
  <div class="line not-covered" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end)</div>
  </div>
  <div class="line not-executable" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Initialize logger for runner module</div>
  </div>
  <div class="line not-covered" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local logger = logging.get_logger(&quot;runner&quot;)</div>
  </div>
  <div class="line not-covered" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count">0</div>    <div class="line-content">logging.configure_from_config(&quot;runner&quot;)</div>
  </div>
  <div class="line not-executable" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Try to load module_reset for enhanced isolation</div>
  </div>
  <div class="line not-covered" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local module_reset_loaded, module_reset = pcall(require, &quot;lib.core.module_reset&quot;)</div>
  </div>
  <div class="line not-covered" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count">0</div>    <div class="line-content">if not module_reset_loaded then</div>
  </div>
  <div class="line not-covered" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.warn(&quot;Module reset system unavailable&quot;, { fallback = &quot;using basic isolation&quot; })</div>
  </div>
  <div class="line not-covered" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- ANSI color codes (keep them for compatibility with existing code)</div>
  </div>
  <div class="line not-covered" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local red = string.char(27) .. &quot;[31m&quot;</div>
  </div>
  <div class="line not-covered" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local green = string.char(27) .. &quot;[32m&quot;</div>
  </div>
  <div class="line not-covered" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local yellow = string.char(27) .. &quot;[33m&quot;</div>
  </div>
  <div class="line not-covered" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local cyan = string.char(27) .. &quot;[36m&quot;</div>
  </div>
  <div class="line not-covered" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local normal = string.char(27) .. &quot;[0m&quot;</div>
  </div>
  <div class="line not-executable" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Run a specific test file and return structured results</div>
  </div>
  <div class="line not-executable" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the test file to run</div>
  </div>
  <div class="line not-executable" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param firmo table The firmo module instance</div>
  </div>
  <div class="line not-executable" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param options table Options for running the test</div>
  </div>
  <div class="line not-executable" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table Table containing test results including:</div>
  </div>
  <div class="line not-executable" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - success: boolean Whether the file executed without errors</div>
  </div>
  <div class="line not-executable" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - error: any Any execution error that occurred</div>
  </div>
  <div class="line not-executable" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - passes: number Number of passing tests</div>
  </div>
  <div class="line not-executable" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - errors: number Number of failing tests</div>
  </div>
  <div class="line not-executable" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - skipped: number Number of skipped tests</div>
  </div>
  <div class="line not-executable" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - total: number Total number of tests</div>
  </div>
  <div class="line not-executable" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - elapsed: number Execution time in seconds</div>
  </div>
  <div class="line not-executable" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - file: string Path to the test file</div>
  </div>
  <div class="line not-executable" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - test_results: TestResult[] Array of structured test results</div>
  </div>
  <div class="line not-executable" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   - test_errors: table[] Array of test errors</div>
  </div>
  <div class="line not-covered" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function runner.run_file(file_path, firmo, options)</div>
  </div>
  <div class="line not-covered" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  options = options or {}</div>
  </div>
  <div class="line not-executable" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Always initialize counter properties for this test file</div>
  </div>
  <div class="line not-executable" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- We want to capture just this file's results, so reset them each time</div>
  </div>
  <div class="line not-covered" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  firmo.passes = 0</div>
  </div>
  <div class="line not-covered" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  firmo.errors = 0</div>
  </div>
  <div class="line not-covered" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  firmo.skipped = 0</div>
  </div>
  <div class="line not-executable" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Since we're resetting each time, these are always zero</div>
  </div>
  <div class="line not-covered" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local prev_passes = 0</div>
  </div>
  <div class="line not-covered" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local prev_errors = 0</div>
  </div>
  <div class="line not-covered" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local prev_skipped = 0</div>
  </div>
  <div class="line not-executable" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Reset test_definition module state if available</div>
  </div>
  <div class="line not-covered" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local test_definition = require(&quot;lib.core.test_definition&quot;)</div>
  </div>
  <div class="line not-covered" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if test_definition and test_definition.reset then</div>
  </div>
  <div class="line not-covered" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test_definition.reset()</div>
  </div>
  <div class="line not-executable" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Enable debug mode for test_definition if verbose is enabled</div>
  </div>
  <div class="line not-covered" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if options.verbose and test_definition.set_debug_mode then</div>
  </div>
  <div class="line not-covered" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      test_definition.set_debug_mode(true)</div>
  </div>
  <div class="line not-covered" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Running file&quot;, { file_path = file_path })</div>
  </div>
  <div class="line not-executable" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Count PASS/FAIL from test output</div>
  </div>
  <div class="line not-covered" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local pass_count = 0</div>
  </div>
  <div class="line not-covered" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local fail_count = 0</div>
  </div>
  <div class="line not-covered" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local skip_count = 0</div>
  </div>
  <div class="line not-executable" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Keep track of the original print function</div>
  </div>
  <div class="line not-covered" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local original_print = print</div>
  </div>
  <div class="line not-covered" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local output_buffer = {}</div>
  </div>
  <div class="line not-executable" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Override print to capture output for diagnostics</div>
  </div>
  <div class="line not-covered" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  _G.print = function(...)</div>
  </div>
  <div class="line not-executable" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Convert arguments to strings first to handle booleans and other non-string values</div>
  </div>
  <div class="line not-covered" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local args = {...}</div>
  </div>
  <div class="line not-covered" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local string_args = {}</div>
  </div>
  <div class="line not-executable" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i, v in ipairs(args) do</div>
  </div>
  <div class="line not-covered" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      string_args[i] = tostring(v)</div>
  </div>
  <div class="line not-covered" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local output = table.concat(string_args, &quot; &quot;)</div>
  </div>
  <div class="line not-covered" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(output_buffer, output)</div>
  </div>
  <div class="line not-executable" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Still show output</div>
  </div>
  <div class="line covered" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    original_print(...)</div>
  </div>
  <div class="line covered" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a collection of structured test results for this file</div>
  </div>
  <div class="line not-executable" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- This will be populated from test_definition's test_results</div>
  </div>
  <div class="line not-executable" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count"></div>    <div class="line-content">  ---@type TestResult[]</div>
  </div>
  <div class="line covered" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count">19</div>    <div class="line-content">  local file_test_results = {}</div>
  </div>
  <div class="line not-executable" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Intercept logger calls to capture structured test results</div>
  </div>
  <div class="line covered" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count">16</div>    <div class="line-content">  local original_logger_info = logger.info</div>
  </div>
  <div class="line covered" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count">16</div>    <div class="line-content">  local original_logger_error = logger.error</div>
  </div>
  <div class="line not-executable" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.info = function(message, context)</div>
  </div>
  <div class="line not-executable" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Look for structured test result objects</div>
  </div>
  <div class="line covered" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count">16</div>    <div class="line-content">    if context and context.test_result and type(context.test_result) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local result = context.test_result</div>
  </div>
  <div class="line not-executable" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Store the result for reporting</div>
  </div>
  <div class="line not-covered" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      table.insert(file_test_results, result)</div>
  </div>
  <div class="line not-executable" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Count based on status</div>
  </div>
  <div class="line not-covered" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if result.status == &quot;pass&quot; then</div>
  </div>
  <div class="line not-covered" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        pass_count = pass_count + 1</div>
  </div>
  <div class="line not-executable" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Display the test result</div>
  </div>
  <div class="line not-covered" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if result.expect_error then</div>
  </div>
  <div class="line not-executable" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Expected error test pass</div>
  </div>
  <div class="line not-covered" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          original_print(green .. &quot;PASS &quot; .. result.name .. &quot; (expected error)&quot; .. normal)</div>
  </div>
  <div class="line not-covered" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Normal test pass</div>
  </div>
  <div class="line not-covered" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          original_print(green .. &quot;PASS &quot; .. result.name .. normal)</div>
  </div>
  <div class="line not-covered" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif result.status == &quot;skip&quot; or result.status == &quot;pending&quot; then</div>
  </div>
  <div class="line not-covered" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        skip_count = skip_count + 1</div>
  </div>
  <div class="line not-executable" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Display skip reason</div>
  </div>
  <div class="line not-covered" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local reason = result.reason and (&quot; - &quot; .. result.reason) or &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        original_print(yellow .. &quot;SKIP &quot; .. result.name .. reason .. normal)</div>
  </div>
  <div class="line not-covered" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return original_logger_info(message, context)</div>
  </div>
  <div class="line not-covered" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.error = function(message, context)</div>
  </div>
  <div class="line not-executable" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Look for structured test result objects</div>
  </div>
  <div class="line not-covered" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if context and context.test_result and type(context.test_result) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local result = context.test_result</div>
  </div>
  <div class="line not-executable" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Store the result for reporting</div>
  </div>
  <div class="line not-covered" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      table.insert(file_test_results, result)</div>
  </div>
  <div class="line not-executable" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Count based on status</div>
  </div>
  <div class="line not-covered" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if result.status == &quot;fail&quot; then</div>
  </div>
  <div class="line not-covered" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        fail_count = fail_count + 1</div>
  </div>
  <div class="line not-executable" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Display the failure</div>
  </div>
  <div class="line not-covered" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local error_message = result.error_message or message</div>
  </div>
  <div class="line not-covered" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        original_print(red .. &quot;FAIL &quot; .. result.name .. &quot; - &quot; .. error_message .. normal)</div>
  </div>
  <div class="line not-covered" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return original_logger_error(message, context)</div>
  </div>
  <div class="line not-covered" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try to load temp_file integration for test file context</div>
  </div>
  <div class="line not-covered" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local temp_file_integration</div>
  </div>
  <div class="line not-covered" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local temp_file</div>
  </div>
  <div class="line not-executable" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try to load temp_file_integration if available</div>
  </div>
  <div class="line not-covered" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local temp_file_integration_loaded, temp_file_integration_module = pcall(require, &quot;lib.tools.temp_file_integration&quot;)</div>
  </div>
  <div class="line not-covered" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if temp_file_integration_loaded then</div>
  </div>
  <div class="line not-covered" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    temp_file_integration = temp_file_integration_module</div>
  </div>
  <div class="line not-executable" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Also load the temp_file module</div>
  </div>
  <div class="line not-covered" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local temp_file_loaded, temp_file_module = pcall(require, &quot;lib.tools.temp_file&quot;)</div>
  </div>
  <div class="line not-covered" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if temp_file_loaded then</div>
  </div>
  <div class="line not-covered" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      temp_file = temp_file_module</div>
  </div>
  <div class="line not-executable" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Create a test context for this file</div>
  </div>
  <div class="line not-covered" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local file_context = {</div>
  </div>
  <div class="line not-covered" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        type = &quot;file&quot;,</div>
  </div>
  <div class="line not-covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        name = file_path,</div>
  </div>
  <div class="line not-covered" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_path = file_path</div>
  </div>
  <div class="line not-covered" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-executable" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Set the current test context</div>
  </div>
  <div class="line not-covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if firmo.set_current_test_context then</div>
  </div>
  <div class="line not-covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        firmo.set_current_test_context(file_context)</div>
  </div>
  <div class="line not-covered" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Also set global context</div>
  </div>
  <div class="line not-covered" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      _G._current_temp_file_context = file_context</div>
  </div>
  <div class="line not-covered" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Execute the test file</div>
  </div>
  <div class="line not-covered" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local start_time = os.clock()</div>
  </div>
  <div class="line not-covered" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, err = pcall(function()</div>
  </div>
  <div class="line not-executable" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Verify file exists</div>
  </div>
  <div class="line not-covered" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not fs.file_exists(file_path) then</div>
  </div>
  <div class="line not-covered" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Test file does not exist: &quot; .. file_path)</div>
  </div>
  <div class="line not-covered" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Ensure proper package path for test file</div>
  </div>
  <div class="line not-covered" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local save_path = package.path</div>
  </div>
  <div class="line not-covered" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local dir = fs.get_directory_name(file_path)</div>
  </div>
  <div class="line not-covered" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if dir and dir ~= &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      package.path = fs.join_paths(dir, &quot;?.lua&quot;) .. &quot;;&quot; .. fs.join_paths(dir, &quot;../?.lua&quot;) .. &quot;;&quot; .. package.path</div>
  </div>
  <div class="line not-covered" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    dofile(file_path)</div>
  </div>
  <div class="line not-covered" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    package.path = save_path</div>
  </div>
  <div class="line not-covered" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line not-covered" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local elapsed_time = os.clock() - start_time</div>
  </div>
  <div class="line not-executable" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Restore original print function</div>
  </div>
  <div class="line not-covered" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  _G.print = original_print</div>
  </div>
  <div class="line not-executable" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Restore original logger functions</div>
  </div>
  <div class="line not-covered" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info = original_logger_info</div>
  </div>
  <div class="line not-covered" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.error = original_logger_error</div>
  </div>
  <div class="line not-executable" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Clean up temporary files</div>
  </div>
  <div class="line not-covered" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if temp_file_integration and temp_file then</div>
  </div>
  <div class="line not-executable" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Clean up any temporary files created during test execution</div>
  </div>
  <div class="line not-covered" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Cleaning up temporary files after test execution&quot;, { file_path = file_path })</div>
  </div>
  <div class="line not-executable" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try to clean up, but don't let cleanup failures affect test results</div>
  </div>
  <div class="line not-covered" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pcall(function()</div>
  </div>
  <div class="line not-covered" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      temp_file.cleanup_all()</div>
  </div>
  <div class="line not-covered" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Clear test context</div>
  </div>
  <div class="line not-covered" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if firmo.set_current_test_context then</div>
  </div>
  <div class="line not-covered" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      firmo.set_current_test_context(nil)</div>
  </div>
  <div class="line not-covered" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Also clear global context</div>
  </div>
  <div class="line not-covered" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    _G._current_temp_file_context = nil</div>
  </div>
  <div class="line not-covered" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Always copy test results from test_definition</div>
  </div>
  <div class="line not-covered" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local test_definition = require(&quot;lib.core.test_definition&quot;)</div>
  </div>
  <div class="line not-covered" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if test_definition and test_definition.get_state then</div>
  </div>
  <div class="line not-covered" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local state = test_definition.get_state()</div>
  </div>
  <div class="line not-covered" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if state and state.test_results then</div>
  </div>
  <div class="line not-executable" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Copy test_definition results into file_test_results for more reliable collection</div>
  </div>
  <div class="line not-covered" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, result in ipairs(state.test_results) do</div>
  </div>
  <div class="line not-covered" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(file_test_results, result)</div>
  </div>
  <div class="line not-covered" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Debug output only in verbose mode</div>
  </div>
  <div class="line not-covered" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if options.verbose then</div>
  </div>
  <div class="line not-covered" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;\n%sStructured Test Result Collection:%s&quot;, cyan, normal))</div>
  </div>
  <div class="line not-covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;  File test results count: %d&quot;, #file_test_results))</div>
  </div>
  <div class="line not-covered" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;  Counts: pass=%d, fail=%d, skip=%d&quot;, pass_count, fail_count, skip_count))</div>
  </div>
  <div class="line not-covered" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;  Test definition results count: %d&quot;, #state.test_results))</div>
  </div>
  <div class="line not-covered" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;  Test definition counters: passes=%d, errors=%d, skipped=%d&quot;, </div>
  </div>
  <div class="line not-covered" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          state.passes or 0, state.errors or 0, state.skipped or 0))</div>
  </div>
  <div class="line not-covered" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;  Copied %d results from test_definition to file_test_results&quot;, </div>
  </div>
  <div class="line not-covered" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          #state.test_results))</div>
  </div>
  <div class="line not-covered" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Use structured test results collected via intercepted logger calls</div>
  </div>
  <div class="line not-covered" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local results = {</div>
  </div>
  <div class="line not-covered" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    success = success,</div>
  </div>
  <div class="line not-covered" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error = err,</div>
  </div>
  <div class="line not-covered" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    passes = pass_count,</div>
  </div>
  <div class="line not-covered" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    errors = fail_count,</div>
  </div>
  <div class="line not-covered" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    skipped = skip_count,</div>
  </div>
  <div class="line not-covered" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    total = 0,</div>
  </div>
  <div class="line not-covered" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elapsed = elapsed_time,</div>
  </div>
  <div class="line not-covered" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    output = table.concat(output_buffer, &quot;\n&quot;),</div>
  </div>
  <div class="line not-covered" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test_results = file_test_results, -- Include the full structured test results</div>
  </div>
  <div class="line not-covered" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file = file_path</div>
  </div>
  <div class="line not-covered" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get test results directly from test_definition, which is more reliable</div>
  </div>
  <div class="line not-covered" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local test_definition = require(&quot;lib.core.test_definition&quot;)</div>
  </div>
  <div class="line not-covered" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if test_definition and test_definition.get_state then</div>
  </div>
  <div class="line not-covered" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local state = test_definition.get_state()</div>
  </div>
  <div class="line not-covered" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if state and state.test_results and #state.test_results &gt; 0 then</div>
  </div>
  <div class="line not-executable" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Use file_test_results which now has the test_definition results</div>
  </div>
  <div class="line not-covered" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      results.test_results = file_test_results</div>
  </div>
  <div class="line not-covered" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      results.passes = state.passes or 0</div>
  </div>
  <div class="line not-covered" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      results.errors = state.errors or 0</div>
  </div>
  <div class="line not-covered" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      results.skipped = state.skipped or 0</div>
  </div>
  <div class="line not-executable" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.debug(&quot;Using test_definition state for test results&quot;, {</div>
  </div>
  <div class="line not-covered" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file = file_path,</div>
  </div>
  <div class="line not-covered" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result_count = #state.test_results,</div>
  </div>
  <div class="line not-covered" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        passes = state.passes,</div>
  </div>
  <div class="line not-covered" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        errors = state.errors,</div>
  </div>
  <div class="line not-covered" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        skipped = state.skipped</div>
  </div>
  <div class="line not-covered" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-executable" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fall back to traditional counters if we couldn't get structured results</div>
  </div>
  <div class="line not-covered" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    results.passes = pass_count &gt; 0 and pass_count or (firmo.passes - prev_passes)</div>
  </div>
  <div class="line not-covered" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    results.errors = fail_count &gt; 0 and fail_count or (firmo.errors - prev_errors)</div>
  </div>
  <div class="line not-covered" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    results.skipped = skip_count &gt; 0 and skip_count or (firmo.skipped - prev_skipped)</div>
  </div>
  <div class="line not-covered" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Calculate total tests</div>
  </div>
  <div class="line not-covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  results.total = results.passes + results.errors + results.skipped</div>
  </div>
  <div class="line not-executable" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add test errors from structured results</div>
  </div>
  <div class="line not-covered" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  results.test_errors = {}</div>
  </div>
  <div class="line not-covered" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, result in ipairs(results.test_results or {}) do</div>
  </div>
  <div class="line not-covered" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if result.status == &quot;fail&quot; then</div>
  </div>
  <div class="line not-covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      table.insert(results.test_errors, {</div>
  </div>
  <div class="line not-covered" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        message = result.error_message or &quot;Test failed: &quot; .. result.name,</div>
  </div>
  <div class="line not-covered" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file = file_path,</div>
  </div>
  <div class="line not-covered" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_name = result.name,</div>
  </div>
  <div class="line not-covered" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_path = result.path_string,</div>
  </div>
  <div class="line not-covered" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = result.error</div>
  </div>
  <div class="line not-covered" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If we don't have structured test errors, try to parse from output (legacy)</div>
  </div>
  <div class="line not-covered" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if #results.test_errors == 0 then</div>
  </div>
  <div class="line not-covered" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for line in results.output:gmatch(&quot;[^\r\n]+&quot;) do</div>
  </div>
  <div class="line not-covered" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if line:match(&quot;FAIL&quot;) then</div>
  </div>
  <div class="line not-covered" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local name = line:match(&quot;FAIL%s+(.+)&quot;)</div>
  </div>
  <div class="line not-covered" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if name then</div>
  </div>
  <div class="line not-covered" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          table.insert(results.test_errors, {</div>
  </div>
  <div class="line not-covered" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            message = &quot;Test failed: &quot; .. name,</div>
  </div>
  <div class="line not-covered" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            file = file_path,</div>
  </div>
  <div class="line not-covered" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line not-covered" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;Execution error&quot;, { error = err })</div>
  </div>
  <div class="line not-covered" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(results.test_errors, {</div>
  </div>
  <div class="line not-covered" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      message = tostring(err),</div>
  </div>
  <div class="line not-covered" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file = file_path,</div>
  </div>
  <div class="line not-covered" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      traceback = debug.traceback(),</div>
  </div>
  <div class="line not-covered" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- CRITICAL FIX: Ensure execution errors are counted as failures</div>
  </div>
  <div class="line not-executable" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- This way, even if a test file has syntax errors or errors in describe blocks,</div>
  </div>
  <div class="line not-executable" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- it will still be properly counted as a failure</div>
  </div>
  <div class="line not-covered" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    results.errors = results.errors + 1</div>
  </div>
  <div class="line not-covered" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Always show the completion status with test counts</div>
  </div>
  <div class="line not-executable" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Use consistent terminology</div>
  </div>
  <div class="line not-covered" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Test completed&quot;, {</div>
  </div>
  <div class="line not-covered" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    passes = results.passes,</div>
  </div>
  <div class="line not-covered" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    failures = results.errors,</div>
  </div>
  <div class="line not-covered" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    skipped = results.skipped,</div>
  </div>
  <div class="line not-covered" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    tests_passed = results.passes, -- Add for consistency with run_all</div>
  </div>
  <div class="line not-covered" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    tests_failed = results.errors, -- Add for consistency with run_all</div>
  </div>
  <div class="line not-covered" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Output JSON results if requested</div>
  </div>
  <div class="line not-covered" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.json_output or options.results_format == &quot;json&quot; then</div>
  </div>
  <div class="line not-executable" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try to load JSON module</div>
  </div>
  <div class="line not-covered" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local json_module</div>
  </div>
  <div class="line not-covered" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local ok, mod = pcall(require, &quot;lib.reporting.json&quot;)</div>
  </div>
  <div class="line not-covered" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not ok then</div>
  </div>
  <div class="line not-covered" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      ok, mod = pcall(require, &quot;../lib/reporting/json&quot;)</div>
  </div>
  <div class="line not-covered" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if ok then</div>
  </div>
  <div class="line not-covered" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      json_module = mod</div>
  </div>
  <div class="line not-executable" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Create test results data structure</div>
  </div>
  <div class="line not-covered" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local test_results = {</div>
  </div>
  <div class="line not-covered" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        name = file_path:match(&quot;([^/\\]+)$&quot;) or file_path,</div>
  </div>
  <div class="line not-covered" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        timestamp = os.date(&quot;!%Y-%m-%dT%H:%M:%S&quot;),</div>
  </div>
  <div class="line not-covered" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        tests = results.total,</div>
  </div>
  <div class="line not-covered" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        failures = results.errors,</div>
  </div>
  <div class="line not-covered" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        errors = success and 0 or 1,</div>
  </div>
  <div class="line not-covered" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        skipped = results.skipped,</div>
  </div>
  <div class="line not-covered" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        time = results.elapsed,</div>
  </div>
  <div class="line not-covered" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_cases = {},</div>
  </div>
  <div class="line not-covered" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file = file_path,</div>
  </div>
  <div class="line not-covered" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        success = success and results.errors == 0,</div>
  </div>
  <div class="line not-covered" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-executable" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Extract test cases if possible</div>
  </div>
  <div class="line not-covered" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for line in results.output:gmatch(&quot;[^\r\n]+&quot;) do</div>
  </div>
  <div class="line not-covered" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if line:match(&quot;PASS%s+&quot;) or line:match(&quot;FAIL%s+&quot;) or line:match(&quot;SKIP%s+&quot;) or line:match(&quot;PENDING%s+&quot;) then</div>
  </div>
  <div class="line not-covered" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local status, name</div>
  </div>
  <div class="line not-covered" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if line:match(&quot;PASS%s+&quot;) then</div>
  </div>
  <div class="line not-covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            status = &quot;pass&quot;</div>
  </div>
  <div class="line not-covered" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            name = line:match(&quot;PASS%s+(.+)&quot;)</div>
  </div>
  <div class="line not-covered" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          elseif line:match(&quot;FAIL%s+&quot;) then</div>
  </div>
  <div class="line not-covered" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            status = &quot;fail&quot;</div>
  </div>
  <div class="line not-covered" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            name = line:match(&quot;FAIL%s+(.+)&quot;)</div>
  </div>
  <div class="line not-covered" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          elseif line:match(&quot;SKIP%s+&quot;) then</div>
  </div>
  <div class="line not-covered" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            status = &quot;skipped&quot;</div>
  </div>
  <div class="line not-covered" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            name = line:match(&quot;SKIP%s+(.+)&quot;)</div>
  </div>
  <div class="line not-covered" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          elseif line:match(&quot;PENDING%s+&quot;) then</div>
  </div>
  <div class="line not-covered" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            status = &quot;pending&quot;</div>
  </div>
  <div class="line not-covered" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            name = line:match(&quot;PENDING:%s+(.+)&quot;)</div>
  </div>
  <div class="line not-covered" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if name then</div>
  </div>
  <div class="line not-covered" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local test_case = {</div>
  </div>
  <div class="line not-covered" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              name = name,</div>
  </div>
  <div class="line not-covered" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              classname = file_path:match(&quot;([^/\\]+)$&quot;):gsub(&quot;%.lua$&quot;, &quot;&quot;),</div>
  </div>
  <div class="line not-covered" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              time = 0, -- We don't have individual test timing</div>
  </div>
  <div class="line not-covered" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              status = status,</div>
  </div>
  <div class="line not-covered" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            }</div>
  </div>
  <div class="line not-executable" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Add failure details if available</div>
  </div>
  <div class="line not-covered" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if status == &quot;fail&quot; then</div>
  </div>
  <div class="line not-covered" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              test_case.failure = {</div>
  </div>
  <div class="line not-covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                message = &quot;Test failed: &quot; .. name,</div>
  </div>
  <div class="line not-covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                type = &quot;Assertion&quot;,</div>
  </div>
  <div class="line not-covered" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                details = &quot;&quot;,</div>
  </div>
  <div class="line not-covered" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              }</div>
  </div>
  <div class="line not-covered" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(test_results.test_cases, test_case)</div>
  </div>
  <div class="line not-covered" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If we couldn't extract individual tests, add a single summary test case</div>
  </div>
  <div class="line not-covered" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if #test_results.test_cases == 0 then</div>
  </div>
  <div class="line not-covered" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(test_results.test_cases, {</div>
  </div>
  <div class="line not-covered" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          name = file_path:match(&quot;([^/\\]+)$&quot;):gsub(&quot;%.lua$&quot;, &quot;&quot;),</div>
  </div>
  <div class="line not-covered" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          classname = file_path:match(&quot;([^/\\]+)$&quot;):gsub(&quot;%.lua$&quot;, &quot;&quot;),</div>
  </div>
  <div class="line not-covered" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          time = results.elapsed,</div>
  </div>
  <div class="line not-covered" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          status = (success and results.errors == 0) and &quot;pass&quot; or &quot;fail&quot;,</div>
  </div>
  <div class="line not-covered" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Format as JSON with markers for parallel execution</div>
  </div>
  <div class="line not-covered" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local json_results = json_module.encode(test_results)</div>
  </div>
  <div class="line not-covered" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;JSON results&quot;, { results = &quot;RESULTS_JSON_BEGIN&quot; .. json_results .. &quot;RESULTS_JSON_END&quot; })</div>
  </div>
  <div class="line not-covered" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return results</div>
  </div>
  <div class="line not-covered" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Find test files in a directory</div>
  </div>
  <div class="line not-covered" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function runner.find_test_files(dir_path, options)</div>
  </div>
  <div class="line not-covered" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  options = options or {}</div>
  </div>
  <div class="line not-covered" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local pattern = options.pattern or &quot;*.lua&quot;</div>
  </div>
  <div class="line not-covered" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local filter = options.filter</div>
  </div>
  <div class="line not-covered" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local exclude_patterns = options.exclude_patterns or { &quot;fixtures/*&quot; }</div>
  </div>
  <div class="line not-covered" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Finding test files&quot;, {</div>
  </div>
  <div class="line not-covered" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    directory = dir_path,</div>
  </div>
  <div class="line not-covered" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pattern = pattern,</div>
  </div>
  <div class="line not-covered" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    filter = filter,</div>
  </div>
  <div class="line not-covered" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    exclude_patterns = table.concat(exclude_patterns, &quot;, &quot;),</div>
  </div>
  <div class="line not-covered" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Handle directory existence check properly</div>
  </div>
  <div class="line not-executable" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- The fs.normalize_path() function automatically removes trailing slashes</div>
  </div>
  <div class="line not-executable" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- but fs.directory_exists() works fine with or without trailing slashes</div>
  </div>
  <div class="line not-executable" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Simply check if directory exists</div>
  </div>
  <div class="line not-covered" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not fs.directory_exists(dir_path) then</div>
  </div>
  <div class="line not-covered" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;Directory not found&quot;, { directory = dir_path })</div>
  </div>
  <div class="line not-covered" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return {}</div>
  </div>
  <div class="line not-covered" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Use filesystem module to find test files</div>
  </div>
  <div class="line not-covered" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local files, err = fs.discover_files({ dir_path }, { pattern }, exclude_patterns)</div>
  </div>
  <div class="line not-covered" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not files then</div>
  </div>
  <div class="line not-covered" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;Failed to discover test files&quot;, {</div>
  </div>
  <div class="line not-covered" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = error_handler.format_error(err),</div>
  </div>
  <div class="line not-covered" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      directory = dir_path,</div>
  </div>
  <div class="line not-covered" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      pattern = pattern,</div>
  </div>
  <div class="line not-covered" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return {}</div>
  </div>
  <div class="line not-covered" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Apply filter if specified</div>
  </div>
  <div class="line not-covered" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if filter and filter ~= &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local filtered_files = {}</div>
  </div>
  <div class="line not-covered" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, file in ipairs(files) do</div>
  </div>
  <div class="line not-covered" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if file:match(filter) then</div>
  </div>
  <div class="line not-covered" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(filtered_files, file)</div>
  </div>
  <div class="line not-covered" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Filtered test files&quot;, {</div>
  </div>
  <div class="line not-covered" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      count = #filtered_files,</div>
  </div>
  <div class="line not-covered" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      original_count = #files,</div>
  </div>
  <div class="line not-covered" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      filter = filter,</div>
  </div>
  <div class="line not-covered" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    files = filtered_files</div>
  </div>
  <div class="line not-covered" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Sort files for consistent execution order</div>
  </div>
  <div class="line not-covered" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.sort(files)</div>
  </div>
  <div class="line not-covered" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return files</div>
  </div>
  <div class="line not-covered" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Run tests in a directory or file list and aggregate results</div>
  </div>
  <div class="line not-executable" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param files_or_dir string|string[] Either a directory path or array of file paths</div>
  </div>
  <div class="line not-executable" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param firmo table The firmo module instance</div>
  </div>
  <div class="line not-executable" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param options table Options for running the tests</div>
  </div>
  <div class="line not-executable" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean Whether all tests passed</div>
  </div>
  <div class="line not-covered" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function runner.run_all(files_or_dir, firmo, options)</div>
  </div>
  <div class="line not-covered" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  options = options or {}</div>
  </div>
  <div class="line not-covered" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local files</div>
  </div>
  <div class="line not-executable" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If files_or_dir is a string, treat it as a directory</div>
  </div>
  <div class="line not-covered" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(files_or_dir) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    files = runner.find_test_files(files_or_dir, options)</div>
  </div>
  <div class="line not-covered" id="L478">
    <div class="line-number"><a href="#L478">478</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L479">
    <div class="line-number"><a href="#L479">479</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    files = files_or_dir</div>
  </div>
  <div class="line not-covered" id="L480">
    <div class="line-number"><a href="#L480">480</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L481">
    <div class="line-number"><a href="#L481">481</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L482">
    <div class="line-number"><a href="#L482">482</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Print debugging info if verbose</div>
  </div>
  <div class="line not-covered" id="L483">
    <div class="line-number"><a href="#L483">483</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.verbose then</div>
  </div>
  <div class="line not-covered" id="L484">
    <div class="line-number"><a href="#L484">484</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    print(string.format(&quot;\n%sRunning %d test files with structured result tracking%s\n&quot;, </div>
  </div>
  <div class="line not-covered" id="L485">
    <div class="line-number"><a href="#L485">485</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      cyan, #files, normal))</div>
  </div>
  <div class="line not-covered" id="L486">
    <div class="line-number"><a href="#L486">486</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L487">
    <div class="line-number"><a href="#L487">487</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Running test files&quot;, { count = #files })</div>
  </div>
  <div class="line not-covered" id="L488">
    <div class="line-number"><a href="#L488">488</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local passed_files = 0</div>
  </div>
  <div class="line not-covered" id="L489">
    <div class="line-number"><a href="#L489">489</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local failed_files = 0</div>
  </div>
  <div class="line not-covered" id="L490">
    <div class="line-number"><a href="#L490">490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local total_passes = 0</div>
  </div>
  <div class="line not-covered" id="L491">
    <div class="line-number"><a href="#L491">491</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local total_failures = 0</div>
  </div>
  <div class="line not-covered" id="L492">
    <div class="line-number"><a href="#L492">492</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local total_skipped = 0</div>
  </div>
  <div class="line not-covered" id="L493">
    <div class="line-number"><a href="#L493">493</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local start_time = os.clock()</div>
  </div>
  <div class="line not-executable" id="L494">
    <div class="line-number"><a href="#L494">494</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Collection to aggregate test results from all files</div>
  </div>
  <div class="line not-executable" id="L495">
    <div class="line-number"><a href="#L495">495</a></div>
    <div class="execution-count"></div>    <div class="line-content">  ---@type TestResult[]</div>
  </div>
  <div class="line not-covered" id="L496">
    <div class="line-number"><a href="#L496">496</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local all_test_results = {}</div>
  </div>
  <div class="line not-executable" id="L497">
    <div class="line-number"><a href="#L497">497</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize module reset if available</div>
  </div>
  <div class="line not-covered" id="L498">
    <div class="line-number"><a href="#L498">498</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if module_reset_loaded and module_reset then</div>
  </div>
  <div class="line not-covered" id="L499">
    <div class="line-number"><a href="#L499">499</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    module_reset.register_with_firmo(firmo)</div>
  </div>
  <div class="line not-executable" id="L500">
    <div class="line-number"><a href="#L500">500</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Configure isolation options</div>
  </div>
  <div class="line not-covered" id="L501">
    <div class="line-number"><a href="#L501">501</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    module_reset.configure({</div>
  </div>
  <div class="line not-covered" id="L502">
    <div class="line-number"><a href="#L502">502</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      reset_modules = true,</div>
  </div>
  <div class="line not-covered" id="L503">
    <div class="line-number"><a href="#L503">503</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      verbose = options.verbose == true,</div>
  </div>
  <div class="line not-covered" id="L504">
    <div class="line-number"><a href="#L504">504</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L505">
    <div class="line-number"><a href="#L505">505</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Module reset system activated&quot;, { feature = &quot;enhanced test isolation&quot; })</div>
  </div>
  <div class="line not-covered" id="L506">
    <div class="line-number"><a href="#L506">506</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L507">
    <div class="line-number"><a href="#L507">507</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Coverage should be already initialized in runner.main and passed in options.coverage_instance</div>
  </div>
  <div class="line not-executable" id="L508">
    <div class="line-number"><a href="#L508">508</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- We just need to log that we're using the pre-initialized coverage</div>
  </div>
  <div class="line not-covered" id="L509">
    <div class="line-number"><a href="#L509">509</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.coverage then</div>
  </div>
  <div class="line not-covered" id="L510">
    <div class="line-number"><a href="#L510">510</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if options.coverage_instance then</div>
  </div>
  <div class="line not-covered" id="L511">
    <div class="line-number"><a href="#L511">511</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.debug(&quot;Using pre-initialized coverage instance from main function&quot;, {</div>
  </div>
  <div class="line not-covered" id="L512">
    <div class="line-number"><a href="#L512">512</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;run_all&quot;,</div>
  </div>
  <div class="line not-covered" id="L513">
    <div class="line-number"><a href="#L513">513</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        coverage_instance_valid = options.coverage_instance ~= nil</div>
  </div>
  <div class="line not-covered" id="L514">
    <div class="line-number"><a href="#L514">514</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-executable" id="L515">
    <div class="line-number"><a href="#L515">515</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L516">
    <div class="line-number"><a href="#L516">516</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Ensure coverage instance is active</div>
  </div>
  <div class="line not-covered" id="L517">
    <div class="line-number"><a href="#L517">517</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if options.coverage_instance.is_active and not options.coverage_instance.is_active() then</div>
  </div>
  <div class="line not-covered" id="L518">
    <div class="line-number"><a href="#L518">518</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.warn(&quot;Coverage instance is not active, trying to start it&quot;, {</div>
  </div>
  <div class="line not-covered" id="L519">
    <div class="line-number"><a href="#L519">519</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          operation = &quot;run_all&quot;</div>
  </div>
  <div class="line not-covered" id="L520">
    <div class="line-number"><a href="#L520">520</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-executable" id="L521">
    <div class="line-number"><a href="#L521">521</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L522">
    <div class="line-number"><a href="#L522">522</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Try to start coverage if it's not active</div>
  </div>
  <div class="line not-covered" id="L523">
    <div class="line-number"><a href="#L523">523</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local ok, err = pcall(function()</div>
  </div>
  <div class="line not-covered" id="L524">
    <div class="line-number"><a href="#L524">524</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          options.coverage_instance.start()</div>
  </div>
  <div class="line not-covered" id="L525">
    <div class="line-number"><a href="#L525">525</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end)</div>
  </div>
  <div class="line not-executable" id="L526">
    <div class="line-number"><a href="#L526">526</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L527">
    <div class="line-number"><a href="#L527">527</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not ok then</div>
  </div>
  <div class="line not-covered" id="L528">
    <div class="line-number"><a href="#L528">528</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          logger.error(&quot;Failed to start coverage in run_all&quot;, {</div>
  </div>
  <div class="line not-covered" id="L529">
    <div class="line-number"><a href="#L529">529</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error = error_handler.format_error(err),</div>
  </div>
  <div class="line not-covered" id="L530">
    <div class="line-number"><a href="#L530">530</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            operation = &quot;run_all.start_coverage&quot;</div>
  </div>
  <div class="line not-covered" id="L531">
    <div class="line-number"><a href="#L531">531</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L532">
    <div class="line-number"><a href="#L532">532</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L533">
    <div class="line-number"><a href="#L533">533</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L534">
    <div class="line-number"><a href="#L534">534</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L535">
    <div class="line-number"><a href="#L535">535</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.warn(&quot;Coverage enabled but no coverage instance was passed&quot;, {</div>
  </div>
  <div class="line not-covered" id="L536">
    <div class="line-number"><a href="#L536">536</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;run_all&quot;,</div>
  </div>
  <div class="line not-covered" id="L537">
    <div class="line-number"><a href="#L537">537</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        solution = &quot;Coverage instance should be initialized in main and passed in options&quot;</div>
  </div>
  <div class="line not-covered" id="L538">
    <div class="line-number"><a href="#L538">538</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L539">
    <div class="line-number"><a href="#L539">539</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L540">
    <div class="line-number"><a href="#L540">540</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L541">
    <div class="line-number"><a href="#L541">541</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Coverage not enabled in options&quot;, { coverage_option = options.coverage })</div>
  </div>
  <div class="line not-covered" id="L542">
    <div class="line-number"><a href="#L542">542</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L543">
    <div class="line-number"><a href="#L543">543</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try to load quality module</div>
  </div>
  <div class="line not-covered" id="L544">
    <div class="line-number"><a href="#L544">544</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local quality_loaded, quality</div>
  </div>
  <div class="line not-covered" id="L545">
    <div class="line-number"><a href="#L545">545</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.quality then</div>
  </div>
  <div class="line not-covered" id="L546">
    <div class="line-number"><a href="#L546">546</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    quality_loaded, quality = pcall(require, &quot;lib.quality&quot;)</div>
  </div>
  <div class="line not-covered" id="L547">
    <div class="line-number"><a href="#L547">547</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if quality_loaded then</div>
  </div>
  <div class="line not-covered" id="L548">
    <div class="line-number"><a href="#L548">548</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;Quality module loaded&quot;, { purpose = &quot;test quality analysis&quot; })</div>
  </div>
  <div class="line not-executable" id="L549">
    <div class="line-number"><a href="#L549">549</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Configure quality validation</div>
  </div>
  <div class="line not-covered" id="L550">
    <div class="line-number"><a href="#L550">550</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      quality.init({</div>
  </div>
  <div class="line not-covered" id="L551">
    <div class="line-number"><a href="#L551">551</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        enabled = true,</div>
  </div>
  <div class="line not-covered" id="L552">
    <div class="line-number"><a href="#L552">552</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        level = options.quality_level or 3,</div>
  </div>
  <div class="line not-covered" id="L553">
    <div class="line-number"><a href="#L553">553</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        debug = options.verbose == true,</div>
  </div>
  <div class="line not-covered" id="L554">
    <div class="line-number"><a href="#L554">554</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        threshold = options.threshold or 80,</div>
  </div>
  <div class="line not-covered" id="L555">
    <div class="line-number"><a href="#L555">555</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L556">
    <div class="line-number"><a href="#L556">556</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L557">
    <div class="line-number"><a href="#L557">557</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Failed to load quality module&quot;, {</div>
  </div>
  <div class="line not-covered" id="L558">
    <div class="line-number"><a href="#L558">558</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = error_handler.format_error(quality),</div>
  </div>
  <div class="line not-covered" id="L559">
    <div class="line-number"><a href="#L559">559</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L560">
    <div class="line-number"><a href="#L560">560</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L561">
    <div class="line-number"><a href="#L561">561</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L562">
    <div class="line-number"><a href="#L562">562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, file in ipairs(files) do</div>
  </div>
  <div class="line not-executable" id="L563">
    <div class="line-number"><a href="#L563">563</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- IMPORTANT: Reset the test counts for each file to correctly capture them</div>
  </div>
  <div class="line not-covered" id="L564">
    <div class="line-number"><a href="#L564">564</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local results = runner.run_file(file, firmo, options)</div>
  </div>
  <div class="line not-executable" id="L565">
    <div class="line-number"><a href="#L565">565</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Count passed/failed files</div>
  </div>
  <div class="line not-executable" id="L566">
    <div class="line-number"><a href="#L566">566</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- CRITICAL FIX: Consider a file failed if:</div>
  </div>
  <div class="line not-executable" id="L567">
    <div class="line-number"><a href="#L567">567</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- 1. There was an execution error (results.success is false), OR</div>
  </div>
  <div class="line not-executable" id="L568">
    <div class="line-number"><a href="#L568">568</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- 2. There were test failures (results.errors &gt; 0)</div>
  </div>
  <div class="line not-covered" id="L569">
    <div class="line-number"><a href="#L569">569</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if results.success and results.errors == 0 then</div>
  </div>
  <div class="line not-covered" id="L570">
    <div class="line-number"><a href="#L570">570</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      passed_files = passed_files + 1</div>
  </div>
  <div class="line not-covered" id="L571">
    <div class="line-number"><a href="#L571">571</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L572">
    <div class="line-number"><a href="#L572">572</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      failed_files = failed_files + 1</div>
  </div>
  <div class="line not-executable" id="L573">
    <div class="line-number"><a href="#L573">573</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Log failure reason for debugging</div>
  </div>
  <div class="line not-covered" id="L574">
    <div class="line-number"><a href="#L574">574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.debug(&quot;File marked as failed&quot;, {</div>
  </div>
  <div class="line not-covered" id="L575">
    <div class="line-number"><a href="#L575">575</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file = file,</div>
  </div>
  <div class="line not-covered" id="L576">
    <div class="line-number"><a href="#L576">576</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        execution_success = results.success,</div>
  </div>
  <div class="line not-covered" id="L577">
    <div class="line-number"><a href="#L577">577</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_errors = results.errors,</div>
  </div>
  <div class="line not-covered" id="L578">
    <div class="line-number"><a href="#L578">578</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        reason = not results.success and &quot;Execution error&quot; or &quot;Test failures&quot;</div>
  </div>
  <div class="line not-covered" id="L579">
    <div class="line-number"><a href="#L579">579</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L580">
    <div class="line-number"><a href="#L580">580</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L581">
    <div class="line-number"><a href="#L581">581</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L582">
    <div class="line-number"><a href="#L582">582</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Get the actual test counts from the results</div>
  </div>
  <div class="line not-covered" id="L583">
    <div class="line-number"><a href="#L583">583</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local file_passes = results.passes</div>
  </div>
  <div class="line not-covered" id="L584">
    <div class="line-number"><a href="#L584">584</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local file_errors = results.errors</div>
  </div>
  <div class="line not-covered" id="L585">
    <div class="line-number"><a href="#L585">585</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local file_skipped = results.skipped or 0</div>
  </div>
  <div class="line not-executable" id="L586">
    <div class="line-number"><a href="#L586">586</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L587">
    <div class="line-number"><a href="#L587">587</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If we're getting zero counts back but the test ran successfully, </div>
  </div>
  <div class="line not-executable" id="L588">
    <div class="line-number"><a href="#L588">588</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- try to extract counts from the firmo state</div>
  </div>
  <div class="line not-covered" id="L589">
    <div class="line-number"><a href="#L589">589</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if file_passes == 0 and file_errors == 0 and results.success then</div>
  </div>
  <div class="line not-executable" id="L590">
    <div class="line-number"><a href="#L590">590</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Try to get test definition state if available</div>
  </div>
  <div class="line not-covered" id="L591">
    <div class="line-number"><a href="#L591">591</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local test_definition = require(&quot;lib.core.test_definition&quot;)</div>
  </div>
  <div class="line not-covered" id="L592">
    <div class="line-number"><a href="#L592">592</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if test_definition and test_definition.get_state then</div>
  </div>
  <div class="line not-covered" id="L593">
    <div class="line-number"><a href="#L593">593</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local state = test_definition.get_state()</div>
  </div>
  <div class="line not-covered" id="L594">
    <div class="line-number"><a href="#L594">594</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_passes = state.passes or 0</div>
  </div>
  <div class="line not-covered" id="L595">
    <div class="line-number"><a href="#L595">595</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_errors = state.errors or 0</div>
  </div>
  <div class="line not-covered" id="L596">
    <div class="line-number"><a href="#L596">596</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_skipped = state.skipped or 0</div>
  </div>
  <div class="line not-executable" id="L597">
    <div class="line-number"><a href="#L597">597</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L598">
    <div class="line-number"><a href="#L598">598</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Log that we're using state directly for debugging</div>
  </div>
  <div class="line not-covered" id="L599">
    <div class="line-number"><a href="#L599">599</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.debug(&quot;Using test_definition state for counts&quot;, {</div>
  </div>
  <div class="line not-covered" id="L600">
    <div class="line-number"><a href="#L600">600</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          file = file,</div>
  </div>
  <div class="line not-covered" id="L601">
    <div class="line-number"><a href="#L601">601</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          state_passes = file_passes,</div>
  </div>
  <div class="line not-covered" id="L602">
    <div class="line-number"><a href="#L602">602</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          state_errors = file_errors,</div>
  </div>
  <div class="line not-covered" id="L603">
    <div class="line-number"><a href="#L603">603</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          state_skipped = file_skipped</div>
  </div>
  <div class="line not-covered" id="L604">
    <div class="line-number"><a href="#L604">604</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L605">
    <div class="line-number"><a href="#L605">605</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L606">
    <div class="line-number"><a href="#L606">606</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L607">
    <div class="line-number"><a href="#L607">607</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Collect all structured test results from this file</div>
  </div>
  <div class="line not-covered" id="L608">
    <div class="line-number"><a href="#L608">608</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if results.test_results and #results.test_results &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L609">
    <div class="line-number"><a href="#L609">609</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if options.verbose then</div>
  </div>
  <div class="line not-covered" id="L610">
    <div class="line-number"><a href="#L610">610</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;\n%sCollecting %d structured test results from %s%s&quot;, </div>
  </div>
  <div class="line not-covered" id="L611">
    <div class="line-number"><a href="#L611">611</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          cyan, #results.test_results, file, normal))</div>
  </div>
  <div class="line not-covered" id="L612">
    <div class="line-number"><a href="#L612">612</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L613">
    <div class="line-number"><a href="#L613">613</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L614">
    <div class="line-number"><a href="#L614">614</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, result in ipairs(results.test_results) do</div>
  </div>
  <div class="line not-executable" id="L615">
    <div class="line-number"><a href="#L615">615</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Add the file path to each result for easier tracking</div>
  </div>
  <div class="line not-covered" id="L616">
    <div class="line-number"><a href="#L616">616</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result.file_path = file</div>
  </div>
  <div class="line not-covered" id="L617">
    <div class="line-number"><a href="#L617">617</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(all_test_results, result)</div>
  </div>
  <div class="line not-executable" id="L618">
    <div class="line-number"><a href="#L618">618</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L619">
    <div class="line-number"><a href="#L619">619</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if options.verbose then</div>
  </div>
  <div class="line not-covered" id="L620">
    <div class="line-number"><a href="#L620">620</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          print(string.format(&quot;  - Added result: %s [%s]&quot;, </div>
  </div>
  <div class="line not-covered" id="L621">
    <div class="line-number"><a href="#L621">621</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            result.name, result.status:upper()))</div>
  </div>
  <div class="line not-covered" id="L622">
    <div class="line-number"><a href="#L622">622</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L623">
    <div class="line-number"><a href="#L623">623</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L624">
    <div class="line-number"><a href="#L624">624</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L625">
    <div class="line-number"><a href="#L625">625</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.debug(&quot;Collected structured test results&quot;, {</div>
  </div>
  <div class="line not-covered" id="L626">
    <div class="line-number"><a href="#L626">626</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file = file,</div>
  </div>
  <div class="line not-covered" id="L627">
    <div class="line-number"><a href="#L627">627</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result_count = #results.test_results,</div>
  </div>
  <div class="line not-covered" id="L628">
    <div class="line-number"><a href="#L628">628</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        total_collected = #all_test_results</div>
  </div>
  <div class="line not-covered" id="L629">
    <div class="line-number"><a href="#L629">629</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L630">
    <div class="line-number"><a href="#L630">630</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L631">
    <div class="line-number"><a href="#L631">631</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if options.verbose then</div>
  </div>
  <div class="line not-covered" id="L632">
    <div class="line-number"><a href="#L632">632</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;\n%sNo structured test results found in %s%s&quot;, </div>
  </div>
  <div class="line not-covered" id="L633">
    <div class="line-number"><a href="#L633">633</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          red, file, normal))</div>
  </div>
  <div class="line not-covered" id="L634">
    <div class="line-number"><a href="#L634">634</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L635">
    <div class="line-number"><a href="#L635">635</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L636">
    <div class="line-number"><a href="#L636">636</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Count total tests</div>
  </div>
  <div class="line not-covered" id="L637">
    <div class="line-number"><a href="#L637">637</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    total_passes = total_passes + file_passes</div>
  </div>
  <div class="line not-covered" id="L638">
    <div class="line-number"><a href="#L638">638</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    total_failures = total_failures + file_errors</div>
  </div>
  <div class="line not-covered" id="L639">
    <div class="line-number"><a href="#L639">639</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    total_skipped = total_skipped + file_skipped</div>
  </div>
  <div class="line not-executable" id="L640">
    <div class="line-number"><a href="#L640">640</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L641">
    <div class="line-number"><a href="#L641">641</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Log collected counts after each file</div>
  </div>
  <div class="line not-covered" id="L642">
    <div class="line-number"><a href="#L642">642</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Accumulated test counts&quot;, {</div>
  </div>
  <div class="line not-covered" id="L643">
    <div class="line-number"><a href="#L643">643</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      current_file = file,</div>
  </div>
  <div class="line not-covered" id="L644">
    <div class="line-number"><a href="#L644">644</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_passes = file_passes,</div>
  </div>
  <div class="line not-covered" id="L645">
    <div class="line-number"><a href="#L645">645</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_failures = file_errors,</div>
  </div>
  <div class="line not-covered" id="L646">
    <div class="line-number"><a href="#L646">646</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_skipped = file_skipped,</div>
  </div>
  <div class="line not-covered" id="L647">
    <div class="line-number"><a href="#L647">647</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      running_total_passes = total_passes,</div>
  </div>
  <div class="line not-covered" id="L648">
    <div class="line-number"><a href="#L648">648</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      running_total_failures = total_failures,</div>
  </div>
  <div class="line not-covered" id="L649">
    <div class="line-number"><a href="#L649">649</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      running_total_skipped = total_skipped</div>
  </div>
  <div class="line not-covered" id="L650">
    <div class="line-number"><a href="#L650">650</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L651">
    <div class="line-number"><a href="#L651">651</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L652">
    <div class="line-number"><a href="#L652">652</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Print out the structured test results from this file for debugging</div>
  </div>
  <div class="line not-covered" id="L653">
    <div class="line-number"><a href="#L653">653</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if options.verbose and results.test_results and #results.test_results &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L654">
    <div class="line-number"><a href="#L654">654</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;\nStructured test results from &quot; .. file .. &quot;:&quot;)</div>
  </div>
  <div class="line not-covered" id="L655">
    <div class="line-number"><a href="#L655">655</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for i, result in ipairs(results.test_results) do</div>
  </div>
  <div class="line not-covered" id="L656">
    <div class="line-number"><a href="#L656">656</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local status_color = &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L657">
    <div class="line-number"><a href="#L657">657</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if result.status == &quot;pass&quot; then </div>
  </div>
  <div class="line not-covered" id="L658">
    <div class="line-number"><a href="#L658">658</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          status_color = green</div>
  </div>
  <div class="line not-covered" id="L659">
    <div class="line-number"><a href="#L659">659</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif result.status == &quot;fail&quot; then</div>
  </div>
  <div class="line not-covered" id="L660">
    <div class="line-number"><a href="#L660">660</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          status_color = red</div>
  </div>
  <div class="line not-covered" id="L661">
    <div class="line-number"><a href="#L661">661</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L662">
    <div class="line-number"><a href="#L662">662</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          status_color = yellow</div>
  </div>
  <div class="line not-covered" id="L663">
    <div class="line-number"><a href="#L663">663</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L664">
    <div class="line-number"><a href="#L664">664</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L665">
    <div class="line-number"><a href="#L665">665</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;  %d. %s[%s]%s %s (%s)&quot;, </div>
  </div>
  <div class="line not-covered" id="L666">
    <div class="line-number"><a href="#L666">666</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          i,</div>
  </div>
  <div class="line not-covered" id="L667">
    <div class="line-number"><a href="#L667">667</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          status_color,</div>
  </div>
  <div class="line not-covered" id="L668">
    <div class="line-number"><a href="#L668">668</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          result.status:upper(),</div>
  </div>
  <div class="line not-covered" id="L669">
    <div class="line-number"><a href="#L669">669</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          normal,</div>
  </div>
  <div class="line not-covered" id="L670">
    <div class="line-number"><a href="#L670">670</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          result.name,</div>
  </div>
  <div class="line not-covered" id="L671">
    <div class="line-number"><a href="#L671">671</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          result.path_string or &quot;&quot;))</div>
  </div>
  <div class="line not-executable" id="L672">
    <div class="line-number"><a href="#L672">672</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L673">
    <div class="line-number"><a href="#L673">673</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if result.expect_error then</div>
  </div>
  <div class="line not-covered" id="L674">
    <div class="line-number"><a href="#L674">674</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          print(string.format(&quot;     Expected error: %s&quot;, tostring(result.error or &quot;&quot;)))</div>
  </div>
  <div class="line not-covered" id="L675">
    <div class="line-number"><a href="#L675">675</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L676">
    <div class="line-number"><a href="#L676">676</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L677">
    <div class="line-number"><a href="#L677">677</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if result.execution_time then</div>
  </div>
  <div class="line not-covered" id="L678">
    <div class="line-number"><a href="#L678">678</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          print(string.format(&quot;     Time: %.4f seconds&quot;, result.execution_time))</div>
  </div>
  <div class="line not-covered" id="L679">
    <div class="line-number"><a href="#L679">679</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L680">
    <div class="line-number"><a href="#L680">680</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L681">
    <div class="line-number"><a href="#L681">681</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;&quot;)</div>
  </div>
  <div class="line not-covered" id="L682">
    <div class="line-number"><a href="#L682">682</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L683">
    <div class="line-number"><a href="#L683">683</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L684">
    <div class="line-number"><a href="#L684">684</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local elapsed_time = os.clock() - start_time</div>
  </div>
  <div class="line not-executable" id="L685">
    <div class="line-number"><a href="#L685">685</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Show collected test results in verbose mode</div>
  </div>
  <div class="line not-covered" id="L686">
    <div class="line-number"><a href="#L686">686</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.verbose and #all_test_results &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L687">
    <div class="line-number"><a href="#L687">687</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    print(string.format(&quot;\n%sAll collected test results: %d%s&quot;, cyan, #all_test_results, normal))</div>
  </div>
  <div class="line not-covered" id="L688">
    <div class="line-number"><a href="#L688">688</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i, result in ipairs(all_test_results) do</div>
  </div>
  <div class="line not-covered" id="L689">
    <div class="line-number"><a href="#L689">689</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if i &lt;= 10 then -- Only show first 10 to avoid flooding the output</div>
  </div>
  <div class="line not-covered" id="L690">
    <div class="line-number"><a href="#L690">690</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local status_color = &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L691">
    <div class="line-number"><a href="#L691">691</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if result.status == &quot;pass&quot; then </div>
  </div>
  <div class="line not-covered" id="L692">
    <div class="line-number"><a href="#L692">692</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          status_color = green</div>
  </div>
  <div class="line not-covered" id="L693">
    <div class="line-number"><a href="#L693">693</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif result.status == &quot;fail&quot; then</div>
  </div>
  <div class="line not-covered" id="L694">
    <div class="line-number"><a href="#L694">694</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          status_color = red</div>
  </div>
  <div class="line not-covered" id="L695">
    <div class="line-number"><a href="#L695">695</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L696">
    <div class="line-number"><a href="#L696">696</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          status_color = yellow</div>
  </div>
  <div class="line not-covered" id="L697">
    <div class="line-number"><a href="#L697">697</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L698">
    <div class="line-number"><a href="#L698">698</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L699">
    <div class="line-number"><a href="#L699">699</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(string.format(&quot;  %d. %s[%s]%s %s (%s)&quot;, </div>
  </div>
  <div class="line not-covered" id="L700">
    <div class="line-number"><a href="#L700">700</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          i,</div>
  </div>
  <div class="line not-covered" id="L701">
    <div class="line-number"><a href="#L701">701</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          status_color,</div>
  </div>
  <div class="line not-covered" id="L702">
    <div class="line-number"><a href="#L702">702</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          result.status:upper(),</div>
  </div>
  <div class="line not-covered" id="L703">
    <div class="line-number"><a href="#L703">703</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          normal,</div>
  </div>
  <div class="line not-covered" id="L704">
    <div class="line-number"><a href="#L704">704</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          result.name,</div>
  </div>
  <div class="line not-covered" id="L705">
    <div class="line-number"><a href="#L705">705</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          result.file_path or &quot;&quot;))</div>
  </div>
  <div class="line not-covered" id="L706">
    <div class="line-number"><a href="#L706">706</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L707">
    <div class="line-number"><a href="#L707">707</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L708">
    <div class="line-number"><a href="#L708">708</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L709">
    <div class="line-number"><a href="#L709">709</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if #all_test_results &gt; 10 then</div>
  </div>
  <div class="line not-covered" id="L710">
    <div class="line-number"><a href="#L710">710</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(string.format(&quot;  ... and %d more&quot;, #all_test_results - 10))</div>
  </div>
  <div class="line not-covered" id="L711">
    <div class="line-number"><a href="#L711">711</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L712">
    <div class="line-number"><a href="#L712">712</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    print(&quot;&quot;)</div>
  </div>
  <div class="line not-covered" id="L713">
    <div class="line-number"><a href="#L713">713</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L714">
    <div class="line-number"><a href="#L714">714</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- In the summary, use consistent terminology:</div>
  </div>
  <div class="line not-executable" id="L715">
    <div class="line-number"><a href="#L715">715</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- - passes/failures =&gt; individual test cases passed/failed</div>
  </div>
  <div class="line not-executable" id="L716">
    <div class="line-number"><a href="#L716">716</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- - files_passed/files_failed =&gt; test files that passed/failed</div>
  </div>
  <div class="line not-covered" id="L717">
    <div class="line-number"><a href="#L717">717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Test run summary&quot;, {</div>
  </div>
  <div class="line not-covered" id="L718">
    <div class="line-number"><a href="#L718">718</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    files_passed = passed_files,</div>
  </div>
  <div class="line not-covered" id="L719">
    <div class="line-number"><a href="#L719">719</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    files_failed = failed_files,</div>
  </div>
  <div class="line not-covered" id="L720">
    <div class="line-number"><a href="#L720">720</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    tests_passed = total_passes, -- Same as 'passes' </div>
  </div>
  <div class="line not-covered" id="L721">
    <div class="line-number"><a href="#L721">721</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    tests_failed = total_failures, -- Same as 'failures'</div>
  </div>
  <div class="line not-covered" id="L722">
    <div class="line-number"><a href="#L722">722</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    tests_skipped = total_skipped,</div>
  </div>
  <div class="line not-covered" id="L723">
    <div class="line-number"><a href="#L723">723</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    passes = total_passes, -- Add these for consistency</div>
  </div>
  <div class="line not-covered" id="L724">
    <div class="line-number"><a href="#L724">724</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    failures = total_failures, -- Add these for consistency </div>
  </div>
  <div class="line not-covered" id="L725">
    <div class="line-number"><a href="#L725">725</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elapsed_time_seconds = string.format(&quot;%.2f&quot;, elapsed_time),</div>
  </div>
  <div class="line not-covered" id="L726">
    <div class="line-number"><a href="#L726">726</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    structured_results_count = #all_test_results</div>
  </div>
  <div class="line not-covered" id="L727">
    <div class="line-number"><a href="#L727">727</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L728">
    <div class="line-number"><a href="#L728">728</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Calculate statistics on test execution time if available</div>
  </div>
  <div class="line not-covered" id="L729">
    <div class="line-number"><a href="#L729">729</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local timing_stats = {}</div>
  </div>
  <div class="line not-covered" id="L730">
    <div class="line-number"><a href="#L730">730</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if #all_test_results &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L731">
    <div class="line-number"><a href="#L731">731</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local slowest_tests = {}</div>
  </div>
  <div class="line not-covered" id="L732">
    <div class="line-number"><a href="#L732">732</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local total_execution_time = 0</div>
  </div>
  <div class="line not-covered" id="L733">
    <div class="line-number"><a href="#L733">733</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local count_with_execution_time = 0</div>
  </div>
  <div class="line not-executable" id="L734">
    <div class="line-number"><a href="#L734">734</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L735">
    <div class="line-number"><a href="#L735">735</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, result in ipairs(all_test_results) do</div>
  </div>
  <div class="line not-covered" id="L736">
    <div class="line-number"><a href="#L736">736</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if result.execution_time then</div>
  </div>
  <div class="line not-covered" id="L737">
    <div class="line-number"><a href="#L737">737</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        total_execution_time = total_execution_time + result.execution_time</div>
  </div>
  <div class="line not-covered" id="L738">
    <div class="line-number"><a href="#L738">738</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        count_with_execution_time = count_with_execution_time + 1</div>
  </div>
  <div class="line not-executable" id="L739">
    <div class="line-number"><a href="#L739">739</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L740">
    <div class="line-number"><a href="#L740">740</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Track slowest tests</div>
  </div>
  <div class="line not-covered" id="L741">
    <div class="line-number"><a href="#L741">741</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if #slowest_tests &lt; 5 then</div>
  </div>
  <div class="line not-covered" id="L742">
    <div class="line-number"><a href="#L742">742</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          table.insert(slowest_tests, result)</div>
  </div>
  <div class="line not-executable" id="L743">
    <div class="line-number"><a href="#L743">743</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Sort by execution time (descending)</div>
  </div>
  <div class="line not-covered" id="L744">
    <div class="line-number"><a href="#L744">744</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          table.sort(slowest_tests, function(a, b) </div>
  </div>
  <div class="line not-covered" id="L745">
    <div class="line-number"><a href="#L745">745</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return (a.execution_time or 0) &gt; (b.execution_time or 0) </div>
  </div>
  <div class="line not-covered" id="L746">
    <div class="line-number"><a href="#L746">746</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end)</div>
  </div>
  <div class="line not-covered" id="L747">
    <div class="line-number"><a href="#L747">747</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif result.execution_time &gt; (slowest_tests[5].execution_time or 0) then</div>
  </div>
  <div class="line not-executable" id="L748">
    <div class="line-number"><a href="#L748">748</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Replace the fastest of our 5 slowest</div>
  </div>
  <div class="line not-covered" id="L749">
    <div class="line-number"><a href="#L749">749</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          slowest_tests[5] = result</div>
  </div>
  <div class="line not-executable" id="L750">
    <div class="line-number"><a href="#L750">750</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Resort</div>
  </div>
  <div class="line not-covered" id="L751">
    <div class="line-number"><a href="#L751">751</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          table.sort(slowest_tests, function(a, b) </div>
  </div>
  <div class="line not-covered" id="L752">
    <div class="line-number"><a href="#L752">752</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return (a.execution_time or 0) &gt; (b.execution_time or 0) </div>
  </div>
  <div class="line not-covered" id="L753">
    <div class="line-number"><a href="#L753">753</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end)</div>
  </div>
  <div class="line not-covered" id="L754">
    <div class="line-number"><a href="#L754">754</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L755">
    <div class="line-number"><a href="#L755">755</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L756">
    <div class="line-number"><a href="#L756">756</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L757">
    <div class="line-number"><a href="#L757">757</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L758">
    <div class="line-number"><a href="#L758">758</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Calculate average execution time</div>
  </div>
  <div class="line not-covered" id="L759">
    <div class="line-number"><a href="#L759">759</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if count_with_execution_time &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L760">
    <div class="line-number"><a href="#L760">760</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      timing_stats = {</div>
  </div>
  <div class="line not-covered" id="L761">
    <div class="line-number"><a href="#L761">761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        total_test_execution_time = total_execution_time,</div>
  </div>
  <div class="line not-covered" id="L762">
    <div class="line-number"><a href="#L762">762</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        average_test_execution_time = total_execution_time / count_with_execution_time,</div>
  </div>
  <div class="line not-covered" id="L763">
    <div class="line-number"><a href="#L763">763</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        tests_with_timing = count_with_execution_time,</div>
  </div>
  <div class="line not-covered" id="L764">
    <div class="line-number"><a href="#L764">764</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        slowest_tests = {}</div>
  </div>
  <div class="line not-covered" id="L765">
    <div class="line-number"><a href="#L765">765</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-executable" id="L766">
    <div class="line-number"><a href="#L766">766</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L767">
    <div class="line-number"><a href="#L767">767</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Add info about slowest tests</div>
  </div>
  <div class="line not-covered" id="L768">
    <div class="line-number"><a href="#L768">768</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for i, slow_test in ipairs(slowest_tests) do</div>
  </div>
  <div class="line not-covered" id="L769">
    <div class="line-number"><a href="#L769">769</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(timing_stats.slowest_tests, {</div>
  </div>
  <div class="line not-covered" id="L770">
    <div class="line-number"><a href="#L770">770</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          name = slow_test.name,</div>
  </div>
  <div class="line not-covered" id="L771">
    <div class="line-number"><a href="#L771">771</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          path = slow_test.path_string,</div>
  </div>
  <div class="line not-covered" id="L772">
    <div class="line-number"><a href="#L772">772</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          execution_time = slow_test.execution_time,</div>
  </div>
  <div class="line not-covered" id="L773">
    <div class="line-number"><a href="#L773">773</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          file = slow_test.file_path</div>
  </div>
  <div class="line not-covered" id="L774">
    <div class="line-number"><a href="#L774">774</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L775">
    <div class="line-number"><a href="#L775">775</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L776">
    <div class="line-number"><a href="#L776">776</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L777">
    <div class="line-number"><a href="#L777">777</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Log timing stats at debug level</div>
  </div>
  <div class="line not-covered" id="L778">
    <div class="line-number"><a href="#L778">778</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.debug(&quot;Test timing statistics&quot;, timing_stats)</div>
  </div>
  <div class="line not-covered" id="L779">
    <div class="line-number"><a href="#L779">779</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L780">
    <div class="line-number"><a href="#L780">780</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L781">
    <div class="line-number"><a href="#L781">781</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local all_passed = failed_files == 0</div>
  </div>
  <div class="line not-covered" id="L782">
    <div class="line-number"><a href="#L782">782</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not all_passed then</div>
  </div>
  <div class="line not-covered" id="L783">
    <div class="line-number"><a href="#L783">783</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;Test run failed&quot;, { </div>
  </div>
  <div class="line not-covered" id="L784">
    <div class="line-number"><a href="#L784">784</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      failed_files = failed_files,</div>
  </div>
  <div class="line not-covered" id="L785">
    <div class="line-number"><a href="#L785">785</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      failed_tests = total_failures</div>
  </div>
  <div class="line not-covered" id="L786">
    <div class="line-number"><a href="#L786">786</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L787">
    <div class="line-number"><a href="#L787">787</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L788">
    <div class="line-number"><a href="#L788">788</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Show detailed failure information</div>
  </div>
  <div class="line not-covered" id="L789">
    <div class="line-number"><a href="#L789">789</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if #all_test_results &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L790">
    <div class="line-number"><a href="#L790">790</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local failed_tests = {}</div>
  </div>
  <div class="line not-covered" id="L791">
    <div class="line-number"><a href="#L791">791</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, result in ipairs(all_test_results) do</div>
  </div>
  <div class="line not-covered" id="L792">
    <div class="line-number"><a href="#L792">792</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if result.status == &quot;fail&quot; then</div>
  </div>
  <div class="line not-covered" id="L793">
    <div class="line-number"><a href="#L793">793</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          table.insert(failed_tests, {</div>
  </div>
  <div class="line not-covered" id="L794">
    <div class="line-number"><a href="#L794">794</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            name = result.name,</div>
  </div>
  <div class="line not-covered" id="L795">
    <div class="line-number"><a href="#L795">795</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            path = result.path_string,</div>
  </div>
  <div class="line not-covered" id="L796">
    <div class="line-number"><a href="#L796">796</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            file = result.file_path,</div>
  </div>
  <div class="line not-covered" id="L797">
    <div class="line-number"><a href="#L797">797</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error_message = result.error_message</div>
  </div>
  <div class="line not-covered" id="L798">
    <div class="line-number"><a href="#L798">798</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L799">
    <div class="line-number"><a href="#L799">799</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L800">
    <div class="line-number"><a href="#L800">800</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L801">
    <div class="line-number"><a href="#L801">801</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L802">
    <div class="line-number"><a href="#L802">802</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if #failed_tests &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L803">
    <div class="line-number"><a href="#L803">803</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.debug(&quot;Failed tests&quot;, { failed_tests = failed_tests })</div>
  </div>
  <div class="line not-covered" id="L804">
    <div class="line-number"><a href="#L804">804</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L805">
    <div class="line-number"><a href="#L805">805</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L806">
    <div class="line-number"><a href="#L806">806</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L807">
    <div class="line-number"><a href="#L807">807</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Test run successful&quot;, { </div>
  </div>
  <div class="line not-covered" id="L808">
    <div class="line-number"><a href="#L808">808</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      all_passed = true,</div>
  </div>
  <div class="line not-covered" id="L809">
    <div class="line-number"><a href="#L809">809</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      test_count = total_passes + total_skipped</div>
  </div>
  <div class="line not-covered" id="L810">
    <div class="line-number"><a href="#L810">810</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L811">
    <div class="line-number"><a href="#L811">811</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L812">
    <div class="line-number"><a href="#L812">812</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Generate coverage reports if enabled</div>
  </div>
  <div class="line not-executable" id="L813">
    <div class="line-number"><a href="#L813">813</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if we should generate coverage reports</div>
  </div>
  <div class="line not-covered" id="L814">
    <div class="line-number"><a href="#L814">814</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.debug(&quot;Checking coverage conditions:&quot;, {</div>
  </div>
  <div class="line not-covered" id="L815">
    <div class="line-number"><a href="#L815">815</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage_loaded = coverage_loaded,</div>
  </div>
  <div class="line not-covered" id="L816">
    <div class="line-number"><a href="#L816">816</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    has_coverage_object = coverage ~= nil,</div>
  </div>
  <div class="line not-covered" id="L817">
    <div class="line-number"><a href="#L817">817</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage_option_set = options.coverage</div>
  </div>
  <div class="line not-covered" id="L818">
    <div class="line-number"><a href="#L818">818</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L819">
    <div class="line-number"><a href="#L819">819</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L820">
    <div class="line-number"><a href="#L820">820</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if coverage_loaded and coverage and options.coverage then</div>
  </div>
  <div class="line not-covered" id="L821">
    <div class="line-number"><a href="#L821">821</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Coverage conditions met - will generate reports&quot;)</div>
  </div>
  <div class="line not-executable" id="L822">
    <div class="line-number"><a href="#L822">822</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L823">
    <div class="line-number"><a href="#L823">823</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Stop coverage tracking</div>
  </div>
  <div class="line not-covered" id="L824">
    <div class="line-number"><a href="#L824">824</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Stopping coverage tracking&quot;)</div>
  </div>
  <div class="line not-covered" id="L825">
    <div class="line-number"><a href="#L825">825</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if coverage.stop then</div>
  </div>
  <div class="line not-covered" id="L826">
    <div class="line-number"><a href="#L826">826</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      coverage.stop()</div>
  </div>
  <div class="line not-covered" id="L827">
    <div class="line-number"><a href="#L827">827</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;Coverage tracking stopped successfully&quot;)</div>
  </div>
  <div class="line not-covered" id="L828">
    <div class="line-number"><a href="#L828">828</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L829">
    <div class="line-number"><a href="#L829">829</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Function not found&quot;, { function_name = &quot;coverage.stop&quot; })</div>
  </div>
  <div class="line not-covered" id="L830">
    <div class="line-number"><a href="#L830">830</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L831">
    <div class="line-number"><a href="#L831">831</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Calculate and save coverage reports</div>
  </div>
  <div class="line not-covered" id="L832">
    <div class="line-number"><a href="#L832">832</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Generating coverage report&quot;)</div>
  </div>
  <div class="line not-executable" id="L833">
    <div class="line-number"><a href="#L833">833</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L834">
    <div class="line-number"><a href="#L834">834</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- get_report_data() handles stats computation internally</div>
  </div>
  <div class="line not-executable" id="L835">
    <div class="line-number"><a href="#L835">835</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Generate reports in different formats</div>
  </div>
  <div class="line not-covered" id="L836">
    <div class="line-number"><a href="#L836">836</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local report_dir = options.report_dir or &quot;./coverage-reports&quot;</div>
  </div>
  <div class="line not-covered" id="L837">
    <div class="line-number"><a href="#L837">837</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    fs.ensure_directory_exists(report_dir)</div>
  </div>
  <div class="line not-covered" id="L838">
    <div class="line-number"><a href="#L838">838</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local formats = { &quot;html&quot;, &quot;json&quot;, &quot;lcov&quot;, &quot;cobertura&quot; }</div>
  </div>
  <div class="line not-executable" id="L839">
    <div class="line-number"><a href="#L839">839</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try to load the reporting module</div>
  </div>
  <div class="line not-covered" id="L840">
    <div class="line-number"><a href="#L840">840</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local reporting_loaded, reporting</div>
  </div>
  <div class="line not-covered" id="L841">
    <div class="line-number"><a href="#L841">841</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    reporting_loaded, reporting = pcall(require, &quot;lib.reporting&quot;)</div>
  </div>
  <div class="line not-executable" id="L842">
    <div class="line-number"><a href="#L842">842</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L843">
    <div class="line-number"><a href="#L843">843</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not reporting_loaded then</div>
  </div>
  <div class="line not-covered" id="L844">
    <div class="line-number"><a href="#L844">844</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Failed to load reporting module&quot;, {</div>
  </div>
  <div class="line not-covered" id="L845">
    <div class="line-number"><a href="#L845">845</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = error_handler.format_error(reporting),</div>
  </div>
  <div class="line not-covered" id="L846">
    <div class="line-number"><a href="#L846">846</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L847">
    <div class="line-number"><a href="#L847">847</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L848">
    <div class="line-number"><a href="#L848">848</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Get coverage report data</div>
  </div>
  <div class="line not-covered" id="L849">
    <div class="line-number"><a href="#L849">849</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Getting coverage report data&quot;)</div>
  </div>
  <div class="line not-covered" id="L850">
    <div class="line-number"><a href="#L850">850</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local report_data = coverage.get_report_data()</div>
  </div>
  <div class="line not-executable" id="L851">
    <div class="line-number"><a href="#L851">851</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L852">
    <div class="line-number"><a href="#L852">852</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not report_data then</div>
  </div>
  <div class="line not-covered" id="L853">
    <div class="line-number"><a href="#L853">853</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Failed to get coverage report data&quot;)</div>
  </div>
  <div class="line not-covered" id="L854">
    <div class="line-number"><a href="#L854">854</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L855">
    <div class="line-number"><a href="#L855">855</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Get file count safely with manual counting</div>
  </div>
  <div class="line not-covered" id="L856">
    <div class="line-number"><a href="#L856">856</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local file_count = 0</div>
  </div>
  <div class="line not-covered" id="L857">
    <div class="line-number"><a href="#L857">857</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if report_data.files then</div>
  </div>
  <div class="line not-covered" id="L858">
    <div class="line-number"><a href="#L858">858</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _ in pairs(report_data.files) do</div>
  </div>
  <div class="line not-covered" id="L859">
    <div class="line-number"><a href="#L859">859</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          file_count = file_count + 1</div>
  </div>
  <div class="line not-covered" id="L860">
    <div class="line-number"><a href="#L860">860</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L861">
    <div class="line-number"><a href="#L861">861</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L862">
    <div class="line-number"><a href="#L862">862</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L863">
    <div class="line-number"><a href="#L863">863</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;Successfully got coverage report data&quot;, {</div>
  </div>
  <div class="line not-covered" id="L864">
    <div class="line-number"><a href="#L864">864</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        has_summary = report_data.summary ~= nil,</div>
  </div>
  <div class="line not-covered" id="L865">
    <div class="line-number"><a href="#L865">865</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        has_files = report_data.files ~= nil,</div>
  </div>
  <div class="line not-covered" id="L866">
    <div class="line-number"><a href="#L866">866</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        files_count = file_count</div>
  </div>
  <div class="line not-covered" id="L867">
    <div class="line-number"><a href="#L867">867</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-executable" id="L868">
    <div class="line-number"><a href="#L868">868</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L869">
    <div class="line-number"><a href="#L869">869</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if reporting_loaded and reporting then</div>
  </div>
  <div class="line not-covered" id="L870">
    <div class="line-number"><a href="#L870">870</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.info(&quot;Reporting module loaded, generating reports&quot;)</div>
  </div>
  <div class="line not-executable" id="L871">
    <div class="line-number"><a href="#L871">871</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L872">
    <div class="line-number"><a href="#L872">872</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Use reporting module to generate reports</div>
  </div>
  <div class="line not-covered" id="L873">
    <div class="line-number"><a href="#L873">873</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _, format in ipairs(formats) do</div>
  </div>
  <div class="line not-covered" id="L874">
    <div class="line-number"><a href="#L874">874</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local report_path = fs.join_paths(report_dir, &quot;coverage-report.&quot; .. format)</div>
  </div>
  <div class="line not-covered" id="L875">
    <div class="line-number"><a href="#L875">875</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          logger.info(&quot;Generating report&quot;, { format = format, path = report_path })</div>
  </div>
  <div class="line not-executable" id="L876">
    <div class="line-number"><a href="#L876">876</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-covered" id="L877">
    <div class="line-number"><a href="#L877">877</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local success, err = reporting.save_coverage_report(report_path, report_data, format)</div>
  </div>
  <div class="line not-covered" id="L878">
    <div class="line-number"><a href="#L878">878</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if success then</div>
  </div>
  <div class="line not-covered" id="L879">
    <div class="line-number"><a href="#L879">879</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            logger.info(&quot;Generated coverage report&quot;, { format = format, path = report_path })</div>
  </div>
  <div class="line not-covered" id="L880">
    <div class="line-number"><a href="#L880">880</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          else</div>
  </div>
  <div class="line not-covered" id="L881">
    <div class="line-number"><a href="#L881">881</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            logger.error(&quot;Failed to generate coverage report&quot;, { </div>
  </div>
  <div class="line not-covered" id="L882">
    <div class="line-number"><a href="#L882">882</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              format = format, </div>
  </div>
  <div class="line not-covered" id="L883">
    <div class="line-number"><a href="#L883">883</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              error = err and error_handler.format_error(err) or &quot;Unknown error&quot; </div>
  </div>
  <div class="line not-covered" id="L884">
    <div class="line-number"><a href="#L884">884</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L885">
    <div class="line-number"><a href="#L885">885</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L886">
    <div class="line-number"><a href="#L886">886</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L887">
    <div class="line-number"><a href="#L887">887</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L888">
    <div class="line-number"><a href="#L888">888</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.error(&quot;Reporting module not available for generating reports&quot;)</div>
  </div>
  <div class="line not-covered" id="L889">
    <div class="line-number"><a href="#L889">889</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L890">
    <div class="line-number"><a href="#L890">890</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L891">
    <div class="line-number"><a href="#L891">891</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Print coverage summary</div>
  </div>
  <div class="line not-covered" id="L892">
    <div class="line-number"><a href="#L892">892</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local summary = report_data and report_data.summary</div>
  </div>
  <div class="line not-covered" id="L893">
    <div class="line-number"><a href="#L893">893</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if summary then</div>
  </div>
  <div class="line not-executable" id="L894">
    <div class="line-number"><a href="#L894">894</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Print detailed coverage data for debugging</div>
  </div>
  <div class="line not-covered" id="L895">
    <div class="line-number"><a href="#L895">895</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if options.debug then</div>
  </div>
  <div class="line not-covered" id="L896">
    <div class="line-number"><a href="#L896">896</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;\nDEBUG: Coverage summary data:&quot;)</div>
  </div>
  <div class="line not-covered" id="L897">
    <div class="line-number"><a href="#L897">897</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;  Overall coverage: &quot; .. string.format(&quot;%.2f&quot;, summary.overall_coverage_percent or 0) .. &quot;%&quot;)</div>
  </div>
  <div class="line not-covered" id="L898">
    <div class="line-number"><a href="#L898">898</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;  Line coverage: &quot; .. string.format(&quot;%.2f&quot;, summary.line_coverage_percent or 0) .. &quot;%&quot;)</div>
  </div>
  <div class="line not-covered" id="L899">
    <div class="line-number"><a href="#L899">899</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;  Function coverage: &quot; .. string.format(&quot;%.2f&quot;, summary.function_coverage_percent or 0) .. &quot;%&quot;)</div>
  </div>
  <div class="line not-covered" id="L900">
    <div class="line-number"><a href="#L900">900</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;  File coverage: &quot; .. string.format(&quot;%.2f&quot;, summary.file_coverage_percent or 0) .. &quot;%&quot;)</div>
  </div>
  <div class="line not-executable" id="L901">
    <div class="line-number"><a href="#L901">901</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L902">
    <div class="line-number"><a href="#L902">902</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Print raw values for debugging</div>
  </div>
  <div class="line not-covered" id="L903">
    <div class="line-number"><a href="#L903">903</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;\nDEBUG: Raw coverage values:&quot;)</div>
  </div>
  <div class="line not-covered" id="L904">
    <div class="line-number"><a href="#L904">904</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;  Overall coverage (raw): &quot; .. tostring(summary.overall_coverage_percent))</div>
  </div>
  <div class="line not-covered" id="L905">
    <div class="line-number"><a href="#L905">905</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;  Line coverage (raw): &quot; .. tostring(summary.line_coverage_percent))</div>
  </div>
  <div class="line not-covered" id="L906">
    <div class="line-number"><a href="#L906">906</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;  Function coverage (raw): &quot; .. tostring(summary.function_coverage_percent))</div>
  </div>
  <div class="line not-covered" id="L907">
    <div class="line-number"><a href="#L907">907</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        print(&quot;  File coverage (raw): &quot; .. tostring(summary.file_coverage_percent))</div>
  </div>
  <div class="line not-covered" id="L908">
    <div class="line-number"><a href="#L908">908</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L909">
    <div class="line-number"><a href="#L909">909</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L910">
    <div class="line-number"><a href="#L910">910</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Use the numeric values for the logger to ensure proper display</div>
  </div>
  <div class="line not-executable" id="L911">
    <div class="line-number"><a href="#L911">911</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Convert percentages to strings with formatting to ensure consistent display</div>
  </div>
  <div class="line not-covered" id="L912">
    <div class="line-number"><a href="#L912">912</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;Coverage summary&quot;, {</div>
  </div>
  <div class="line not-covered" id="L913">
    <div class="line-number"><a href="#L913">913</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        overall = string.format(&quot;%.2f%%&quot;, summary.overall_coverage_percent or 0),</div>
  </div>
  <div class="line not-covered" id="L914">
    <div class="line-number"><a href="#L914">914</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        lines = string.format(&quot;%.2f%%&quot;, summary.line_coverage_percent or 0),</div>
  </div>
  <div class="line not-covered" id="L915">
    <div class="line-number"><a href="#L915">915</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        functions = string.format(&quot;%.2f%%&quot;, summary.function_coverage_percent or 0),</div>
  </div>
  <div class="line not-covered" id="L916">
    <div class="line-number"><a href="#L916">916</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        files = string.format(&quot;%.2f%%&quot;, summary.file_coverage_percent or 0),</div>
  </div>
  <div class="line not-covered" id="L917">
    <div class="line-number"><a href="#L917">917</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-executable" id="L918">
    <div class="line-number"><a href="#L918">918</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L919">
    <div class="line-number"><a href="#L919">919</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Debug: Print raw values</div>
  </div>
  <div class="line not-covered" id="L920">
    <div class="line-number"><a href="#L920">920</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.debug(&quot;Raw coverage percentage values:&quot;, {</div>
  </div>
  <div class="line not-covered" id="L921">
    <div class="line-number"><a href="#L921">921</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        overall_percent = summary.overall_coverage_percent,</div>
  </div>
  <div class="line not-covered" id="L922">
    <div class="line-number"><a href="#L922">922</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        line_percent = summary.line_coverage_percent,</div>
  </div>
  <div class="line not-covered" id="L923">
    <div class="line-number"><a href="#L923">923</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        function_percent = summary.function_coverage_percent,</div>
  </div>
  <div class="line not-covered" id="L924">
    <div class="line-number"><a href="#L924">924</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_percent = summary.file_coverage_percent</div>
  </div>
  <div class="line not-covered" id="L925">
    <div class="line-number"><a href="#L925">925</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L926">
    <div class="line-number"><a href="#L926">926</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L927">
    <div class="line-number"><a href="#L927">927</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Failed to get coverage summary from report data&quot;)</div>
  </div>
  <div class="line not-covered" id="L928">
    <div class="line-number"><a href="#L928">928</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L929">
    <div class="line-number"><a href="#L929">929</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L930">
    <div class="line-number"><a href="#L930">930</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Generate quality reports if enabled</div>
  </div>
  <div class="line not-covered" id="L931">
    <div class="line-number"><a href="#L931">931</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if quality_loaded and quality and options.quality then</div>
  </div>
  <div class="line not-covered" id="L932">
    <div class="line-number"><a href="#L932">932</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Generating quality report&quot;)</div>
  </div>
  <div class="line not-covered" id="L933">
    <div class="line-number"><a href="#L933">933</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    quality.calculate_stats()</div>
  </div>
  <div class="line not-executable" id="L934">
    <div class="line-number"><a href="#L934">934</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Generate quality reports in different formats</div>
  </div>
  <div class="line not-covered" id="L935">
    <div class="line-number"><a href="#L935">935</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local report_dir = options.report_dir or &quot;./coverage-reports&quot;</div>
  </div>
  <div class="line not-covered" id="L936">
    <div class="line-number"><a href="#L936">936</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    fs.ensure_directory_exists(report_dir)</div>
  </div>
  <div class="line not-executable" id="L937">
    <div class="line-number"><a href="#L937">937</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Use the reporting module if available, otherwise fall back to quality.save_report</div>
  </div>
  <div class="line not-covered" id="L938">
    <div class="line-number"><a href="#L938">938</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local reporting_loaded, reporting = pcall(require, &quot;lib.reporting&quot;)</div>
  </div>
  <div class="line not-executable" id="L939">
    <div class="line-number"><a href="#L939">939</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L940">
    <div class="line-number"><a href="#L940">940</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if reporting_loaded and reporting then</div>
  </div>
  <div class="line not-executable" id="L941">
    <div class="line-number"><a href="#L941">941</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Get quality report data</div>
  </div>
  <div class="line not-covered" id="L942">
    <div class="line-number"><a href="#L942">942</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local quality_data = quality.get_report_data()</div>
  </div>
  <div class="line not-executable" id="L943">
    <div class="line-number"><a href="#L943">943</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L944">
    <div class="line-number"><a href="#L944">944</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if quality_data then</div>
  </div>
  <div class="line not-executable" id="L945">
    <div class="line-number"><a href="#L945">945</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Generate HTML quality report</div>
  </div>
  <div class="line not-covered" id="L946">
    <div class="line-number"><a href="#L946">946</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local success, err = reporting.save_quality_report(</div>
  </div>
  <div class="line not-covered" id="L947">
    <div class="line-number"><a href="#L947">947</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          fs.join_paths(report_dir, &quot;quality-report.html&quot;), </div>
  </div>
  <div class="line not-covered" id="L948">
    <div class="line-number"><a href="#L948">948</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          quality_data, </div>
  </div>
  <div class="line not-covered" id="L949">
    <div class="line-number"><a href="#L949">949</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;html&quot;</div>
  </div>
  <div class="line not-covered" id="L950">
    <div class="line-number"><a href="#L950">950</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        )</div>
  </div>
  <div class="line not-executable" id="L951">
    <div class="line-number"><a href="#L951">951</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L952">
    <div class="line-number"><a href="#L952">952</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if success then</div>
  </div>
  <div class="line not-covered" id="L953">
    <div class="line-number"><a href="#L953">953</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          logger.info(&quot;Generated HTML quality report&quot;)</div>
  </div>
  <div class="line not-covered" id="L954">
    <div class="line-number"><a href="#L954">954</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L955">
    <div class="line-number"><a href="#L955">955</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          logger.error(&quot;Failed to generate HTML quality report&quot;, {</div>
  </div>
  <div class="line not-covered" id="L956">
    <div class="line-number"><a href="#L956">956</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error = err and error_handler.format_error(err) or &quot;Unknown error&quot;</div>
  </div>
  <div class="line not-covered" id="L957">
    <div class="line-number"><a href="#L957">957</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L958">
    <div class="line-number"><a href="#L958">958</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L959">
    <div class="line-number"><a href="#L959">959</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L960">
    <div class="line-number"><a href="#L960">960</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Generate JSON quality report</div>
  </div>
  <div class="line not-covered" id="L961">
    <div class="line-number"><a href="#L961">961</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        success, err = reporting.save_quality_report(</div>
  </div>
  <div class="line not-covered" id="L962">
    <div class="line-number"><a href="#L962">962</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          fs.join_paths(report_dir, &quot;quality-report.json&quot;), </div>
  </div>
  <div class="line not-covered" id="L963">
    <div class="line-number"><a href="#L963">963</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          quality_data, </div>
  </div>
  <div class="line not-covered" id="L964">
    <div class="line-number"><a href="#L964">964</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;json&quot;</div>
  </div>
  <div class="line not-covered" id="L965">
    <div class="line-number"><a href="#L965">965</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        )</div>
  </div>
  <div class="line not-executable" id="L966">
    <div class="line-number"><a href="#L966">966</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L967">
    <div class="line-number"><a href="#L967">967</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if success then</div>
  </div>
  <div class="line not-covered" id="L968">
    <div class="line-number"><a href="#L968">968</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          logger.info(&quot;Generated JSON quality report&quot;)</div>
  </div>
  <div class="line not-covered" id="L969">
    <div class="line-number"><a href="#L969">969</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L970">
    <div class="line-number"><a href="#L970">970</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          logger.error(&quot;Failed to generate JSON quality report&quot;, {</div>
  </div>
  <div class="line not-covered" id="L971">
    <div class="line-number"><a href="#L971">971</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error = err and error_handler.format_error(err) or &quot;Unknown error&quot;</div>
  </div>
  <div class="line not-covered" id="L972">
    <div class="line-number"><a href="#L972">972</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L973">
    <div class="line-number"><a href="#L973">973</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L974">
    <div class="line-number"><a href="#L974">974</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L975">
    <div class="line-number"><a href="#L975">975</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.error(&quot;Failed to get quality report data&quot;)</div>
  </div>
  <div class="line not-covered" id="L976">
    <div class="line-number"><a href="#L976">976</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L977">
    <div class="line-number"><a href="#L977">977</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L978">
    <div class="line-number"><a href="#L978">978</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Fall back to legacy approach</div>
  </div>
  <div class="line not-covered" id="L979">
    <div class="line-number"><a href="#L979">979</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.warn(&quot;Reporting module not available, using legacy quality.save_report&quot;)</div>
  </div>
  <div class="line not-executable" id="L980">
    <div class="line-number"><a href="#L980">980</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L981">
    <div class="line-number"><a href="#L981">981</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Generate HTML quality report</div>
  </div>
  <div class="line not-covered" id="L982">
    <div class="line-number"><a href="#L982">982</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local success = quality.save_report(fs.join_paths(report_dir, &quot;quality-report.html&quot;), &quot;html&quot;)</div>
  </div>
  <div class="line not-covered" id="L983">
    <div class="line-number"><a href="#L983">983</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if success then</div>
  </div>
  <div class="line not-covered" id="L984">
    <div class="line-number"><a href="#L984">984</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.info(&quot;Generated HTML quality report&quot;)</div>
  </div>
  <div class="line not-covered" id="L985">
    <div class="line-number"><a href="#L985">985</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L986">
    <div class="line-number"><a href="#L986">986</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L987">
    <div class="line-number"><a href="#L987">987</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Generate JSON quality report</div>
  </div>
  <div class="line not-covered" id="L988">
    <div class="line-number"><a href="#L988">988</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      success = quality.save_report(fs.join_paths(report_dir, &quot;quality-report.json&quot;), &quot;json&quot;)</div>
  </div>
  <div class="line not-covered" id="L989">
    <div class="line-number"><a href="#L989">989</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if success then</div>
  </div>
  <div class="line not-covered" id="L990">
    <div class="line-number"><a href="#L990">990</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.info(&quot;Generated JSON quality report&quot;)</div>
  </div>
  <div class="line not-covered" id="L991">
    <div class="line-number"><a href="#L991">991</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L992">
    <div class="line-number"><a href="#L992">992</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L993">
    <div class="line-number"><a href="#L993">993</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Print quality summary</div>
  </div>
  <div class="line not-covered" id="L994">
    <div class="line-number"><a href="#L994">994</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local report = quality.summary_report()</div>
  </div>
  <div class="line not-covered" id="L995">
    <div class="line-number"><a href="#L995">995</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Quality summary&quot;, {</div>
  </div>
  <div class="line not-covered" id="L996">
    <div class="line-number"><a href="#L996">996</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      score = string.format(&quot;%.2f%%&quot;, report.quality_score),</div>
  </div>
  <div class="line not-covered" id="L997">
    <div class="line-number"><a href="#L997">997</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      tests_analyzed = report.tests_analyzed,</div>
  </div>
  <div class="line not-covered" id="L998">
    <div class="line-number"><a href="#L998">998</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      level = report.level,</div>
  </div>
  <div class="line not-covered" id="L999">
    <div class="line-number"><a href="#L999">999</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      level_name = report.level_name,</div>
  </div>
  <div class="line not-covered" id="L1000">
    <div class="line-number"><a href="#L1000">1000</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1001">
    <div class="line-number"><a href="#L1001">1001</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1002">
    <div class="line-number"><a href="#L1002">1002</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Output overall JSON results if requested</div>
  </div>
  <div class="line not-covered" id="L1003">
    <div class="line-number"><a href="#L1003">1003</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.json_output or options.results_format == &quot;json&quot; then</div>
  </div>
  <div class="line not-executable" id="L1004">
    <div class="line-number"><a href="#L1004">1004</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try to load JSON module</div>
  </div>
  <div class="line not-covered" id="L1005">
    <div class="line-number"><a href="#L1005">1005</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local json_module</div>
  </div>
  <div class="line not-covered" id="L1006">
    <div class="line-number"><a href="#L1006">1006</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local ok, mod = pcall(require, &quot;lib.reporting.json&quot;)</div>
  </div>
  <div class="line not-covered" id="L1007">
    <div class="line-number"><a href="#L1007">1007</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not ok then</div>
  </div>
  <div class="line not-covered" id="L1008">
    <div class="line-number"><a href="#L1008">1008</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      ok, mod = pcall(require, &quot;../lib/reporting/json&quot;)</div>
  </div>
  <div class="line not-covered" id="L1009">
    <div class="line-number"><a href="#L1009">1009</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1010">
    <div class="line-number"><a href="#L1010">1010</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if ok then</div>
  </div>
  <div class="line not-covered" id="L1011">
    <div class="line-number"><a href="#L1011">1011</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      json_module = mod</div>
  </div>
  <div class="line not-executable" id="L1012">
    <div class="line-number"><a href="#L1012">1012</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Create aggregated test results</div>
  </div>
  <div class="line not-covered" id="L1013">
    <div class="line-number"><a href="#L1013">1013</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local test_results = {</div>
  </div>
  <div class="line not-covered" id="L1014">
    <div class="line-number"><a href="#L1014">1014</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        name = &quot;firmo-tests&quot;,</div>
  </div>
  <div class="line not-covered" id="L1015">
    <div class="line-number"><a href="#L1015">1015</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        timestamp = os.date(&quot;!%Y-%m-%dT%H:%M:%S&quot;),</div>
  </div>
  <div class="line not-covered" id="L1016">
    <div class="line-number"><a href="#L1016">1016</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        tests = total_passes + total_failures + total_skipped,</div>
  </div>
  <div class="line not-covered" id="L1017">
    <div class="line-number"><a href="#L1017">1017</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        failures = total_failures,</div>
  </div>
  <div class="line not-covered" id="L1018">
    <div class="line-number"><a href="#L1018">1018</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        errors = 0,</div>
  </div>
  <div class="line not-covered" id="L1019">
    <div class="line-number"><a href="#L1019">1019</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        skipped = total_skipped,</div>
  </div>
  <div class="line not-covered" id="L1020">
    <div class="line-number"><a href="#L1020">1020</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        time = elapsed_time,</div>
  </div>
  <div class="line not-covered" id="L1021">
    <div class="line-number"><a href="#L1021">1021</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        files_tested = #files,</div>
  </div>
  <div class="line not-covered" id="L1022">
    <div class="line-number"><a href="#L1022">1022</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        files_passed = passed_files,</div>
  </div>
  <div class="line not-covered" id="L1023">
    <div class="line-number"><a href="#L1023">1023</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        files_failed = failed_files,</div>
  </div>
  <div class="line not-covered" id="L1024">
    <div class="line-number"><a href="#L1024">1024</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        success = all_passed,</div>
  </div>
  <div class="line not-covered" id="L1025">
    <div class="line-number"><a href="#L1025">1025</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_cases = {}</div>
  </div>
  <div class="line not-covered" id="L1026">
    <div class="line-number"><a href="#L1026">1026</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-executable" id="L1027">
    <div class="line-number"><a href="#L1027">1027</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1028">
    <div class="line-number"><a href="#L1028">1028</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Add individual test cases from structured results if available</div>
  </div>
  <div class="line not-covered" id="L1029">
    <div class="line-number"><a href="#L1029">1029</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if #all_test_results &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L1030">
    <div class="line-number"><a href="#L1030">1030</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _, result in ipairs(all_test_results) do</div>
  </div>
  <div class="line not-covered" id="L1031">
    <div class="line-number"><a href="#L1031">1031</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local test_case = {</div>
  </div>
  <div class="line not-covered" id="L1032">
    <div class="line-number"><a href="#L1032">1032</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            name = result.name,</div>
  </div>
  <div class="line not-covered" id="L1033">
    <div class="line-number"><a href="#L1033">1033</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            path = result.path_string,</div>
  </div>
  <div class="line not-covered" id="L1034">
    <div class="line-number"><a href="#L1034">1034</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            status = result.status,</div>
  </div>
  <div class="line not-covered" id="L1035">
    <div class="line-number"><a href="#L1035">1035</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            file = result.file_path,</div>
  </div>
  <div class="line not-covered" id="L1036">
    <div class="line-number"><a href="#L1036">1036</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            time = result.execution_time or 0</div>
  </div>
  <div class="line not-covered" id="L1037">
    <div class="line-number"><a href="#L1037">1037</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          }</div>
  </div>
  <div class="line not-executable" id="L1038">
    <div class="line-number"><a href="#L1038">1038</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L1039">
    <div class="line-number"><a href="#L1039">1039</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Add error details for failed tests</div>
  </div>
  <div class="line not-covered" id="L1040">
    <div class="line-number"><a href="#L1040">1040</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if result.status == &quot;fail&quot; and result.error_message then</div>
  </div>
  <div class="line not-covered" id="L1041">
    <div class="line-number"><a href="#L1041">1041</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            test_case.failure = {</div>
  </div>
  <div class="line not-covered" id="L1042">
    <div class="line-number"><a href="#L1042">1042</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              message = result.error_message,</div>
  </div>
  <div class="line not-covered" id="L1043">
    <div class="line-number"><a href="#L1043">1043</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              type = &quot;Assertion&quot;</div>
  </div>
  <div class="line not-covered" id="L1044">
    <div class="line-number"><a href="#L1044">1044</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            }</div>
  </div>
  <div class="line not-covered" id="L1045">
    <div class="line-number"><a href="#L1045">1045</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-executable" id="L1046">
    <div class="line-number"><a href="#L1046">1046</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L1047">
    <div class="line-number"><a href="#L1047">1047</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Add metadata</div>
  </div>
  <div class="line not-covered" id="L1048">
    <div class="line-number"><a href="#L1048">1048</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if result.options then</div>
  </div>
  <div class="line not-covered" id="L1049">
    <div class="line-number"><a href="#L1049">1049</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            test_case.metadata = result.options</div>
  </div>
  <div class="line not-covered" id="L1050">
    <div class="line-number"><a href="#L1050">1050</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-executable" id="L1051">
    <div class="line-number"><a href="#L1051">1051</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-covered" id="L1052">
    <div class="line-number"><a href="#L1052">1052</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          table.insert(test_results.test_cases, test_case)</div>
  </div>
  <div class="line not-covered" id="L1053">
    <div class="line-number"><a href="#L1053">1053</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1054">
    <div class="line-number"><a href="#L1054">1054</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1055">
    <div class="line-number"><a href="#L1055">1055</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.debug(&quot;Added structured test cases to JSON output&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1056">
    <div class="line-number"><a href="#L1056">1056</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          test_case_count = #test_results.test_cases</div>
  </div>
  <div class="line not-covered" id="L1057">
    <div class="line-number"><a href="#L1057">1057</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1058">
    <div class="line-number"><a href="#L1058">1058</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1059">
    <div class="line-number"><a href="#L1059">1059</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Format as JSON with markers for parallel execution</div>
  </div>
  <div class="line not-covered" id="L1060">
    <div class="line-number"><a href="#L1060">1060</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local json_results = json_module.encode(test_results)</div>
  </div>
  <div class="line not-covered" id="L1061">
    <div class="line-number"><a href="#L1061">1061</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;Overall JSON results&quot;, { results = &quot;RESULTS_JSON_BEGIN&quot; .. json_results .. &quot;RESULTS_JSON_END&quot; })</div>
  </div>
  <div class="line not-covered" id="L1062">
    <div class="line-number"><a href="#L1062">1062</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1063">
    <div class="line-number"><a href="#L1063">1063</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1064">
    <div class="line-number"><a href="#L1064">1064</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return all_passed</div>
  </div>
  <div class="line not-covered" id="L1065">
    <div class="line-number"><a href="#L1065">1065</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1066">
    <div class="line-number"><a href="#L1066">1066</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Watch mode for continuous testing</div>
  </div>
  <div class="line not-covered" id="L1067">
    <div class="line-number"><a href="#L1067">1067</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function runner.watch_mode(path, firmo, options)</div>
  </div>
  <div class="line not-covered" id="L1068">
    <div class="line-number"><a href="#L1068">1068</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not has_watcher then</div>
  </div>
  <div class="line not-covered" id="L1069">
    <div class="line-number"><a href="#L1069">1069</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;Watch mode unavailable&quot;, { reason = &quot;Watcher module not found&quot; })</div>
  </div>
  <div class="line not-covered" id="L1070">
    <div class="line-number"><a href="#L1070">1070</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1071">
    <div class="line-number"><a href="#L1071">1071</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1072">
    <div class="line-number"><a href="#L1072">1072</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  options = options or {}</div>
  </div>
  <div class="line not-covered" id="L1073">
    <div class="line-number"><a href="#L1073">1073</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local exclude_patterns = options.exclude_patterns or { &quot;node_modules&quot;, &quot;%.git&quot; }</div>
  </div>
  <div class="line not-covered" id="L1074">
    <div class="line-number"><a href="#L1074">1074</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local watch_interval = options.interval or 1.0</div>
  </div>
  <div class="line not-executable" id="L1075">
    <div class="line-number"><a href="#L1075">1075</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize the file watcher</div>
  </div>
  <div class="line not-covered" id="L1076">
    <div class="line-number"><a href="#L1076">1076</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Watch mode activated&quot;)</div>
  </div>
  <div class="line not-covered" id="L1077">
    <div class="line-number"><a href="#L1077">1077</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Press Ctrl+C to exit&quot;)</div>
  </div>
  <div class="line not-executable" id="L1078">
    <div class="line-number"><a href="#L1078">1078</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Determine what to watch based on path type</div>
  </div>
  <div class="line not-covered" id="L1079">
    <div class="line-number"><a href="#L1079">1079</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local directories = {}</div>
  </div>
  <div class="line not-covered" id="L1080">
    <div class="line-number"><a href="#L1080">1080</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local files = {}</div>
  </div>
  <div class="line not-executable" id="L1081">
    <div class="line-number"><a href="#L1081">1081</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if path is a directory or file</div>
  </div>
  <div class="line not-covered" id="L1082">
    <div class="line-number"><a href="#L1082">1082</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if fs.directory_exists(path) then</div>
  </div>
  <div class="line not-executable" id="L1083">
    <div class="line-number"><a href="#L1083">1083</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Watch the directory and run tests in it</div>
  </div>
  <div class="line not-covered" id="L1084">
    <div class="line-number"><a href="#L1084">1084</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(directories, path)</div>
  </div>
  <div class="line not-executable" id="L1085">
    <div class="line-number"><a href="#L1085">1085</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Find test files in the directory</div>
  </div>
  <div class="line not-covered" id="L1086">
    <div class="line-number"><a href="#L1086">1086</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local test_pattern = options.pattern or &quot;*_test.lua&quot;</div>
  </div>
  <div class="line not-covered" id="L1087">
    <div class="line-number"><a href="#L1087">1087</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local found = fs.discover_files({ path }, { test_pattern }, exclude_patterns)</div>
  </div>
  <div class="line not-covered" id="L1088">
    <div class="line-number"><a href="#L1088">1088</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if found then</div>
  </div>
  <div class="line not-covered" id="L1089">
    <div class="line-number"><a href="#L1089">1089</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, file in ipairs(found) do</div>
  </div>
  <div class="line not-covered" id="L1090">
    <div class="line-number"><a href="#L1090">1090</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(files, file)</div>
  </div>
  <div class="line not-covered" id="L1091">
    <div class="line-number"><a href="#L1091">1091</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1092">
    <div class="line-number"><a href="#L1092">1092</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1093">
    <div class="line-number"><a href="#L1093">1093</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Watching directory&quot;, { path = path, files_found = #files })</div>
  </div>
  <div class="line not-covered" id="L1094">
    <div class="line-number"><a href="#L1094">1094</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif fs.file_exists(path) then</div>
  </div>
  <div class="line not-executable" id="L1095">
    <div class="line-number"><a href="#L1095">1095</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Watch the file's directory and run the specific file</div>
  </div>
  <div class="line not-covered" id="L1096">
    <div class="line-number"><a href="#L1096">1096</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local dir = fs.get_directory_name(path)</div>
  </div>
  <div class="line not-covered" id="L1097">
    <div class="line-number"><a href="#L1097">1097</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(directories, dir)</div>
  </div>
  <div class="line not-covered" id="L1098">
    <div class="line-number"><a href="#L1098">1098</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(files, path)</div>
  </div>
  <div class="line not-covered" id="L1099">
    <div class="line-number"><a href="#L1099">1099</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Watching file&quot;, { file = path, directory = dir })</div>
  </div>
  <div class="line not-covered" id="L1100">
    <div class="line-number"><a href="#L1100">1100</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L1101">
    <div class="line-number"><a href="#L1101">1101</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;Path not found for watch mode&quot;, { path = path })</div>
  </div>
  <div class="line not-covered" id="L1102">
    <div class="line-number"><a href="#L1102">1102</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1103">
    <div class="line-number"><a href="#L1103">1103</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1104">
    <div class="line-number"><a href="#L1104">1104</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  watcher.set_check_interval(watch_interval)</div>
  </div>
  <div class="line not-covered" id="L1105">
    <div class="line-number"><a href="#L1105">1105</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  watcher.init(directories, exclude_patterns)</div>
  </div>
  <div class="line not-covered" id="L1106">
    <div class="line-number"><a href="#L1106">1106</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local last_run_time = os.time()</div>
  </div>
  <div class="line not-covered" id="L1107">
    <div class="line-number"><a href="#L1107">1107</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local debounce_time = 0.5 -- seconds to wait after changes before running tests</div>
  </div>
  <div class="line not-covered" id="L1108">
    <div class="line-number"><a href="#L1108">1108</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local last_change_time = 0</div>
  </div>
  <div class="line not-covered" id="L1109">
    <div class="line-number"><a href="#L1109">1109</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local need_to_run = true</div>
  </div>
  <div class="line not-covered" id="L1110">
    <div class="line-number"><a href="#L1110">1110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local run_success = true</div>
  </div>
  <div class="line not-executable" id="L1111">
    <div class="line-number"><a href="#L1111">1111</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a copy of options for the runner</div>
  </div>
  <div class="line not-covered" id="L1112">
    <div class="line-number"><a href="#L1112">1112</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local runner_options = {}</div>
  </div>
  <div class="line not-covered" id="L1113">
    <div class="line-number"><a href="#L1113">1113</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for k, v in pairs(options) do</div>
  </div>
  <div class="line not-covered" id="L1114">
    <div class="line-number"><a href="#L1114">1114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    runner_options[k] = v</div>
  </div>
  <div class="line not-covered" id="L1115">
    <div class="line-number"><a href="#L1115">1115</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1116">
    <div class="line-number"><a href="#L1116">1116</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Watch loop</div>
  </div>
  <div class="line not-covered" id="L1117">
    <div class="line-number"><a href="#L1117">1117</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  while true do</div>
  </div>
  <div class="line not-covered" id="L1118">
    <div class="line-number"><a href="#L1118">1118</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local current_time = os.time()</div>
  </div>
  <div class="line not-executable" id="L1119">
    <div class="line-number"><a href="#L1119">1119</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check for file changes</div>
  </div>
  <div class="line not-covered" id="L1120">
    <div class="line-number"><a href="#L1120">1120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local changed_files = watcher.check_for_changes()</div>
  </div>
  <div class="line not-covered" id="L1121">
    <div class="line-number"><a href="#L1121">1121</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if changed_files then</div>
  </div>
  <div class="line not-covered" id="L1122">
    <div class="line-number"><a href="#L1122">1122</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      last_change_time = current_time</div>
  </div>
  <div class="line not-covered" id="L1123">
    <div class="line-number"><a href="#L1123">1123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      need_to_run = true</div>
  </div>
  <div class="line not-covered" id="L1124">
    <div class="line-number"><a href="#L1124">1124</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;File changes detected&quot;, { files = #changed_files })</div>
  </div>
  <div class="line not-covered" id="L1125">
    <div class="line-number"><a href="#L1125">1125</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, file in ipairs(changed_files) do</div>
  </div>
  <div class="line not-covered" id="L1126">
    <div class="line-number"><a href="#L1126">1126</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.info(&quot;Changed file&quot;, { path = file })</div>
  </div>
  <div class="line not-covered" id="L1127">
    <div class="line-number"><a href="#L1127">1127</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1128">
    <div class="line-number"><a href="#L1128">1128</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1129">
    <div class="line-number"><a href="#L1129">1129</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Run tests if needed and after debounce period</div>
  </div>
  <div class="line not-covered" id="L1130">
    <div class="line-number"><a href="#L1130">1130</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if need_to_run and current_time - last_change_time &gt;= debounce_time then</div>
  </div>
  <div class="line not-covered" id="L1131">
    <div class="line-number"><a href="#L1131">1131</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;Running tests&quot;, { timestamp = os.date(&quot;%Y-%m-%d %H:%M:%S&quot;) })</div>
  </div>
  <div class="line not-executable" id="L1132">
    <div class="line-number"><a href="#L1132">1132</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Clear terminal</div>
  </div>
  <div class="line not-covered" id="L1133">
    <div class="line-number"><a href="#L1133">1133</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      io.write(&quot;\027[2J\027[H&quot;)</div>
  </div>
  <div class="line not-covered" id="L1134">
    <div class="line-number"><a href="#L1134">1134</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      firmo.reset()</div>
  </div>
  <div class="line not-executable" id="L1135">
    <div class="line-number"><a href="#L1135">1135</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Run tests based on the files we found earlier</div>
  </div>
  <div class="line not-covered" id="L1136">
    <div class="line-number"><a href="#L1136">1136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if #files &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L1137">
    <div class="line-number"><a href="#L1137">1137</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        run_success = runner.run_all(files, firmo, runner_options)</div>
  </div>
  <div class="line not-covered" id="L1138">
    <div class="line-number"><a href="#L1138">1138</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L1139">
    <div class="line-number"><a href="#L1139">1139</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.warn(&quot;No test files found to run&quot;)</div>
  </div>
  <div class="line not-covered" id="L1140">
    <div class="line-number"><a href="#L1140">1140</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        run_success = true</div>
  </div>
  <div class="line not-covered" id="L1141">
    <div class="line-number"><a href="#L1141">1141</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1142">
    <div class="line-number"><a href="#L1142">1142</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      last_run_time = current_time</div>
  </div>
  <div class="line not-covered" id="L1143">
    <div class="line-number"><a href="#L1143">1143</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      need_to_run = false</div>
  </div>
  <div class="line not-covered" id="L1144">
    <div class="line-number"><a href="#L1144">1144</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;Watching for changes&quot;)</div>
  </div>
  <div class="line not-covered" id="L1145">
    <div class="line-number"><a href="#L1145">1145</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1146">
    <div class="line-number"><a href="#L1146">1146</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Small sleep to prevent CPU hogging</div>
  </div>
  <div class="line not-covered" id="L1147">
    <div class="line-number"><a href="#L1147">1147</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    os.execute(&quot;sleep 0.1&quot;)</div>
  </div>
  <div class="line not-covered" id="L1148">
    <div class="line-number"><a href="#L1148">1148</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1149">
    <div class="line-number"><a href="#L1149">1149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return run_success</div>
  </div>
  <div class="line not-covered" id="L1150">
    <div class="line-number"><a href="#L1150">1150</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1151">
    <div class="line-number"><a href="#L1151">1151</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Parse command-line arguments</div>
  </div>
  <div class="line not-covered" id="L1152">
    <div class="line-number"><a href="#L1152">1152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function runner.parse_arguments(args)</div>
  </div>
  <div class="line not-covered" id="L1153">
    <div class="line-number"><a href="#L1153">1153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local options = {</div>
  </div>
  <div class="line not-covered" id="L1154">
    <div class="line-number"><a href="#L1154">1154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    verbose = false, -- Verbose output</div>
  </div>
  <div class="line not-covered" id="L1155">
    <div class="line-number"><a href="#L1155">1155</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    memory = false, -- Track memory usage</div>
  </div>
  <div class="line not-covered" id="L1156">
    <div class="line-number"><a href="#L1156">1156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    performance = false, -- Show performance stats</div>
  </div>
  <div class="line not-covered" id="L1157">
    <div class="line-number"><a href="#L1157">1157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage = false, -- Enable coverage tracking</div>
  </div>
  <div class="line not-covered" id="L1158">
    <div class="line-number"><a href="#L1158">1158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage_debug = false, -- Enable debug output for coverage</div>
  </div>
  <div class="line not-covered" id="L1159">
    <div class="line-number"><a href="#L1159">1159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    discover_uncovered = true, -- Discover files that aren't executed by tests</div>
  </div>
  <div class="line not-covered" id="L1160">
    <div class="line-number"><a href="#L1160">1160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    quality = false, -- Enable quality validation</div>
  </div>
  <div class="line not-covered" id="L1161">
    <div class="line-number"><a href="#L1161">1161</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    quality_level = 3, -- Quality validation level</div>
  </div>
  <div class="line not-covered" id="L1162">
    <div class="line-number"><a href="#L1162">1162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    watch = false, -- Enable watch mode</div>
  </div>
  <div class="line not-covered" id="L1163">
    <div class="line-number"><a href="#L1163">1163</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    json_output = false, -- Output JSON results</div>
  </div>
  <div class="line not-covered" id="L1164">
    <div class="line-number"><a href="#L1164">1164</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pattern = nil, -- Pattern for test files</div>
  </div>
  <div class="line not-covered" id="L1165">
    <div class="line-number"><a href="#L1165">1165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    filter = nil, -- Filter pattern for tests</div>
  </div>
  <div class="line not-covered" id="L1166">
    <div class="line-number"><a href="#L1166">1166</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    report_dir = &quot;./coverage-reports&quot;, -- Directory for reports</div>
  </div>
  <div class="line not-covered" id="L1167">
    <div class="line-number"><a href="#L1167">1167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    formats = { &quot;html&quot;, &quot;json&quot;, &quot;lcov&quot;, &quot;cobertura&quot; }, -- Report formats</div>
  </div>
  <div class="line not-covered" id="L1168">
    <div class="line-number"><a href="#L1168">1168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    threshold = 80, -- Coverage/quality threshold</div>
  </div>
  <div class="line not-covered" id="L1169">
    <div class="line-number"><a href="#L1169">1169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    exclude_patterns = { &quot;fixtures/*&quot; }, -- Patterns to exclude</div>
  </div>
  <div class="line not-covered" id="L1170">
    <div class="line-number"><a href="#L1170">1170</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L1171">
    <div class="line-number"><a href="#L1171">1171</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1172">
    <div class="line-number"><a href="#L1172">1172</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;Parse arguments input:&quot;)</div>
  </div>
  <div class="line not-covered" id="L1173">
    <div class="line-number"><a href="#L1173">1173</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i, arg in ipairs(args) do</div>
  </div>
  <div class="line not-covered" id="L1174">
    <div class="line-number"><a href="#L1174">1174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    print(i, arg)</div>
  </div>
  <div class="line not-covered" id="L1175">
    <div class="line-number"><a href="#L1175">1175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1176">
    <div class="line-number"><a href="#L1176">1176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local path = nil</div>
  </div>
  <div class="line not-covered" id="L1177">
    <div class="line-number"><a href="#L1177">1177</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local i = 1</div>
  </div>
  <div class="line not-covered" id="L1178">
    <div class="line-number"><a href="#L1178">1178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  while i &lt;= #args do</div>
  </div>
  <div class="line not-covered" id="L1179">
    <div class="line-number"><a href="#L1179">1179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local arg = args[i]</div>
  </div>
  <div class="line not-executable" id="L1180">
    <div class="line-number"><a href="#L1180">1180</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Boolean flags</div>
  </div>
  <div class="line not-covered" id="L1181">
    <div class="line-number"><a href="#L1181">1181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if arg == &quot;--verbose&quot; or arg == &quot;-v&quot; then</div>
  </div>
  <div class="line not-covered" id="L1182">
    <div class="line-number"><a href="#L1182">1182</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.verbose = true</div>
  </div>
  <div class="line not-covered" id="L1183">
    <div class="line-number"><a href="#L1183">1183</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--memory&quot; or arg == &quot;-m&quot; then</div>
  </div>
  <div class="line not-covered" id="L1184">
    <div class="line-number"><a href="#L1184">1184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.memory = true</div>
  </div>
  <div class="line not-covered" id="L1185">
    <div class="line-number"><a href="#L1185">1185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--performance&quot; or arg == &quot;-p&quot; then</div>
  </div>
  <div class="line not-covered" id="L1186">
    <div class="line-number"><a href="#L1186">1186</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.performance = true</div>
  </div>
  <div class="line not-covered" id="L1187">
    <div class="line-number"><a href="#L1187">1187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--coverage&quot; or arg == &quot;-c&quot; then</div>
  </div>
  <div class="line not-covered" id="L1188">
    <div class="line-number"><a href="#L1188">1188</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.coverage = true</div>
  </div>
  <div class="line not-covered" id="L1189">
    <div class="line-number"><a href="#L1189">1189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;SET COVERAGE OPTION TO TRUE&quot;)</div>
  </div>
  <div class="line not-covered" id="L1190">
    <div class="line-number"><a href="#L1190">1190</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--coverage-debug&quot; or arg == &quot;-cd&quot; then</div>
  </div>
  <div class="line not-covered" id="L1191">
    <div class="line-number"><a href="#L1191">1191</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.coverage_debug = true</div>
  </div>
  <div class="line not-covered" id="L1192">
    <div class="line-number"><a href="#L1192">1192</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--quality&quot; or arg == &quot;-q&quot; then</div>
  </div>
  <div class="line not-covered" id="L1193">
    <div class="line-number"><a href="#L1193">1193</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.quality = true</div>
  </div>
  <div class="line not-covered" id="L1194">
    <div class="line-number"><a href="#L1194">1194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--watch&quot; or arg == &quot;-w&quot; then</div>
  </div>
  <div class="line not-covered" id="L1195">
    <div class="line-number"><a href="#L1195">1195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.watch = true</div>
  </div>
  <div class="line not-covered" id="L1196">
    <div class="line-number"><a href="#L1196">1196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--json&quot; or arg == &quot;-j&quot; then</div>
  </div>
  <div class="line not-covered" id="L1197">
    <div class="line-number"><a href="#L1197">1197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.json_output = true</div>
  </div>
  <div class="line not-executable" id="L1198">
    <div class="line-number"><a href="#L1198">1198</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Options with values (format: --option=value or --option value)</div>
  </div>
  <div class="line not-covered" id="L1199">
    <div class="line-number"><a href="#L1199">1199</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg:match(&quot;^%-%-pattern=(.+)$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1200">
    <div class="line-number"><a href="#L1200">1200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.pattern = arg:match(&quot;^%-%-pattern=(.+)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1201">
    <div class="line-number"><a href="#L1201">1201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg:match(&quot;^%-%-filter=(.+)$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1202">
    <div class="line-number"><a href="#L1202">1202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.filter = arg:match(&quot;^%-%-filter=(.+)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1203">
    <div class="line-number"><a href="#L1203">1203</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg:match(&quot;^%-%-report%-dir=(.+)$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1204">
    <div class="line-number"><a href="#L1204">1204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.report_dir = arg:match(&quot;^%-%-report%-dir=(.+)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1205">
    <div class="line-number"><a href="#L1205">1205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg:match(&quot;^%-%-quality%-level=(%d+)$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1206">
    <div class="line-number"><a href="#L1206">1206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.quality_level = tonumber(arg:match(&quot;^%-%-quality%-level=(%d+)$&quot;))</div>
  </div>
  <div class="line not-covered" id="L1207">
    <div class="line-number"><a href="#L1207">1207</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg:match(&quot;^%-%-threshold=(%d+)$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1208">
    <div class="line-number"><a href="#L1208">1208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.threshold = tonumber(arg:match(&quot;^%-%-threshold=(%d+)$&quot;))</div>
  </div>
  <div class="line not-covered" id="L1209">
    <div class="line-number"><a href="#L1209">1209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg:match(&quot;^%-%-format=(.+)$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1210">
    <div class="line-number"><a href="#L1210">1210</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.formats = { arg:match(&quot;^%-%-format=(.+)$&quot;) }</div>
  </div>
  <div class="line not-executable" id="L1211">
    <div class="line-number"><a href="#L1211">1211</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Options with values (separate argument)</div>
  </div>
  <div class="line not-covered" id="L1212">
    <div class="line-number"><a href="#L1212">1212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--pattern&quot; and i &lt; #args then</div>
  </div>
  <div class="line not-covered" id="L1213">
    <div class="line-number"><a href="#L1213">1213</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      i = i + 1</div>
  </div>
  <div class="line not-covered" id="L1214">
    <div class="line-number"><a href="#L1214">1214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.pattern = args[i]</div>
  </div>
  <div class="line not-covered" id="L1215">
    <div class="line-number"><a href="#L1215">1215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--filter&quot; and i &lt; #args then</div>
  </div>
  <div class="line not-covered" id="L1216">
    <div class="line-number"><a href="#L1216">1216</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      i = i + 1</div>
  </div>
  <div class="line not-covered" id="L1217">
    <div class="line-number"><a href="#L1217">1217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.filter = args[i]</div>
  </div>
  <div class="line not-covered" id="L1218">
    <div class="line-number"><a href="#L1218">1218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--report-dir&quot; and i &lt; #args then</div>
  </div>
  <div class="line not-covered" id="L1219">
    <div class="line-number"><a href="#L1219">1219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      i = i + 1</div>
  </div>
  <div class="line not-covered" id="L1220">
    <div class="line-number"><a href="#L1220">1220</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.report_dir = args[i]</div>
  </div>
  <div class="line not-covered" id="L1221">
    <div class="line-number"><a href="#L1221">1221</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--quality-level&quot; and i &lt; #args then</div>
  </div>
  <div class="line not-covered" id="L1222">
    <div class="line-number"><a href="#L1222">1222</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      i = i + 1</div>
  </div>
  <div class="line not-covered" id="L1223">
    <div class="line-number"><a href="#L1223">1223</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.quality_level = tonumber(args[i])</div>
  </div>
  <div class="line not-covered" id="L1224">
    <div class="line-number"><a href="#L1224">1224</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--threshold&quot; and i &lt; #args then</div>
  </div>
  <div class="line not-covered" id="L1225">
    <div class="line-number"><a href="#L1225">1225</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      i = i + 1</div>
  </div>
  <div class="line not-covered" id="L1226">
    <div class="line-number"><a href="#L1226">1226</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.threshold = tonumber(args[i])</div>
  </div>
  <div class="line not-covered" id="L1227">
    <div class="line-number"><a href="#L1227">1227</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--format&quot; and i &lt; #args then</div>
  </div>
  <div class="line not-covered" id="L1228">
    <div class="line-number"><a href="#L1228">1228</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      i = i + 1</div>
  </div>
  <div class="line not-covered" id="L1229">
    <div class="line-number"><a href="#L1229">1229</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options.formats = { args[i] }</div>
  </div>
  <div class="line not-executable" id="L1230">
    <div class="line-number"><a href="#L1230">1230</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Help flag</div>
  </div>
  <div class="line not-covered" id="L1231">
    <div class="line-number"><a href="#L1231">1231</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif arg == &quot;--help&quot; or arg == &quot;-h&quot; then</div>
  </div>
  <div class="line not-covered" id="L1232">
    <div class="line-number"><a href="#L1232">1232</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      runner.print_usage()</div>
  </div>
  <div class="line not-covered" id="L1233">
    <div class="line-number"><a href="#L1233">1233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      os.exit(0)</div>
  </div>
  <div class="line not-executable" id="L1234">
    <div class="line-number"><a href="#L1234">1234</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- First non-flag argument is considered the path</div>
  </div>
  <div class="line not-covered" id="L1235">
    <div class="line-number"><a href="#L1235">1235</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif not arg:match(&quot;^%-&quot;) and not path then</div>
  </div>
  <div class="line not-covered" id="L1236">
    <div class="line-number"><a href="#L1236">1236</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = arg</div>
  </div>
  <div class="line not-covered" id="L1237">
    <div class="line-number"><a href="#L1237">1237</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1238">
    <div class="line-number"><a href="#L1238">1238</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    i = i + 1</div>
  </div>
  <div class="line not-covered" id="L1239">
    <div class="line-number"><a href="#L1239">1239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1240">
    <div class="line-number"><a href="#L1240">1240</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return path, options</div>
  </div>
  <div class="line not-covered" id="L1241">
    <div class="line-number"><a href="#L1241">1241</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1242">
    <div class="line-number"><a href="#L1242">1242</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Print usage information</div>
  </div>
  <div class="line not-covered" id="L1243">
    <div class="line-number"><a href="#L1243">1243</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function runner.print_usage()</div>
  </div>
  <div class="line not-covered" id="L1244">
    <div class="line-number"><a href="#L1244">1244</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;Usage: lua scripts/runner.lua [options] [path]&quot;)</div>
  </div>
  <div class="line not-covered" id="L1245">
    <div class="line-number"><a href="#L1245">1245</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;&quot;)</div>
  </div>
  <div class="line not-covered" id="L1246">
    <div class="line-number"><a href="#L1246">1246</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;Where path can be a file or directory, and options include:&quot;)</div>
  </div>
  <div class="line not-covered" id="L1247">
    <div class="line-number"><a href="#L1247">1247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --pattern=&lt;pattern&gt;   Only run test files matching pattern (e.g., '*_test.lua')&quot;)</div>
  </div>
  <div class="line not-covered" id="L1248">
    <div class="line-number"><a href="#L1248">1248</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --filter=&lt;filter&gt;     Only run tests matching filter (by tag or description)&quot;)</div>
  </div>
  <div class="line not-covered" id="L1249">
    <div class="line-number"><a href="#L1249">1249</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --format=&lt;format&gt;     Output format (summary, tap, junit, etc.)&quot;)</div>
  </div>
  <div class="line not-covered" id="L1250">
    <div class="line-number"><a href="#L1250">1250</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --report-dir=&lt;path&gt;   Save reports to specified directory&quot;)</div>
  </div>
  <div class="line not-covered" id="L1251">
    <div class="line-number"><a href="#L1251">1251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --coverage, -c        Enable coverage tracking&quot;)</div>
  </div>
  <div class="line not-covered" id="L1252">
    <div class="line-number"><a href="#L1252">1252</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --coverage-debug, -cd Enable debug output for coverage&quot;)</div>
  </div>
  <div class="line not-covered" id="L1253">
    <div class="line-number"><a href="#L1253">1253</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --quality, -q         Enable quality validation&quot;)</div>
  </div>
  <div class="line not-covered" id="L1254">
    <div class="line-number"><a href="#L1254">1254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --quality-level=&lt;n&gt;   Set quality validation level (1-5)&quot;)</div>
  </div>
  <div class="line not-covered" id="L1255">
    <div class="line-number"><a href="#L1255">1255</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --threshold=&lt;n&gt;       Set coverage/quality threshold (0-100)&quot;)</div>
  </div>
  <div class="line not-covered" id="L1256">
    <div class="line-number"><a href="#L1256">1256</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --verbose, -v         Enable verbose output&quot;)</div>
  </div>
  <div class="line not-covered" id="L1257">
    <div class="line-number"><a href="#L1257">1257</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --memory, -m          Track memory usage&quot;)</div>
  </div>
  <div class="line not-covered" id="L1258">
    <div class="line-number"><a href="#L1258">1258</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --performance, -p     Show performance metrics&quot;)</div>
  </div>
  <div class="line not-covered" id="L1259">
    <div class="line-number"><a href="#L1259">1259</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --watch, -w           Enable watch mode for continuous testing&quot;)</div>
  </div>
  <div class="line not-covered" id="L1260">
    <div class="line-number"><a href="#L1260">1260</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --json, -j            Output JSON results&quot;)</div>
  </div>
  <div class="line not-covered" id="L1261">
    <div class="line-number"><a href="#L1261">1261</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  --help, -h            Show this help message&quot;)</div>
  </div>
  <div class="line not-covered" id="L1262">
    <div class="line-number"><a href="#L1262">1262</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;&quot;)</div>
  </div>
  <div class="line not-covered" id="L1263">
    <div class="line-number"><a href="#L1263">1263</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;Examples:&quot;)</div>
  </div>
  <div class="line not-covered" id="L1264">
    <div class="line-number"><a href="#L1264">1264</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  lua scripts/runner.lua tests/coverage_test.lua     Run a single test file&quot;)</div>
  </div>
  <div class="line not-covered" id="L1265">
    <div class="line-number"><a href="#L1265">1265</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  lua scripts/runner.lua tests/                      Run all tests in directory&quot;)</div>
  </div>
  <div class="line not-covered" id="L1266">
    <div class="line-number"><a href="#L1266">1266</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  lua scripts/runner.lua --pattern=coverage tests/   Run coverage-related tests&quot;)</div>
  </div>
  <div class="line not-covered" id="L1267">
    <div class="line-number"><a href="#L1267">1267</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  lua scripts/runner.lua --coverage tests/           Run tests with coverage&quot;)</div>
  </div>
  <div class="line not-covered" id="L1268">
    <div class="line-number"><a href="#L1268">1268</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1269">
    <div class="line-number"><a href="#L1269">1269</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Main function to run tests from command line</div>
  </div>
  <div class="line not-covered" id="L1270">
    <div class="line-number"><a href="#L1270">1270</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function runner.main(args)</div>
  </div>
  <div class="line not-executable" id="L1271">
    <div class="line-number"><a href="#L1271">1271</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Print all args for debugging</div>
  </div>
  <div class="line not-covered" id="L1272">
    <div class="line-number"><a href="#L1272">1272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;Runner.main called with arguments:&quot;)</div>
  </div>
  <div class="line not-covered" id="L1273">
    <div class="line-number"><a href="#L1273">1273</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i, arg in ipairs(args) do</div>
  </div>
  <div class="line not-covered" id="L1274">
    <div class="line-number"><a href="#L1274">1274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    print(i, arg)</div>
  </div>
  <div class="line not-covered" id="L1275">
    <div class="line-number"><a href="#L1275">1275</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1276">
    <div class="line-number"><a href="#L1276">1276</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1277">
    <div class="line-number"><a href="#L1277">1277</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parse command-line arguments</div>
  </div>
  <div class="line not-covered" id="L1278">
    <div class="line-number"><a href="#L1278">1278</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local path, options = runner.parse_arguments(args)</div>
  </div>
  <div class="line not-executable" id="L1279">
    <div class="line-number"><a href="#L1279">1279</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1280">
    <div class="line-number"><a href="#L1280">1280</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Print options for debugging</div>
  </div>
  <div class="line not-covered" id="L1281">
    <div class="line-number"><a href="#L1281">1281</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;Parsed options:&quot;)</div>
  </div>
  <div class="line not-covered" id="L1282">
    <div class="line-number"><a href="#L1282">1282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  path:&quot;, path)</div>
  </div>
  <div class="line not-covered" id="L1283">
    <div class="line-number"><a href="#L1283">1283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  coverage:&quot;, options.coverage)</div>
  </div>
  <div class="line not-covered" id="L1284">
    <div class="line-number"><a href="#L1284">1284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  print(&quot;  report_dir:&quot;, options.report_dir)</div>
  </div>
  <div class="line not-executable" id="L1285">
    <div class="line-number"><a href="#L1285">1285</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1286">
    <div class="line-number"><a href="#L1286">1286</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Make sure we have a path</div>
  </div>
  <div class="line not-covered" id="L1287">
    <div class="line-number"><a href="#L1287">1287</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not path then</div>
  </div>
  <div class="line not-covered" id="L1288">
    <div class="line-number"><a href="#L1288">1288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;No path specified&quot;, { usage = &quot;lua scripts/runner.lua [options] [path]&quot; })</div>
  </div>
  <div class="line not-covered" id="L1289">
    <div class="line-number"><a href="#L1289">1289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    runner.print_usage()</div>
  </div>
  <div class="line not-covered" id="L1290">
    <div class="line-number"><a href="#L1290">1290</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1291">
    <div class="line-number"><a href="#L1291">1291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1292">
    <div class="line-number"><a href="#L1292">1292</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try to load firmo</div>
  </div>
  <div class="line not-covered" id="L1293">
    <div class="line-number"><a href="#L1293">1293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local firmo_loaded, firmo = pcall(require, &quot;firmo&quot;)</div>
  </div>
  <div class="line not-covered" id="L1294">
    <div class="line-number"><a href="#L1294">1294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not firmo_loaded then</div>
  </div>
  <div class="line not-executable" id="L1295">
    <div class="line-number"><a href="#L1295">1295</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try again with relative path</div>
  </div>
  <div class="line not-covered" id="L1296">
    <div class="line-number"><a href="#L1296">1296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    firmo_loaded, firmo = pcall(require, &quot;firmo&quot;)</div>
  </div>
  <div class="line not-covered" id="L1297">
    <div class="line-number"><a href="#L1297">1297</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not firmo_loaded then</div>
  </div>
  <div class="line not-covered" id="L1298">
    <div class="line-number"><a href="#L1298">1298</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Failed to load firmo&quot;, { error = error_handler.format_error(firmo) })</div>
  </div>
  <div class="line not-covered" id="L1299">
    <div class="line-number"><a href="#L1299">1299</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line not-covered" id="L1300">
    <div class="line-number"><a href="#L1300">1300</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1301">
    <div class="line-number"><a href="#L1301">1301</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1302">
    <div class="line-number"><a href="#L1302">1302</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if we're running in watch mode</div>
  </div>
  <div class="line not-covered" id="L1303">
    <div class="line-number"><a href="#L1303">1303</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.watch then</div>
  </div>
  <div class="line not-executable" id="L1304">
    <div class="line-number"><a href="#L1304">1304</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Setup watch mode for continuous testing</div>
  </div>
  <div class="line not-covered" id="L1305">
    <div class="line-number"><a href="#L1305">1305</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return runner.watch_mode(path, firmo, options)</div>
  </div>
  <div class="line not-covered" id="L1306">
    <div class="line-number"><a href="#L1306">1306</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1307">
    <div class="line-number"><a href="#L1307">1307</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize coverage if running with --coverage flag</div>
  </div>
  <div class="line not-covered" id="L1308">
    <div class="line-number"><a href="#L1308">1308</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local coverage_init_success = true</div>
  </div>
  <div class="line not-covered" id="L1309">
    <div class="line-number"><a href="#L1309">1309</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local coverage = nil</div>
  </div>
  <div class="line not-executable" id="L1310">
    <div class="line-number"><a href="#L1310">1310</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1311">
    <div class="line-number"><a href="#L1311">1311</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try to load the central configuration</div>
  </div>
  <div class="line not-covered" id="L1312">
    <div class="line-number"><a href="#L1312">1312</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local central_config</div>
  </div>
  <div class="line not-covered" id="L1313">
    <div class="line-number"><a href="#L1313">1313</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local central_config_loaded, central_config_result = pcall(require, &quot;lib.core.central_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L1314">
    <div class="line-number"><a href="#L1314">1314</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if central_config_loaded then</div>
  </div>
  <div class="line not-covered" id="L1315">
    <div class="line-number"><a href="#L1315">1315</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    central_config = central_config_result</div>
  </div>
  <div class="line not-covered" id="L1316">
    <div class="line-number"><a href="#L1316">1316</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Central configuration loaded successfully&quot;)</div>
  </div>
  <div class="line not-executable" id="L1317">
    <div class="line-number"><a href="#L1317">1317</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1318">
    <div class="line-number"><a href="#L1318">1318</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try to load from .firmo-config.lua if it exists</div>
  </div>
  <div class="line not-covered" id="L1319">
    <div class="line-number"><a href="#L1319">1319</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if fs.file_exists(&quot;.firmo-config.lua&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1320">
    <div class="line-number"><a href="#L1320">1320</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local config_loaded, config_err = central_config.load_from_file(&quot;.firmo-config.lua&quot;)</div>
  </div>
  <div class="line not-covered" id="L1321">
    <div class="line-number"><a href="#L1321">1321</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_loaded then</div>
  </div>
  <div class="line not-covered" id="L1322">
    <div class="line-number"><a href="#L1322">1322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.info(&quot;Loaded configuration from .firmo-config.lua&quot;)</div>
  </div>
  <div class="line not-covered" id="L1323">
    <div class="line-number"><a href="#L1323">1323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L1324">
    <div class="line-number"><a href="#L1324">1324</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.warn(&quot;Failed to load .firmo-config.lua&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1325">
    <div class="line-number"><a href="#L1325">1325</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          error = error_handler.format_error(config_err)</div>
  </div>
  <div class="line not-covered" id="L1326">
    <div class="line-number"><a href="#L1326">1326</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1327">
    <div class="line-number"><a href="#L1327">1327</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1328">
    <div class="line-number"><a href="#L1328">1328</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1329">
    <div class="line-number"><a href="#L1329">1329</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L1330">
    <div class="line-number"><a href="#L1330">1330</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Central configuration module not available&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1331">
    <div class="line-number"><a href="#L1331">1331</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = error_handler.format_error(central_config_result)</div>
  </div>
  <div class="line not-covered" id="L1332">
    <div class="line-number"><a href="#L1332">1332</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1333">
    <div class="line-number"><a href="#L1333">1333</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1334">
    <div class="line-number"><a href="#L1334">1334</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1335">
    <div class="line-number"><a href="#L1335">1335</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.coverage then</div>
  </div>
  <div class="line not-executable" id="L1336">
    <div class="line-number"><a href="#L1336">1336</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Load coverage module</div>
  </div>
  <div class="line not-covered" id="L1337">
    <div class="line-number"><a href="#L1337">1337</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local coverage_loaded</div>
  </div>
  <div class="line not-covered" id="L1338">
    <div class="line-number"><a href="#L1338">1338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage_loaded, coverage = pcall(require, &quot;lib.coverage&quot;)</div>
  </div>
  <div class="line not-executable" id="L1339">
    <div class="line-number"><a href="#L1339">1339</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1340">
    <div class="line-number"><a href="#L1340">1340</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not coverage_loaded then</div>
  </div>
  <div class="line not-covered" id="L1341">
    <div class="line-number"><a href="#L1341">1341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Failed to load coverage module&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1342">
    <div class="line-number"><a href="#L1342">1342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = error_handler.format_error(coverage)</div>
  </div>
  <div class="line not-covered" id="L1343">
    <div class="line-number"><a href="#L1343">1343</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L1344">
    <div class="line-number"><a href="#L1344">1344</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line not-covered" id="L1345">
    <div class="line-number"><a href="#L1345">1345</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1346">
    <div class="line-number"><a href="#L1346">1346</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1347">
    <div class="line-number"><a href="#L1347">1347</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Initialize and start coverage tracking</div>
  </div>
  <div class="line not-covered" id="L1348">
    <div class="line-number"><a href="#L1348">1348</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local ok, err = pcall(function()</div>
  </div>
  <div class="line not-executable" id="L1349">
    <div class="line-number"><a href="#L1349">1349</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Build coverage configuration from configuration file and command line options</div>
  </div>
  <div class="line not-covered" id="L1350">
    <div class="line-number"><a href="#L1350">1350</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local coverage_config = {</div>
  </div>
  <div class="line not-covered" id="L1351">
    <div class="line-number"><a href="#L1351">1351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        enabled = true,</div>
  </div>
  <div class="line not-covered" id="L1352">
    <div class="line-number"><a href="#L1352">1352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        full_reset = true,</div>
  </div>
  <div class="line not-covered" id="L1353">
    <div class="line-number"><a href="#L1353">1353</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        debug = options.coverage_debug == true,</div>
  </div>
  <div class="line not-covered" id="L1354">
    <div class="line-number"><a href="#L1354">1354</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        discover_uncovered = options.discover_uncovered ~= false,</div>
  </div>
  <div class="line not-covered" id="L1355">
    <div class="line-number"><a href="#L1355">1355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        threshold = options.threshold or 80</div>
  </div>
  <div class="line not-covered" id="L1356">
    <div class="line-number"><a href="#L1356">1356</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-executable" id="L1357">
    <div class="line-number"><a href="#L1357">1357</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1358">
    <div class="line-number"><a href="#L1358">1358</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Apply config from central configuration if available</div>
  </div>
  <div class="line not-covered" id="L1359">
    <div class="line-number"><a href="#L1359">1359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if central_config then</div>
  </div>
  <div class="line not-covered" id="L1360">
    <div class="line-number"><a href="#L1360">1360</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local file_config = central_config.get(&quot;coverage&quot;, {})</div>
  </div>
  <div class="line not-executable" id="L1361">
    <div class="line-number"><a href="#L1361">1361</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1362">
    <div class="line-number"><a href="#L1362">1362</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Merge include/exclude from config file</div>
  </div>
  <div class="line not-covered" id="L1363">
    <div class="line-number"><a href="#L1363">1363</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if file_config.include then </div>
  </div>
  <div class="line not-covered" id="L1364">
    <div class="line-number"><a href="#L1364">1364</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          coverage_config.include = file_config.include</div>
  </div>
  <div class="line not-covered" id="L1365">
    <div class="line-number"><a href="#L1365">1365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1366">
    <div class="line-number"><a href="#L1366">1366</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1367">
    <div class="line-number"><a href="#L1367">1367</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if file_config.exclude then</div>
  </div>
  <div class="line not-covered" id="L1368">
    <div class="line-number"><a href="#L1368">1368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          coverage_config.exclude = file_config.exclude</div>
  </div>
  <div class="line not-covered" id="L1369">
    <div class="line-number"><a href="#L1369">1369</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1370">
    <div class="line-number"><a href="#L1370">1370</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L1371">
    <div class="line-number"><a href="#L1371">1371</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Apply other config file settings (but command line options take precedence)</div>
  </div>
  <div class="line not-covered" id="L1372">
    <div class="line-number"><a href="#L1372">1372</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if file_config.track_blocks ~= nil then</div>
  </div>
  <div class="line not-covered" id="L1373">
    <div class="line-number"><a href="#L1373">1373</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          coverage_config.track_blocks = file_config.track_blocks</div>
  </div>
  <div class="line not-covered" id="L1374">
    <div class="line-number"><a href="#L1374">1374</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1375">
    <div class="line-number"><a href="#L1375">1375</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1376">
    <div class="line-number"><a href="#L1376">1376</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if file_config.use_static_analysis ~= nil then</div>
  </div>
  <div class="line not-covered" id="L1377">
    <div class="line-number"><a href="#L1377">1377</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          coverage_config.use_static_analysis = file_config.use_static_analysis</div>
  </div>
  <div class="line not-covered" id="L1378">
    <div class="line-number"><a href="#L1378">1378</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1379">
    <div class="line-number"><a href="#L1379">1379</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1380">
    <div class="line-number"><a href="#L1380">1380</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if file_config.auto_fix_block_relationships ~= nil then</div>
  </div>
  <div class="line not-covered" id="L1381">
    <div class="line-number"><a href="#L1381">1381</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          coverage_config.auto_fix_block_relationships = file_config.auto_fix_block_relationships</div>
  </div>
  <div class="line not-covered" id="L1382">
    <div class="line-number"><a href="#L1382">1382</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1383">
    <div class="line-number"><a href="#L1383">1383</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1384">
    <div class="line-number"><a href="#L1384">1384</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if file_config.track_all_executed ~= nil then</div>
  </div>
  <div class="line not-covered" id="L1385">
    <div class="line-number"><a href="#L1385">1385</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          coverage_config.track_all_executed = file_config.track_all_executed</div>
  </div>
  <div class="line not-covered" id="L1386">
    <div class="line-number"><a href="#L1386">1386</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1387">
    <div class="line-number"><a href="#L1387">1387</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1388">
    <div class="line-number"><a href="#L1388">1388</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if file_config.debug ~= nil and not options.coverage_debug then</div>
  </div>
  <div class="line not-covered" id="L1389">
    <div class="line-number"><a href="#L1389">1389</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          coverage_config.debug = file_config.debug</div>
  </div>
  <div class="line not-covered" id="L1390">
    <div class="line-number"><a href="#L1390">1390</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L1391">
    <div class="line-number"><a href="#L1391">1391</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1392">
    <div class="line-number"><a href="#L1392">1392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.debug(&quot;Applied coverage settings from config file&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1393">
    <div class="line-number"><a href="#L1393">1393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          include_patterns = #(coverage_config.include or {}),</div>
  </div>
  <div class="line not-covered" id="L1394">
    <div class="line-number"><a href="#L1394">1394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          exclude_patterns = #(coverage_config.exclude or {})</div>
  </div>
  <div class="line not-covered" id="L1395">
    <div class="line-number"><a href="#L1395">1395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1396">
    <div class="line-number"><a href="#L1396">1396</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-executable" id="L1397">
    <div class="line-number"><a href="#L1397">1397</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Fallback to reasonable defaults if no config file</div>
  </div>
  <div class="line not-covered" id="L1398">
    <div class="line-number"><a href="#L1398">1398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        coverage_config.include = coverage_config.include or {</div>
  </div>
  <div class="line not-covered" id="L1399">
    <div class="line-number"><a href="#L1399">1399</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;**/*.lua&quot;,     -- All Lua files by default</div>
  </div>
  <div class="line not-covered" id="L1400">
    <div class="line-number"><a href="#L1400">1400</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;lib/**/*.lua&quot;, -- Library code</div>
  </div>
  <div class="line not-covered" id="L1401">
    <div class="line-number"><a href="#L1401">1401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;firmo.lua&quot;     -- Main module</div>
  </div>
  <div class="line not-covered" id="L1402">
    <div class="line-number"><a href="#L1402">1402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        }</div>
  </div>
  <div class="line not-executable" id="L1403">
    <div class="line-number"><a href="#L1403">1403</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1404">
    <div class="line-number"><a href="#L1404">1404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        coverage_config.exclude = coverage_config.exclude or {</div>
  </div>
  <div class="line not-covered" id="L1405">
    <div class="line-number"><a href="#L1405">1405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;**/tests/**/*.lua&quot;, -- Test files</div>
  </div>
  <div class="line not-covered" id="L1406">
    <div class="line-number"><a href="#L1406">1406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;**/test/**/*.lua&quot;,  -- Another test directory</div>
  </div>
  <div class="line not-covered" id="L1407">
    <div class="line-number"><a href="#L1407">1407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;**/*_test.lua&quot;,     -- Test files with suffix</div>
  </div>
  <div class="line not-covered" id="L1408">
    <div class="line-number"><a href="#L1408">1408</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;**/*_spec.lua&quot;      -- Spec files</div>
  </div>
  <div class="line not-covered" id="L1409">
    <div class="line-number"><a href="#L1409">1409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        }</div>
  </div>
  <div class="line not-covered" id="L1410">
    <div class="line-number"><a href="#L1410">1410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1411">
    <div class="line-number"><a href="#L1411">1411</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1412">
    <div class="line-number"><a href="#L1412">1412</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Initialize coverage with the merged configuration</div>
  </div>
  <div class="line not-covered" id="L1413">
    <div class="line-number"><a href="#L1413">1413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      coverage.init(coverage_config)</div>
  </div>
  <div class="line not-covered" id="L1414">
    <div class="line-number"><a href="#L1414">1414</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      coverage.start()</div>
  </div>
  <div class="line not-executable" id="L1415">
    <div class="line-number"><a href="#L1415">1415</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1416">
    <div class="line-number"><a href="#L1416">1416</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Debug output of final configuration</div>
  </div>
  <div class="line not-covered" id="L1417">
    <div class="line-number"><a href="#L1417">1417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.debug(&quot;Coverage initialized with configuration&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1418">
    <div class="line-number"><a href="#L1418">1418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        include_patterns = coverage_config.include and table.concat(coverage_config.include, &quot;, &quot;) or &quot;none&quot;,</div>
  </div>
  <div class="line not-covered" id="L1419">
    <div class="line-number"><a href="#L1419">1419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        exclude_patterns = coverage_config.exclude and table.concat(coverage_config.exclude, &quot;, &quot;) or &quot;none&quot;,</div>
  </div>
  <div class="line not-covered" id="L1420">
    <div class="line-number"><a href="#L1420">1420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        debug_mode = coverage_config.debug</div>
  </div>
  <div class="line not-covered" id="L1421">
    <div class="line-number"><a href="#L1421">1421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L1422">
    <div class="line-number"><a href="#L1422">1422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1423">
    <div class="line-number"><a href="#L1423">1423</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1424">
    <div class="line-number"><a href="#L1424">1424</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not ok then</div>
  </div>
  <div class="line not-covered" id="L1425">
    <div class="line-number"><a href="#L1425">1425</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Failed to initialize or start coverage&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1426">
    <div class="line-number"><a href="#L1426">1426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = error_handler.format_error(err)</div>
  </div>
  <div class="line not-covered" id="L1427">
    <div class="line-number"><a href="#L1427">1427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L1428">
    <div class="line-number"><a href="#L1428">1428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      coverage_init_success = false</div>
  </div>
  <div class="line not-covered" id="L1429">
    <div class="line-number"><a href="#L1429">1429</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L1430">
    <div class="line-number"><a href="#L1430">1430</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;Coverage tracking started successfully&quot;)</div>
  </div>
  <div class="line not-covered" id="L1431">
    <div class="line-number"><a href="#L1431">1431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1432">
    <div class="line-number"><a href="#L1432">1432</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1433">
    <div class="line-number"><a href="#L1433">1433</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Always store coverage in options so it can be passed to both run_file and run_all</div>
  </div>
  <div class="line not-covered" id="L1434">
    <div class="line-number"><a href="#L1434">1434</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    options.coverage_instance = coverage</div>
  </div>
  <div class="line not-covered" id="L1435">
    <div class="line-number"><a href="#L1435">1435</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1436">
    <div class="line-number"><a href="#L1436">1436</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1437">
    <div class="line-number"><a href="#L1437">1437</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if path is a file or directory</div>
  </div>
  <div class="line not-executable" id="L1438">
    <div class="line-number"><a href="#L1438">1438</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- We can automatically detect directories without a flag</div>
  </div>
  <div class="line not-covered" id="L1439">
    <div class="line-number"><a href="#L1439">1439</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local test_success = false</div>
  </div>
  <div class="line not-executable" id="L1440">
    <div class="line-number"><a href="#L1440">1440</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1441">
    <div class="line-number"><a href="#L1441">1441</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if fs.directory_exists(path) then</div>
  </div>
  <div class="line not-executable" id="L1442">
    <div class="line-number"><a href="#L1442">1442</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Run all tests in directory</div>
  </div>
  <div class="line not-covered" id="L1443">
    <div class="line-number"><a href="#L1443">1443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Detected directory path&quot;, { path = path })</div>
  </div>
  <div class="line not-covered" id="L1444">
    <div class="line-number"><a href="#L1444">1444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test_success = runner.run_all(path, firmo, options)</div>
  </div>
  <div class="line not-executable" id="L1445">
    <div class="line-number"><a href="#L1445">1445</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1446">
    <div class="line-number"><a href="#L1446">1446</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- CRITICAL FIX: Ensure test failures cause the process to fail</div>
  </div>
  <div class="line not-covered" id="L1447">
    <div class="line-number"><a href="#L1447">1447</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not test_success then</div>
  </div>
  <div class="line not-covered" id="L1448">
    <div class="line-number"><a href="#L1448">1448</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Test failures detected in directory&quot;, { path = path })</div>
  </div>
  <div class="line not-executable" id="L1449">
    <div class="line-number"><a href="#L1449">1449</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Continue to generate reports, but remember to return false at the end</div>
  </div>
  <div class="line not-covered" id="L1450">
    <div class="line-number"><a href="#L1450">1450</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1451">
    <div class="line-number"><a href="#L1451">1451</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif fs.file_exists(path) then</div>
  </div>
  <div class="line not-executable" id="L1452">
    <div class="line-number"><a href="#L1452">1452</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Run a single test file with the same options (including coverage)</div>
  </div>
  <div class="line not-covered" id="L1453">
    <div class="line-number"><a href="#L1453">1453</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Detected file path&quot;, { path = path })</div>
  </div>
  <div class="line not-covered" id="L1454">
    <div class="line-number"><a href="#L1454">1454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = runner.run_file(path, firmo, options)</div>
  </div>
  <div class="line not-covered" id="L1455">
    <div class="line-number"><a href="#L1455">1455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test_success = result.success and result.errors == 0</div>
  </div>
  <div class="line not-executable" id="L1456">
    <div class="line-number"><a href="#L1456">1456</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1457">
    <div class="line-number"><a href="#L1457">1457</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- CRITICAL FIX: Ensure test failures cause the process to fail</div>
  </div>
  <div class="line not-covered" id="L1458">
    <div class="line-number"><a href="#L1458">1458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not test_success then</div>
  </div>
  <div class="line not-covered" id="L1459">
    <div class="line-number"><a href="#L1459">1459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Test failures detected in file&quot;, { </div>
  </div>
  <div class="line not-covered" id="L1460">
    <div class="line-number"><a href="#L1460">1460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path = path,</div>
  </div>
  <div class="line not-covered" id="L1461">
    <div class="line-number"><a href="#L1461">1461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        success = result.success,</div>
  </div>
  <div class="line not-covered" id="L1462">
    <div class="line-number"><a href="#L1462">1462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        errors = result.errors,</div>
  </div>
  <div class="line not-covered" id="L1463">
    <div class="line-number"><a href="#L1463">1463</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_errors = #(result.test_errors or {})</div>
  </div>
  <div class="line not-covered" id="L1464">
    <div class="line-number"><a href="#L1464">1464</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-executable" id="L1465">
    <div class="line-number"><a href="#L1465">1465</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1466">
    <div class="line-number"><a href="#L1466">1466</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Print specific error details</div>
  </div>
  <div class="line not-covered" id="L1467">
    <div class="line-number"><a href="#L1467">1467</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if result.test_errors and #result.test_errors &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L1468">
    <div class="line-number"><a href="#L1468">1468</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for i, err in ipairs(result.test_errors) do</div>
  </div>
  <div class="line not-covered" id="L1469">
    <div class="line-number"><a href="#L1469">1469</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          logger.error(string.format(&quot;Test error #%d: %s&quot;, i, err.message), {</div>
  </div>
  <div class="line not-covered" id="L1470">
    <div class="line-number"><a href="#L1470">1470</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            test_name = err.test_name,</div>
  </div>
  <div class="line not-covered" id="L1471">
    <div class="line-number"><a href="#L1471">1471</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            file = err.file</div>
  </div>
  <div class="line not-covered" id="L1472">
    <div class="line-number"><a href="#L1472">1472</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L1473">
    <div class="line-number"><a href="#L1473">1473</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1474">
    <div class="line-number"><a href="#L1474">1474</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1475">
    <div class="line-number"><a href="#L1475">1475</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1476">
    <div class="line-number"><a href="#L1476">1476</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Continue to generate reports, but remember to return false at the end</div>
  </div>
  <div class="line not-covered" id="L1477">
    <div class="line-number"><a href="#L1477">1477</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1478">
    <div class="line-number"><a href="#L1478">1478</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-executable" id="L1479">
    <div class="line-number"><a href="#L1479">1479</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Path not found</div>
  </div>
  <div class="line not-covered" id="L1480">
    <div class="line-number"><a href="#L1480">1480</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;Path not found&quot;, { path = path })</div>
  </div>
  <div class="line not-covered" id="L1481">
    <div class="line-number"><a href="#L1481">1481</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1482">
    <div class="line-number"><a href="#L1482">1482</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1483">
    <div class="line-number"><a href="#L1483">1483</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1484">
    <div class="line-number"><a href="#L1484">1484</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Generate coverage reports if needed</div>
  </div>
  <div class="line not-covered" id="L1485">
    <div class="line-number"><a href="#L1485">1485</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local report_success = true</div>
  </div>
  <div class="line not-executable" id="L1486">
    <div class="line-number"><a href="#L1486">1486</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1487">
    <div class="line-number"><a href="#L1487">1487</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.coverage and coverage and coverage_init_success then</div>
  </div>
  <div class="line not-executable" id="L1488">
    <div class="line-number"><a href="#L1488">1488</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Stop coverage tracking</div>
  </div>
  <div class="line not-covered" id="L1489">
    <div class="line-number"><a href="#L1489">1489</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local ok, err = pcall(function()</div>
  </div>
  <div class="line not-covered" id="L1490">
    <div class="line-number"><a href="#L1490">1490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      coverage.stop()</div>
  </div>
  <div class="line not-covered" id="L1491">
    <div class="line-number"><a href="#L1491">1491</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1492">
    <div class="line-number"><a href="#L1492">1492</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1493">
    <div class="line-number"><a href="#L1493">1493</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not ok then</div>
  </div>
  <div class="line not-covered" id="L1494">
    <div class="line-number"><a href="#L1494">1494</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Failed to stop coverage tracking&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1495">
    <div class="line-number"><a href="#L1495">1495</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = error_handler.format_error(err)</div>
  </div>
  <div class="line not-covered" id="L1496">
    <div class="line-number"><a href="#L1496">1496</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L1497">
    <div class="line-number"><a href="#L1497">1497</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      report_success = false</div>
  </div>
  <div class="line not-covered" id="L1498">
    <div class="line-number"><a href="#L1498">1498</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1499">
    <div class="line-number"><a href="#L1499">1499</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1500">
    <div class="line-number"><a href="#L1500">1500</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Get coverage report data</div>
  </div>
  <div class="line not-covered" id="L1501">
    <div class="line-number"><a href="#L1501">1501</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local report_data</div>
  </div>
  <div class="line not-covered" id="L1502">
    <div class="line-number"><a href="#L1502">1502</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    ok, report_data = pcall(function() </div>
  </div>
  <div class="line not-covered" id="L1503">
    <div class="line-number"><a href="#L1503">1503</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return coverage.get_report_data() </div>
  </div>
  <div class="line not-covered" id="L1504">
    <div class="line-number"><a href="#L1504">1504</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1505">
    <div class="line-number"><a href="#L1505">1505</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1506">
    <div class="line-number"><a href="#L1506">1506</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not ok or not report_data then</div>
  </div>
  <div class="line not-covered" id="L1507">
    <div class="line-number"><a href="#L1507">1507</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Failed to get coverage report data&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1508">
    <div class="line-number"><a href="#L1508">1508</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = ok and &quot;No data returned&quot; or error_handler.format_error(report_data)</div>
  </div>
  <div class="line not-covered" id="L1509">
    <div class="line-number"><a href="#L1509">1509</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L1510">
    <div class="line-number"><a href="#L1510">1510</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      report_success = false</div>
  </div>
  <div class="line not-covered" id="L1511">
    <div class="line-number"><a href="#L1511">1511</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L1512">
    <div class="line-number"><a href="#L1512">1512</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Count files in report_data</div>
  </div>
  <div class="line not-covered" id="L1513">
    <div class="line-number"><a href="#L1513">1513</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local file_count = 0</div>
  </div>
  <div class="line not-covered" id="L1514">
    <div class="line-number"><a href="#L1514">1514</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if report_data.files then</div>
  </div>
  <div class="line not-covered" id="L1515">
    <div class="line-number"><a href="#L1515">1515</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _ in pairs(report_data.files) do</div>
  </div>
  <div class="line not-covered" id="L1516">
    <div class="line-number"><a href="#L1516">1516</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          file_count = file_count + 1</div>
  </div>
  <div class="line not-covered" id="L1517">
    <div class="line-number"><a href="#L1517">1517</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1518">
    <div class="line-number"><a href="#L1518">1518</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1519">
    <div class="line-number"><a href="#L1519">1519</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1520">
    <div class="line-number"><a href="#L1520">1520</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if file_count == 0 then</div>
  </div>
  <div class="line not-covered" id="L1521">
    <div class="line-number"><a href="#L1521">1521</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.error(&quot;No files were tracked in coverage data&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1522">
    <div class="line-number"><a href="#L1522">1522</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          operation = &quot;coverage tracking&quot;</div>
  </div>
  <div class="line not-covered" id="L1523">
    <div class="line-number"><a href="#L1523">1523</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1524">
    <div class="line-number"><a href="#L1524">1524</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        report_success = false</div>
  </div>
  <div class="line not-covered" id="L1525">
    <div class="line-number"><a href="#L1525">1525</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-executable" id="L1526">
    <div class="line-number"><a href="#L1526">1526</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Generate reports</div>
  </div>
  <div class="line not-covered" id="L1527">
    <div class="line-number"><a href="#L1527">1527</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local reporting</div>
  </div>
  <div class="line not-covered" id="L1528">
    <div class="line-number"><a href="#L1528">1528</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        ok, reporting = pcall(require, &quot;lib.reporting&quot;)</div>
  </div>
  <div class="line not-executable" id="L1529">
    <div class="line-number"><a href="#L1529">1529</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L1530">
    <div class="line-number"><a href="#L1530">1530</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not ok then</div>
  </div>
  <div class="line not-covered" id="L1531">
    <div class="line-number"><a href="#L1531">1531</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          logger.error(&quot;Failed to load reporting module&quot;)</div>
  </div>
  <div class="line not-covered" id="L1532">
    <div class="line-number"><a href="#L1532">1532</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          report_success = false</div>
  </div>
  <div class="line not-covered" id="L1533">
    <div class="line-number"><a href="#L1533">1533</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L1534">
    <div class="line-number"><a href="#L1534">1534</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Create reports directory</div>
  </div>
  <div class="line not-covered" id="L1535">
    <div class="line-number"><a href="#L1535">1535</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local report_dir = options.report_dir or &quot;./coverage-reports&quot;</div>
  </div>
  <div class="line not-covered" id="L1536">
    <div class="line-number"><a href="#L1536">1536</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          fs.ensure_directory_exists(report_dir)</div>
  </div>
  <div class="line not-executable" id="L1537">
    <div class="line-number"><a href="#L1537">1537</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L1538">
    <div class="line-number"><a href="#L1538">1538</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Generate reports</div>
  </div>
  <div class="line not-covered" id="L1539">
    <div class="line-number"><a href="#L1539">1539</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local formats = options.formats or { &quot;html&quot;, &quot;json&quot;, &quot;lcov&quot;, &quot;cobertura&quot; }</div>
  </div>
  <div class="line not-executable" id="L1540">
    <div class="line-number"><a href="#L1540">1540</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-covered" id="L1541">
    <div class="line-number"><a href="#L1541">1541</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          for _, format in ipairs(formats) do</div>
  </div>
  <div class="line not-covered" id="L1542">
    <div class="line-number"><a href="#L1542">1542</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local report_path = fs.join_paths(report_dir, &quot;coverage-report.&quot; .. format)</div>
  </div>
  <div class="line not-covered" id="L1543">
    <div class="line-number"><a href="#L1543">1543</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local format_success, err = reporting.save_coverage_report(report_path, report_data, format)</div>
  </div>
  <div class="line not-executable" id="L1544">
    <div class="line-number"><a href="#L1544">1544</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L1545">
    <div class="line-number"><a href="#L1545">1545</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if not format_success then</div>
  </div>
  <div class="line not-covered" id="L1546">
    <div class="line-number"><a href="#L1546">1546</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              logger.error(&quot;Failed to generate &quot; .. format .. &quot; report&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1547">
    <div class="line-number"><a href="#L1547">1547</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                error = err and error_handler.format_error(err) or &quot;Unknown error&quot;</div>
  </div>
  <div class="line not-covered" id="L1548">
    <div class="line-number"><a href="#L1548">1548</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              })</div>
  </div>
  <div class="line not-covered" id="L1549">
    <div class="line-number"><a href="#L1549">1549</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              report_success = false</div>
  </div>
  <div class="line not-covered" id="L1550">
    <div class="line-number"><a href="#L1550">1550</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1551">
    <div class="line-number"><a href="#L1551">1551</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-executable" id="L1552">
    <div class="line-number"><a href="#L1552">1552</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L1553">
    <div class="line-number"><a href="#L1553">1553</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Print coverage summary</div>
  </div>
  <div class="line not-covered" id="L1554">
    <div class="line-number"><a href="#L1554">1554</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if report_data.summary then</div>
  </div>
  <div class="line not-executable" id="L1555">
    <div class="line-number"><a href="#L1555">1555</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Calculate actual file counts manually</div>
  </div>
  <div class="line not-covered" id="L1556">
    <div class="line-number"><a href="#L1556">1556</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local file_count = 0</div>
  </div>
  <div class="line not-covered" id="L1557">
    <div class="line-number"><a href="#L1557">1557</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local covered_file_count = 0</div>
  </div>
  <div class="line not-covered" id="L1558">
    <div class="line-number"><a href="#L1558">1558</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local total_lines = 0</div>
  </div>
  <div class="line not-covered" id="L1559">
    <div class="line-number"><a href="#L1559">1559</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local covered_lines = 0</div>
  </div>
  <div class="line not-executable" id="L1560">
    <div class="line-number"><a href="#L1560">1560</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L1561">
    <div class="line-number"><a href="#L1561">1561</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            for file_path, file_data in pairs(report_data.files) do</div>
  </div>
  <div class="line not-covered" id="L1562">
    <div class="line-number"><a href="#L1562">1562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              file_count = file_count + 1</div>
  </div>
  <div class="line not-covered" id="L1563">
    <div class="line-number"><a href="#L1563">1563</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              covered_file_count = covered_file_count + 1  -- All files with data are considered covered</div>
  </div>
  <div class="line not-executable" id="L1564">
    <div class="line-number"><a href="#L1564">1564</a></div>
    <div class="execution-count"></div>    <div class="line-content">              </div>
  </div>
  <div class="line not-executable" id="L1565">
    <div class="line-number"><a href="#L1565">1565</a></div>
    <div class="execution-count"></div>    <div class="line-content">              -- Count lines</div>
  </div>
  <div class="line not-covered" id="L1566">
    <div class="line-number"><a href="#L1566">1566</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              if file_data.lines then</div>
  </div>
  <div class="line not-covered" id="L1567">
    <div class="line-number"><a href="#L1567">1567</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                for line_num, line_data in pairs(file_data.lines) do</div>
  </div>
  <div class="line not-covered" id="L1568">
    <div class="line-number"><a href="#L1568">1568</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  if type(line_data) == &quot;table&quot; and line_data.executable then</div>
  </div>
  <div class="line not-covered" id="L1569">
    <div class="line-number"><a href="#L1569">1569</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    total_lines = total_lines + 1</div>
  </div>
  <div class="line not-covered" id="L1570">
    <div class="line-number"><a href="#L1570">1570</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    if line_data.covered or line_data.executed then</div>
  </div>
  <div class="line not-covered" id="L1571">
    <div class="line-number"><a href="#L1571">1571</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                      covered_lines = covered_lines + 1</div>
  </div>
  <div class="line not-covered" id="L1572">
    <div class="line-number"><a href="#L1572">1572</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                    end</div>
  </div>
  <div class="line not-covered" id="L1573">
    <div class="line-number"><a href="#L1573">1573</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  end</div>
  </div>
  <div class="line not-covered" id="L1574">
    <div class="line-number"><a href="#L1574">1574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L1575">
    <div class="line-number"><a href="#L1575">1575</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              end</div>
  </div>
  <div class="line not-covered" id="L1576">
    <div class="line-number"><a href="#L1576">1576</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-executable" id="L1577">
    <div class="line-number"><a href="#L1577">1577</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-executable" id="L1578">
    <div class="line-number"><a href="#L1578">1578</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Calculate percentages</div>
  </div>
  <div class="line not-covered" id="L1579">
    <div class="line-number"><a href="#L1579">1579</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local file_percent = file_count &gt; 0 and (covered_file_count / file_count * 100) or 0</div>
  </div>
  <div class="line not-covered" id="L1580">
    <div class="line-number"><a href="#L1580">1580</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local line_percent = total_lines &gt; 0 and (covered_lines / total_lines * 100) or 0</div>
  </div>
  <div class="line not-executable" id="L1581">
    <div class="line-number"><a href="#L1581">1581</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-executable" id="L1582">
    <div class="line-number"><a href="#L1582">1582</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Also update the summary values directly to ensure they're consistent everywhere</div>
  </div>
  <div class="line not-covered" id="L1583">
    <div class="line-number"><a href="#L1583">1583</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            report_data.summary.line_coverage_percent = line_percent</div>
  </div>
  <div class="line not-covered" id="L1584">
    <div class="line-number"><a href="#L1584">1584</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            report_data.summary.file_coverage_percent = file_percent</div>
  </div>
  <div class="line not-covered" id="L1585">
    <div class="line-number"><a href="#L1585">1585</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            report_data.summary.overall_coverage_percent = (file_percent + line_percent + (report_data.summary.function_coverage_percent or 0)) / 3</div>
  </div>
  <div class="line not-executable" id="L1586">
    <div class="line-number"><a href="#L1586">1586</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-covered" id="L1587">
    <div class="line-number"><a href="#L1587">1587</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local overall_percent = (file_percent + line_percent + (report_data.summary.function_coverage_percent or 0)) / 3</div>
  </div>
  <div class="line not-executable" id="L1588">
    <div class="line-number"><a href="#L1588">1588</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-executable" id="L1589">
    <div class="line-number"><a href="#L1589">1589</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Print report with manually calculated values</div>
  </div>
  <div class="line not-covered" id="L1590">
    <div class="line-number"><a href="#L1590">1590</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            logger.info(&quot;Coverage summary&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1591">
    <div class="line-number"><a href="#L1591">1591</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              overall = string.format(&quot;%.2f%%&quot;, overall_percent),</div>
  </div>
  <div class="line not-covered" id="L1592">
    <div class="line-number"><a href="#L1592">1592</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              lines = string.format(&quot;%.2f%%&quot;, line_percent),</div>
  </div>
  <div class="line not-covered" id="L1593">
    <div class="line-number"><a href="#L1593">1593</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              functions = string.format(&quot;%.2f%%&quot;, report_data.summary.function_coverage_percent or 0),</div>
  </div>
  <div class="line not-covered" id="L1594">
    <div class="line-number"><a href="#L1594">1594</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              files = string.format(&quot;%.2f%%&quot;, file_percent)</div>
  </div>
  <div class="line not-covered" id="L1595">
    <div class="line-number"><a href="#L1595">1595</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-executable" id="L1596">
    <div class="line-number"><a href="#L1596">1596</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-executable" id="L1597">
    <div class="line-number"><a href="#L1597">1597</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Debug output for manual calculation</div>
  </div>
  <div class="line not-covered" id="L1598">
    <div class="line-number"><a href="#L1598">1598</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            logger.debug(&quot;Manual coverage calculation&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1599">
    <div class="line-number"><a href="#L1599">1599</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              file_count = file_count,</div>
  </div>
  <div class="line not-covered" id="L1600">
    <div class="line-number"><a href="#L1600">1600</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              covered_file_count = covered_file_count,</div>
  </div>
  <div class="line not-covered" id="L1601">
    <div class="line-number"><a href="#L1601">1601</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              total_lines = total_lines,</div>
  </div>
  <div class="line not-covered" id="L1602">
    <div class="line-number"><a href="#L1602">1602</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              covered_lines = covered_lines</div>
  </div>
  <div class="line not-covered" id="L1603">
    <div class="line-number"><a href="#L1603">1603</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L1604">
    <div class="line-number"><a href="#L1604">1604</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L1605">
    <div class="line-number"><a href="#L1605">1605</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1606">
    <div class="line-number"><a href="#L1606">1606</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1607">
    <div class="line-number"><a href="#L1607">1607</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1608">
    <div class="line-number"><a href="#L1608">1608</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1609">
    <div class="line-number"><a href="#L1609">1609</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1610">
    <div class="line-number"><a href="#L1610">1610</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- CRITICAL FIX: Return success only if all operations succeeded AND no test failures</div>
  </div>
  <div class="line not-covered" id="L1611">
    <div class="line-number"><a href="#L1611">1611</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local final_success = test_success and coverage_init_success and report_success</div>
  </div>
  <div class="line not-executable" id="L1612">
    <div class="line-number"><a href="#L1612">1612</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1613">
    <div class="line-number"><a href="#L1613">1613</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add more detailed logging about the exit status</div>
  </div>
  <div class="line not-covered" id="L1614">
    <div class="line-number"><a href="#L1614">1614</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.debug(&quot;Exit status components&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1615">
    <div class="line-number"><a href="#L1615">1615</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test_success = test_success,</div>
  </div>
  <div class="line not-covered" id="L1616">
    <div class="line-number"><a href="#L1616">1616</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage_init_success = coverage_init_success,</div>
  </div>
  <div class="line not-covered" id="L1617">
    <div class="line-number"><a href="#L1617">1617</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    report_success = report_success,</div>
  </div>
  <div class="line not-covered" id="L1618">
    <div class="line-number"><a href="#L1618">1618</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    final_success = final_success</div>
  </div>
  <div class="line not-covered" id="L1619">
    <div class="line-number"><a href="#L1619">1619</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L1620">
    <div class="line-number"><a href="#L1620">1620</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1621">
    <div class="line-number"><a href="#L1621">1621</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add additional debug logging for coverage data if coverage was enabled</div>
  </div>
  <div class="line not-covered" id="L1622">
    <div class="line-number"><a href="#L1622">1622</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.coverage and coverage and coverage_init_success then</div>
  </div>
  <div class="line not-executable" id="L1623">
    <div class="line-number"><a href="#L1623">1623</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if we have report data that includes coverage metrics</div>
  </div>
  <div class="line not-covered" id="L1624">
    <div class="line-number"><a href="#L1624">1624</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local has_report_data = false</div>
  </div>
  <div class="line not-covered" id="L1625">
    <div class="line-number"><a href="#L1625">1625</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local line_coverage_percent = 0</div>
  </div>
  <div class="line not-covered" id="L1626">
    <div class="line-number"><a href="#L1626">1626</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local function_coverage_percent = 0</div>
  </div>
  <div class="line not-covered" id="L1627">
    <div class="line-number"><a href="#L1627">1627</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local file_coverage_percent = 0</div>
  </div>
  <div class="line not-executable" id="L1628">
    <div class="line-number"><a href="#L1628">1628</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1629">
    <div class="line-number"><a href="#L1629">1629</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try to safely extract coverage percentages for validation</div>
  </div>
  <div class="line not-covered" id="L1630">
    <div class="line-number"><a href="#L1630">1630</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, report_data = pcall(function() </div>
  </div>
  <div class="line not-covered" id="L1631">
    <div class="line-number"><a href="#L1631">1631</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return coverage.get_report_data() </div>
  </div>
  <div class="line not-covered" id="L1632">
    <div class="line-number"><a href="#L1632">1632</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1633">
    <div class="line-number"><a href="#L1633">1633</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1634">
    <div class="line-number"><a href="#L1634">1634</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success and report_data and report_data.summary then</div>
  </div>
  <div class="line not-covered" id="L1635">
    <div class="line-number"><a href="#L1635">1635</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      has_report_data = true</div>
  </div>
  <div class="line not-covered" id="L1636">
    <div class="line-number"><a href="#L1636">1636</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_coverage_percent = report_data.summary.line_coverage_percent or 0</div>
  </div>
  <div class="line not-covered" id="L1637">
    <div class="line-number"><a href="#L1637">1637</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      function_coverage_percent = report_data.summary.function_coverage_percent or 0</div>
  </div>
  <div class="line not-covered" id="L1638">
    <div class="line-number"><a href="#L1638">1638</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_coverage_percent = report_data.summary.file_coverage_percent or 0</div>
  </div>
  <div class="line not-covered" id="L1639">
    <div class="line-number"><a href="#L1639">1639</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1640">
    <div class="line-number"><a href="#L1640">1640</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1641">
    <div class="line-number"><a href="#L1641">1641</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Coverage data consistency check&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1642">
    <div class="line-number"><a href="#L1642">1642</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      is_coverage_enabled = options.coverage == true,</div>
  </div>
  <div class="line not-covered" id="L1643">
    <div class="line-number"><a href="#L1643">1643</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      coverage_object_valid = coverage ~= nil,</div>
  </div>
  <div class="line not-covered" id="L1644">
    <div class="line-number"><a href="#L1644">1644</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      is_active = coverage.is_active and coverage.is_active() or false,</div>
  </div>
  <div class="line not-covered" id="L1645">
    <div class="line-number"><a href="#L1645">1645</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      report_success = report_success,</div>
  </div>
  <div class="line not-covered" id="L1646">
    <div class="line-number"><a href="#L1646">1646</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      has_report_data = has_report_data,</div>
  </div>
  <div class="line not-covered" id="L1647">
    <div class="line-number"><a href="#L1647">1647</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_coverage_percent = string.format(&quot;%.2f%%&quot;, line_coverage_percent),</div>
  </div>
  <div class="line not-covered" id="L1648">
    <div class="line-number"><a href="#L1648">1648</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      function_coverage_percent = string.format(&quot;%.2f%%&quot;, function_coverage_percent),</div>
  </div>
  <div class="line not-covered" id="L1649">
    <div class="line-number"><a href="#L1649">1649</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_coverage_percent = string.format(&quot;%.2f%%&quot;, file_coverage_percent)</div>
  </div>
  <div class="line not-covered" id="L1650">
    <div class="line-number"><a href="#L1650">1650</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1651">
    <div class="line-number"><a href="#L1651">1651</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1652">
    <div class="line-number"><a href="#L1652">1652</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1653">
    <div class="line-number"><a href="#L1653">1653</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log a clear error message if tests failed</div>
  </div>
  <div class="line not-covered" id="L1654">
    <div class="line-number"><a href="#L1654">1654</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not test_success then</div>
  </div>
  <div class="line not-covered" id="L1655">
    <div class="line-number"><a href="#L1655">1655</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;TESTS FAILED! Returning non-zero exit code&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1656">
    <div class="line-number"><a href="#L1656">1656</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      reason = &quot;Tests had failures or execution errors&quot;,</div>
  </div>
  <div class="line not-covered" id="L1657">
    <div class="line-number"><a href="#L1657">1657</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      exit_code = 1</div>
  </div>
  <div class="line not-covered" id="L1658">
    <div class="line-number"><a href="#L1658">1658</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1659">
    <div class="line-number"><a href="#L1659">1659</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1660">
    <div class="line-number"><a href="#L1660">1660</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1661">
    <div class="line-number"><a href="#L1661">1661</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return the combined success status</div>
  </div>
  <div class="line not-covered" id="L1662">
    <div class="line-number"><a href="#L1662">1662</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return final_success</div>
  </div>
  <div class="line not-covered" id="L1663">
    <div class="line-number"><a href="#L1663">1663</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1664">
    <div class="line-number"><a href="#L1664">1664</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- If this script is being run directly, execute main function</div>
  </div>
  <div class="line not-covered" id="L1665">
    <div class="line-number"><a href="#L1665">1665</a></div>
    <div class="execution-count">0</div>    <div class="line-content">if arg and arg[0]:match(&quot;runner%.lua$&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1666">
    <div class="line-number"><a href="#L1666">1666</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a clean args table (without script name)</div>
  </div>
  <div class="line not-covered" id="L1667">
    <div class="line-number"><a href="#L1667">1667</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local args = {}</div>
  </div>
  <div class="line not-covered" id="L1668">
    <div class="line-number"><a href="#L1668">1668</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i = 1, #arg do</div>
  </div>
  <div class="line not-covered" id="L1669">
    <div class="line-number"><a href="#L1669">1669</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    args[i] = arg[i]</div>
  </div>
  <div class="line not-covered" id="L1670">
    <div class="line-number"><a href="#L1670">1670</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1671">
    <div class="line-number"><a href="#L1671">1671</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- CRITICAL FIX: Run the main function and always exit with appropriate code</div>
  </div>
  <div class="line not-executable" id="L1672">
    <div class="line-number"><a href="#L1672">1672</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- This ensures test failures are properly propagated to the OS exit code</div>
  </div>
  <div class="line not-covered" id="L1673">
    <div class="line-number"><a href="#L1673">1673</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success = runner.main(args)</div>
  </div>
  <div class="line not-executable" id="L1674">
    <div class="line-number"><a href="#L1674">1674</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1675">
    <div class="line-number"><a href="#L1675">1675</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log the exit code to ensure transparency</div>
  </div>
  <div class="line not-covered" id="L1676">
    <div class="line-number"><a href="#L1676">1676</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Exiting with code&quot;, { </div>
  </div>
  <div class="line not-covered" id="L1677">
    <div class="line-number"><a href="#L1677">1677</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    success = success, </div>
  </div>
  <div class="line not-covered" id="L1678">
    <div class="line-number"><a href="#L1678">1678</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    exit_code = success and 0 or 1,</div>
  </div>
  <div class="line not-covered" id="L1679">
    <div class="line-number"><a href="#L1679">1679</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    reason = success and &quot;All tests passed&quot; or &quot;Test failures detected&quot;</div>
  </div>
  <div class="line not-covered" id="L1680">
    <div class="line-number"><a href="#L1680">1680</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L1681">
    <div class="line-number"><a href="#L1681">1681</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1682">
    <div class="line-number"><a href="#L1682">1682</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Always exit with appropriate code</div>
  </div>
  <div class="line not-covered" id="L1683">
    <div class="line-number"><a href="#L1683">1683</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  os.exit(success and 0 or 1)</div>
  </div>
  <div class="line not-covered" id="L1684">
    <div class="line-number"><a href="#L1684">1684</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L1685">
    <div class="line-number"><a href="#L1685">1685</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return runner</div>
  </div>
</div>
<div class="source-code" id="file---lib-coverage-debug-hook-lua">
  <h3>./lib/coverage/debug_hook.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">143 / 391 (36%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 36%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">5 / 5 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 606      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 391      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 5      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 5      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-coverage-debug-hook-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-coverage-debug-hook-lua" value="all" checked>
        All <span class="function-count">5</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-coverage-debug-hook-lua" value="executed">
        Executed <span class="function-count badge-success">5</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-coverage-debug-hook-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-coverage-debug-hook-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-coverage-debug-hook-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-coverage-debug-hook-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-coverage-debug-hook-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">0</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-coverage-debug-hook-lua" value="closure">
        Closure <span class="function-count function-type-closure">5</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-coverage-debug-hook-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>stop <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L375">375-411</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>is_running <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L415">415-417</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>get_coverage_data <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L421">421-430</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>2</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>set_auto_fix_block_relationships <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L435">435-439</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>fix_block_relationships <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L444">444-607</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for debug_hook.lua    const tableId = 'functions---lib-coverage-debug-hook-lua';
    const searchId = 'func-search---lib-coverage-debug-hook-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-coverage-debug-hook-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-coverage-debug-hook-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-coverage-debug-hook-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-coverage-debug-hook-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class CoverageDebugHook</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field start fun(coverage_data: table): boolean Starts the debug hook</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field stop fun(): boolean Stops the debug hook</div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_running fun(): boolean Checks if the debug hook is running</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_coverage_data fun(): table|nil Returns the current coverage data</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field fix_block_relationships fun(): {files_processed: number, relationships_fixed: number, pending_relationships_resolved: number} Fixes inconsistent parent-child relationships in block tracking</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field set_auto_fix_block_relationships fun(enabled: boolean): boolean Sets whether to automatically fix block relationships on stop</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field _VERSION string Version of this module</div>
  </div>
  <div class="line not-covered" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local M = {}</div>
  </div>
  <div class="line not-executable" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dependencies</div>
  </div>
  <div class="line not-covered" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local error_handler = require(&quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line not-covered" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local logger = require(&quot;lib.tools.logging&quot;)</div>
  </div>
  <div class="line not-covered" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local data_structure = require(&quot;lib.coverage.data_structure&quot;)</div>
  </div>
  <div class="line not-covered" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local central_config = require(&quot;lib.core.central_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local fs = require(&quot;lib.tools.filesystem&quot;)</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Version</div>
  </div>
  <div class="line not-covered" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M._VERSION = &quot;0.1.0&quot;</div>
  </div>
  <div class="line not-executable" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Module state</div>
  </div>
  <div class="line not-covered" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local hook_active = false</div>
  </div>
  <div class="line not-covered" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local original_hook = nil</div>
  </div>
  <div class="line not-covered" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local coverage_data = nil</div>
  </div>
  <div class="line not-covered" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local file_cache = {}</div>
  </div>
  <div class="line not-covered" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local tracked_files_log = nil</div>
  </div>
  <div class="line not-covered" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local auto_fix_block_relationships = true -- Enabled by default</div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Default configuration used when central_config is not available</div>
  </div>
  <div class="line not-covered" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local default_config = {</div>
  </div>
  <div class="line not-covered" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  coverage = {</div>
  </div>
  <div class="line not-covered" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    track_all_executed = true,</div>
  </div>
  <div class="line not-covered" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    include = {&quot;**/*.lua&quot;},</div>
  </div>
  <div class="line not-covered" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    exclude = {}</div>
  </div>
  <div class="line not-covered" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-covered" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Configuration cache to avoid repetitive warnings</div>
  </div>
  <div class="line not-covered" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local config_cache = nil</div>
  </div>
  <div class="line not-executable" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Gets configuration settings safely, falling back to defaults if needed</div>
  </div>
  <div class="line not-executable" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table config The configuration table</div>
  </div>
  <div class="line not-covered" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_safe_config()</div>
  </div>
  <div class="line not-executable" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return cached config if available</div>
  </div>
  <div class="line not-covered" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config_cache then</div>
  </div>
  <div class="line not-covered" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return config_cache</div>
  </div>
  <div class="line not-covered" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try to get configuration from central_config</div>
  </div>
  <div class="line not-covered" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, result = pcall(function() </div>
  </div>
  <div class="line not-covered" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if central_config and type(central_config.get_config) == &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return central_config.get_config() </div>
  </div>
  <div class="line not-covered" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line not-executable" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If successful and returned a table, use it</div>
  </div>
  <div class="line not-covered" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if success and type(result) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config_cache = result</div>
  </div>
  <div class="line not-covered" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log warning once (not cached, so will only log once)</div>
  </div>
  <div class="line not-covered" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not config_cache then</div>
  </div>
  <div class="line not-covered" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Failed to load central configuration, using default settings&quot;, {</div>
  </div>
  <div class="line not-covered" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = success and &quot;No configuration returned&quot; or tostring(result)</div>
  </div>
  <div class="line not-covered" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Cache the default to avoid repeated warnings</div>
  </div>
  <div class="line not-covered" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config_cache = default_config</div>
  </div>
  <div class="line not-covered" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return default_config</div>
  </div>
  <div class="line not-covered" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Determines if a file should be tracked for coverage</div>
  </div>
  <div class="line not-executable" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The file path to check</div>
  </div>
  <div class="line not-executable" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean should_track Whether the file should be tracked</div>
  </div>
  <div class="line not-covered" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function should_track_file(file_path)</div>
  </div>
  <div class="line not-covered" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_path then</div>
  </div>
  <div class="line not-covered" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = data_structure.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get configuration safely</div>
  </div>
  <div class="line not-covered" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local config = get_safe_config()</div>
  </div>
  <div class="line not-executable" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if the file should be tracked based on configuration</div>
  </div>
  <div class="line not-covered" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.coverage then</div>
  </div>
  <div class="line not-executable" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If track_all_executed is enabled, check file extension</div>
  </div>
  <div class="line not-covered" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if config.coverage.track_all_executed and normalized_path:match(&quot;%.lua$&quot;) then</div>
  </div>
  <div class="line not-executable" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Check exclude patterns first</div>
  </div>
  <div class="line not-covered" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local should_exclude = false</div>
  </div>
  <div class="line not-covered" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(config.coverage.exclude) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _, pattern in ipairs(config.coverage.exclude) do</div>
  </div>
  <div class="line not-executable" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Convert glob patterns to Lua patterns</div>
  </div>
  <div class="line not-covered" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local lua_pattern = pattern:gsub(&quot;%*%*&quot;, &quot;.*&quot;):gsub(&quot;%*&quot;, &quot;[^/]*&quot;):gsub(&quot;%-&quot;, &quot;%%-&quot;):gsub(&quot;%(&quot;, &quot;%%(&quot;):gsub(&quot;%)&quot;, &quot;%%)&quot;)</div>
  </div>
  <div class="line not-covered" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if normalized_path:match(lua_pattern) then</div>
  </div>
  <div class="line not-covered" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            should_exclude = true</div>
  </div>
  <div class="line not-covered" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            break</div>
  </div>
  <div class="line not-covered" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If excluded, don't track</div>
  </div>
  <div class="line not-covered" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if should_exclude then</div>
  </div>
  <div class="line not-covered" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false</div>
  </div>
  <div class="line not-covered" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Not excluded and track_all_executed is enabled, so include</div>
  </div>
  <div class="line not-covered" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return true</div>
  </div>
  <div class="line not-covered" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Otherwise check include/exclude patterns if available</div>
  </div>
  <div class="line not-executable" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check include patterns</div>
  </div>
  <div class="line not-covered" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local should_include = false</div>
  </div>
  <div class="line not-covered" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(config.coverage.include) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, pattern in ipairs(config.coverage.include) do</div>
  </div>
  <div class="line not-executable" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Convert glob patterns to Lua patterns</div>
  </div>
  <div class="line not-covered" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local lua_pattern = pattern:gsub(&quot;%*%*&quot;, &quot;.*&quot;):gsub(&quot;%*&quot;, &quot;[^/]*&quot;):gsub(&quot;%-&quot;, &quot;%%-&quot;):gsub(&quot;%(&quot;, &quot;%%(&quot;):gsub(&quot;%)&quot;, &quot;%%)&quot;)</div>
  </div>
  <div class="line not-covered" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if normalized_path:match(lua_pattern) then</div>
  </div>
  <div class="line not-covered" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          should_include = true</div>
  </div>
  <div class="line not-covered" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          break</div>
  </div>
  <div class="line not-covered" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If not included by any pattern, don't track</div>
  </div>
  <div class="line not-covered" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not should_include then</div>
  </div>
  <div class="line not-covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line not-covered" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check exclude patterns</div>
  </div>
  <div class="line not-covered" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(config.coverage.exclude) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, pattern in ipairs(config.coverage.exclude) do</div>
  </div>
  <div class="line not-executable" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Convert glob patterns to Lua patterns</div>
  </div>
  <div class="line not-covered" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local lua_pattern = pattern:gsub(&quot;%*%*&quot;, &quot;.*&quot;):gsub(&quot;%*&quot;, &quot;[^/]*&quot;):gsub(&quot;%-&quot;, &quot;%%-&quot;):gsub(&quot;%(&quot;, &quot;%%(&quot;):gsub(&quot;%)&quot;, &quot;%%)&quot;)</div>
  </div>
  <div class="line not-covered" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if normalized_path:match(lua_pattern) then</div>
  </div>
  <div class="line not-covered" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          return false</div>
  </div>
  <div class="line not-covered" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If we've reached here, the file should be tracked</div>
  </div>
  <div class="line not-covered" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return should_include</div>
  </div>
  <div class="line not-covered" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- By default, don't track</div>
  </div>
  <div class="line not-covered" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return false</div>
  </div>
  <div class="line not-covered" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Gets the source code for a file, caching the result</div>
  </div>
  <div class="line not-executable" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The file path</div>
  </div>
  <div class="line not-executable" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string|nil source_code The source code content or nil if not found</div>
  </div>
  <div class="line not-executable" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil error Error information if failed</div>
  </div>
  <div class="line not-covered" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_file_source(file_path)</div>
  </div>
  <div class="line not-executable" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check cache first</div>
  </div>
  <div class="line not-covered" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if file_cache[file_path] then</div>
  </div>
  <div class="line not-covered" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return file_cache[file_path]</div>
  </div>
  <div class="line not-covered" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Read the file content</div>
  </div>
  <div class="line not-covered" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local content, err = error_handler.safe_io_operation(</div>
  </div>
  <div class="line not-covered" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    function() return fs.read_file(file_path) end,</div>
  </div>
  <div class="line not-covered" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_path,</div>
  </div>
  <div class="line not-covered" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    {operation = &quot;read_source_file&quot;}</div>
  </div>
  <div class="line not-covered" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  )</div>
  </div>
  <div class="line not-executable" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not content then</div>
  </div>
  <div class="line not-covered" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Failed to read source file&quot;, {</div>
  </div>
  <div class="line not-covered" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = file_path,</div>
  </div>
  <div class="line not-covered" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = error_handler.format_error(err)</div>
  </div>
  <div class="line not-covered" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, err</div>
  </div>
  <div class="line not-covered" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Cache the content</div>
  </div>
  <div class="line not-covered" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  file_cache[file_path] = content</div>
  </div>
  <div class="line not-executable" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return content</div>
  </div>
  <div class="line not-covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Initializes coverage for a file if not already tracked</div>
  </div>
  <div class="line not-executable" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The file path</div>
  </div>
  <div class="line not-executable" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether initialization succeeded</div>
  </div>
  <div class="line not-covered" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function ensure_file_tracked(file_path)</div>
  </div>
  <div class="line not-covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_path or not should_track_file(file_path) then</div>
  </div>
  <div class="line not-covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = data_structure.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if file is already initialized</div>
  </div>
  <div class="line not-covered" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if data_structure.get_file_data(coverage_data, normalized_path) then</div>
  </div>
  <div class="line not-covered" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the source code</div>
  </div>
  <div class="line not-covered" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local source_code, err = get_file_source(file_path)</div>
  </div>
  <div class="line not-covered" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not source_code then</div>
  </div>
  <div class="line not-covered" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Failed to initialize coverage for file&quot;, {</div>
  </div>
  <div class="line not-covered" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = err and error_handler.format_error(err) or &quot;Unknown error&quot;</div>
  </div>
  <div class="line not-covered" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize coverage data for the file</div>
  </div>
  <div class="line not-covered" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  data_structure.initialize_file(coverage_data, normalized_path, source_code)</div>
  </div>
  <div class="line not-executable" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.debug(&quot;Initialized coverage tracking for file&quot;, {</div>
  </div>
  <div class="line not-covered" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_path = normalized_path</div>
  </div>
  <div class="line not-covered" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Map to track active functions </div>
  </div>
  <div class="line not-covered" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local active_functions = {}</div>
  </div>
  <div class="line not-executable" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- The debug hook function that tracks line executions and function calls</div>
  </div>
  <div class="line not-executable" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param event string The debug event (e.g., &quot;line&quot;, &quot;call&quot;, &quot;return&quot;)</div>
  </div>
  <div class="line not-executable" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param line number The line number for line events</div>
  </div>
  <div class="line not-covered" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function debug_hook_function(event, line)</div>
  </div>
  <div class="line not-executable" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Call the original hook if it exists</div>
  </div>
  <div class="line not-covered" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if original_hook then</div>
  </div>
  <div class="line not-covered" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    original_hook(event, line)</div>
  </div>
  <div class="line not-covered" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get information about the current execution</div>
  </div>
  <div class="line not-covered" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local info = debug.getinfo(2, &quot;Sln&quot;) -- 'S' for source, 'l' for line info, 'n' for name</div>
  </div>
  <div class="line not-covered" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not info or not info.source then</div>
  </div>
  <div class="line not-covered" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return</div>
  </div>
  <div class="line not-covered" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Skip files loaded from memory (no actual file path)</div>
  </div>
  <div class="line not-covered" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if info.source:sub(1, 1) ~= &quot;@&quot; then</div>
  </div>
  <div class="line not-covered" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return</div>
  </div>
  <div class="line not-covered" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Extract the file path</div>
  </div>
  <div class="line not-covered" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local file_path = info.source:sub(2)  -- Remove the leading &quot;@&quot;</div>
  </div>
  <div class="line not-executable" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Record file paths for debugging</div>
  </div>
  <div class="line not-covered" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if event == &quot;line&quot; and not tracked_files_log then</div>
  </div>
  <div class="line not-covered" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local debug_file = io.open(&quot;coverage_debug.log&quot;, &quot;w&quot;)</div>
  </div>
  <div class="line not-covered" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if debug_file then</div>
  </div>
  <div class="line not-covered" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:write(&quot;Debug Hook Tracking Information\n&quot;)</div>
  </div>
  <div class="line not-covered" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:write(&quot;==============================\n\n&quot;)</div>
  </div>
  <div class="line not-covered" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:close()</div>
  </div>
  <div class="line not-covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      tracked_files_log = {}</div>
  </div>
  <div class="line not-covered" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Track unique files for debugging</div>
  </div>
  <div class="line not-covered" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if event == &quot;line&quot; and tracked_files_log and not tracked_files_log[file_path] then</div>
  </div>
  <div class="line not-covered" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    tracked_files_log[file_path] = true</div>
  </div>
  <div class="line not-covered" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local track_status = should_track_file(file_path) and &quot;YES&quot; or &quot;NO&quot;</div>
  </div>
  <div class="line not-covered" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local debug_file = io.open(&quot;coverage_debug.log&quot;, &quot;a&quot;)</div>
  </div>
  <div class="line not-covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if debug_file then</div>
  </div>
  <div class="line not-covered" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:write(string.format(&quot;File: %s\n&quot;, file_path))</div>
  </div>
  <div class="line not-covered" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:write(string.format(&quot;Should track: %s\n&quot;, track_status))</div>
  </div>
  <div class="line not-covered" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:write(string.format(&quot;Current event: %s\n&quot;, event))</div>
  </div>
  <div class="line not-covered" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:write(string.format(&quot;Current line: %d\n\n&quot;, line))</div>
  </div>
  <div class="line not-covered" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:close()</div>
  </div>
  <div class="line not-covered" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Skip files that shouldn't be tracked</div>
  </div>
  <div class="line not-covered" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not should_track_file(file_path) then</div>
  </div>
  <div class="line not-covered" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return</div>
  </div>
  <div class="line not-covered" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Ensure file is initialized in coverage data</div>
  </div>
  <div class="line not-covered" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not ensure_file_tracked(file_path) then</div>
  </div>
  <div class="line not-covered" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return</div>
  </div>
  <div class="line not-covered" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Process based on event type</div>
  </div>
  <div class="line not-covered" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if event == &quot;line&quot; then</div>
  </div>
  <div class="line not-executable" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Debug line execution tracking</div>
  </div>
  <div class="line not-covered" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local debug_file = io.open(&quot;coverage_execution.log&quot;, &quot;a&quot;)</div>
  </div>
  <div class="line not-covered" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if debug_file then</div>
  </div>
  <div class="line not-covered" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:write(string.format(&quot;EXECUTING: %s:%d\n&quot;, file_path, line))</div>
  </div>
  <div class="line not-covered" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug_file:close()</div>
  </div>
  <div class="line not-covered" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Mark the current line as executed</div>
  </div>
  <div class="line not-covered" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data_structure.mark_line_executed(coverage_data, file_path, line)</div>
  </div>
  <div class="line not-executable" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif event == &quot;call&quot; then</div>
  </div>
  <div class="line not-executable" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Extract function information</div>
  </div>
  <div class="line not-covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local name = info.name or &quot;anonymous&quot;</div>
  </div>
  <div class="line not-covered" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local func_type = data_structure.FUNCTION_TYPES.ANONYMOUS</div>
  </div>
  <div class="line not-executable" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Determine function type</div>
  </div>
  <div class="line not-covered" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if info.name then</div>
  </div>
  <div class="line not-covered" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if info.namewhat == &quot;global&quot; then</div>
  </div>
  <div class="line not-covered" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        func_type = data_structure.FUNCTION_TYPES.GLOBAL</div>
  </div>
  <div class="line not-covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif info.namewhat == &quot;local&quot; then</div>
  </div>
  <div class="line not-covered" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        func_type = data_structure.FUNCTION_TYPES.LOCAL</div>
  </div>
  <div class="line not-covered" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif info.namewhat == &quot;method&quot; then</div>
  </div>
  <div class="line not-covered" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        func_type = data_structure.FUNCTION_TYPES.METHOD</div>
  </div>
  <div class="line not-covered" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        func_type = data_structure.FUNCTION_TYPES.CLOSURE</div>
  </div>
  <div class="line not-covered" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Create a function ID for tracking</div>
  </div>
  <div class="line not-covered" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local start_line = info.linedefined</div>
  </div>
  <div class="line not-covered" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local end_line = info.lastlinedefined</div>
  </div>
  <div class="line not-covered" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local func_id = name .. &quot;:&quot; .. start_line .. &quot;-&quot; .. end_line</div>
  </div>
  <div class="line not-executable" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Register the function if not already registered</div>
  </div>
  <div class="line not-covered" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data_structure.register_function(</div>
  </div>
  <div class="line not-covered" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      coverage_data,</div>
  </div>
  <div class="line not-covered" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path,</div>
  </div>
  <div class="line not-covered" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      name,</div>
  </div>
  <div class="line not-covered" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      start_line,</div>
  </div>
  <div class="line not-covered" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end_line,</div>
  </div>
  <div class="line not-covered" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_type</div>
  </div>
  <div class="line not-covered" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    )</div>
  </div>
  <div class="line not-executable" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Mark function as executed and track it as active</div>
  </div>
  <div class="line not-covered" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data_structure.mark_function_executed(coverage_data, file_path, func_id)</div>
  </div>
  <div class="line not-executable" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Remember this function is active at this level</div>
  </div>
  <div class="line not-covered" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local level = 2  -- The function that was called (skipping the debug hook itself)</div>
  </div>
  <div class="line not-covered" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    active_functions[level] = {</div>
  </div>
  <div class="line not-covered" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = file_path,</div>
  </div>
  <div class="line not-covered" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_id = func_id</div>
  </div>
  <div class="line not-covered" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    }</div>
  </div>
  <div class="line not-executable" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif event == &quot;return&quot; then</div>
  </div>
  <div class="line not-executable" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Function is returning, remove from active functions</div>
  </div>
  <div class="line not-covered" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local level = 2  -- The function that's returning</div>
  </div>
  <div class="line not-covered" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    active_functions[level] = nil</div>
  </div>
  <div class="line not-covered" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Starts the debug hook for coverage tracking</div>
  </div>
  <div class="line not-executable" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param initial_data table Optional existing coverage data to continue from</div>
  </div>
  <div class="line not-executable" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the hook was successfully started</div>
  </div>
  <div class="line not-covered" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.start(initial_data)</div>
  </div>
  <div class="line not-executable" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if hook is already running</div>
  </div>
  <div class="line not-covered" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if hook_active then</div>
  </div>
  <div class="line not-covered" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Debug hook is already running&quot;)</div>
  </div>
  <div class="line not-covered" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize coverage data</div>
  </div>
  <div class="line not-covered" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if initial_data and type(initial_data) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage_data = initial_data</div>
  </div>
  <div class="line not-covered" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    coverage_data = data_structure.create()</div>
  </div>
  <div class="line not-covered" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Store the original hook if any</div>
  </div>
  <div class="line not-covered" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  original_hook = debug.gethook()</div>
  </div>
  <div class="line not-executable" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Set our debug hook to track lines, calls, and returns</div>
  </div>
  <div class="line not-covered" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  debug.sethook(debug_hook_function, &quot;lcr&quot;)</div>
  </div>
  <div class="line not-executable" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Mark as active</div>
  </div>
  <div class="line not-covered" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  hook_active = true</div>
  </div>
  <div class="line not-executable" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Started coverage debug hook&quot;)</div>
  </div>
  <div class="line not-covered" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Stops the debug hook and returns the collected data</div>
  </div>
  <div class="line not-executable" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the hook was successfully stopped</div>
  </div>
  <div class="line not-covered" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.stop()</div>
  </div>
  <div class="line not-executable" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if hook is running</div>
  </div>
  <div class="line not-covered" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not hook_active then</div>
  </div>
  <div class="line not-covered" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Debug hook is not running&quot;)</div>
  </div>
  <div class="line not-covered" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Restore the original hook if any</div>
  </div>
  <div class="line covered" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if original_hook then</div>
  </div>
  <div class="line not-covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    debug.sethook(original_hook, &quot;clr&quot;) -- Ensure we pass the mode</div>
  </div>
  <div class="line not-covered" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    debug.sethook() -- This clears the hook</div>
  </div>
  <div class="line not-covered" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Mark as inactive first to prevent hook from firing during validation</div>
  </div>
  <div class="line covered" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  hook_active = false</div>
  </div>
  <div class="line not-executable" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Calculate coverage summary using the central data structure</div>
  </div>
  <div class="line covered" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if coverage_data then</div>
  </div>
  <div class="line not-executable" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Let the data_structure module handle all calculations</div>
  </div>
  <div class="line not-executable" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Just use calculate_summary, which will ensure consistency</div>
  </div>
  <div class="line covered" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    data_structure.calculate_summary(coverage_data)</div>
  </div>
  <div class="line not-executable" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fix block relationships if auto-fix is enabled</div>
  </div>
  <div class="line covered" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if auto_fix_block_relationships then</div>
  </div>
  <div class="line covered" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local stats = M.fix_block_relationships()</div>
  </div>
  <div class="line covered" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      logger.debug(&quot;Auto-fixed block relationships&quot;, {</div>
  </div>
  <div class="line covered" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        files_processed = stats.files_processed,</div>
  </div>
  <div class="line covered" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        relationships_fixed = stats.relationships_fixed,</div>
  </div>
  <div class="line covered" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        pending_relationships_resolved = stats.pending_relationships_resolved</div>
  </div>
  <div class="line covered" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      })</div>
  </div>
  <div class="line covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.info(&quot;Stopped coverage debug hook&quot;)</div>
  </div>
  <div class="line covered" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line covered" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Checks if the debug hook is currently running</div>
  </div>
  <div class="line not-executable" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean is_running Whether the hook is running</div>
  </div>
  <div class="line covered" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.is_running()</div>
  </div>
  <div class="line covered" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return hook_active</div>
  </div>
  <div class="line covered" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Returns the current coverage data</div>
  </div>
  <div class="line not-executable" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil coverage_data The current coverage data or nil if not available</div>
  </div>
  <div class="line covered" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.get_coverage_data()</div>
  </div>
  <div class="line covered" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not coverage_data then</div>
  </div>
  <div class="line covered" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line covered" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Recalculate summary to ensure it's up to date</div>
  </div>
  <div class="line not-covered" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  data_structure.calculate_summary(coverage_data)</div>
  </div>
  <div class="line not-executable" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return coverage_data</div>
  </div>
  <div class="line covered" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Sets whether to automatically fix block relationships when stopping coverage</div>
  </div>
  <div class="line not-executable" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param enabled boolean Whether to enable automatic fixing</div>
  </div>
  <div class="line not-executable" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Always returns true</div>
  </div>
  <div class="line not-covered" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.set_auto_fix_block_relationships(enabled)</div>
  </div>
  <div class="line not-covered" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  auto_fix_block_relationships = enabled</div>
  </div>
  <div class="line covered" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.debug(&quot;Auto-fix block relationships &quot; .. (enabled and &quot;enabled&quot; or &quot;disabled&quot;))</div>
  </div>
  <div class="line covered" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count">3</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line covered" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Fixes inconsistent parent-child relationships in the block tracking data</div>
  </div>
  <div class="line not-executable" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This ensures that all parent-child references are bi-directional and consistent</div>
  </div>
  <div class="line not-executable" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return {files_processed: number, relationships_fixed: number, pending_relationships_resolved: number} Statistics about the fix operation</div>
  </div>
  <div class="line covered" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count">3</div>    <div class="line-content">function M.fix_block_relationships()</div>
  </div>
  <div class="line not-executable" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize statistics</div>
  </div>
  <div class="line covered" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count">4</div>    <div class="line-content">  local stats = {</div>
  </div>
  <div class="line covered" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    files_processed = 0,</div>
  </div>
  <div class="line not-covered" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    relationships_fixed = 0,</div>
  </div>
  <div class="line not-covered" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pending_relationships_resolved = 0</div>
  </div>
  <div class="line not-covered" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if coverage data exists</div>
  </div>
  <div class="line covered" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not coverage_data or not coverage_data.files then</div>
  </div>
  <div class="line covered" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.debug(&quot;No coverage data available for block relationship fixing&quot;)</div>
  </div>
  <div class="line covered" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return stats</div>
  </div>
  <div class="line covered" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Process each file</div>
  </div>
  <div class="line not-covered" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for file_path, file_data in pairs(coverage_data.files) do</div>
  </div>
  <div class="line not-covered" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    stats.files_processed = stats.files_processed + 1</div>
  </div>
  <div class="line not-executable" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if the file has block data</div>
  </div>
  <div class="line covered" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if not file_data.logical_chunks then</div>
  </div>
  <div class="line covered" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      goto continue</div>
  </div>
  <div class="line covered" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Process pending relationships first</div>
  </div>
  <div class="line covered" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if file_data._pending_child_blocks then</div>
  </div>
  <div class="line covered" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      for parent_id, child_blocks in pairs(file_data._pending_child_blocks) do</div>
  </div>
  <div class="line not-executable" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Check if the parent block now exists</div>
  </div>
  <div class="line covered" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if file_data.logical_chunks[parent_id] then</div>
  </div>
  <div class="line not-executable" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Parent exists, add all children</div>
  </div>
  <div class="line covered" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          file_data.logical_chunks[parent_id].children = file_data.logical_chunks[parent_id].children or {}</div>
  </div>
  <div class="line not-executable" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line covered" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          for _, child_id in ipairs(child_blocks) do</div>
  </div>
  <div class="line not-executable" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Check if child exists</div>
  </div>
  <div class="line covered" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count">12</div>    <div class="line-content">            if file_data.logical_chunks[child_id] then</div>
  </div>
  <div class="line not-executable" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count"></div>    <div class="line-content">              -- Update child's parent_id</div>
  </div>
  <div class="line covered" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              file_data.logical_chunks[child_id].parent_id = parent_id</div>
  </div>
  <div class="line not-executable" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count"></div>    <div class="line-content">              </div>
  </div>
  <div class="line not-executable" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count"></div>    <div class="line-content">              -- Add to parent's children array if not already there</div>
  </div>
  <div class="line covered" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              local already_child = false</div>
  </div>
  <div class="line covered" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              for _, existing_child_id in ipairs(file_data.logical_chunks[parent_id].children) do</div>
  </div>
  <div class="line covered" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                if existing_child_id == child_id then</div>
  </div>
  <div class="line covered" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                  already_child = true</div>
  </div>
  <div class="line covered" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                  break</div>
  </div>
  <div class="line covered" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                end</div>
  </div>
  <div class="line covered" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              end</div>
  </div>
  <div class="line not-executable" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count"></div>    <div class="line-content">              </div>
  </div>
  <div class="line covered" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              if not already_child then</div>
  </div>
  <div class="line covered" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                table.insert(file_data.logical_chunks[parent_id].children, child_id)</div>
  </div>
  <div class="line covered" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                stats.pending_relationships_resolved = stats.pending_relationships_resolved + 1</div>
  </div>
  <div class="line covered" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              end</div>
  </div>
  <div class="line covered" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            end</div>
  </div>
  <div class="line covered" id="L478">
    <div class="line-number"><a href="#L478">478</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line covered" id="L479">
    <div class="line-number"><a href="#L479">479</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L480">
    <div class="line-number"><a href="#L480">480</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L481">
    <div class="line-number"><a href="#L481">481</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L482">
    <div class="line-number"><a href="#L482">482</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Clear pending relationships</div>
  </div>
  <div class="line covered" id="L483">
    <div class="line-number"><a href="#L483">483</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      file_data._pending_child_blocks = {}</div>
  </div>
  <div class="line covered" id="L484">
    <div class="line-number"><a href="#L484">484</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L485">
    <div class="line-number"><a href="#L485">485</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L486">
    <div class="line-number"><a href="#L486">486</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Build a map of blocks by ID for efficient access</div>
  </div>
  <div class="line covered" id="L487">
    <div class="line-number"><a href="#L487">487</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local block_map = {}</div>
  </div>
  <div class="line covered" id="L488">
    <div class="line-number"><a href="#L488">488</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local orphaned_blocks = {}</div>
  </div>
  <div class="line not-executable" id="L489">
    <div class="line-number"><a href="#L489">489</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L490">
    <div class="line-number"><a href="#L490">490</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Initialize block map and identify orphaned blocks</div>
  </div>
  <div class="line covered" id="L491">
    <div class="line-number"><a href="#L491">491</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    for block_id, block_data in pairs(file_data.logical_chunks) do</div>
  </div>
  <div class="line covered" id="L492">
    <div class="line-number"><a href="#L492">492</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      block_map[block_id] = block_data</div>
  </div>
  <div class="line not-executable" id="L493">
    <div class="line-number"><a href="#L493">493</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L494">
    <div class="line-number"><a href="#L494">494</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Initialize children array if it doesn't exist</div>
  </div>
  <div class="line covered" id="L495">
    <div class="line-number"><a href="#L495">495</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      block_data.children = block_data.children or {}</div>
  </div>
  <div class="line not-executable" id="L496">
    <div class="line-number"><a href="#L496">496</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L497">
    <div class="line-number"><a href="#L497">497</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Check for orphaned blocks (has parent_id but parent doesn't exist)</div>
  </div>
  <div class="line covered" id="L498">
    <div class="line-number"><a href="#L498">498</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if block_data.parent_id and block_data.parent_id ~= &quot;root&quot; and not file_data.logical_chunks[block_data.parent_id] then</div>
  </div>
  <div class="line covered" id="L499">
    <div class="line-number"><a href="#L499">499</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        table.insert(orphaned_blocks, block_id)</div>
  </div>
  <div class="line covered" id="L500">
    <div class="line-number"><a href="#L500">500</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L501">
    <div class="line-number"><a href="#L501">501</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L502">
    <div class="line-number"><a href="#L502">502</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L503">
    <div class="line-number"><a href="#L503">503</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Process all block relationships to ensure consistency</div>
  </div>
  <div class="line covered" id="L504">
    <div class="line-number"><a href="#L504">504</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    for block_id, block_data in pairs(file_data.logical_chunks) do</div>
  </div>
  <div class="line not-executable" id="L505">
    <div class="line-number"><a href="#L505">505</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Skip the root block</div>
  </div>
  <div class="line covered" id="L506">
    <div class="line-number"><a href="#L506">506</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if block_id == &quot;root&quot; then goto next_block end</div>
  </div>
  <div class="line not-executable" id="L507">
    <div class="line-number"><a href="#L507">507</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L508">
    <div class="line-number"><a href="#L508">508</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If block has a parent, ensure parent has this block as a child</div>
  </div>
  <div class="line covered" id="L509">
    <div class="line-number"><a href="#L509">509</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if block_data.parent_id and block_data.parent_id ~= &quot;root&quot; then</div>
  </div>
  <div class="line covered" id="L510">
    <div class="line-number"><a href="#L510">510</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        local parent = file_data.logical_chunks[block_data.parent_id]</div>
  </div>
  <div class="line not-executable" id="L511">
    <div class="line-number"><a href="#L511">511</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line covered" id="L512">
    <div class="line-number"><a href="#L512">512</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if parent then</div>
  </div>
  <div class="line not-executable" id="L513">
    <div class="line-number"><a href="#L513">513</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Ensure parent has children array</div>
  </div>
  <div class="line covered" id="L514">
    <div class="line-number"><a href="#L514">514</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          parent.children = parent.children or {}</div>
  </div>
  <div class="line not-executable" id="L515">
    <div class="line-number"><a href="#L515">515</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L516">
    <div class="line-number"><a href="#L516">516</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Check if block is already in parent's children</div>
  </div>
  <div class="line covered" id="L517">
    <div class="line-number"><a href="#L517">517</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          local already_child = false</div>
  </div>
  <div class="line covered" id="L518">
    <div class="line-number"><a href="#L518">518</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          for _, child_id in ipairs(parent.children) do</div>
  </div>
  <div class="line covered" id="L519">
    <div class="line-number"><a href="#L519">519</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            if child_id == block_id then</div>
  </div>
  <div class="line covered" id="L520">
    <div class="line-number"><a href="#L520">520</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              already_child = true</div>
  </div>
  <div class="line covered" id="L521">
    <div class="line-number"><a href="#L521">521</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              break</div>
  </div>
  <div class="line covered" id="L522">
    <div class="line-number"><a href="#L522">522</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            end</div>
  </div>
  <div class="line covered" id="L523">
    <div class="line-number"><a href="#L523">523</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-executable" id="L524">
    <div class="line-number"><a href="#L524">524</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L525">
    <div class="line-number"><a href="#L525">525</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Add to parent's children if not already there</div>
  </div>
  <div class="line covered" id="L526">
    <div class="line-number"><a href="#L526">526</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          if not already_child then</div>
  </div>
  <div class="line covered" id="L527">
    <div class="line-number"><a href="#L527">527</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            table.insert(parent.children, block_id)</div>
  </div>
  <div class="line covered" id="L528">
    <div class="line-number"><a href="#L528">528</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            stats.relationships_fixed = stats.relationships_fixed + 1</div>
  </div>
  <div class="line covered" id="L529">
    <div class="line-number"><a href="#L529">529</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line covered" id="L530">
    <div class="line-number"><a href="#L530">530</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L531">
    <div class="line-number"><a href="#L531">531</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L532">
    <div class="line-number"><a href="#L532">532</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L533">
    <div class="line-number"><a href="#L533">533</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If block has children, ensure each child has this block as parent</div>
  </div>
  <div class="line covered" id="L534">
    <div class="line-number"><a href="#L534">534</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if block_data.children then</div>
  </div>
  <div class="line covered" id="L535">
    <div class="line-number"><a href="#L535">535</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        for _, child_id in ipairs(block_data.children) do</div>
  </div>
  <div class="line covered" id="L536">
    <div class="line-number"><a href="#L536">536</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          local child = file_data.logical_chunks[child_id]</div>
  </div>
  <div class="line not-executable" id="L537">
    <div class="line-number"><a href="#L537">537</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line covered" id="L538">
    <div class="line-number"><a href="#L538">538</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          if child and child.parent_id ~= block_id then</div>
  </div>
  <div class="line covered" id="L539">
    <div class="line-number"><a href="#L539">539</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            child.parent_id = block_id</div>
  </div>
  <div class="line covered" id="L540">
    <div class="line-number"><a href="#L540">540</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            stats.relationships_fixed = stats.relationships_fixed + 1</div>
  </div>
  <div class="line covered" id="L541">
    <div class="line-number"><a href="#L541">541</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line covered" id="L542">
    <div class="line-number"><a href="#L542">542</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L543">
    <div class="line-number"><a href="#L543">543</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L544">
    <div class="line-number"><a href="#L544">544</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line covered" id="L545">
    <div class="line-number"><a href="#L545">545</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      ::next_block::</div>
  </div>
  <div class="line covered" id="L546">
    <div class="line-number"><a href="#L546">546</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L547">
    <div class="line-number"><a href="#L547">547</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L548">
    <div class="line-number"><a href="#L548">548</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle orphaned blocks - connect them to the root</div>
  </div>
  <div class="line covered" id="L549">
    <div class="line-number"><a href="#L549">549</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    for _, block_id in ipairs(orphaned_blocks) do</div>
  </div>
  <div class="line covered" id="L550">
    <div class="line-number"><a href="#L550">550</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local block = file_data.logical_chunks[block_id]</div>
  </div>
  <div class="line covered" id="L551">
    <div class="line-number"><a href="#L551">551</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if block then</div>
  </div>
  <div class="line not-executable" id="L552">
    <div class="line-number"><a href="#L552">552</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Set parent to root</div>
  </div>
  <div class="line covered" id="L553">
    <div class="line-number"><a href="#L553">553</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        block.parent_id = &quot;root&quot;</div>
  </div>
  <div class="line covered" id="L554">
    <div class="line-number"><a href="#L554">554</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        stats.relationships_fixed = stats.relationships_fixed + 1</div>
  </div>
  <div class="line not-executable" id="L555">
    <div class="line-number"><a href="#L555">555</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L556">
    <div class="line-number"><a href="#L556">556</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Add to root's children</div>
  </div>
  <div class="line covered" id="L557">
    <div class="line-number"><a href="#L557">557</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if not file_data.logical_chunks[&quot;root&quot;] then</div>
  </div>
  <div class="line covered" id="L558">
    <div class="line-number"><a href="#L558">558</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          file_data.logical_chunks[&quot;root&quot;] = {</div>
  </div>
  <div class="line covered" id="L559">
    <div class="line-number"><a href="#L559">559</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            id = &quot;root&quot;,</div>
  </div>
  <div class="line covered" id="L560">
    <div class="line-number"><a href="#L560">560</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            type = &quot;root&quot;,</div>
  </div>
  <div class="line covered" id="L561">
    <div class="line-number"><a href="#L561">561</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            children = {}</div>
  </div>
  <div class="line covered" id="L562">
    <div class="line-number"><a href="#L562">562</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          }</div>
  </div>
  <div class="line covered" id="L563">
    <div class="line-number"><a href="#L563">563</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L564">
    <div class="line-number"><a href="#L564">564</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L565">
    <div class="line-number"><a href="#L565">565</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Ensure root has children array</div>
  </div>
  <div class="line covered" id="L566">
    <div class="line-number"><a href="#L566">566</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        file_data.logical_chunks[&quot;root&quot;].children = file_data.logical_chunks[&quot;root&quot;].children or {}</div>
  </div>
  <div class="line not-executable" id="L567">
    <div class="line-number"><a href="#L567">567</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L568">
    <div class="line-number"><a href="#L568">568</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Add orphaned block to root's children</div>
  </div>
  <div class="line covered" id="L569">
    <div class="line-number"><a href="#L569">569</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        table.insert(file_data.logical_chunks[&quot;root&quot;].children, block_id)</div>
  </div>
  <div class="line covered" id="L570">
    <div class="line-number"><a href="#L570">570</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L571">
    <div class="line-number"><a href="#L571">571</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L572">
    <div class="line-number"><a href="#L572">572</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L573">
    <div class="line-number"><a href="#L573">573</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    ::continue::</div>
  </div>
  <div class="line covered" id="L574">
    <div class="line-number"><a href="#L574">574</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L575">
    <div class="line-number"><a href="#L575">575</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L576">
    <div class="line-number"><a href="#L576">576</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log results</div>
  </div>
  <div class="line covered" id="L577">
    <div class="line-number"><a href="#L577">577</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if stats.relationships_fixed &gt; 0 or stats.pending_relationships_resolved &gt; 0 then</div>
  </div>
  <div class="line covered" id="L578">
    <div class="line-number"><a href="#L578">578</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.info(&quot;Block relationships fixed&quot;, {</div>
  </div>
  <div class="line covered" id="L579">
    <div class="line-number"><a href="#L579">579</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      files_processed = stats.files_processed,</div>
  </div>
  <div class="line covered" id="L580">
    <div class="line-number"><a href="#L580">580</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      relationships_fixed = stats.relationships_fixed,</div>
  </div>
  <div class="line covered" id="L581">
    <div class="line-number"><a href="#L581">581</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      pending_relationships_resolved = stats.pending_relationships_resolved</div>
  </div>
  <div class="line covered" id="L582">
    <div class="line-number"><a href="#L582">582</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    })</div>
  </div>
  <div class="line covered" id="L583">
    <div class="line-number"><a href="#L583">583</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  else</div>
  </div>
  <div class="line covered" id="L584">
    <div class="line-number"><a href="#L584">584</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.debug(&quot;No block relationships needed fixing&quot;, {</div>
  </div>
  <div class="line covered" id="L585">
    <div class="line-number"><a href="#L585">585</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      files_processed = stats.files_processed</div>
  </div>
  <div class="line covered" id="L586">
    <div class="line-number"><a href="#L586">586</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    })</div>
  </div>
  <div class="line covered" id="L587">
    <div class="line-number"><a href="#L587">587</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L588">
    <div class="line-number"><a href="#L588">588</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L589">
    <div class="line-number"><a href="#L589">589</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return stats</div>
  </div>
  <div class="line covered" id="L590">
    <div class="line-number"><a href="#L590">590</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L591">
    <div class="line-number"><a href="#L591">591</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Resets the coverage data to a clean state</div>
  </div>
  <div class="line not-executable" id="L592">
    <div class="line-number"><a href="#L592">592</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the reset was successful</div>
  </div>
  <div class="line covered" id="L593">
    <div class="line-number"><a href="#L593">593</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.reset()</div>
  </div>
  <div class="line covered" id="L594">
    <div class="line-number"><a href="#L594">594</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if hook_active then</div>
  </div>
  <div class="line covered" id="L595">
    <div class="line-number"><a href="#L595">595</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.warn(&quot;Cannot reset coverage data while debug hook is running&quot;)</div>
  </div>
  <div class="line covered" id="L596">
    <div class="line-number"><a href="#L596">596</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L597">
    <div class="line-number"><a href="#L597">597</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L598">
    <div class="line-number"><a href="#L598">598</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L599">
    <div class="line-number"><a href="#L599">599</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  coverage_data = data_structure.create()</div>
  </div>
  <div class="line covered" id="L600">
    <div class="line-number"><a href="#L600">600</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  file_cache = {}</div>
  </div>
  <div class="line not-executable" id="L601">
    <div class="line-number"><a href="#L601">601</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L602">
    <div class="line-number"><a href="#L602">602</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.info(&quot;Reset coverage data&quot;)</div>
  </div>
  <div class="line covered" id="L603">
    <div class="line-number"><a href="#L603">603</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line covered" id="L604">
    <div class="line-number"><a href="#L604">604</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line covered" id="L605">
    <div class="line-number"><a href="#L605">605</a></div>
    <div class="execution-count">1</div>    <div class="line-content">return M</div>
  </div>
  <div class="line not-executable" id="L606">
    <div class="line-number"><a href="#L606">606</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 606</div>
  </div>
</div>
<div class="source-code" id="file---lib-coverage-init-lua">
  <h3>./lib/coverage/init.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">72 / 269 (26%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 26%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">3 / 3 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 411      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 269      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 3      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 3      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-coverage-init-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-coverage-init-lua" value="all" checked>
        All <span class="function-count">3</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-coverage-init-lua" value="executed">
        Executed <span class="function-count badge-success">3</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-coverage-init-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-coverage-init-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-coverage-init-lua" value="local">
        Local <span class="function-count function-type-local">1</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-coverage-init-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-coverage-init-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">0</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-coverage-init-lua" value="closure">
        Closure <span class="function-count function-type-closure">2</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-coverage-init-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>stop <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L91">91-147</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>track_file <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L220">220-269</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="local" data-executed="true">
          <td>operation <span class="function-type-badge function-type-local">local</span></td>
          <td>local</td>
          <td><a href="#L252">252-252</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for init.lua    const tableId = 'functions---lib-coverage-init-lua';
    const searchId = 'func-search---lib-coverage-init-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-coverage-init-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-coverage-init-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-coverage-init-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-coverage-init-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class CoverageV2</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field start fun(): boolean Starts coverage tracking</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field stop fun(): boolean Stops coverage tracking</div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field reset fun(): boolean Resets coverage data</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_running fun(): boolean Checks if coverage tracking is running</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_report_data fun(): table|nil Gets coverage data for reporting</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field generate_reports fun(output_dir: string, formats: string[]): boolean, string|nil Generate coverage reports in specified formats</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_available_formats fun(): string[] Gets a list of available report formats</div>
  </div>
  <div class="line not-executable" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field _VERSION string Version of this module</div>
  </div>
  <div class="line not-covered" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local M = {}</div>
  </div>
  <div class="line not-executable" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dependencies</div>
  </div>
  <div class="line not-covered" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local error_handler = require(&quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line not-covered" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local logger = require(&quot;lib.tools.logging&quot;)</div>
  </div>
  <div class="line not-covered" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local central_config = require(&quot;lib.core.central_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local fs = require(&quot;lib.tools.filesystem&quot;)</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Internal modules</div>
  </div>
  <div class="line not-covered" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local debug_hook = require(&quot;lib.coverage.debug_hook&quot;)</div>
  </div>
  <div class="line not-covered" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local data_structure = require(&quot;lib.coverage.data_structure&quot;)</div>
  </div>
  <div class="line not-covered" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local line_classifier = require(&quot;lib.coverage.line_classifier&quot;)</div>
  </div>
  <div class="line not-executable" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Version</div>
  </div>
  <div class="line not-covered" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M._VERSION = &quot;0.1.0&quot;</div>
  </div>
  <div class="line not-executable" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Initializes the coverage module with configuration</div>
  </div>
  <div class="line not-executable" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param config table Configuration table with include/exclude patterns and other settings</div>
  </div>
  <div class="line not-executable" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether initialization was successful</div>
  </div>
  <div class="line not-covered" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.init(config)</div>
  </div>
  <div class="line not-covered" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Initializing coverage module (v2)&quot;)</div>
  </div>
  <div class="line not-executable" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Store configuration in central_config</div>
  </div>
  <div class="line not-covered" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config then</div>
  </div>
  <div class="line not-covered" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(config.debug) == &quot;boolean&quot; then</div>
  </div>
  <div class="line not-covered" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      central_config.set(&quot;coverage.debug&quot;, config.debug)</div>
  </div>
  <div class="line not-covered" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(config.track_all_executed) == &quot;boolean&quot; then</div>
  </div>
  <div class="line not-covered" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      central_config.set(&quot;coverage.track_all_executed&quot;, config.track_all_executed)</div>
  </div>
  <div class="line not-covered" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(config.include) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      central_config.set(&quot;coverage.include&quot;, config.include)</div>
  </div>
  <div class="line not-covered" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(config.exclude) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      central_config.set(&quot;coverage.exclude&quot;, config.exclude)</div>
  </div>
  <div class="line not-covered" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(config.source_dirs) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      central_config.set(&quot;coverage.source_dirs&quot;, config.source_dirs)</div>
  </div>
  <div class="line not-covered" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(config.report_dir) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      central_config.set(&quot;coverage.report_dir&quot;, config.report_dir)</div>
  </div>
  <div class="line not-covered" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(config.auto_fix_block_relationships) == &quot;boolean&quot; then</div>
  </div>
  <div class="line not-covered" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      central_config.set(&quot;coverage.auto_fix_block_relationships&quot;, config.auto_fix_block_relationships)</div>
  </div>
  <div class="line not-covered" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Coverage configuration set&quot;, {</div>
  </div>
  <div class="line not-covered" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      debug = central_config.get(&quot;coverage.debug&quot;),</div>
  </div>
  <div class="line not-covered" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      track_all_executed = central_config.get(&quot;coverage.track_all_executed&quot;),</div>
  </div>
  <div class="line not-covered" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      include_count = #(central_config.get(&quot;coverage.include&quot;) or {}),</div>
  </div>
  <div class="line not-covered" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      exclude_count = #(central_config.get(&quot;coverage.exclude&quot;) or {})</div>
  </div>
  <div class="line not-covered" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Starts coverage tracking</div>
  </div>
  <div class="line not-executable" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether coverage tracking was successfully started</div>
  </div>
  <div class="line not-covered" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.start()</div>
  </div>
  <div class="line not-covered" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.info(&quot;Starting coverage tracking (v2)&quot;)</div>
  </div>
  <div class="line not-executable" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize fresh coverage data</div>
  </div>
  <div class="line not-covered" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success = debug_hook.start()</div>
  </div>
  <div class="line not-executable" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line not-covered" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;Failed to start coverage tracking&quot;)</div>
  </div>
  <div class="line not-covered" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Stops coverage tracking and processes the results</div>
  </div>
  <div class="line not-executable" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether coverage tracking was successfully stopped</div>
  </div>
  <div class="line not-covered" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.stop()</div>
  </div>
  <div class="line covered" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.info(&quot;Stopping coverage tracking (v2)&quot;)</div>
  </div>
  <div class="line not-executable" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if tracking is running</div>
  </div>
  <div class="line not-covered" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not debug_hook.is_running() then</div>
  </div>
  <div class="line not-covered" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Coverage tracking is not running&quot;)</div>
  </div>
  <div class="line covered" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the configuration for auto-fixing block relationships</div>
  </div>
  <div class="line covered" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local auto_fix_blocks = central_config.get(&quot;coverage.auto_fix_block_relationships&quot;)</div>
  </div>
  <div class="line covered" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if auto_fix_blocks ~= nil then</div>
  </div>
  <div class="line not-executable" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Only call set if it's explicitly configured</div>
  </div>
  <div class="line covered" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    debug_hook.set_auto_fix_block_relationships(auto_fix_blocks)</div>
  </div>
  <div class="line covered" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Stop the debug hook (which will auto-fix block relationships if enabled)</div>
  </div>
  <div class="line covered" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local success = debug_hook.stop()</div>
  </div>
  <div class="line covered" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line covered" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.error(&quot;Failed to stop coverage tracking&quot;)</div>
  </div>
  <div class="line covered" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the collected coverage data</div>
  </div>
  <div class="line covered" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local coverage_data = debug_hook.get_coverage_data()</div>
  </div>
  <div class="line covered" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not coverage_data then</div>
  </div>
  <div class="line covered" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.error(&quot;No coverage data available after stopping tracking&quot;)</div>
  </div>
  <div class="line covered" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Process all files to classify lines</div>
  </div>
  <div class="line covered" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for file_path, _ in pairs(coverage_data.files) do</div>
  </div>
  <div class="line covered" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    line_classifier.classify_lines(coverage_data, file_path)</div>
  </div>
  <div class="line covered" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Calculate final summary</div>
  </div>
  <div class="line covered" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  data_structure.calculate_summary(coverage_data)</div>
  </div>
  <div class="line not-executable" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Validate the final data structure</div>
  </div>
  <div class="line covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local is_valid, error_message = data_structure.validate(coverage_data)</div>
  </div>
  <div class="line covered" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not is_valid then</div>
  </div>
  <div class="line covered" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.error(&quot;Coverage data validation failed&quot;, {</div>
  </div>
  <div class="line covered" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      error = error_message</div>
  </div>
  <div class="line covered" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    })</div>
  </div>
  <div class="line covered" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.info(&quot;Coverage tracking stopped successfully&quot;, {</div>
  </div>
  <div class="line covered" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    total_files = coverage_data.summary.total_files,</div>
  </div>
  <div class="line covered" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    executed_files = coverage_data.summary.executed_files,</div>
  </div>
  <div class="line covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    total_lines = coverage_data.summary.total_lines,</div>
  </div>
  <div class="line covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    executed_lines = coverage_data.summary.executed_lines,</div>
  </div>
  <div class="line covered" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    line_coverage_percent = coverage_data.summary.line_coverage_percent .. &quot;%&quot;</div>
  </div>
  <div class="line covered" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line covered" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Resets coverage data</div>
  </div>
  <div class="line not-executable" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the reset was successful</div>
  </div>
  <div class="line covered" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.reset()</div>
  </div>
  <div class="line covered" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return debug_hook.reset()</div>
  </div>
  <div class="line covered" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Checks if coverage tracking is currently running</div>
  </div>
  <div class="line not-executable" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean is_running Whether coverage tracking is running</div>
  </div>
  <div class="line not-covered" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.is_running()</div>
  </div>
  <div class="line not-covered" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return debug_hook.is_running()</div>
  </div>
  <div class="line not-covered" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Gets the current coverage data for reporting</div>
  </div>
  <div class="line not-executable" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil coverage_data The coverage data or nil if not available</div>
  </div>
  <div class="line not-covered" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_report_data()</div>
  </div>
  <div class="line not-executable" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the raw coverage data</div>
  </div>
  <div class="line not-covered" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local coverage_data = debug_hook.get_coverage_data()</div>
  </div>
  <div class="line not-covered" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not coverage_data then</div>
  </div>
  <div class="line not-covered" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return a deep copy to prevent modification</div>
  </div>
  <div class="line not-executable" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- In a real implementation, we would create a deep copy here</div>
  </div>
  <div class="line not-executable" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- For now, we'll just return the data directly</div>
  </div>
  <div class="line not-covered" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return coverage_data</div>
  </div>
  <div class="line not-covered" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Gets all tracked file paths</div>
  </div>
  <div class="line not-executable" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string[] file_paths List of normalized file paths being tracked</div>
  </div>
  <div class="line not-covered" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_tracked_files()</div>
  </div>
  <div class="line not-covered" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local coverage_data = debug_hook.get_coverage_data()</div>
  </div>
  <div class="line not-covered" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not coverage_data then</div>
  </div>
  <div class="line not-covered" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return {}</div>
  </div>
  <div class="line not-covered" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local file_paths = {}</div>
  </div>
  <div class="line not-covered" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for file_path, _ in pairs(coverage_data.files) do</div>
  </div>
  <div class="line not-covered" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(file_paths, file_path)</div>
  </div>
  <div class="line not-covered" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return file_paths</div>
  </div>
  <div class="line not-covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Gets coverage summary</div>
  </div>
  <div class="line not-executable" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil summary Coverage summary statistics or nil if not available</div>
  </div>
  <div class="line not-covered" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_summary()</div>
  </div>
  <div class="line not-covered" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local coverage_data = debug_hook.get_coverage_data()</div>
  </div>
  <div class="line not-covered" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not coverage_data then</div>
  </div>
  <div class="line not-covered" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return coverage_data.summary</div>
  </div>
  <div class="line not-covered" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Gets coverage data for a specific file</div>
  </div>
  <div class="line not-executable" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The file path</div>
  </div>
  <div class="line not-executable" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil file_data Coverage data for the file or nil if not available</div>
  </div>
  <div class="line not-covered" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_file_coverage(file_path)</div>
  </div>
  <div class="line not-covered" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local coverage_data = debug_hook.get_coverage_data()</div>
  </div>
  <div class="line not-covered" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not coverage_data then</div>
  </div>
  <div class="line not-covered" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = data_structure.normalize_path(file_path)</div>
  </div>
  <div class="line not-covered" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return coverage_data.files[normalized_path]</div>
  </div>
  <div class="line not-covered" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Explicitly tracks a file for coverage</div>
  </div>
  <div class="line not-executable" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The file path to track</div>
  </div>
  <div class="line not-executable" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the file was successfully tracked</div>
  </div>
  <div class="line not-executable" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string|nil error_message Error message if tracking failed</div>
  </div>
  <div class="line not-covered" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.track_file(file_path)</div>
  </div>
  <div class="line not-executable" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = data_structure.normalize_path(file_path)</div>
  </div>
  <div class="line not-covered" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not normalized_path then</div>
  </div>
  <div class="line not-covered" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, &quot;Failed to normalize file path&quot;</div>
  </div>
  <div class="line not-covered" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.debug(&quot;Tracking file for coverage&quot;, {</div>
  </div>
  <div class="line not-covered" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_path = file_path,</div>
  </div>
  <div class="line not-covered" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    normalized_path = normalized_path,</div>
  </div>
  <div class="line covered" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    operation = &quot;track_file&quot;</div>
  </div>
  <div class="line covered" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the coverage data</div>
  </div>
  <div class="line covered" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local coverage_data = debug_hook.get_coverage_data()</div>
  </div>
  <div class="line covered" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not coverage_data then</div>
  </div>
  <div class="line covered" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false, &quot;No coverage data available, coverage tracking may not be started&quot;</div>
  </div>
  <div class="line covered" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if file already exists in the data structure</div>
  </div>
  <div class="line covered" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  if coverage_data.files[normalized_path] then</div>
  </div>
  <div class="line covered" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.debug(&quot;File already being tracked&quot;, {</div>
  </div>
  <div class="line covered" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      file_path = normalized_path</div>
  </div>
  <div class="line covered" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    })</div>
  </div>
  <div class="line covered" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line covered" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Read the file content</div>
  </div>
  <div class="line covered" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  local content, err = error_handler.safe_io_operation(</div>
  </div>
  <div class="line covered" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    function() return fs.read_file(file_path) end,</div>
  </div>
  <div class="line covered" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    file_path,</div>
  </div>
  <div class="line covered" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    {operation = &quot;read_file_for_tracking&quot;}</div>
  </div>
  <div class="line covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  )</div>
  </div>
  <div class="line not-executable" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not content then</div>
  </div>
  <div class="line covered" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false, &quot;Failed to read file: &quot; .. error_handler.format_error(err)</div>
  </div>
  <div class="line covered" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize coverage data for the file</div>
  </div>
  <div class="line covered" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  data_structure.initialize_file(coverage_data, normalized_path, content)</div>
  </div>
  <div class="line not-executable" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">3</div>    <div class="line-content">  logger.info(&quot;Started tracking file for coverage&quot;, {</div>
  </div>
  <div class="line covered" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count">3</div>    <div class="line-content">    file_path = normalized_path</div>
  </div>
  <div class="line covered" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line covered" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Explicitly marks a line as executed for coverage</div>
  </div>
  <div class="line not-executable" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The file path</div>
  </div>
  <div class="line not-executable" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param line_num number The line number to mark as executed</div>
  </div>
  <div class="line not-executable" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the line was successfully marked</div>
  </div>
  <div class="line not-executable" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string|nil error_message Error message if marking failed</div>
  </div>
  <div class="line covered" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count">2</div>    <div class="line-content">function M.track_line(file_path, line_num)</div>
  </div>
  <div class="line not-executable" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line covered" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count">3</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line covered" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  error_handler.assert(type(line_num) == &quot;number&quot;, &quot;line_num must be a number&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if coverage is active</div>
  </div>
  <div class="line covered" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  if not M.is_running() then</div>
  </div>
  <div class="line covered" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.debug(&quot;Coverage not active, ignoring track_line&quot;, {</div>
  </div>
  <div class="line not-covered" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = file_path,</div>
  </div>
  <div class="line not-covered" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_num = line_num</div>
  </div>
  <div class="line not-covered" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, &quot;Coverage tracking is not active&quot;</div>
  </div>
  <div class="line not-covered" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = data_structure.normalize_path(file_path)</div>
  </div>
  <div class="line not-covered" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not normalized_path then</div>
  </div>
  <div class="line not-covered" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, &quot;Failed to normalize file path&quot;</div>
  </div>
  <div class="line not-covered" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.debug(&quot;Manually tracking line execution&quot;, {</div>
  </div>
  <div class="line not-covered" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    line_num = line_num,</div>
  </div>
  <div class="line not-covered" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    operation = &quot;track_line&quot;</div>
  </div>
  <div class="line not-covered" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the coverage data</div>
  </div>
  <div class="line not-covered" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local coverage_data = debug_hook.get_coverage_data()</div>
  </div>
  <div class="line not-covered" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not coverage_data then</div>
  </div>
  <div class="line not-covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, &quot;No coverage data available&quot;</div>
  </div>
  <div class="line not-covered" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Ensure the file is being tracked</div>
  </div>
  <div class="line not-covered" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not coverage_data.files[normalized_path] then</div>
  </div>
  <div class="line not-covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, err = M.track_file(file_path)</div>
  </div>
  <div class="line not-covered" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line not-covered" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, &quot;Failed to track file: &quot; .. (err or &quot;Unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Mark the line as executed</div>
  </div>
  <div class="line not-covered" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success = data_structure.mark_line_executed(coverage_data, normalized_path, line_num)</div>
  </div>
  <div class="line not-covered" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line not-covered" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, &quot;Failed to mark line as executed&quot;</div>
  </div>
  <div class="line not-covered" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Generates coverage reports in specified formats</div>
  </div>
  <div class="line not-executable" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param output_dir string Directory where reports should be saved</div>
  </div>
  <div class="line not-executable" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param formats string[] List of formats to generate (html, lcov, json)</div>
  </div>
  <div class="line not-executable" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether report generation was successful</div>
  </div>
  <div class="line not-executable" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string|nil error_message Error message if generation failed</div>
  </div>
  <div class="line not-covered" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.generate_reports(output_dir, formats)</div>
  </div>
  <div class="line not-executable" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(output_dir) == &quot;string&quot;, &quot;output_dir must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(formats) == &quot;table&quot;, &quot;formats must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Ensure output directory exists</div>
  </div>
  <div class="line not-covered" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local mkdir_success, mkdir_err = fs.ensure_directory_exists(output_dir)</div>
  </div>
  <div class="line not-covered" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not mkdir_success then</div>
  </div>
  <div class="line not-covered" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, &quot;Failed to create output directory: &quot; .. error_handler.format_error(mkdir_err)</div>
  </div>
  <div class="line not-covered" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize output path</div>
  </div>
  <div class="line not-covered" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if output_dir:sub(-1) ~= &quot;/&quot; then</div>
  </div>
  <div class="line not-covered" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    output_dir = output_dir .. &quot;/&quot;</div>
  </div>
  <div class="line not-covered" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get coverage data</div>
  </div>
  <div class="line not-covered" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local coverage_data = M.get_report_data()</div>
  </div>
  <div class="line not-covered" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not coverage_data then</div>
  </div>
  <div class="line not-covered" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, &quot;No coverage data available&quot;</div>
  </div>
  <div class="line not-covered" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Recalculate summary to ensure accurate data</div>
  </div>
  <div class="line not-covered" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  data_structure.calculate_summary(coverage_data)</div>
  </div>
  <div class="line not-executable" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Track successes</div>
  </div>
  <div class="line not-covered" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local successes = {}</div>
  </div>
  <div class="line not-covered" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local errors = {}</div>
  </div>
  <div class="line not-executable" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Generate reports in each requested format</div>
  </div>
  <div class="line not-covered" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, format in ipairs(formats) do</div>
  </div>
  <div class="line not-covered" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local formatter = nil</div>
  </div>
  <div class="line not-executable" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Load the appropriate formatter</div>
  </div>
  <div class="line not-covered" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if format == &quot;html&quot; then</div>
  </div>
  <div class="line not-covered" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      formatter = require(&quot;lib.reporting.formatters.html&quot;)</div>
  </div>
  <div class="line not-covered" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif format == &quot;lcov&quot; then</div>
  </div>
  <div class="line not-covered" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      formatter = require(&quot;lib.reporting.formatters.lcov&quot;)</div>
  </div>
  <div class="line not-covered" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif format == &quot;cobertura&quot; then</div>
  </div>
  <div class="line not-covered" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      formatter = require(&quot;lib.reporting.formatters.cobertura&quot;)</div>
  </div>
  <div class="line not-covered" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif format == &quot;json&quot; then</div>
  </div>
  <div class="line not-covered" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      formatter = require(&quot;lib.reporting.formatters.json&quot;)</div>
  </div>
  <div class="line not-covered" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if formatter then</div>
  </div>
  <div class="line not-covered" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local output_path = output_dir .. &quot;coverage-report.&quot; .. format</div>
  </div>
  <div class="line not-covered" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local success, err = formatter.generate(coverage_data, output_path)</div>
  </div>
  <div class="line not-executable" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if success then</div>
  </div>
  <div class="line not-covered" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(successes, format)</div>
  </div>
  <div class="line not-covered" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(errors, format .. &quot;: &quot; .. (err or &quot;Unknown error&quot;))</div>
  </div>
  <div class="line not-covered" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      table.insert(errors, format .. &quot;: Unsupported format&quot;)</div>
  </div>
  <div class="line not-covered" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log results</div>
  </div>
  <div class="line not-covered" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if #successes &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Generated coverage reports&quot;, {</div>
  </div>
  <div class="line not-covered" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      output_dir = output_dir,</div>
  </div>
  <div class="line not-covered" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      formats = table.concat(successes, &quot;, &quot;),</div>
  </div>
  <div class="line not-covered" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      total_files = coverage_data.summary.total_files,</div>
  </div>
  <div class="line not-covered" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_coverage = coverage_data.summary.line_coverage_percent .. &quot;%&quot;,</div>
  </div>
  <div class="line not-covered" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      function_coverage = coverage_data.summary.function_coverage_percent .. &quot;%&quot;</div>
  </div>
  <div class="line not-covered" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return results</div>
  </div>
  <div class="line not-covered" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if #errors &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return #successes &gt; 0, &quot;Failed to generate some reports: &quot; .. table.concat(errors, &quot;; &quot;)</div>
  </div>
  <div class="line not-covered" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Gets a list of available report formats</div>
  </div>
  <div class="line not-executable" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string[] formats List of available format names</div>
  </div>
  <div class="line not-covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_available_formats()</div>
  </div>
  <div class="line not-covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local available_formats = {&quot;html&quot;, &quot;lcov&quot;}</div>
  </div>
  <div class="line not-executable" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if other formatters are available</div>
  </div>
  <div class="line not-covered" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local function has_formatter(name)</div>
  </div>
  <div class="line not-covered" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success = pcall(function() require(&quot;lib.reporting.formatters.&quot; .. name) end)</div>
  </div>
  <div class="line not-covered" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return success</div>
  </div>
  <div class="line not-covered" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if has_formatter(&quot;cobertura&quot;) then</div>
  </div>
  <div class="line not-covered" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(available_formats, &quot;cobertura&quot;)</div>
  </div>
  <div class="line not-covered" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if has_formatter(&quot;json&quot;) then</div>
  </div>
  <div class="line not-covered" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(available_formats, &quot;json&quot;)</div>
  </div>
  <div class="line not-covered" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return available_formats</div>
  </div>
  <div class="line not-covered" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return M</div>
  </div>
</div>
<div class="source-code" id="file---lib-coverage-data-structure-lua">
  <h3>./lib/coverage/data_structure.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">204 / 698 (29%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 29%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">3 / 3 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 1058      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 698      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 3      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 3      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-coverage-data-structure-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-coverage-data-structure-lua" value="all" checked>
        All <span class="function-count">3</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-coverage-data-structure-lua" value="executed">
        Executed <span class="function-count badge-success">3</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-coverage-data-structure-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-coverage-data-structure-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-coverage-data-structure-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-coverage-data-structure-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-coverage-data-structure-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">0</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-coverage-data-structure-lua" value="closure">
        Closure <span class="function-count function-type-closure">3</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-coverage-data-structure-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>normalize_path <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L51">51-68</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>2</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>initialize_file <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L110">110-192</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>calculate_summary <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L465">465-667</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>3</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for data_structure.lua    const tableId = 'functions---lib-coverage-data-structure-lua';
    const searchId = 'func-search---lib-coverage-data-structure-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-coverage-data-structure-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-coverage-data-structure-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-coverage-data-structure-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-coverage-data-structure-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class CoverageDataStructure</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field create fun(): table Creates a new coverage data structure</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field initialize_file fun(data: table, file_path: string, source_code: string): table Initializes coverage data for a file</div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field mark_line_executed fun(data: table, file_path: string, line_number: number): boolean Marks a line as executed</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_file_data fun(data: table, file_path: string): table|nil Gets data for a specific file</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field set_line_classification fun(data: table, file_path: string, line_number: number, classification: string): boolean Sets the classification for a line</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field calculate_summary fun(data: table): table Calculates summary statistics</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field validate fun(data: table): boolean, string|nil Validates the data structure</div>
  </div>
  <div class="line not-executable" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field normalize_path fun(path: string): string Normalizes a file path</div>
  </div>
  <div class="line not-executable" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field _VERSION string Version of this module</div>
  </div>
  <div class="line not-covered" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local M = {}</div>
  </div>
  <div class="line not-executable" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dependencies</div>
  </div>
  <div class="line not-covered" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local error_handler = require(&quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line not-covered" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local logger = require(&quot;lib.tools.logging&quot;)</div>
  </div>
  <div class="line not-covered" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local central_config = require(&quot;lib.core.central_config&quot;)</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Version</div>
  </div>
  <div class="line not-covered" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M._VERSION = &quot;0.1.0&quot;</div>
  </div>
  <div class="line not-executable" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Line type constants</div>
  </div>
  <div class="line not-covered" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.LINE_TYPES = {</div>
  </div>
  <div class="line not-covered" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  CODE = &quot;code&quot;,</div>
  </div>
  <div class="line not-covered" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  COMMENT = &quot;comment&quot;,</div>
  </div>
  <div class="line not-covered" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  BLANK = &quot;blank&quot;,</div>
  </div>
  <div class="line not-covered" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  STRUCTURE = &quot;structure&quot;</div>
  </div>
  <div class="line not-covered" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Block type constants</div>
  </div>
  <div class="line not-covered" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.BLOCK_TYPES = {</div>
  </div>
  <div class="line not-covered" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  FUNCTION = &quot;function&quot;,</div>
  </div>
  <div class="line not-covered" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  IF = &quot;if&quot;,</div>
  </div>
  <div class="line not-covered" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  FOR = &quot;for&quot;,</div>
  </div>
  <div class="line not-covered" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  WHILE = &quot;while&quot;,</div>
  </div>
  <div class="line not-covered" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  DO = &quot;do&quot;,</div>
  </div>
  <div class="line not-covered" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  REPEAT = &quot;repeat&quot;</div>
  </div>
  <div class="line not-covered" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Function type constants</div>
  </div>
  <div class="line not-covered" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.FUNCTION_TYPES = {</div>
  </div>
  <div class="line not-covered" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  GLOBAL = &quot;global&quot;,     -- Functions defined at global scope</div>
  </div>
  <div class="line not-covered" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  LOCAL = &quot;local&quot;,       -- Local functions</div>
  </div>
  <div class="line not-covered" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  METHOD = &quot;method&quot;,     -- Methods (obj:method())</div>
  </div>
  <div class="line not-covered" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  ANONYMOUS = &quot;anonymous&quot;, -- Anonymous functions</div>
  </div>
  <div class="line not-covered" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  CLOSURE = &quot;closure&quot;    -- Functions that close over variables</div>
  </div>
  <div class="line not-covered" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Normalizes a file path for consistent lookup</div>
  </div>
  <div class="line not-executable" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param path string The file path to normalize</div>
  </div>
  <div class="line not-executable" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string normalized_path The normalized path</div>
  </div>
  <div class="line not-covered" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.normalize_path(path)</div>
  </div>
  <div class="line not-covered" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not path then</div>
  </div>
  <div class="line not-covered" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Replace backslashes with forward slashes</div>
  </div>
  <div class="line covered" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local normalized = path:gsub(&quot;\\&quot;, &quot;/&quot;)</div>
  </div>
  <div class="line not-executable" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Remove trailing slashes</div>
  </div>
  <div class="line covered" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  normalized = normalized:gsub(&quot;/$&quot;, &quot;&quot;)</div>
  </div>
  <div class="line not-executable" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Remove duplicate slashes</div>
  </div>
  <div class="line covered" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  while normalized:match(&quot;//&quot;) do</div>
  </div>
  <div class="line covered" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    normalized = normalized:gsub(&quot;//&quot;, &quot;/&quot;)</div>
  </div>
  <div class="line covered" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return normalized</div>
  </div>
  <div class="line covered" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Creates a new coverage data structure with initialized fields</div>
  </div>
  <div class="line not-executable" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table coverage_data The initialized coverage data structure</div>
  </div>
  <div class="line covered" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.create()</div>
  </div>
  <div class="line covered" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return {</div>
  </div>
  <div class="line not-executable" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Summary statistics</div>
  </div>
  <div class="line covered" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    summary = {</div>
  </div>
  <div class="line not-executable" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- File statistics</div>
  </div>
  <div class="line not-covered" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      total_files = 0,</div>
  </div>
  <div class="line not-covered" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      covered_files = 0,</div>
  </div>
  <div class="line not-covered" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      executed_files = 0,</div>
  </div>
  <div class="line not-covered" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_coverage_percent = 0,</div>
  </div>
  <div class="line not-executable" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Line statistics</div>
  </div>
  <div class="line not-covered" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      total_lines = 0,</div>
  </div>
  <div class="line not-covered" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      executable_lines = 0,</div>
  </div>
  <div class="line not-covered" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      executed_lines = 0,</div>
  </div>
  <div class="line not-covered" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      covered_lines = 0,</div>
  </div>
  <div class="line not-covered" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_coverage_percent = 0,</div>
  </div>
  <div class="line not-covered" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      execution_coverage_percent = 0,</div>
  </div>
  <div class="line not-executable" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Function statistics</div>
  </div>
  <div class="line not-covered" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      total_functions = 0,</div>
  </div>
  <div class="line not-covered" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      executed_functions = 0,</div>
  </div>
  <div class="line not-covered" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      covered_functions = 0,</div>
  </div>
  <div class="line not-covered" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      function_coverage_percent = 0,</div>
  </div>
  <div class="line not-executable" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Combined metrics</div>
  </div>
  <div class="line not-covered" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      overall_coverage_percent = 0,</div>
  </div>
  <div class="line not-covered" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    },</div>
  </div>
  <div class="line not-executable" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Detailed data for each file</div>
  </div>
  <div class="line not-covered" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    files = {},</div>
  </div>
  <div class="line not-covered" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-covered" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Initializes coverage data for a specific file</div>
  </div>
  <div class="line not-executable" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure</div>
  </div>
  <div class="line not-executable" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the file</div>
  </div>
  <div class="line not-executable" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param source_code string The source code content of the file</div>
  </div>
  <div class="line not-executable" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table file_data The initialized file data</div>
  </div>
  <div class="line not-covered" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.initialize_file(data, file_path, source_code)</div>
  </div>
  <div class="line not-executable" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(data) == &quot;table&quot;, &quot;data must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(source_code) == &quot;string&quot;, &quot;source_code must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = M.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if file already exists in the data structure</div>
  </div>
  <div class="line covered" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if data.files[normalized_path] then</div>
  </div>
  <div class="line covered" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.debug(&quot;File already exists in coverage data&quot;, {file_path = normalized_path})</div>
  </div>
  <div class="line covered" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return data.files[normalized_path]</div>
  </div>
  <div class="line covered" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Count lines in the source code</div>
  </div>
  <div class="line covered" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local line_count = 0</div>
  </div>
  <div class="line covered" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for _ in source_code:gmatch(&quot;[^\r\n]+&quot;) do</div>
  </div>
  <div class="line covered" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    line_count = line_count + 1</div>
  </div>
  <div class="line covered" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Extract file name from path</div>
  </div>
  <div class="line covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local file_name = normalized_path:match(&quot;([^/]+)$&quot;) or normalized_path</div>
  </div>
  <div class="line not-executable" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize file data structure</div>
  </div>
  <div class="line covered" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count">24</div>    <div class="line-content">  local file_data = {</div>
  </div>
  <div class="line not-executable" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- File metadata</div>
  </div>
  <div class="line covered" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    path = normalized_path,</div>
  </div>
  <div class="line covered" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    name = file_name,</div>
  </div>
  <div class="line covered" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    source = source_code,</div>
  </div>
  <div class="line covered" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    discovered = true,</div>
  </div>
  <div class="line not-executable" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Line-specific data</div>
  </div>
  <div class="line covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    lines = {},</div>
  </div>
  <div class="line not-executable" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Execution count mapping (for quick lookup)</div>
  </div>
  <div class="line covered" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    execution_counts = {},</div>
  </div>
  <div class="line not-executable" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Function data</div>
  </div>
  <div class="line covered" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    functions = {},</div>
  </div>
  <div class="line not-executable" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Block relationship data</div>
  </div>
  <div class="line covered" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    blocks = {},</div>
  </div>
  <div class="line not-executable" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- File statistics</div>
  </div>
  <div class="line covered" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    total_lines = line_count,</div>
  </div>
  <div class="line covered" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    executable_lines = 0,</div>
  </div>
  <div class="line covered" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    executed_lines = 0,</div>
  </div>
  <div class="line covered" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    covered_lines = 0,</div>
  </div>
  <div class="line covered" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    line_coverage_percent = 0,</div>
  </div>
  <div class="line covered" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    execution_coverage_percent = 0,</div>
  </div>
  <div class="line covered" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    total_functions = 0,</div>
  </div>
  <div class="line covered" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    executed_functions = 0,</div>
  </div>
  <div class="line covered" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    covered_functions = 0,</div>
  </div>
  <div class="line covered" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    function_coverage_percent = 0,</div>
  </div>
  <div class="line covered" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize line data</div>
  </div>
  <div class="line covered" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local lines_array = {}</div>
  </div>
  <div class="line covered" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for line in source_code:gmatch(&quot;[^\r\n]+&quot;) do</div>
  </div>
  <div class="line covered" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    table.insert(lines_array, line)</div>
  </div>
  <div class="line covered" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for i, line_content in ipairs(lines_array) do</div>
  </div>
  <div class="line covered" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    file_data.lines[i] = {</div>
  </div>
  <div class="line covered" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      executable = false,  -- Will be set by the static analyzer</div>
  </div>
  <div class="line covered" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      executed = false,</div>
  </div>
  <div class="line covered" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count">24</div>    <div class="line-content">      covered = false,</div>
  </div>
  <div class="line covered" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count">23</div>    <div class="line-content">      execution_count = 0,</div>
  </div>
  <div class="line covered" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      line_type = M.LINE_TYPES.CODE,  -- Default classification, will be updated</div>
  </div>
  <div class="line covered" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      content = line_content,</div>
  </div>
  <div class="line covered" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count">24</div>    <div class="line-content">    }</div>
  </div>
  <div class="line covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">23</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add file to data structure</div>
  </div>
  <div class="line covered" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count">23</div>    <div class="line-content">  data.files[normalized_path] = file_data</div>
  </div>
  <div class="line not-executable" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update summary statistics</div>
  </div>
  <div class="line covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">23</div>    <div class="line-content">  data.summary.total_files = data.summary.total_files + 1</div>
  </div>
  <div class="line covered" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count">23</div>    <div class="line-content">  data.summary.total_lines = data.summary.total_lines + line_count</div>
  </div>
  <div class="line not-executable" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return file_data</div>
  </div>
  <div class="line covered" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Gets coverage data for a specific file</div>
  </div>
  <div class="line not-executable" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure</div>
  </div>
  <div class="line not-executable" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the file</div>
  </div>
  <div class="line not-executable" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil file_data The file data or nil if not found</div>
  </div>
  <div class="line covered" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.get_file_data(data, file_path)</div>
  </div>
  <div class="line not-executable" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line covered" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  error_handler.assert(type(data) == &quot;table&quot;, &quot;data must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line covered" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path for lookup</div>
  </div>
  <div class="line not-covered" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = M.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return data.files[normalized_path]</div>
  </div>
  <div class="line not-covered" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Marks a line as executed</div>
  </div>
  <div class="line not-executable" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure</div>
  </div>
  <div class="line not-executable" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the file</div>
  </div>
  <div class="line not-executable" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param line_number number The line number that was executed</div>
  </div>
  <div class="line not-executable" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the operation succeeded</div>
  </div>
  <div class="line not-covered" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.mark_line_executed(data, file_path, line_number)</div>
  </div>
  <div class="line not-executable" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(data) == &quot;table&quot;, &quot;data must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(line_number) == &quot;number&quot;, &quot;line_number must be a number&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = M.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the file data</div>
  </div>
  <div class="line not-covered" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local file_data = data.files[normalized_path]</div>
  </div>
  <div class="line not-covered" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data then</div>
  </div>
  <div class="line not-covered" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to mark line executed for a file not in the coverage data&quot;, {</div>
  </div>
  <div class="line not-covered" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_number = line_number</div>
  </div>
  <div class="line not-covered" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if line exists, and add it if it doesn't</div>
  </div>
  <div class="line not-covered" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data.lines[line_number] then</div>
  </div>
  <div class="line not-executable" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Some files like assertion.lua might have line execution events for lines </div>
  </div>
  <div class="line not-executable" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- that weren't in the source when we read it. This could happen if the file changed,</div>
  </div>
  <div class="line not-executable" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- or if there are multiple versions. We'll dynamically add these lines.</div>
  </div>
  <div class="line not-covered" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if line_number &gt; file_data.total_lines then</div>
  </div>
  <div class="line not-executable" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Add new line entries for all lines up to this one</div>
  </div>
  <div class="line not-covered" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for i = file_data.total_lines + 1, line_number do</div>
  </div>
  <div class="line not-covered" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_data.lines[i] = {</div>
  </div>
  <div class="line not-covered" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          executable = true,  -- Assume it's executable since we're executing it</div>
  </div>
  <div class="line not-covered" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          executed = false,</div>
  </div>
  <div class="line not-covered" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          covered = false,</div>
  </div>
  <div class="line not-covered" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          execution_count = 0,</div>
  </div>
  <div class="line not-covered" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          line_type = M.LINE_TYPES.CODE,  -- Default classification</div>
  </div>
  <div class="line not-covered" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          content = &quot;-- Dynamically added line &quot; .. i,  -- Placeholder content</div>
  </div>
  <div class="line not-covered" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        }</div>
  </div>
  <div class="line not-covered" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Update file statistics</div>
  </div>
  <div class="line not-covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_data.total_lines = line_number</div>
  </div>
  <div class="line not-covered" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      data.summary.total_lines = data.summary.total_lines + (line_number - file_data.total_lines)</div>
  </div>
  <div class="line not-executable" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Only log once per file</div>
  </div>
  <div class="line not-covered" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not file_data.expanded_lines_logged then</div>
  </div>
  <div class="line not-covered" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        logger.info(&quot;Dynamically expanded line count for file&quot;, {</div>
  </div>
  <div class="line not-covered" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          original_lines = file_data.total_lines,</div>
  </div>
  <div class="line not-covered" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          new_lines = line_number</div>
  </div>
  <div class="line not-covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_data.expanded_lines_logged = true</div>
  </div>
  <div class="line not-covered" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.warn(&quot;Attempted to mark non-existent line as executed&quot;, {</div>
  </div>
  <div class="line not-covered" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        line_number = line_number,</div>
  </div>
  <div class="line not-covered" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        total_lines = file_data.total_lines</div>
  </div>
  <div class="line not-covered" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line not-covered" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the line data</div>
  </div>
  <div class="line not-covered" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local line_data = file_data.lines[line_number]</div>
  </div>
  <div class="line not-executable" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log execution</div>
  </div>
  <div class="line not-covered" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local debug_file = io.open(&quot;line_tracking_debug.log&quot;, &quot;a&quot;)</div>
  </div>
  <div class="line not-covered" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if debug_file then</div>
  </div>
  <div class="line not-covered" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    debug_file:write(string.format(&quot;MARKED EXECUTED: %s:%d [type=%s, was_executed=%s, count=%d]\n&quot;, </div>
  </div>
  <div class="line not-covered" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      normalized_path, </div>
  </div>
  <div class="line not-covered" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_number,</div>
  </div>
  <div class="line not-covered" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_data.line_type,</div>
  </div>
  <div class="line not-covered" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      tostring(line_data.executed),</div>
  </div>
  <div class="line not-covered" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_data.execution_count</div>
  </div>
  <div class="line not-covered" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    ))</div>
  </div>
  <div class="line not-covered" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    debug_file:close()</div>
  </div>
  <div class="line not-covered" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Important: If a line is executed, it must be executable</div>
  </div>
  <div class="line not-covered" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if line_data.line_type ~= M.LINE_TYPES.COMMENT and</div>
  </div>
  <div class="line not-covered" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">     line_data.line_type ~= M.LINE_TYPES.BLANK then</div>
  </div>
  <div class="line not-covered" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    line_data.executable = true</div>
  </div>
  <div class="line not-covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update execution count</div>
  </div>
  <div class="line not-covered" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  line_data.execution_count = line_data.execution_count + 1</div>
  </div>
  <div class="line not-covered" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  file_data.execution_counts[line_number] = line_data.execution_count</div>
  </div>
  <div class="line not-executable" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- When a line is executed, it's definitely executable, executed, and covered</div>
  </div>
  <div class="line not-covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if line_data.line_type ~= &quot;comment&quot; and line_data.line_type ~= &quot;blank&quot; then</div>
  </div>
  <div class="line not-covered" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    line_data.executable = true</div>
  </div>
  <div class="line not-covered" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Mark as executed</div>
  </div>
  <div class="line not-covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  line_data.executed = true</div>
  </div>
  <div class="line not-executable" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Mark as covered too</div>
  </div>
  <div class="line not-covered" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  line_data.covered = true</div>
  </div>
  <div class="line not-executable" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- We don't update file statistics here as they will be recalculated</div>
  </div>
  <div class="line not-executable" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- during calculate_summary to ensure consistency</div>
  </div>
  <div class="line not-executable" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Sets the classification for a line</div>
  </div>
  <div class="line not-executable" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure</div>
  </div>
  <div class="line not-executable" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the file</div>
  </div>
  <div class="line not-executable" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param line_number number The line number to classify</div>
  </div>
  <div class="line not-executable" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param classification string The line classification (code, comment, blank, structure)</div>
  </div>
  <div class="line not-executable" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the operation succeeded</div>
  </div>
  <div class="line not-covered" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.set_line_classification(data, file_path, line_number, classification)</div>
  </div>
  <div class="line not-executable" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(data) == &quot;table&quot;, &quot;data must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(line_number) == &quot;number&quot;, &quot;line_number must be a number&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(classification) == &quot;string&quot;, &quot;classification must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Validate classification type</div>
  </div>
  <div class="line not-covered" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local valid_types = {</div>
  </div>
  <div class="line not-covered" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    [M.LINE_TYPES.CODE] = true,</div>
  </div>
  <div class="line not-covered" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    [M.LINE_TYPES.COMMENT] = true,</div>
  </div>
  <div class="line not-covered" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    [M.LINE_TYPES.BLANK] = true,</div>
  </div>
  <div class="line not-covered" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    [M.LINE_TYPES.STRUCTURE] = true</div>
  </div>
  <div class="line not-covered" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not valid_types[classification] then</div>
  </div>
  <div class="line not-covered" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Invalid line classification&quot;, {</div>
  </div>
  <div class="line not-covered" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = file_path,</div>
  </div>
  <div class="line not-covered" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_number = line_number,</div>
  </div>
  <div class="line not-covered" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      classification = classification,</div>
  </div>
  <div class="line not-covered" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      valid_types = table.concat({M.LINE_TYPES.CODE, M.LINE_TYPES.COMMENT, M.LINE_TYPES.BLANK, M.LINE_TYPES.STRUCTURE}, &quot;, &quot;)</div>
  </div>
  <div class="line not-covered" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = M.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the file data</div>
  </div>
  <div class="line not-covered" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local file_data = data.files[normalized_path]</div>
  </div>
  <div class="line not-covered" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data then</div>
  </div>
  <div class="line not-covered" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to classify line for a file not in the coverage data&quot;, {</div>
  </div>
  <div class="line not-covered" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_number = line_number</div>
  </div>
  <div class="line not-covered" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if line exists</div>
  </div>
  <div class="line not-covered" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data.lines[line_number] then</div>
  </div>
  <div class="line not-covered" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to classify non-existent line&quot;, {</div>
  </div>
  <div class="line not-covered" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_number = line_number,</div>
  </div>
  <div class="line not-covered" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      total_lines = file_data.total_lines</div>
  </div>
  <div class="line not-covered" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the line data</div>
  </div>
  <div class="line not-covered" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local line_data = file_data.lines[line_number]</div>
  </div>
  <div class="line not-covered" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local was_executable = line_data.executable</div>
  </div>
  <div class="line not-executable" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update classification</div>
  </div>
  <div class="line not-covered" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  line_data.line_type = classification</div>
  </div>
  <div class="line not-executable" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update executability based on classification</div>
  </div>
  <div class="line not-covered" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if classification == M.LINE_TYPES.CODE then</div>
  </div>
  <div class="line not-covered" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    line_data.executable = true</div>
  </div>
  <div class="line not-covered" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    line_data.executable = false</div>
  </div>
  <div class="line not-covered" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update file statistics if executability changed</div>
  </div>
  <div class="line not-covered" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if was_executable ~= line_data.executable then</div>
  </div>
  <div class="line not-covered" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if line_data.executable then</div>
  </div>
  <div class="line not-covered" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_data.executable_lines = file_data.executable_lines + 1</div>
  </div>
  <div class="line not-executable" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- We no longer update global statistics here</div>
  </div>
  <div class="line not-covered" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_data.executable_lines = file_data.executable_lines - 1</div>
  </div>
  <div class="line not-executable" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- We no longer update global statistics here</div>
  </div>
  <div class="line not-covered" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Marks a line as covered (executed + validated)</div>
  </div>
  <div class="line not-executable" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure</div>
  </div>
  <div class="line not-executable" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the file</div>
  </div>
  <div class="line not-executable" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param line_number number The line number that was covered</div>
  </div>
  <div class="line not-executable" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the operation succeeded</div>
  </div>
  <div class="line not-covered" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.mark_line_covered(data, file_path, line_number)</div>
  </div>
  <div class="line not-executable" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(data) == &quot;table&quot;, &quot;data must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(line_number) == &quot;number&quot;, &quot;line_number must be a number&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = M.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the file data</div>
  </div>
  <div class="line not-covered" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local file_data = data.files[normalized_path]</div>
  </div>
  <div class="line not-covered" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data then</div>
  </div>
  <div class="line not-covered" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to mark line covered for a file not in the coverage data&quot;, {</div>
  </div>
  <div class="line not-covered" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_number = line_number</div>
  </div>
  <div class="line not-covered" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if line exists</div>
  </div>
  <div class="line not-covered" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data.lines[line_number] then</div>
  </div>
  <div class="line not-covered" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to mark non-existent line as covered&quot;, {</div>
  </div>
  <div class="line not-covered" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_number = line_number,</div>
  </div>
  <div class="line not-covered" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      total_lines = file_data.total_lines</div>
  </div>
  <div class="line not-covered" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the line data</div>
  </div>
  <div class="line not-covered" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local line_data = file_data.lines[line_number]</div>
  </div>
  <div class="line not-executable" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Line must be executed before it can be covered</div>
  </div>
  <div class="line not-covered" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not line_data.executed then</div>
  </div>
  <div class="line not-covered" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to mark a non-executed line as covered&quot;, {</div>
  </div>
  <div class="line not-covered" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      line_number = line_number</div>
  </div>
  <div class="line not-covered" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Mark as covered if not already</div>
  </div>
  <div class="line not-covered" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not line_data.covered then</div>
  </div>
  <div class="line not-covered" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    line_data.covered = true</div>
  </div>
  <div class="line not-executable" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update file statistics</div>
  </div>
  <div class="line not-covered" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_data.covered_lines = file_data.covered_lines + 1</div>
  </div>
  <div class="line not-executable" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- We no longer update global statistics here, they will be calculated</div>
  </div>
  <div class="line not-executable" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- by calculate_summary when needed. This prevents inconsistencies.</div>
  </div>
  <div class="line not-executable" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Mark file as covered if this is the first covered line</div>
  </div>
  <div class="line not-executable" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- (We'll track this during calculate_summary)</div>
  </div>
  <div class="line not-covered" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Calculates coverage statistics for the entire codebase</div>
  </div>
  <div class="line not-executable" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure</div>
  </div>
  <div class="line not-executable" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table data The updated coverage data structure</div>
  </div>
  <div class="line not-covered" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.calculate_summary(data)</div>
  </div>
  <div class="line not-executable" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(data) == &quot;table&quot;, &quot;data must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Reset summary counters to recalculate</div>
  </div>
  <div class="line not-covered" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local summary = data.summary</div>
  </div>
  <div class="line not-covered" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  summary.total_files = 0</div>
  </div>
  <div class="line not-covered" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  summary.covered_files = 0</div>
  </div>
  <div class="line not-covered" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  summary.executed_files = 0</div>
  </div>
  <div class="line not-covered" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  summary.total_lines = 0</div>
  </div>
  <div class="line not-covered" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  summary.executable_lines = 0</div>
  </div>
  <div class="line not-covered" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  summary.executed_lines = 0</div>
  </div>
  <div class="line not-covered" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  summary.covered_lines = 0</div>
  </div>
  <div class="line covered" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  summary.total_functions = 0</div>
  </div>
  <div class="line covered" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  summary.executed_functions = 0</div>
  </div>
  <div class="line covered" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count">3</div>    <div class="line-content">  summary.covered_functions = 0</div>
  </div>
  <div class="line not-executable" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Calculate per-file statistics</div>
  </div>
  <div class="line covered" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count">3</div>    <div class="line-content">  for path, file_data in pairs(data.files) do</div>
  </div>
  <div class="line not-executable" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update file counters</div>
  </div>
  <div class="line covered" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count">3</div>    <div class="line-content">    summary.total_files = summary.total_files + 1</div>
  </div>
  <div class="line covered" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count">3</div>    <div class="line-content">    summary.total_lines = summary.total_lines + file_data.total_lines</div>
  </div>
  <div class="line not-executable" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- First, count executable lines correctly</div>
  </div>
  <div class="line covered" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count">3</div>    <div class="line-content">    file_data.executable_lines = 0</div>
  </div>
  <div class="line covered" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count">3</div>    <div class="line-content">    for line_num, line_data in pairs(file_data.lines) do</div>
  </div>
  <div class="line not-executable" id="L478">
    <div class="line-number"><a href="#L478">478</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Only count truly executable code lines</div>
  </div>
  <div class="line covered" id="L479">
    <div class="line-number"><a href="#L479">479</a></div>
    <div class="execution-count">3</div>    <div class="line-content">      if line_data.line_type == M.LINE_TYPES.CODE then</div>
  </div>
  <div class="line covered" id="L480">
    <div class="line-number"><a href="#L480">480</a></div>
    <div class="execution-count">3</div>    <div class="line-content">        line_data.executable = true</div>
  </div>
  <div class="line covered" id="L481">
    <div class="line-number"><a href="#L481">481</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        file_data.executable_lines = file_data.executable_lines + 1</div>
  </div>
  <div class="line covered" id="L482">
    <div class="line-number"><a href="#L482">482</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      else</div>
  </div>
  <div class="line covered" id="L483">
    <div class="line-number"><a href="#L483">483</a></div>
    <div class="execution-count">36</div>    <div class="line-content">        line_data.executable = false</div>
  </div>
  <div class="line covered" id="L484">
    <div class="line-number"><a href="#L484">484</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L485">
    <div class="line-number"><a href="#L485">485</a></div>
    <div class="execution-count">33</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L486">
    <div class="line-number"><a href="#L486">486</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L487">
    <div class="line-number"><a href="#L487">487</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    summary.executable_lines = summary.executable_lines + file_data.executable_lines</div>
  </div>
  <div class="line not-executable" id="L488">
    <div class="line-number"><a href="#L488">488</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L489">
    <div class="line-number"><a href="#L489">489</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Initialize file statistics for recounting</div>
  </div>
  <div class="line covered" id="L490">
    <div class="line-number"><a href="#L490">490</a></div>
    <div class="execution-count">31517</div>    <div class="line-content">    file_data.executed_lines = 0</div>
  </div>
  <div class="line covered" id="L491">
    <div class="line-number"><a href="#L491">491</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    file_data.covered_lines = 0</div>
  </div>
  <div class="line not-executable" id="L492">
    <div class="line-number"><a href="#L492">492</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L493">
    <div class="line-number"><a href="#L493">493</a></div>
    <div class="execution-count">31484</div>    <div class="line-content">    local file_has_executed_lines = false</div>
  </div>
  <div class="line covered" id="L494">
    <div class="line-number"><a href="#L494">494</a></div>
    <div class="execution-count">31484</div>    <div class="line-content">    local file_has_covered_lines = false</div>
  </div>
  <div class="line not-executable" id="L495">
    <div class="line-number"><a href="#L495">495</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L496">
    <div class="line-number"><a href="#L496">496</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Calculate line statistics</div>
  </div>
  <div class="line covered" id="L497">
    <div class="line-number"><a href="#L497">497</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    for line_num, line_data in pairs(file_data.lines) do</div>
  </div>
  <div class="line not-executable" id="L498">
    <div class="line-number"><a href="#L498">498</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Any line with execution_count &gt; 0 must be marked as executed</div>
  </div>
  <div class="line covered" id="L499">
    <div class="line-number"><a href="#L499">499</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if line_data.execution_count &gt; 0 then</div>
  </div>
  <div class="line covered" id="L500">
    <div class="line-number"><a href="#L500">500</a></div>
    <div class="execution-count">33</div>    <div class="line-content">        line_data.executed = true</div>
  </div>
  <div class="line not-executable" id="L501">
    <div class="line-number"><a href="#L501">501</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L502">
    <div class="line-number"><a href="#L502">502</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- A line that is executed must be executable</div>
  </div>
  <div class="line covered" id="L503">
    <div class="line-number"><a href="#L503">503</a></div>
    <div class="execution-count">33</div>    <div class="line-content">        if line_data.line_type ~= &quot;comment&quot; and line_data.line_type ~= &quot;blank&quot; then</div>
  </div>
  <div class="line covered" id="L504">
    <div class="line-number"><a href="#L504">504</a></div>
    <div class="execution-count">33</div>    <div class="line-content">          line_data.executable = true</div>
  </div>
  <div class="line covered" id="L505">
    <div class="line-number"><a href="#L505">505</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L506">
    <div class="line-number"><a href="#L506">506</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L507">
    <div class="line-number"><a href="#L507">507</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- All executed lines are also considered covered</div>
  </div>
  <div class="line covered" id="L508">
    <div class="line-number"><a href="#L508">508</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        line_data.covered = true</div>
  </div>
  <div class="line covered" id="L509">
    <div class="line-number"><a href="#L509">509</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L510">
    <div class="line-number"><a href="#L510">510</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L511">
    <div class="line-number"><a href="#L511">511</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Count all executed and executable lines correctly</div>
  </div>
  <div class="line covered" id="L512">
    <div class="line-number"><a href="#L512">512</a></div>
    <div class="execution-count">31484</div>    <div class="line-content">      if line_data.executable then</div>
  </div>
  <div class="line covered" id="L513">
    <div class="line-number"><a href="#L513">513</a></div>
    <div class="execution-count">2849</div>    <div class="line-content">        if line_data.executed then</div>
  </div>
  <div class="line covered" id="L514">
    <div class="line-number"><a href="#L514">514</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          file_data.executed_lines = file_data.executed_lines + 1</div>
  </div>
  <div class="line covered" id="L515">
    <div class="line-number"><a href="#L515">515</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          summary.executed_lines = summary.executed_lines + 1</div>
  </div>
  <div class="line covered" id="L516">
    <div class="line-number"><a href="#L516">516</a></div>
    <div class="execution-count">2849</div>    <div class="line-content">          file_has_executed_lines = true</div>
  </div>
  <div class="line not-executable" id="L517">
    <div class="line-number"><a href="#L517">517</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L518">
    <div class="line-number"><a href="#L518">518</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- All executed lines are considered covered too</div>
  </div>
  <div class="line covered" id="L519">
    <div class="line-number"><a href="#L519">519</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          file_data.covered_lines = file_data.covered_lines + 1</div>
  </div>
  <div class="line covered" id="L520">
    <div class="line-number"><a href="#L520">520</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          summary.covered_lines = summary.covered_lines + 1</div>
  </div>
  <div class="line covered" id="L521">
    <div class="line-number"><a href="#L521">521</a></div>
    <div class="execution-count">2849</div>    <div class="line-content">          file_has_covered_lines = true</div>
  </div>
  <div class="line covered" id="L522">
    <div class="line-number"><a href="#L522">522</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L523">
    <div class="line-number"><a href="#L523">523</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-executable" id="L524">
    <div class="line-number"><a href="#L524">524</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Ensure non-executable lines are never counted as executed or covered</div>
  </div>
  <div class="line covered" id="L525">
    <div class="line-number"><a href="#L525">525</a></div>
    <div class="execution-count">31484</div>    <div class="line-content">        line_data.executed = false</div>
  </div>
  <div class="line covered" id="L526">
    <div class="line-number"><a href="#L526">526</a></div>
    <div class="execution-count">31484</div>    <div class="line-content">        line_data.covered = false</div>
  </div>
  <div class="line covered" id="L527">
    <div class="line-number"><a href="#L527">527</a></div>
    <div class="execution-count">2849</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L528">
    <div class="line-number"><a href="#L528">528</a></div>
    <div class="execution-count">2849</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L529">
    <div class="line-number"><a href="#L529">529</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L530">
    <div class="line-number"><a href="#L530">530</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Count total functions</div>
  </div>
  <div class="line covered" id="L531">
    <div class="line-number"><a href="#L531">531</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    file_data.total_functions = 0</div>
  </div>
  <div class="line covered" id="L532">
    <div class="line-number"><a href="#L532">532</a></div>
    <div class="execution-count">2849</div>    <div class="line-content">    file_data.executed_functions = 0</div>
  </div>
  <div class="line covered" id="L533">
    <div class="line-number"><a href="#L533">533</a></div>
    <div class="execution-count">2849</div>    <div class="line-content">    file_data.covered_functions = 0</div>
  </div>
  <div class="line not-executable" id="L534">
    <div class="line-number"><a href="#L534">534</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L535">
    <div class="line-number"><a href="#L535">535</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Calculate function statistics</div>
  </div>
  <div class="line covered" id="L536">
    <div class="line-number"><a href="#L536">536</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    for func_id, func_data in pairs(file_data.functions) do</div>
  </div>
  <div class="line covered" id="L537">
    <div class="line-number"><a href="#L537">537</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      file_data.total_functions = file_data.total_functions + 1</div>
  </div>
  <div class="line not-executable" id="L538">
    <div class="line-number"><a href="#L538">538</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L539">
    <div class="line-number"><a href="#L539">539</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- A function is executed if its execution count is &gt; 0</div>
  </div>
  <div class="line covered" id="L540">
    <div class="line-number"><a href="#L540">540</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if func_data.execution_count &gt; 0 then</div>
  </div>
  <div class="line covered" id="L541">
    <div class="line-number"><a href="#L541">541</a></div>
    <div class="execution-count">33</div>    <div class="line-content">        func_data.executed = true</div>
  </div>
  <div class="line covered" id="L542">
    <div class="line-number"><a href="#L542">542</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        file_data.executed_functions = file_data.executed_functions + 1</div>
  </div>
  <div class="line not-executable" id="L543">
    <div class="line-number"><a href="#L543">543</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L544">
    <div class="line-number"><a href="#L544">544</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- In this simple implementation, executed functions are considered covered</div>
  </div>
  <div class="line covered" id="L545">
    <div class="line-number"><a href="#L545">545</a></div>
    <div class="execution-count">33</div>    <div class="line-content">        func_data.covered = true</div>
  </div>
  <div class="line covered" id="L546">
    <div class="line-number"><a href="#L546">546</a></div>
    <div class="execution-count">33</div>    <div class="line-content">        file_data.covered_functions = file_data.covered_functions + 1</div>
  </div>
  <div class="line not-executable" id="L547">
    <div class="line-number"><a href="#L547">547</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L548">
    <div class="line-number"><a href="#L548">548</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Mark all lines in the function range as executed and covered</div>
  </div>
  <div class="line covered" id="L549">
    <div class="line-number"><a href="#L549">549</a></div>
    <div class="execution-count">144</div>    <div class="line-content">        for line_num = func_data.start_line, func_data.end_line do</div>
  </div>
  <div class="line covered" id="L550">
    <div class="line-number"><a href="#L550">550</a></div>
    <div class="execution-count">111</div>    <div class="line-content">          local line_data = file_data.lines[line_num]</div>
  </div>
  <div class="line covered" id="L551">
    <div class="line-number"><a href="#L551">551</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          if line_data and line_data.executable then</div>
  </div>
  <div class="line covered" id="L552">
    <div class="line-number"><a href="#L552">552</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            line_data.executed = true</div>
  </div>
  <div class="line covered" id="L553">
    <div class="line-number"><a href="#L553">553</a></div>
    <div class="execution-count">111</div>    <div class="line-content">            line_data.covered = true</div>
  </div>
  <div class="line not-executable" id="L554">
    <div class="line-number"><a href="#L554">554</a></div>
    <div class="execution-count"></div>    <div class="line-content">            </div>
  </div>
  <div class="line not-executable" id="L555">
    <div class="line-number"><a href="#L555">555</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Ensure the line is counted in file statistics if it wasn't already</div>
  </div>
  <div class="line covered" id="L556">
    <div class="line-number"><a href="#L556">556</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            if line_data.execution_count == 0 then</div>
  </div>
  <div class="line covered" id="L557">
    <div class="line-number"><a href="#L557">557</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              line_data.execution_count = 1</div>
  </div>
  <div class="line covered" id="L558">
    <div class="line-number"><a href="#L558">558</a></div>
    <div class="execution-count">111</div>    <div class="line-content">              file_data.executed_lines = file_data.executed_lines + 1</div>
  </div>
  <div class="line covered" id="L559">
    <div class="line-number"><a href="#L559">559</a></div>
    <div class="execution-count">111</div>    <div class="line-content">              file_data.covered_lines = file_data.covered_lines + 1</div>
  </div>
  <div class="line covered" id="L560">
    <div class="line-number"><a href="#L560">560</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              file_has_executed_lines = true</div>
  </div>
  <div class="line covered" id="L561">
    <div class="line-number"><a href="#L561">561</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              file_has_covered_lines = true</div>
  </div>
  <div class="line covered" id="L562">
    <div class="line-number"><a href="#L562">562</a></div>
    <div class="execution-count">4737</div>    <div class="line-content">            end</div>
  </div>
  <div class="line covered" id="L563">
    <div class="line-number"><a href="#L563">563</a></div>
    <div class="execution-count">4626</div>    <div class="line-content">          end</div>
  </div>
  <div class="line covered" id="L564">
    <div class="line-number"><a href="#L564">564</a></div>
    <div class="execution-count">4626</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L565">
    <div class="line-number"><a href="#L565">565</a></div>
    <div class="execution-count">4616</div>    <div class="line-content">      else</div>
  </div>
  <div class="line covered" id="L566">
    <div class="line-number"><a href="#L566">566</a></div>
    <div class="execution-count">4616</div>    <div class="line-content">        func_data.executed = false</div>
  </div>
  <div class="line covered" id="L567">
    <div class="line-number"><a href="#L567">567</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        func_data.covered = false</div>
  </div>
  <div class="line covered" id="L568">
    <div class="line-number"><a href="#L568">568</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L569">
    <div class="line-number"><a href="#L569">569</a></div>
    <div class="execution-count">4616</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L570">
    <div class="line-number"><a href="#L570">570</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L571">
    <div class="line-number"><a href="#L571">571</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update summary function statistics</div>
  </div>
  <div class="line covered" id="L572">
    <div class="line-number"><a href="#L572">572</a></div>
    <div class="execution-count">1370</div>    <div class="line-content">    summary.total_functions = summary.total_functions + file_data.total_functions</div>
  </div>
  <div class="line covered" id="L573">
    <div class="line-number"><a href="#L573">573</a></div>
    <div class="execution-count">1370</div>    <div class="line-content">    summary.executed_functions = summary.executed_functions + file_data.executed_functions</div>
  </div>
  <div class="line covered" id="L574">
    <div class="line-number"><a href="#L574">574</a></div>
    <div class="execution-count">1370</div>    <div class="line-content">    summary.covered_functions = summary.covered_functions + file_data.covered_functions</div>
  </div>
  <div class="line not-executable" id="L575">
    <div class="line-number"><a href="#L575">575</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L576">
    <div class="line-number"><a href="#L576">576</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update file execution flag</div>
  </div>
  <div class="line covered" id="L577">
    <div class="line-number"><a href="#L577">577</a></div>
    <div class="execution-count">111</div>    <div class="line-content">    if file_has_executed_lines then</div>
  </div>
  <div class="line covered" id="L578">
    <div class="line-number"><a href="#L578">578</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      summary.executed_files = summary.executed_files + 1</div>
  </div>
  <div class="line covered" id="L579">
    <div class="line-number"><a href="#L579">579</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L580">
    <div class="line-number"><a href="#L580">580</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L581">
    <div class="line-number"><a href="#L581">581</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update file coverage flag</div>
  </div>
  <div class="line covered" id="L582">
    <div class="line-number"><a href="#L582">582</a></div>
    <div class="execution-count">33</div>    <div class="line-content">    if file_has_covered_lines then</div>
  </div>
  <div class="line covered" id="L583">
    <div class="line-number"><a href="#L583">583</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      summary.covered_files = summary.covered_files + 1</div>
  </div>
  <div class="line covered" id="L584">
    <div class="line-number"><a href="#L584">584</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L585">
    <div class="line-number"><a href="#L585">585</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L586">
    <div class="line-number"><a href="#L586">586</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Calculate file percentages</div>
  </div>
  <div class="line covered" id="L587">
    <div class="line-number"><a href="#L587">587</a></div>
    <div class="execution-count">33</div>    <div class="line-content">    if file_data.executable_lines &gt; 0 then</div>
  </div>
  <div class="line covered" id="L588">
    <div class="line-number"><a href="#L588">588</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      file_data.line_coverage_percent = math.floor((file_data.covered_lines / file_data.executable_lines) * 100)</div>
  </div>
  <div class="line covered" id="L589">
    <div class="line-number"><a href="#L589">589</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      file_data.execution_coverage_percent = math.floor((file_data.executed_lines / file_data.executable_lines) * 100)</div>
  </div>
  <div class="line covered" id="L590">
    <div class="line-number"><a href="#L590">590</a></div>
    <div class="execution-count">33</div>    <div class="line-content">    else</div>
  </div>
  <div class="line covered" id="L591">
    <div class="line-number"><a href="#L591">591</a></div>
    <div class="execution-count">31</div>    <div class="line-content">      file_data.line_coverage_percent = 0</div>
  </div>
  <div class="line covered" id="L592">
    <div class="line-number"><a href="#L592">592</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      file_data.execution_coverage_percent = 0</div>
  </div>
  <div class="line covered" id="L593">
    <div class="line-number"><a href="#L593">593</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L594">
    <div class="line-number"><a href="#L594">594</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L595">
    <div class="line-number"><a href="#L595">595</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Calculate function coverage percent</div>
  </div>
  <div class="line covered" id="L596">
    <div class="line-number"><a href="#L596">596</a></div>
    <div class="execution-count">31</div>    <div class="line-content">    if file_data.total_functions &gt; 0 then</div>
  </div>
  <div class="line covered" id="L597">
    <div class="line-number"><a href="#L597">597</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      file_data.function_coverage_percent = math.floor((file_data.executed_functions / file_data.total_functions) * 100)</div>
  </div>
  <div class="line covered" id="L598">
    <div class="line-number"><a href="#L598">598</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    else</div>
  </div>
  <div class="line covered" id="L599">
    <div class="line-number"><a href="#L599">599</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      file_data.function_coverage_percent = 0</div>
  </div>
  <div class="line covered" id="L600">
    <div class="line-number"><a href="#L600">600</a></div>
    <div class="execution-count">33</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L601">
    <div class="line-number"><a href="#L601">601</a></div>
    <div class="execution-count">33</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L602">
    <div class="line-number"><a href="#L602">602</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L603">
    <div class="line-number"><a href="#L603">603</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Calculate summary percentages</div>
  </div>
  <div class="line covered" id="L604">
    <div class="line-number"><a href="#L604">604</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if summary.executable_lines &gt; 0 then</div>
  </div>
  <div class="line covered" id="L605">
    <div class="line-number"><a href="#L605">605</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    summary.line_coverage_percent = math.floor((summary.covered_lines / summary.executable_lines) * 100)</div>
  </div>
  <div class="line covered" id="L606">
    <div class="line-number"><a href="#L606">606</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    summary.execution_coverage_percent = math.floor((summary.executed_lines / summary.executable_lines) * 100)</div>
  </div>
  <div class="line covered" id="L607">
    <div class="line-number"><a href="#L607">607</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  else</div>
  </div>
  <div class="line covered" id="L608">
    <div class="line-number"><a href="#L608">608</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    summary.line_coverage_percent = 0</div>
  </div>
  <div class="line covered" id="L609">
    <div class="line-number"><a href="#L609">609</a></div>
    <div class="execution-count">33</div>    <div class="line-content">    summary.execution_coverage_percent = 0</div>
  </div>
  <div class="line covered" id="L610">
    <div class="line-number"><a href="#L610">610</a></div>
    <div class="execution-count">28</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L611">
    <div class="line-number"><a href="#L611">611</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L612">
    <div class="line-number"><a href="#L612">612</a></div>
    <div class="execution-count">5</div>    <div class="line-content">  if summary.total_functions &gt; 0 then</div>
  </div>
  <div class="line covered" id="L613">
    <div class="line-number"><a href="#L613">613</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    summary.function_coverage_percent = math.floor((summary.covered_functions / summary.total_functions) * 100)</div>
  </div>
  <div class="line covered" id="L614">
    <div class="line-number"><a href="#L614">614</a></div>
    <div class="execution-count">4</div>    <div class="line-content">  else</div>
  </div>
  <div class="line covered" id="L615">
    <div class="line-number"><a href="#L615">615</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    summary.function_coverage_percent = 0</div>
  </div>
  <div class="line covered" id="L616">
    <div class="line-number"><a href="#L616">616</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L617">
    <div class="line-number"><a href="#L617">617</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L618">
    <div class="line-number"><a href="#L618">618</a></div>
    <div class="execution-count">4</div>    <div class="line-content">  if summary.total_files &gt; 0 then</div>
  </div>
  <div class="line covered" id="L619">
    <div class="line-number"><a href="#L619">619</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    summary.file_coverage_percent = math.floor((summary.covered_files / summary.total_files) * 100)</div>
  </div>
  <div class="line covered" id="L620">
    <div class="line-number"><a href="#L620">620</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  else</div>
  </div>
  <div class="line covered" id="L621">
    <div class="line-number"><a href="#L621">621</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    summary.file_coverage_percent = 0</div>
  </div>
  <div class="line covered" id="L622">
    <div class="line-number"><a href="#L622">622</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L623">
    <div class="line-number"><a href="#L623">623</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L624">
    <div class="line-number"><a href="#L624">624</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Calculate overall coverage (weighted average)</div>
  </div>
  <div class="line covered" id="L625">
    <div class="line-number"><a href="#L625">625</a></div>
    <div class="execution-count">4</div>    <div class="line-content">  if summary.executable_lines &gt; 0 or summary.total_functions &gt; 0 or summary.total_files &gt; 0 then</div>
  </div>
  <div class="line covered" id="L626">
    <div class="line-number"><a href="#L626">626</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    local weights = {</div>
  </div>
  <div class="line covered" id="L627">
    <div class="line-number"><a href="#L627">627</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      lines = 0.7,</div>
  </div>
  <div class="line covered" id="L628">
    <div class="line-number"><a href="#L628">628</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      functions = 0.2,</div>
  </div>
  <div class="line covered" id="L629">
    <div class="line-number"><a href="#L629">629</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      files = 0.1</div>
  </div>
  <div class="line covered" id="L630">
    <div class="line-number"><a href="#L630">630</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    }</div>
  </div>
  <div class="line not-executable" id="L631">
    <div class="line-number"><a href="#L631">631</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L632">
    <div class="line-number"><a href="#L632">632</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    summary.overall_coverage_percent = math.floor(</div>
  </div>
  <div class="line covered" id="L633">
    <div class="line-number"><a href="#L633">633</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      (summary.line_coverage_percent * weights.lines) +</div>
  </div>
  <div class="line covered" id="L634">
    <div class="line-number"><a href="#L634">634</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      (summary.function_coverage_percent * weights.functions) +</div>
  </div>
  <div class="line covered" id="L635">
    <div class="line-number"><a href="#L635">635</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      (summary.file_coverage_percent * weights.files)</div>
  </div>
  <div class="line covered" id="L636">
    <div class="line-number"><a href="#L636">636</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    )</div>
  </div>
  <div class="line covered" id="L637">
    <div class="line-number"><a href="#L637">637</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  else</div>
  </div>
  <div class="line covered" id="L638">
    <div class="line-number"><a href="#L638">638</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    summary.overall_coverage_percent = 0</div>
  </div>
  <div class="line covered" id="L639">
    <div class="line-number"><a href="#L639">639</a></div>
    <div class="execution-count">4</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L640">
    <div class="line-number"><a href="#L640">640</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L641">
    <div class="line-number"><a href="#L641">641</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log detailed statistics for debugging</div>
  </div>
  <div class="line covered" id="L642">
    <div class="line-number"><a href="#L642">642</a></div>
    <div class="execution-count">4</div>    <div class="line-content">  logger.debug(&quot;Coverage summary calculated&quot;, {</div>
  </div>
  <div class="line covered" id="L643">
    <div class="line-number"><a href="#L643">643</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    total_files = summary.total_files,</div>
  </div>
  <div class="line covered" id="L644">
    <div class="line-number"><a href="#L644">644</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    executable_lines = summary.executable_lines,</div>
  </div>
  <div class="line covered" id="L645">
    <div class="line-number"><a href="#L645">645</a></div>
    <div class="execution-count">7</div>    <div class="line-content">    executed_lines = summary.executed_lines,</div>
  </div>
  <div class="line covered" id="L646">
    <div class="line-number"><a href="#L646">646</a></div>
    <div class="execution-count">7</div>    <div class="line-content">    covered_lines = summary.covered_lines,</div>
  </div>
  <div class="line covered" id="L647">
    <div class="line-number"><a href="#L647">647</a></div>
    <div class="execution-count">7</div>    <div class="line-content">    total_functions = summary.total_functions,</div>
  </div>
  <div class="line covered" id="L648">
    <div class="line-number"><a href="#L648">648</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    executed_functions = summary.executed_functions,</div>
  </div>
  <div class="line covered" id="L649">
    <div class="line-number"><a href="#L649">649</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    line_coverage = summary.line_coverage_percent .. &quot;%&quot;,</div>
  </div>
  <div class="line covered" id="L650">
    <div class="line-number"><a href="#L650">650</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    function_coverage = summary.function_coverage_percent .. &quot;%&quot;</div>
  </div>
  <div class="line covered" id="L651">
    <div class="line-number"><a href="#L651">651</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L652">
    <div class="line-number"><a href="#L652">652</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L653">
    <div class="line-number"><a href="#L653">653</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return data</div>
  </div>
  <div class="line covered" id="L654">
    <div class="line-number"><a href="#L654">654</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L655">
    <div class="line-number"><a href="#L655">655</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Validates the coverage data structure</div>
  </div>
  <div class="line not-executable" id="L656">
    <div class="line-number"><a href="#L656">656</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure to validate</div>
  </div>
  <div class="line not-executable" id="L657">
    <div class="line-number"><a href="#L657">657</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean is_valid Whether the data structure is valid</div>
  </div>
  <div class="line not-executable" id="L658">
    <div class="line-number"><a href="#L658">658</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string|nil error_message Error message if validation failed</div>
  </div>
  <div class="line covered" id="L659">
    <div class="line-number"><a href="#L659">659</a></div>
    <div class="execution-count">4</div>    <div class="line-content">function M.validate(data)</div>
  </div>
  <div class="line not-executable" id="L660">
    <div class="line-number"><a href="#L660">660</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check basic structure</div>
  </div>
  <div class="line covered" id="L661">
    <div class="line-number"><a href="#L661">661</a></div>
    <div class="execution-count">4</div>    <div class="line-content">  if type(data) ~= &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L662">
    <div class="line-number"><a href="#L662">662</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    return false, &quot;Coverage data must be a table&quot;</div>
  </div>
  <div class="line covered" id="L663">
    <div class="line-number"><a href="#L663">663</a></div>
    <div class="execution-count">4</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L664">
    <div class="line-number"><a href="#L664">664</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L665">
    <div class="line-number"><a href="#L665">665</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if type(data.summary) ~= &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L666">
    <div class="line-number"><a href="#L666">666</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    return false, &quot;Coverage data must have a summary field&quot;</div>
  </div>
  <div class="line covered" id="L667">
    <div class="line-number"><a href="#L667">667</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L668">
    <div class="line-number"><a href="#L668">668</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L669">
    <div class="line-number"><a href="#L669">669</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(data.files) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L670">
    <div class="line-number"><a href="#L670">670</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, &quot;Coverage data must have a files field&quot;</div>
  </div>
  <div class="line not-covered" id="L671">
    <div class="line-number"><a href="#L671">671</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L672">
    <div class="line-number"><a href="#L672">672</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L673">
    <div class="line-number"><a href="#L673">673</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check summary fields</div>
  </div>
  <div class="line not-covered" id="L674">
    <div class="line-number"><a href="#L674">674</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local required_summary_fields = {</div>
  </div>
  <div class="line not-covered" id="L675">
    <div class="line-number"><a href="#L675">675</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;total_files&quot;, &quot;covered_files&quot;, &quot;executed_files&quot;, &quot;file_coverage_percent&quot;,</div>
  </div>
  <div class="line not-covered" id="L676">
    <div class="line-number"><a href="#L676">676</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;total_lines&quot;, &quot;executable_lines&quot;, &quot;executed_lines&quot;, &quot;covered_lines&quot;,</div>
  </div>
  <div class="line not-covered" id="L677">
    <div class="line-number"><a href="#L677">677</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;line_coverage_percent&quot;, &quot;execution_coverage_percent&quot;,</div>
  </div>
  <div class="line not-covered" id="L678">
    <div class="line-number"><a href="#L678">678</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;total_functions&quot;, &quot;executed_functions&quot;, &quot;covered_functions&quot;, &quot;function_coverage_percent&quot;,</div>
  </div>
  <div class="line not-covered" id="L679">
    <div class="line-number"><a href="#L679">679</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;overall_coverage_percent&quot;</div>
  </div>
  <div class="line not-covered" id="L680">
    <div class="line-number"><a href="#L680">680</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L681">
    <div class="line-number"><a href="#L681">681</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L682">
    <div class="line-number"><a href="#L682">682</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, field in ipairs(required_summary_fields) do</div>
  </div>
  <div class="line not-covered" id="L683">
    <div class="line-number"><a href="#L683">683</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(data.summary[field]) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L684">
    <div class="line-number"><a href="#L684">684</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, &quot;Summary field '&quot; .. field .. &quot;' must be a number&quot;</div>
  </div>
  <div class="line not-covered" id="L685">
    <div class="line-number"><a href="#L685">685</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L686">
    <div class="line-number"><a href="#L686">686</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L687">
    <div class="line-number"><a href="#L687">687</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L688">
    <div class="line-number"><a href="#L688">688</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check files</div>
  </div>
  <div class="line not-covered" id="L689">
    <div class="line-number"><a href="#L689">689</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for path, file_data in pairs(data.files) do</div>
  </div>
  <div class="line not-executable" id="L690">
    <div class="line-number"><a href="#L690">690</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Path must be normalized</div>
  </div>
  <div class="line not-covered" id="L691">
    <div class="line-number"><a href="#L691">691</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if path ~= M.normalize_path(path) then</div>
  </div>
  <div class="line not-covered" id="L692">
    <div class="line-number"><a href="#L692">692</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, &quot;File path '&quot; .. path .. &quot;' is not normalized&quot;</div>
  </div>
  <div class="line not-covered" id="L693">
    <div class="line-number"><a href="#L693">693</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L694">
    <div class="line-number"><a href="#L694">694</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L695">
    <div class="line-number"><a href="#L695">695</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check file structure</div>
  </div>
  <div class="line not-covered" id="L696">
    <div class="line-number"><a href="#L696">696</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(file_data) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L697">
    <div class="line-number"><a href="#L697">697</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, &quot;File data for '&quot; .. path .. &quot;' must be a table&quot;</div>
  </div>
  <div class="line not-covered" id="L698">
    <div class="line-number"><a href="#L698">698</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L699">
    <div class="line-number"><a href="#L699">699</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L700">
    <div class="line-number"><a href="#L700">700</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check required file fields</div>
  </div>
  <div class="line not-covered" id="L701">
    <div class="line-number"><a href="#L701">701</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local required_file_fields = {</div>
  </div>
  <div class="line not-covered" id="L702">
    <div class="line-number"><a href="#L702">702</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;path&quot;, &quot;name&quot;, &quot;source&quot;, &quot;lines&quot;, &quot;execution_counts&quot;, &quot;functions&quot;, &quot;blocks&quot;,</div>
  </div>
  <div class="line not-covered" id="L703">
    <div class="line-number"><a href="#L703">703</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;total_lines&quot;, &quot;executable_lines&quot;, &quot;executed_lines&quot;, &quot;covered_lines&quot;,</div>
  </div>
  <div class="line not-covered" id="L704">
    <div class="line-number"><a href="#L704">704</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;line_coverage_percent&quot;, &quot;execution_coverage_percent&quot;,</div>
  </div>
  <div class="line not-covered" id="L705">
    <div class="line-number"><a href="#L705">705</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;total_functions&quot;, &quot;executed_functions&quot;, &quot;covered_functions&quot;, &quot;function_coverage_percent&quot;</div>
  </div>
  <div class="line not-covered" id="L706">
    <div class="line-number"><a href="#L706">706</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    }</div>
  </div>
  <div class="line not-executable" id="L707">
    <div class="line-number"><a href="#L707">707</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L708">
    <div class="line-number"><a href="#L708">708</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, field in ipairs(required_file_fields) do</div>
  </div>
  <div class="line not-covered" id="L709">
    <div class="line-number"><a href="#L709">709</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if file_data[field] == nil then</div>
  </div>
  <div class="line not-covered" id="L710">
    <div class="line-number"><a href="#L710">710</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false, &quot;File '&quot; .. path .. &quot;' missing required field '&quot; .. field .. &quot;'&quot;</div>
  </div>
  <div class="line not-covered" id="L711">
    <div class="line-number"><a href="#L711">711</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L712">
    <div class="line-number"><a href="#L712">712</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L713">
    <div class="line-number"><a href="#L713">713</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L714">
    <div class="line-number"><a href="#L714">714</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Validate line data</div>
  </div>
  <div class="line not-covered" id="L715">
    <div class="line-number"><a href="#L715">715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for line_num, line_data in pairs(file_data.lines) do</div>
  </div>
  <div class="line not-covered" id="L716">
    <div class="line-number"><a href="#L716">716</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(line_num) ~= &quot;number&quot; or line_num &lt; 1 or math.floor(line_num) ~= line_num then</div>
  </div>
  <div class="line not-covered" id="L717">
    <div class="line-number"><a href="#L717">717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false, &quot;Line number '&quot; .. tostring(line_num) .. &quot;' in file '&quot; .. path .. &quot;' must be a positive integer&quot;</div>
  </div>
  <div class="line not-covered" id="L718">
    <div class="line-number"><a href="#L718">718</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L719">
    <div class="line-number"><a href="#L719">719</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L720">
    <div class="line-number"><a href="#L720">720</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Check line data structure</div>
  </div>
  <div class="line not-covered" id="L721">
    <div class="line-number"><a href="#L721">721</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(line_data) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L722">
    <div class="line-number"><a href="#L722">722</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false, &quot;Line data for line &quot; .. line_num .. &quot; in file '&quot; .. path .. &quot;' must be a table&quot;</div>
  </div>
  <div class="line not-covered" id="L723">
    <div class="line-number"><a href="#L723">723</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L724">
    <div class="line-number"><a href="#L724">724</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L725">
    <div class="line-number"><a href="#L725">725</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Check required line fields</div>
  </div>
  <div class="line not-covered" id="L726">
    <div class="line-number"><a href="#L726">726</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local required_line_fields = {</div>
  </div>
  <div class="line not-covered" id="L727">
    <div class="line-number"><a href="#L727">727</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;executable&quot;, &quot;executed&quot;, &quot;covered&quot;, &quot;execution_count&quot;, &quot;line_type&quot;, &quot;content&quot;</div>
  </div>
  <div class="line not-covered" id="L728">
    <div class="line-number"><a href="#L728">728</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-executable" id="L729">
    <div class="line-number"><a href="#L729">729</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L730">
    <div class="line-number"><a href="#L730">730</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, field in ipairs(required_line_fields) do</div>
  </div>
  <div class="line not-covered" id="L731">
    <div class="line-number"><a href="#L731">731</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if line_data[field] == nil then</div>
  </div>
  <div class="line not-covered" id="L732">
    <div class="line-number"><a href="#L732">732</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          return false, &quot;Line &quot; .. line_num .. &quot; in file '&quot; .. path .. &quot;' missing required field '&quot; .. field .. &quot;'&quot;</div>
  </div>
  <div class="line not-covered" id="L733">
    <div class="line-number"><a href="#L733">733</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L734">
    <div class="line-number"><a href="#L734">734</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L735">
    <div class="line-number"><a href="#L735">735</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L736">
    <div class="line-number"><a href="#L736">736</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Validate line relationships</div>
  </div>
  <div class="line not-covered" id="L737">
    <div class="line-number"><a href="#L737">737</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if line_data.covered and not line_data.executed then</div>
  </div>
  <div class="line not-covered" id="L738">
    <div class="line-number"><a href="#L738">738</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false, &quot;Line &quot; .. line_num .. &quot; in file '&quot; .. path .. &quot;' is marked as covered but not executed&quot;</div>
  </div>
  <div class="line not-covered" id="L739">
    <div class="line-number"><a href="#L739">739</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L740">
    <div class="line-number"><a href="#L740">740</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L741">
    <div class="line-number"><a href="#L741">741</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L742">
    <div class="line-number"><a href="#L742">742</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L743">
    <div class="line-number"><a href="#L743">743</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Validate summary statistics match file data</div>
  </div>
  <div class="line not-covered" id="L744">
    <div class="line-number"><a href="#L744">744</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local file_count = 0</div>
  </div>
  <div class="line not-covered" id="L745">
    <div class="line-number"><a href="#L745">745</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local total_lines = 0</div>
  </div>
  <div class="line not-covered" id="L746">
    <div class="line-number"><a href="#L746">746</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local executable_lines = 0</div>
  </div>
  <div class="line not-covered" id="L747">
    <div class="line-number"><a href="#L747">747</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local executed_lines = 0</div>
  </div>
  <div class="line not-covered" id="L748">
    <div class="line-number"><a href="#L748">748</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local covered_lines = 0</div>
  </div>
  <div class="line not-covered" id="L749">
    <div class="line-number"><a href="#L749">749</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local total_functions = 0</div>
  </div>
  <div class="line not-covered" id="L750">
    <div class="line-number"><a href="#L750">750</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local executed_functions = 0</div>
  </div>
  <div class="line not-covered" id="L751">
    <div class="line-number"><a href="#L751">751</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local covered_functions = 0</div>
  </div>
  <div class="line not-covered" id="L752">
    <div class="line-number"><a href="#L752">752</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local executed_files = 0</div>
  </div>
  <div class="line not-covered" id="L753">
    <div class="line-number"><a href="#L753">753</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local covered_files = 0</div>
  </div>
  <div class="line not-executable" id="L754">
    <div class="line-number"><a href="#L754">754</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L755">
    <div class="line-number"><a href="#L755">755</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for path, file_data in pairs(data.files) do</div>
  </div>
  <div class="line not-covered" id="L756">
    <div class="line-number"><a href="#L756">756</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_count = file_count + 1</div>
  </div>
  <div class="line not-covered" id="L757">
    <div class="line-number"><a href="#L757">757</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    total_lines = total_lines + file_data.total_lines</div>
  </div>
  <div class="line not-covered" id="L758">
    <div class="line-number"><a href="#L758">758</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    executable_lines = executable_lines + file_data.executable_lines</div>
  </div>
  <div class="line not-covered" id="L759">
    <div class="line-number"><a href="#L759">759</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    executed_lines = executed_lines + file_data.executed_lines</div>
  </div>
  <div class="line not-covered" id="L760">
    <div class="line-number"><a href="#L760">760</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    covered_lines = covered_lines + file_data.covered_lines</div>
  </div>
  <div class="line not-covered" id="L761">
    <div class="line-number"><a href="#L761">761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    total_functions = total_functions + file_data.total_functions</div>
  </div>
  <div class="line not-covered" id="L762">
    <div class="line-number"><a href="#L762">762</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    executed_functions = executed_functions + file_data.executed_functions</div>
  </div>
  <div class="line not-covered" id="L763">
    <div class="line-number"><a href="#L763">763</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    covered_functions = covered_functions + file_data.covered_functions</div>
  </div>
  <div class="line not-executable" id="L764">
    <div class="line-number"><a href="#L764">764</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L765">
    <div class="line-number"><a href="#L765">765</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if file_data.executed_lines &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L766">
    <div class="line-number"><a href="#L766">766</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      executed_files = executed_files + 1</div>
  </div>
  <div class="line not-covered" id="L767">
    <div class="line-number"><a href="#L767">767</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L768">
    <div class="line-number"><a href="#L768">768</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L769">
    <div class="line-number"><a href="#L769">769</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if file_data.covered_lines &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L770">
    <div class="line-number"><a href="#L770">770</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      covered_files = covered_files + 1</div>
  </div>
  <div class="line not-covered" id="L771">
    <div class="line-number"><a href="#L771">771</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L772">
    <div class="line-number"><a href="#L772">772</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L773">
    <div class="line-number"><a href="#L773">773</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L774">
    <div class="line-number"><a href="#L774">774</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check summary matches calculated values but allow for some flexibility</div>
  </div>
  <div class="line not-executable" id="L775">
    <div class="line-number"><a href="#L775">775</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Our goal is to ensure the data is in the correct form, and we know in the test environment</div>
  </div>
  <div class="line not-executable" id="L776">
    <div class="line-number"><a href="#L776">776</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- we might sometimes have mismatches due to various factors like modules being loaded in different ways</div>
  </div>
  <div class="line not-executable" id="L777">
    <div class="line-number"><a href="#L777">777</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L778">
    <div class="line-number"><a href="#L778">778</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Just log differences for now</div>
  </div>
  <div class="line not-covered" id="L779">
    <div class="line-number"><a href="#L779">779</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if data.summary.total_files ~= file_count then</div>
  </div>
  <div class="line not-covered" id="L780">
    <div class="line-number"><a href="#L780">780</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Summary mismatch: total_files&quot;, {</div>
  </div>
  <div class="line not-covered" id="L781">
    <div class="line-number"><a href="#L781">781</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      summary_value = data.summary.total_files,</div>
  </div>
  <div class="line not-covered" id="L782">
    <div class="line-number"><a href="#L782">782</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      calculated_value = file_count</div>
  </div>
  <div class="line not-covered" id="L783">
    <div class="line-number"><a href="#L783">783</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L784">
    <div class="line-number"><a href="#L784">784</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fix it rather than failing validation</div>
  </div>
  <div class="line not-covered" id="L785">
    <div class="line-number"><a href="#L785">785</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data.summary.total_files = file_count</div>
  </div>
  <div class="line not-covered" id="L786">
    <div class="line-number"><a href="#L786">786</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L787">
    <div class="line-number"><a href="#L787">787</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L788">
    <div class="line-number"><a href="#L788">788</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if data.summary.total_lines ~= total_lines then</div>
  </div>
  <div class="line not-covered" id="L789">
    <div class="line-number"><a href="#L789">789</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Summary mismatch: total_lines&quot;, {</div>
  </div>
  <div class="line not-covered" id="L790">
    <div class="line-number"><a href="#L790">790</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      summary_value = data.summary.total_lines,</div>
  </div>
  <div class="line not-covered" id="L791">
    <div class="line-number"><a href="#L791">791</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      calculated_value = total_lines</div>
  </div>
  <div class="line not-covered" id="L792">
    <div class="line-number"><a href="#L792">792</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L793">
    <div class="line-number"><a href="#L793">793</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fix it</div>
  </div>
  <div class="line not-covered" id="L794">
    <div class="line-number"><a href="#L794">794</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data.summary.total_lines = total_lines</div>
  </div>
  <div class="line not-covered" id="L795">
    <div class="line-number"><a href="#L795">795</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L796">
    <div class="line-number"><a href="#L796">796</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L797">
    <div class="line-number"><a href="#L797">797</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if data.summary.executable_lines ~= executable_lines then</div>
  </div>
  <div class="line not-covered" id="L798">
    <div class="line-number"><a href="#L798">798</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Summary mismatch: executable_lines&quot;, {</div>
  </div>
  <div class="line not-covered" id="L799">
    <div class="line-number"><a href="#L799">799</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      summary_value = data.summary.executable_lines,</div>
  </div>
  <div class="line not-covered" id="L800">
    <div class="line-number"><a href="#L800">800</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      calculated_value = executable_lines</div>
  </div>
  <div class="line not-covered" id="L801">
    <div class="line-number"><a href="#L801">801</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L802">
    <div class="line-number"><a href="#L802">802</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fix it</div>
  </div>
  <div class="line not-covered" id="L803">
    <div class="line-number"><a href="#L803">803</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data.summary.executable_lines = executable_lines</div>
  </div>
  <div class="line not-covered" id="L804">
    <div class="line-number"><a href="#L804">804</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L805">
    <div class="line-number"><a href="#L805">805</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L806">
    <div class="line-number"><a href="#L806">806</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if data.summary.executed_lines ~= executed_lines then</div>
  </div>
  <div class="line not-covered" id="L807">
    <div class="line-number"><a href="#L807">807</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Summary mismatch: executed_lines&quot;, {</div>
  </div>
  <div class="line not-covered" id="L808">
    <div class="line-number"><a href="#L808">808</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      summary_value = data.summary.executed_lines,</div>
  </div>
  <div class="line not-covered" id="L809">
    <div class="line-number"><a href="#L809">809</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      calculated_value = executed_lines</div>
  </div>
  <div class="line not-covered" id="L810">
    <div class="line-number"><a href="#L810">810</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L811">
    <div class="line-number"><a href="#L811">811</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fix it</div>
  </div>
  <div class="line not-covered" id="L812">
    <div class="line-number"><a href="#L812">812</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data.summary.executed_lines = executed_lines</div>
  </div>
  <div class="line not-covered" id="L813">
    <div class="line-number"><a href="#L813">813</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L814">
    <div class="line-number"><a href="#L814">814</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L815">
    <div class="line-number"><a href="#L815">815</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if data.summary.covered_lines ~= covered_lines then</div>
  </div>
  <div class="line not-covered" id="L816">
    <div class="line-number"><a href="#L816">816</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Summary mismatch: covered_lines&quot;, {</div>
  </div>
  <div class="line not-covered" id="L817">
    <div class="line-number"><a href="#L817">817</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      summary_value = data.summary.covered_lines,</div>
  </div>
  <div class="line not-covered" id="L818">
    <div class="line-number"><a href="#L818">818</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      calculated_value = covered_lines</div>
  </div>
  <div class="line not-covered" id="L819">
    <div class="line-number"><a href="#L819">819</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L820">
    <div class="line-number"><a href="#L820">820</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fix it</div>
  </div>
  <div class="line not-covered" id="L821">
    <div class="line-number"><a href="#L821">821</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data.summary.covered_lines = covered_lines</div>
  </div>
  <div class="line not-covered" id="L822">
    <div class="line-number"><a href="#L822">822</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L823">
    <div class="line-number"><a href="#L823">823</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L824">
    <div class="line-number"><a href="#L824">824</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if data.summary.executed_files ~= executed_files then</div>
  </div>
  <div class="line not-covered" id="L825">
    <div class="line-number"><a href="#L825">825</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Summary mismatch: executed_files&quot;, {</div>
  </div>
  <div class="line not-covered" id="L826">
    <div class="line-number"><a href="#L826">826</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      summary_value = data.summary.executed_files,</div>
  </div>
  <div class="line not-covered" id="L827">
    <div class="line-number"><a href="#L827">827</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      calculated_value = executed_files</div>
  </div>
  <div class="line not-covered" id="L828">
    <div class="line-number"><a href="#L828">828</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L829">
    <div class="line-number"><a href="#L829">829</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fix it</div>
  </div>
  <div class="line not-covered" id="L830">
    <div class="line-number"><a href="#L830">830</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data.summary.executed_files = executed_files</div>
  </div>
  <div class="line not-covered" id="L831">
    <div class="line-number"><a href="#L831">831</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L832">
    <div class="line-number"><a href="#L832">832</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L833">
    <div class="line-number"><a href="#L833">833</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if data.summary.covered_files ~= covered_files then</div>
  </div>
  <div class="line not-covered" id="L834">
    <div class="line-number"><a href="#L834">834</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Summary mismatch: covered_files&quot;, {</div>
  </div>
  <div class="line not-covered" id="L835">
    <div class="line-number"><a href="#L835">835</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      summary_value = data.summary.covered_files,</div>
  </div>
  <div class="line not-covered" id="L836">
    <div class="line-number"><a href="#L836">836</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      calculated_value = covered_files</div>
  </div>
  <div class="line not-covered" id="L837">
    <div class="line-number"><a href="#L837">837</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L838">
    <div class="line-number"><a href="#L838">838</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fix it</div>
  </div>
  <div class="line not-covered" id="L839">
    <div class="line-number"><a href="#L839">839</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data.summary.covered_files = covered_files</div>
  </div>
  <div class="line not-covered" id="L840">
    <div class="line-number"><a href="#L840">840</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L841">
    <div class="line-number"><a href="#L841">841</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L842">
    <div class="line-number"><a href="#L842">842</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true, nil</div>
  </div>
  <div class="line not-covered" id="L843">
    <div class="line-number"><a href="#L843">843</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L844">
    <div class="line-number"><a href="#L844">844</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Registers a function in the coverage data</div>
  </div>
  <div class="line not-executable" id="L845">
    <div class="line-number"><a href="#L845">845</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure</div>
  </div>
  <div class="line not-executable" id="L846">
    <div class="line-number"><a href="#L846">846</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the file containing the function</div>
  </div>
  <div class="line not-executable" id="L847">
    <div class="line-number"><a href="#L847">847</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param func_name string The function name</div>
  </div>
  <div class="line not-executable" id="L848">
    <div class="line-number"><a href="#L848">848</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param start_line number The starting line of the function</div>
  </div>
  <div class="line not-executable" id="L849">
    <div class="line-number"><a href="#L849">849</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param end_line number The ending line of the function</div>
  </div>
  <div class="line not-executable" id="L850">
    <div class="line-number"><a href="#L850">850</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param func_type string The function type (global, local, method, anonymous, closure)</div>
  </div>
  <div class="line not-executable" id="L851">
    <div class="line-number"><a href="#L851">851</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the operation succeeded</div>
  </div>
  <div class="line not-covered" id="L852">
    <div class="line-number"><a href="#L852">852</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.register_function(data, file_path, func_name, start_line, end_line, func_type)</div>
  </div>
  <div class="line not-executable" id="L853">
    <div class="line-number"><a href="#L853">853</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L854">
    <div class="line-number"><a href="#L854">854</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(data) == &quot;table&quot;, &quot;data must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L855">
    <div class="line-number"><a href="#L855">855</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L856">
    <div class="line-number"><a href="#L856">856</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(func_name) == &quot;string&quot;, &quot;func_name must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L857">
    <div class="line-number"><a href="#L857">857</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(start_line) == &quot;number&quot;, &quot;start_line must be a number&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L858">
    <div class="line-number"><a href="#L858">858</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(end_line) == &quot;number&quot;, &quot;end_line must be a number&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L859">
    <div class="line-number"><a href="#L859">859</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(func_type) == &quot;string&quot;, &quot;func_type must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L860">
    <div class="line-number"><a href="#L860">860</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L861">
    <div class="line-number"><a href="#L861">861</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Validate function type</div>
  </div>
  <div class="line not-covered" id="L862">
    <div class="line-number"><a href="#L862">862</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local valid_types = {</div>
  </div>
  <div class="line not-covered" id="L863">
    <div class="line-number"><a href="#L863">863</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    [M.FUNCTION_TYPES.GLOBAL] = true,</div>
  </div>
  <div class="line not-covered" id="L864">
    <div class="line-number"><a href="#L864">864</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    [M.FUNCTION_TYPES.LOCAL] = true,</div>
  </div>
  <div class="line not-covered" id="L865">
    <div class="line-number"><a href="#L865">865</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    [M.FUNCTION_TYPES.METHOD] = true,</div>
  </div>
  <div class="line not-covered" id="L866">
    <div class="line-number"><a href="#L866">866</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    [M.FUNCTION_TYPES.ANONYMOUS] = true,</div>
  </div>
  <div class="line not-covered" id="L867">
    <div class="line-number"><a href="#L867">867</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    [M.FUNCTION_TYPES.CLOSURE] = true</div>
  </div>
  <div class="line not-covered" id="L868">
    <div class="line-number"><a href="#L868">868</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L869">
    <div class="line-number"><a href="#L869">869</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L870">
    <div class="line-number"><a href="#L870">870</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not valid_types[func_type] then</div>
  </div>
  <div class="line not-covered" id="L871">
    <div class="line-number"><a href="#L871">871</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Invalid function type&quot;, {</div>
  </div>
  <div class="line not-covered" id="L872">
    <div class="line-number"><a href="#L872">872</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = file_path,</div>
  </div>
  <div class="line not-covered" id="L873">
    <div class="line-number"><a href="#L873">873</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_name = func_name,</div>
  </div>
  <div class="line not-covered" id="L874">
    <div class="line-number"><a href="#L874">874</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_type = func_type,</div>
  </div>
  <div class="line not-covered" id="L875">
    <div class="line-number"><a href="#L875">875</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      valid_types = table.concat({</div>
  </div>
  <div class="line not-covered" id="L876">
    <div class="line-number"><a href="#L876">876</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        M.FUNCTION_TYPES.GLOBAL, </div>
  </div>
  <div class="line not-covered" id="L877">
    <div class="line-number"><a href="#L877">877</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        M.FUNCTION_TYPES.LOCAL, </div>
  </div>
  <div class="line not-covered" id="L878">
    <div class="line-number"><a href="#L878">878</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        M.FUNCTION_TYPES.METHOD, </div>
  </div>
  <div class="line not-covered" id="L879">
    <div class="line-number"><a href="#L879">879</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        M.FUNCTION_TYPES.ANONYMOUS, </div>
  </div>
  <div class="line not-covered" id="L880">
    <div class="line-number"><a href="#L880">880</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        M.FUNCTION_TYPES.CLOSURE</div>
  </div>
  <div class="line not-covered" id="L881">
    <div class="line-number"><a href="#L881">881</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }, &quot;, &quot;)</div>
  </div>
  <div class="line not-covered" id="L882">
    <div class="line-number"><a href="#L882">882</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L883">
    <div class="line-number"><a href="#L883">883</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L884">
    <div class="line-number"><a href="#L884">884</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L885">
    <div class="line-number"><a href="#L885">885</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L886">
    <div class="line-number"><a href="#L886">886</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L887">
    <div class="line-number"><a href="#L887">887</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = M.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L888">
    <div class="line-number"><a href="#L888">888</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L889">
    <div class="line-number"><a href="#L889">889</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the file data</div>
  </div>
  <div class="line not-covered" id="L890">
    <div class="line-number"><a href="#L890">890</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local file_data = data.files[normalized_path]</div>
  </div>
  <div class="line not-covered" id="L891">
    <div class="line-number"><a href="#L891">891</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data then</div>
  </div>
  <div class="line not-covered" id="L892">
    <div class="line-number"><a href="#L892">892</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to register function for a file not in the coverage data&quot;, {</div>
  </div>
  <div class="line not-covered" id="L893">
    <div class="line-number"><a href="#L893">893</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L894">
    <div class="line-number"><a href="#L894">894</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_name = func_name</div>
  </div>
  <div class="line not-covered" id="L895">
    <div class="line-number"><a href="#L895">895</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L896">
    <div class="line-number"><a href="#L896">896</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L897">
    <div class="line-number"><a href="#L897">897</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L898">
    <div class="line-number"><a href="#L898">898</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L899">
    <div class="line-number"><a href="#L899">899</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a unique function ID</div>
  </div>
  <div class="line not-covered" id="L900">
    <div class="line-number"><a href="#L900">900</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local func_id = func_name .. &quot;:&quot; .. start_line .. &quot;-&quot; .. end_line</div>
  </div>
  <div class="line not-executable" id="L901">
    <div class="line-number"><a href="#L901">901</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L902">
    <div class="line-number"><a href="#L902">902</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if function already exists</div>
  </div>
  <div class="line not-covered" id="L903">
    <div class="line-number"><a href="#L903">903</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if file_data.functions[func_id] then</div>
  </div>
  <div class="line not-covered" id="L904">
    <div class="line-number"><a href="#L904">904</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Function already registered&quot;, {</div>
  </div>
  <div class="line not-covered" id="L905">
    <div class="line-number"><a href="#L905">905</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L906">
    <div class="line-number"><a href="#L906">906</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_name = func_name,</div>
  </div>
  <div class="line not-covered" id="L907">
    <div class="line-number"><a href="#L907">907</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_id = func_id</div>
  </div>
  <div class="line not-covered" id="L908">
    <div class="line-number"><a href="#L908">908</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L909">
    <div class="line-number"><a href="#L909">909</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L910">
    <div class="line-number"><a href="#L910">910</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L911">
    <div class="line-number"><a href="#L911">911</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L912">
    <div class="line-number"><a href="#L912">912</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Register the function</div>
  </div>
  <div class="line not-covered" id="L913">
    <div class="line-number"><a href="#L913">913</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  file_data.functions[func_id] = {</div>
  </div>
  <div class="line not-covered" id="L914">
    <div class="line-number"><a href="#L914">914</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    name = func_name,</div>
  </div>
  <div class="line not-covered" id="L915">
    <div class="line-number"><a href="#L915">915</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    start_line = start_line,</div>
  </div>
  <div class="line not-covered" id="L916">
    <div class="line-number"><a href="#L916">916</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end_line = end_line,</div>
  </div>
  <div class="line not-covered" id="L917">
    <div class="line-number"><a href="#L917">917</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    type = func_type,</div>
  </div>
  <div class="line not-covered" id="L918">
    <div class="line-number"><a href="#L918">918</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    executed = false,</div>
  </div>
  <div class="line not-covered" id="L919">
    <div class="line-number"><a href="#L919">919</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    covered = false,</div>
  </div>
  <div class="line not-covered" id="L920">
    <div class="line-number"><a href="#L920">920</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    execution_count = 0,</div>
  </div>
  <div class="line not-executable" id="L921">
    <div class="line-number"><a href="#L921">921</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Track lines that belong to this function</div>
  </div>
  <div class="line not-covered" id="L922">
    <div class="line-number"><a href="#L922">922</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    lines = {},</div>
  </div>
  <div class="line not-covered" id="L923">
    <div class="line-number"><a href="#L923">923</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L924">
    <div class="line-number"><a href="#L924">924</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L925">
    <div class="line-number"><a href="#L925">925</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update line-to-function mapping</div>
  </div>
  <div class="line not-covered" id="L926">
    <div class="line-number"><a href="#L926">926</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for line_num = start_line, end_line do</div>
  </div>
  <div class="line not-covered" id="L927">
    <div class="line-number"><a href="#L927">927</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if file_data.lines[line_num] then</div>
  </div>
  <div class="line not-executable" id="L928">
    <div class="line-number"><a href="#L928">928</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Add this line to the function's lines</div>
  </div>
  <div class="line not-covered" id="L929">
    <div class="line-number"><a href="#L929">929</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_data.functions[func_id].lines[line_num] = true</div>
  </div>
  <div class="line not-covered" id="L930">
    <div class="line-number"><a href="#L930">930</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L931">
    <div class="line-number"><a href="#L931">931</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L932">
    <div class="line-number"><a href="#L932">932</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L933">
    <div class="line-number"><a href="#L933">933</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update file statistics</div>
  </div>
  <div class="line not-covered" id="L934">
    <div class="line-number"><a href="#L934">934</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  file_data.total_functions = file_data.total_functions + 1</div>
  </div>
  <div class="line not-covered" id="L935">
    <div class="line-number"><a href="#L935">935</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  data.summary.total_functions = data.summary.total_functions + 1</div>
  </div>
  <div class="line not-executable" id="L936">
    <div class="line-number"><a href="#L936">936</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L937">
    <div class="line-number"><a href="#L937">937</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.debug(&quot;Registered function&quot;, {</div>
  </div>
  <div class="line not-covered" id="L938">
    <div class="line-number"><a href="#L938">938</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L939">
    <div class="line-number"><a href="#L939">939</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    func_name = func_name,</div>
  </div>
  <div class="line not-covered" id="L940">
    <div class="line-number"><a href="#L940">940</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    func_id = func_id,</div>
  </div>
  <div class="line not-covered" id="L941">
    <div class="line-number"><a href="#L941">941</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    start_line = start_line,</div>
  </div>
  <div class="line not-covered" id="L942">
    <div class="line-number"><a href="#L942">942</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end_line = end_line,</div>
  </div>
  <div class="line not-covered" id="L943">
    <div class="line-number"><a href="#L943">943</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    func_type = func_type</div>
  </div>
  <div class="line not-covered" id="L944">
    <div class="line-number"><a href="#L944">944</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L945">
    <div class="line-number"><a href="#L945">945</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L946">
    <div class="line-number"><a href="#L946">946</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L947">
    <div class="line-number"><a href="#L947">947</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L948">
    <div class="line-number"><a href="#L948">948</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Marks a function as executed</div>
  </div>
  <div class="line not-executable" id="L949">
    <div class="line-number"><a href="#L949">949</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure</div>
  </div>
  <div class="line not-executable" id="L950">
    <div class="line-number"><a href="#L950">950</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the file</div>
  </div>
  <div class="line not-executable" id="L951">
    <div class="line-number"><a href="#L951">951</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param func_id string The function ID</div>
  </div>
  <div class="line not-executable" id="L952">
    <div class="line-number"><a href="#L952">952</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the operation succeeded</div>
  </div>
  <div class="line not-covered" id="L953">
    <div class="line-number"><a href="#L953">953</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.mark_function_executed(data, file_path, func_id)</div>
  </div>
  <div class="line not-executable" id="L954">
    <div class="line-number"><a href="#L954">954</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L955">
    <div class="line-number"><a href="#L955">955</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(data) == &quot;table&quot;, &quot;data must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L956">
    <div class="line-number"><a href="#L956">956</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L957">
    <div class="line-number"><a href="#L957">957</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(func_id) == &quot;string&quot;, &quot;func_id must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L958">
    <div class="line-number"><a href="#L958">958</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L959">
    <div class="line-number"><a href="#L959">959</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L960">
    <div class="line-number"><a href="#L960">960</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = M.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L961">
    <div class="line-number"><a href="#L961">961</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L962">
    <div class="line-number"><a href="#L962">962</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the file data</div>
  </div>
  <div class="line not-covered" id="L963">
    <div class="line-number"><a href="#L963">963</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local file_data = data.files[normalized_path]</div>
  </div>
  <div class="line not-covered" id="L964">
    <div class="line-number"><a href="#L964">964</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data then</div>
  </div>
  <div class="line not-covered" id="L965">
    <div class="line-number"><a href="#L965">965</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to mark function executed for a file not in the coverage data&quot;, {</div>
  </div>
  <div class="line not-covered" id="L966">
    <div class="line-number"><a href="#L966">966</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L967">
    <div class="line-number"><a href="#L967">967</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_id = func_id</div>
  </div>
  <div class="line not-covered" id="L968">
    <div class="line-number"><a href="#L968">968</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L969">
    <div class="line-number"><a href="#L969">969</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L970">
    <div class="line-number"><a href="#L970">970</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L971">
    <div class="line-number"><a href="#L971">971</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L972">
    <div class="line-number"><a href="#L972">972</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if function exists</div>
  </div>
  <div class="line not-covered" id="L973">
    <div class="line-number"><a href="#L973">973</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data.functions[func_id] then</div>
  </div>
  <div class="line not-covered" id="L974">
    <div class="line-number"><a href="#L974">974</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to mark non-existent function as executed&quot;, {</div>
  </div>
  <div class="line not-covered" id="L975">
    <div class="line-number"><a href="#L975">975</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L976">
    <div class="line-number"><a href="#L976">976</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_id = func_id</div>
  </div>
  <div class="line not-covered" id="L977">
    <div class="line-number"><a href="#L977">977</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L978">
    <div class="line-number"><a href="#L978">978</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L979">
    <div class="line-number"><a href="#L979">979</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L980">
    <div class="line-number"><a href="#L980">980</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L981">
    <div class="line-number"><a href="#L981">981</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the function data</div>
  </div>
  <div class="line not-covered" id="L982">
    <div class="line-number"><a href="#L982">982</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local func_data = file_data.functions[func_id]</div>
  </div>
  <div class="line not-executable" id="L983">
    <div class="line-number"><a href="#L983">983</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L984">
    <div class="line-number"><a href="#L984">984</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update execution count</div>
  </div>
  <div class="line not-covered" id="L985">
    <div class="line-number"><a href="#L985">985</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  func_data.execution_count = func_data.execution_count + 1</div>
  </div>
  <div class="line not-executable" id="L986">
    <div class="line-number"><a href="#L986">986</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L987">
    <div class="line-number"><a href="#L987">987</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Mark as executed if this is the first execution</div>
  </div>
  <div class="line not-covered" id="L988">
    <div class="line-number"><a href="#L988">988</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not func_data.executed then</div>
  </div>
  <div class="line not-covered" id="L989">
    <div class="line-number"><a href="#L989">989</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    func_data.executed = true</div>
  </div>
  <div class="line not-executable" id="L990">
    <div class="line-number"><a href="#L990">990</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L991">
    <div class="line-number"><a href="#L991">991</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update file statistics</div>
  </div>
  <div class="line not-covered" id="L992">
    <div class="line-number"><a href="#L992">992</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_data.executed_functions = file_data.executed_functions + 1</div>
  </div>
  <div class="line not-executable" id="L993">
    <div class="line-number"><a href="#L993">993</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L994">
    <div class="line-number"><a href="#L994">994</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update global statistics</div>
  </div>
  <div class="line not-covered" id="L995">
    <div class="line-number"><a href="#L995">995</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data.summary.executed_functions = data.summary.executed_functions + 1</div>
  </div>
  <div class="line not-covered" id="L996">
    <div class="line-number"><a href="#L996">996</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L997">
    <div class="line-number"><a href="#L997">997</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L998">
    <div class="line-number"><a href="#L998">998</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L999">
    <div class="line-number"><a href="#L999">999</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1000">
    <div class="line-number"><a href="#L1000">1000</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Marks a function as covered (executed + validated)</div>
  </div>
  <div class="line not-executable" id="L1001">
    <div class="line-number"><a href="#L1001">1001</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param data table The coverage data structure</div>
  </div>
  <div class="line not-executable" id="L1002">
    <div class="line-number"><a href="#L1002">1002</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the file</div>
  </div>
  <div class="line not-executable" id="L1003">
    <div class="line-number"><a href="#L1003">1003</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param func_id string The function ID</div>
  </div>
  <div class="line not-executable" id="L1004">
    <div class="line-number"><a href="#L1004">1004</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the operation succeeded</div>
  </div>
  <div class="line not-covered" id="L1005">
    <div class="line-number"><a href="#L1005">1005</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.mark_function_covered(data, file_path, func_id)</div>
  </div>
  <div class="line not-executable" id="L1006">
    <div class="line-number"><a href="#L1006">1006</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L1007">
    <div class="line-number"><a href="#L1007">1007</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(data) == &quot;table&quot;, &quot;data must be a table&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L1008">
    <div class="line-number"><a href="#L1008">1008</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(file_path) == &quot;string&quot;, &quot;file_path must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-covered" id="L1009">
    <div class="line-number"><a href="#L1009">1009</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_handler.assert(type(func_id) == &quot;string&quot;, &quot;func_id must be a string&quot;, error_handler.CATEGORY.VALIDATION)</div>
  </div>
  <div class="line not-executable" id="L1010">
    <div class="line-number"><a href="#L1010">1010</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1011">
    <div class="line-number"><a href="#L1011">1011</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Normalize the path</div>
  </div>
  <div class="line not-covered" id="L1012">
    <div class="line-number"><a href="#L1012">1012</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local normalized_path = M.normalize_path(file_path)</div>
  </div>
  <div class="line not-executable" id="L1013">
    <div class="line-number"><a href="#L1013">1013</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1014">
    <div class="line-number"><a href="#L1014">1014</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the file data</div>
  </div>
  <div class="line not-covered" id="L1015">
    <div class="line-number"><a href="#L1015">1015</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local file_data = data.files[normalized_path]</div>
  </div>
  <div class="line not-covered" id="L1016">
    <div class="line-number"><a href="#L1016">1016</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data then</div>
  </div>
  <div class="line not-covered" id="L1017">
    <div class="line-number"><a href="#L1017">1017</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to mark function covered for a file not in the coverage data&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1018">
    <div class="line-number"><a href="#L1018">1018</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L1019">
    <div class="line-number"><a href="#L1019">1019</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_id = func_id</div>
  </div>
  <div class="line not-covered" id="L1020">
    <div class="line-number"><a href="#L1020">1020</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1021">
    <div class="line-number"><a href="#L1021">1021</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1022">
    <div class="line-number"><a href="#L1022">1022</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1023">
    <div class="line-number"><a href="#L1023">1023</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1024">
    <div class="line-number"><a href="#L1024">1024</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if function exists</div>
  </div>
  <div class="line not-covered" id="L1025">
    <div class="line-number"><a href="#L1025">1025</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not file_data.functions[func_id] then</div>
  </div>
  <div class="line not-covered" id="L1026">
    <div class="line-number"><a href="#L1026">1026</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to mark non-existent function as covered&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1027">
    <div class="line-number"><a href="#L1027">1027</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L1028">
    <div class="line-number"><a href="#L1028">1028</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_id = func_id</div>
  </div>
  <div class="line not-covered" id="L1029">
    <div class="line-number"><a href="#L1029">1029</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1030">
    <div class="line-number"><a href="#L1030">1030</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1031">
    <div class="line-number"><a href="#L1031">1031</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1032">
    <div class="line-number"><a href="#L1032">1032</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1033">
    <div class="line-number"><a href="#L1033">1033</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the function data</div>
  </div>
  <div class="line not-covered" id="L1034">
    <div class="line-number"><a href="#L1034">1034</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local func_data = file_data.functions[func_id]</div>
  </div>
  <div class="line not-executable" id="L1035">
    <div class="line-number"><a href="#L1035">1035</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1036">
    <div class="line-number"><a href="#L1036">1036</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Function must be executed before it can be covered</div>
  </div>
  <div class="line not-covered" id="L1037">
    <div class="line-number"><a href="#L1037">1037</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not func_data.executed then</div>
  </div>
  <div class="line not-covered" id="L1038">
    <div class="line-number"><a href="#L1038">1038</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(&quot;Attempted to mark a non-executed function as covered&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1039">
    <div class="line-number"><a href="#L1039">1039</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_path = normalized_path,</div>
  </div>
  <div class="line not-covered" id="L1040">
    <div class="line-number"><a href="#L1040">1040</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      func_id = func_id</div>
  </div>
  <div class="line not-covered" id="L1041">
    <div class="line-number"><a href="#L1041">1041</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1042">
    <div class="line-number"><a href="#L1042">1042</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1043">
    <div class="line-number"><a href="#L1043">1043</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1044">
    <div class="line-number"><a href="#L1044">1044</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1045">
    <div class="line-number"><a href="#L1045">1045</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Mark as covered if not already</div>
  </div>
  <div class="line not-covered" id="L1046">
    <div class="line-number"><a href="#L1046">1046</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not func_data.covered then</div>
  </div>
  <div class="line not-covered" id="L1047">
    <div class="line-number"><a href="#L1047">1047</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    func_data.covered = true</div>
  </div>
  <div class="line not-executable" id="L1048">
    <div class="line-number"><a href="#L1048">1048</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1049">
    <div class="line-number"><a href="#L1049">1049</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update file statistics</div>
  </div>
  <div class="line not-covered" id="L1050">
    <div class="line-number"><a href="#L1050">1050</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_data.covered_functions = file_data.covered_functions + 1</div>
  </div>
  <div class="line not-executable" id="L1051">
    <div class="line-number"><a href="#L1051">1051</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1052">
    <div class="line-number"><a href="#L1052">1052</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update global statistics</div>
  </div>
  <div class="line not-covered" id="L1053">
    <div class="line-number"><a href="#L1053">1053</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    data.summary.covered_functions = data.summary.covered_functions + 1</div>
  </div>
  <div class="line not-covered" id="L1054">
    <div class="line-number"><a href="#L1054">1054</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1055">
    <div class="line-number"><a href="#L1055">1055</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1056">
    <div class="line-number"><a href="#L1056">1056</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L1057">
    <div class="line-number"><a href="#L1057">1057</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L1058">
    <div class="line-number"><a href="#L1058">1058</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return M</div>
  </div>
</div>
<div class="source-code" id="file---lib-core-central-config-lua">
  <h3>./lib/core/central_config.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">37 / 1155 (3%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 3%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">2 / 2 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 1850      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 1155      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 2      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 2      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-core-central-config-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-core-central-config-lua" value="all" checked>
        All <span class="function-count">2</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-core-central-config-lua" value="executed">
        Executed <span class="function-count badge-success">2</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-core-central-config-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-core-central-config-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-core-central-config-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-core-central-config-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-core-central-config-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">0</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-core-central-config-lua" value="closure">
        Closure <span class="function-count function-type-closure">2</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-core-central-config-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>path_to_parts <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L76">76-87</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>get <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L299">299-367</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for central_config.lua    const tableId = 'functions---lib-core-central-config-lua';
    const searchId = 'func-search---lib-core-central-config-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-core-central-config-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-core-central-config-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-core-central-config-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-core-central-config-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Centralized configuration module for firmo</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Provides a global configuration store with standardized access patterns</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Features:</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Hierarchical configuration with dot-notation paths (module.setting.subsetting)</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Schema validation for type safety and consistency</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Change listeners with hierarchical notification</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Default values with automatic application</div>
  </div>
  <div class="line not-executable" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - File-based persistence with load/save capabilities</div>
  </div>
  <div class="line not-executable" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Clean serialization of Lua tables for readable config files</div>
  </div>
  <div class="line not-executable" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Comprehensive error handling with detailed context</div>
  </div>
  <div class="line not-executable" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Lazy loading of dependencies to avoid circular references</div>
  </div>
  <div class="line not-executable" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @version 0.3.0</div>
  </div>
  <div class="line not-executable" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @author Firmo Team</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Directly require error_handler to ensure it's always available</div>
  </div>
  <div class="line not-covered" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local error_handler = require(&quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line not-executable" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class central_config</div>
  </div>
  <div class="line not-executable" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get fun(path?: string, default?: any): any, table|nil Returns the value at the specified path or the default if not found</div>
  </div>
  <div class="line not-executable" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field set fun(path: string, value: any): central_config Sets a value at the specified path</div>
  </div>
  <div class="line not-executable" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field delete fun(path: string): boolean, table|nil Deletes a value at the specified path</div>
  </div>
  <div class="line not-executable" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field on_change fun(path: string, callback: fun(path: string, old_value: any, new_value: any)): central_config Registers a callback for when a value changes</div>
  </div>
  <div class="line not-executable" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field notify_change fun(path: string, old_value: any, new_value: any) Notifies listeners of a value change</div>
  </div>
  <div class="line not-executable" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field register_module fun(module_name: string, schema?: table, defaults?: table): central_config Registers a module's schema and defaults</div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field validate fun(module_name?: string): boolean, table|nil Validates configuration against registered schemas</div>
  </div>
  <div class="line not-executable" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field load_from_file fun(path?: string): table|nil, table|nil Loads configuration from a file</div>
  </div>
  <div class="line not-executable" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field save_to_file fun(path?: string): boolean, table|nil Saves configuration to a file</div>
  </div>
  <div class="line not-executable" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field reset fun(module_name?: string): central_config Resets configuration to defaults</div>
  </div>
  <div class="line not-executable" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field configure_from_options fun(options: table): central_config Configures from options table (typically from CLI)</div>
  </div>
  <div class="line not-executable" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field configure_from_config fun(global_config: table): central_config Configures from global config</div>
  </div>
  <div class="line not-executable" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field serialize fun(obj: any): any Serializes an object for storage</div>
  </div>
  <div class="line not-executable" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field merge fun(target: table, source: table): table Merges two tables</div>
  </div>
  <div class="line not-executable" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field DEFAULT_CONFIG_PATH string The default configuration file path</div>
  </div>
  <div class="line not-executable" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field ERROR_TYPES table Error type constants mapping to error_handler categories</div>
  </div>
  <div class="line not-executable" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field _VERSION string Module version identifier</div>
  </div>
  <div class="line not-executable" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Module table</div>
  </div>
  <div class="line not-covered" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local M = {}</div>
  </div>
  <div class="line not-executable" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Module version</div>
  </div>
  <div class="line not-covered" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M._VERSION = &quot;0.3.0&quot;</div>
  </div>
  <div class="line not-executable" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Configuration storage</div>
  </div>
  <div class="line not-covered" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local config = {</div>
  </div>
  <div class="line not-covered" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  values = {}, -- Main configuration values</div>
  </div>
  <div class="line not-covered" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  schemas = {}, -- Registered schemas by module</div>
  </div>
  <div class="line not-covered" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  listeners = {}, -- Change listeners by path</div>
  </div>
  <div class="line not-covered" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  defaults = {}, -- Default values by module</div>
  </div>
  <div class="line not-covered" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@private</div>
  </div>
  <div class="line not-executable" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Initialize empty config storage</div>
  </div>
  <div class="line not-covered" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function init_config()</div>
  </div>
  <div class="line not-covered" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.values = {}</div>
  </div>
  <div class="line not-covered" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.schemas = {}</div>
  </div>
  <div class="line not-covered" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.listeners = {}</div>
  </div>
  <div class="line not-covered" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.defaults = {}</div>
  </div>
  <div class="line not-covered" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Constants</div>
  </div>
  <div class="line not-covered" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.DEFAULT_CONFIG_PATH = &quot;.firmo-config.lua&quot;</div>
  </div>
  <div class="line not-executable" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Error categories mapping to error_handler categories</div>
  </div>
  <div class="line not-covered" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.ERROR_TYPES = {</div>
  </div>
  <div class="line not-covered" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  VALIDATION = error_handler.CATEGORY.VALIDATION, -- Schema validation errors</div>
  </div>
  <div class="line not-covered" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  ACCESS = error_handler.CATEGORY.VALIDATION, -- Path access errors</div>
  </div>
  <div class="line not-covered" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  IO = error_handler.CATEGORY.IO, -- File I/O errors</div>
  </div>
  <div class="line not-covered" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  PARSE = error_handler.CATEGORY.PARSE, -- Config file parsing errors</div>
  </div>
  <div class="line not-covered" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@private</div>
  </div>
  <div class="line not-executable" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param path string|nil The dot-separated path to convert to parts</div>
  </div>
  <div class="line not-executable" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string[] Array of path segments</div>
  </div>
  <div class="line not-executable" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Helper for generating pathed keys (a.b.c -&gt; [&quot;a&quot;][&quot;b&quot;][&quot;c&quot;])</div>
  </div>
  <div class="line not-covered" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function path_to_parts(path)</div>
  </div>
  <div class="line not-covered" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not path or path == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return {}</div>
  </div>
  <div class="line not-covered" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local parts = {}</div>
  </div>
  <div class="line not-covered" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for part in string.gmatch(path, &quot;[^.]+&quot;) do</div>
  </div>
  <div class="line not-covered" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(parts, part)</div>
  </div>
  <div class="line not-covered" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return parts</div>
  </div>
  <div class="line covered" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@private</div>
  </div>
  <div class="line not-executable" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param t table The table to ensure path in</div>
  </div>
  <div class="line not-executable" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param parts string[] The path parts to ensure exist</div>
  </div>
  <div class="line not-executable" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil parent The parent table where the last part would be set</div>
  </div>
  <div class="line not-executable" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil error The error if any occurred</div>
  </div>
  <div class="line not-executable" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Create value at path</div>
  </div>
  <div class="line not-executable" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@diagnostic disable-next-line: unused-local</div>
  </div>
  <div class="line covered" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local function ensure_path(t, parts)</div>
  </div>
  <div class="line covered" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not t or type(t) ~= &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return nil,</div>
  </div>
  <div class="line not-covered" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_handler.validation_error(&quot;Target must be a table for ensure_path&quot;, {</div>
  </div>
  <div class="line not-covered" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        target_type = type(t),</div>
  </div>
  <div class="line not-covered" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        parts = parts,</div>
  </div>
  <div class="line not-covered" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local current = t</div>
  </div>
  <div class="line not-covered" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i, part in ipairs(parts) do</div>
  </div>
  <div class="line not-covered" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if i &lt; #parts then</div>
  </div>
  <div class="line not-covered" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      current[part] = current[part] or {}</div>
  </div>
  <div class="line not-covered" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(current[part]) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        current[part] = {} -- Convert to table if it's not</div>
  </div>
  <div class="line not-covered" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      current = current[part]</div>
  </div>
  <div class="line not-covered" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return current</div>
  </div>
  <div class="line not-covered" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Lazy loading of dependencies to avoid circular references</div>
  </div>
  <div class="line not-covered" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local _logging, _fs</div>
  </div>
  <div class="line not-executable" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@private</div>
  </div>
  <div class="line not-executable" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil The logging module if available, nil otherwise</div>
  </div>
  <div class="line not-executable" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Get the logging module, loading it if necessary</div>
  </div>
  <div class="line not-covered" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_logging()</div>
  </div>
  <div class="line not-covered" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not _logging then</div>
  </div>
  <div class="line not-covered" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, logging = pcall(require, &quot;lib.tools.logging&quot;)</div>
  </div>
  <div class="line not-covered" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    _logging = success and logging or nil</div>
  </div>
  <div class="line not-covered" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return _logging</div>
  </div>
  <div class="line not-covered" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@private</div>
  </div>
  <div class="line not-executable" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil The filesystem module if available, nil otherwise</div>
  </div>
  <div class="line not-executable" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Get the filesystem module, loading it if necessary</div>
  </div>
  <div class="line not-covered" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_fs()</div>
  </div>
  <div class="line not-covered" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not _fs then</div>
  </div>
  <div class="line not-covered" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, fs = pcall(require, &quot;lib.tools.filesystem&quot;)</div>
  </div>
  <div class="line not-covered" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    _fs = success and fs or nil</div>
  </div>
  <div class="line not-covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return _fs</div>
  </div>
  <div class="line not-covered" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@private</div>
  </div>
  <div class="line not-executable" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param level string The log level ('debug', 'info', 'warn', 'error')</div>
  </div>
  <div class="line not-executable" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The log message</div>
  </div>
  <div class="line not-executable" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param params? table Additional parameters for structured logging</div>
  </div>
  <div class="line not-executable" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Log helper with structured logging</div>
  </div>
  <div class="line not-covered" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function log(level, message, params)</div>
  </div>
  <div class="line not-covered" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local logging = get_logging()</div>
  </div>
  <div class="line not-covered" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if logging then</div>
  </div>
  <div class="line not-covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local logger = logging.get_logger(&quot;central_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger[level](message, params or {})</div>
  </div>
  <div class="line not-covered" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@private</div>
  </div>
  <div class="line not-executable" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param target table|nil The target table to merge into</div>
  </div>
  <div class="line not-executable" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param source table|nil The source table to merge from</div>
  </div>
  <div class="line not-executable" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil merged The merged table</div>
  </div>
  <div class="line not-executable" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil error Any error that occurred during merging</div>
  </div>
  <div class="line not-executable" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Deep merge helper (for merging configs)</div>
  </div>
  <div class="line not-covered" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function deep_merge(target, source)</div>
  </div>
  <div class="line not-executable" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Input validation</div>
  </div>
  <div class="line not-covered" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if source ~= nil and type(source) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil,</div>
  </div>
  <div class="line not-covered" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_handler.validation_error(&quot;Source must be a table or nil for deep_merge&quot;, {</div>
  </div>
  <div class="line not-covered" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        source_type = type(source),</div>
  </div>
  <div class="line not-covered" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;deep_merge&quot;,</div>
  </div>
  <div class="line not-covered" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if source == nil then</div>
  </div>
  <div class="line not-covered" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return target</div>
  </div>
  <div class="line not-covered" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if target ~= nil and type(target) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil,</div>
  </div>
  <div class="line not-covered" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_handler.validation_error(&quot;Target must be a table or nil for deep_merge&quot;, {</div>
  </div>
  <div class="line not-covered" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        target_type = type(target),</div>
  </div>
  <div class="line not-covered" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;deep_merge&quot;,</div>
  </div>
  <div class="line not-covered" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if target == nil then</div>
  </div>
  <div class="line not-covered" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    target = {}</div>
  </div>
  <div class="line not-covered" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for k, v in pairs(source) do</div>
  </div>
  <div class="line not-covered" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) == &quot;table&quot; and type(target[k]) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local merged_value, err = deep_merge(target[k], v)</div>
  </div>
  <div class="line not-covered" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if err then</div>
  </div>
  <div class="line not-covered" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return nil,</div>
  </div>
  <div class="line not-covered" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          error_handler.validation_error(&quot;Failed to merge nested table&quot;, {</div>
  </div>
  <div class="line not-covered" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            key = k,</div>
  </div>
  <div class="line not-covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            operation = &quot;deep_merge&quot;,</div>
  </div>
  <div class="line not-covered" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error = err.message,</div>
  </div>
  <div class="line not-covered" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      target[k] = merged_value</div>
  </div>
  <div class="line not-covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      target[k] = v</div>
  </div>
  <div class="line not-covered" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return target</div>
  </div>
  <div class="line not-covered" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@private</div>
  </div>
  <div class="line not-executable" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param obj any The object to copy</div>
  </div>
  <div class="line not-executable" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return any A deep copy of the input object</div>
  </div>
  <div class="line not-executable" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Deep copy helper</div>
  </div>
  <div class="line not-covered" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function deep_copy(obj)</div>
  </div>
  <div class="line not-executable" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Input validation</div>
  </div>
  <div class="line not-covered" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if obj ~= nil and type(obj) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-executable" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- For non-tables, just return the value</div>
  </div>
  <div class="line not-covered" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return obj</div>
  </div>
  <div class="line not-covered" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if obj == nil then</div>
  </div>
  <div class="line not-covered" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local result = {}</div>
  </div>
  <div class="line not-covered" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for k, v in pairs(obj) do</div>
  </div>
  <div class="line not-covered" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      result[k] = deep_copy(v)</div>
  </div>
  <div class="line not-covered" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      result[k] = v</div>
  </div>
  <div class="line not-covered" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return result</div>
  </div>
  <div class="line not-covered" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@private</div>
  </div>
  <div class="line not-executable" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param a any First value to compare</div>
  </div>
  <div class="line not-executable" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param b any Second value to compare</div>
  </div>
  <div class="line not-executable" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean Whether the values are deeply equal</div>
  </div>
  <div class="line not-executable" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Deep compare helper</div>
  </div>
  <div class="line not-covered" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function deep_equals(a, b)</div>
  </div>
  <div class="line not-executable" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Direct comparison for identical references or non-table values</div>
  </div>
  <div class="line not-covered" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if a == b then</div>
  </div>
  <div class="line not-covered" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Type checking</div>
  </div>
  <div class="line not-covered" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(a) ~= &quot;table&quot; or type(b) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check all keys in a exist in b with equal values</div>
  </div>
  <div class="line not-covered" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for k, v in pairs(a) do</div>
  </div>
  <div class="line not-covered" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not deep_equals(v, b[k]) then</div>
  </div>
  <div class="line not-covered" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line not-covered" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check for extra keys in b that don't exist in a</div>
  </div>
  <div class="line not-covered" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for k in pairs(b) do</div>
  </div>
  <div class="line not-covered" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if a[k] == nil then</div>
  </div>
  <div class="line not-covered" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line not-covered" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Gets a configuration value from the specified path</div>
  </div>
  <div class="line not-executable" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function retrieves a value from the central configuration store using a </div>
  </div>
  <div class="line not-executable" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- dot-separated path notation. It returns a copy of the value to prevent direct</div>
  </div>
  <div class="line not-executable" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- modification of configuration data. If the path doesn't exist, it returns either</div>
  </div>
  <div class="line not-executable" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- the provided default value or an error object.</div>
  </div>
  <div class="line not-executable" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path? string The path to get the value at (dot-separated, e.g. 'module.setting')</div>
  </div>
  <div class="line not-executable" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param default? any Value to return if path doesn't exist</div>
  </div>
  <div class="line not-executable" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return any value The value at the path or the default</div>
  </div>
  <div class="line not-executable" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil error Error if any occurred</div>
  </div>
  <div class="line not-executable" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get a simple setting with default value</div>
  </div>
  <div class="line not-executable" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local logging_level = central_config.get(&quot;logging.level&quot;, &quot;info&quot;)</div>
  </div>
  <div class="line not-executable" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get a complex configuration object </div>
  </div>
  <div class="line not-executable" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local database_config = central_config.get(&quot;database&quot;)</div>
  </div>
  <div class="line not-executable" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if database_config then</div>
  </div>
  <div class="line not-executable" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   db.connect(database_config.host, database_config.port)</div>
  </div>
  <div class="line not-executable" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get full configuration</div>
  </div>
  <div class="line not-executable" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local full_config = central_config.get()</div>
  </div>
  <div class="line not-executable" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- With error handling</div>
  </div>
  <div class="line not-executable" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local cache_settings, err = central_config.get(&quot;cache.settings&quot;)</div>
  </div>
  <div class="line not-executable" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if err then</div>
  </div>
  <div class="line not-executable" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error getting cache settings: &quot; .. err.message)</div>
  </div>
  <div class="line not-executable" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Use defaults</div>
  </div>
  <div class="line not-executable" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   cache_settings = { ttl = 3600, max_size = 1000 }</div>
  </div>
  <div class="line not-executable" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get(path, default)</div>
  </div>
  <div class="line not-executable" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if path ~= nil and type(path) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Path must be a string or nil&quot;, {</div>
  </div>
  <div class="line not-covered" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;path&quot;,</div>
  </div>
  <div class="line not-covered" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(path),</div>
  </div>
  <div class="line not-covered" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;get&quot;,</div>
  </div>
  <div class="line not-covered" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, err</div>
  </div>
  <div class="line not-covered" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return all config if no path specified</div>
  </div>
  <div class="line not-covered" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not path or path == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return deep_copy(config.values)</div>
  </div>
  <div class="line not-covered" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local parts = path_to_parts(path)</div>
  </div>
  <div class="line not-covered" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if #parts == 0 then</div>
  </div>
  <div class="line not-covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return deep_copy(config.values)</div>
  </div>
  <div class="line not-covered" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Navigate to value</div>
  </div>
  <div class="line not-covered" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local current = config.values</div>
  </div>
  <div class="line not-covered" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i, part in ipairs(parts) do</div>
  </div>
  <div class="line not-covered" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(current) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local context = {</div>
  </div>
  <div class="line not-covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path = path,</div>
  </div>
  <div class="line not-covered" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        failed_at = table.concat(parts, &quot;.&quot;, 1, i - 1),</div>
  </div>
  <div class="line not-covered" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        expected = &quot;table&quot;,</div>
  </div>
  <div class="line not-covered" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        got = type(current),</div>
  </div>
  <div class="line not-covered" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;debug&quot;, &quot;Path traversal failed at part&quot;, context)</div>
  </div>
  <div class="line not-covered" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if default ~= nil then</div>
  </div>
  <div class="line not-covered" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return default</div>
  </div>
  <div class="line covered" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      else</div>
  </div>
  <div class="line covered" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        local err =</div>
  </div>
  <div class="line covered" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          error_handler.validation_error(&quot;Path traversal failed: expected table but got &quot; .. type(current), context)</div>
  </div>
  <div class="line covered" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        return nil, err</div>
  </div>
  <div class="line covered" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    current = current[part]</div>
  </div>
  <div class="line covered" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if current == nil then</div>
  </div>
  <div class="line covered" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local context = {</div>
  </div>
  <div class="line covered" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        path = path,</div>
  </div>
  <div class="line covered" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        failed_at = table.concat(parts, &quot;.&quot;, 1, i),</div>
  </div>
  <div class="line covered" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      }</div>
  </div>
  <div class="line covered" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      log(&quot;debug&quot;, &quot;Path not found&quot;, context)</div>
  </div>
  <div class="line covered" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if default ~= nil then</div>
  </div>
  <div class="line covered" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        return default</div>
  </div>
  <div class="line covered" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      else</div>
  </div>
  <div class="line covered" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        local err = error_handler.validation_error(&quot;Path not found: &quot; .. path, context)</div>
  </div>
  <div class="line covered" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        return nil, err</div>
  </div>
  <div class="line covered" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return copy to prevent direct modification</div>
  </div>
  <div class="line covered" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if type(current) == &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return deep_copy(current)</div>
  </div>
  <div class="line covered" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count">3</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  return current</div>
  </div>
  <div class="line covered" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Sets a configuration value at the specified path</div>
  </div>
  <div class="line not-executable" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function stores a value in the configuration system at the specified path,</div>
  </div>
  <div class="line not-executable" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- automatically creating any required parent tables. When setting table values,</div>
  </div>
  <div class="line not-executable" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- it makes a deep copy to prevent unintended modification by reference. The function</div>
  </div>
  <div class="line not-executable" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- also notifies any change listeners if the value changes. The function supports</div>
  </div>
  <div class="line not-executable" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- method chaining by returning the module instance.</div>
  </div>
  <div class="line not-executable" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path? string The path to set the value at (dot-separated, e.g. 'module.setting')</div>
  </div>
  <div class="line not-executable" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param value any The value to store at the specified path</div>
  </div>
  <div class="line not-executable" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return central_config The module instance for chaining</div>
  </div>
  <div class="line not-executable" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Set a simple value</div>
  </div>
  <div class="line not-executable" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.set(&quot;logging.level&quot;, &quot;debug&quot;)</div>
  </div>
  <div class="line not-executable" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Set a nested value</div>
  </div>
  <div class="line not-executable" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.set(&quot;database.connection&quot;, {</div>
  </div>
  <div class="line not-executable" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   host = &quot;localhost&quot;, </div>
  </div>
  <div class="line not-executable" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   port = 5432,</div>
  </div>
  <div class="line not-executable" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   username = &quot;app_user&quot;,</div>
  </div>
  <div class="line not-executable" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   password = &quot;secret&quot;</div>
  </div>
  <div class="line not-executable" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-executable" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Set the entire configuration at once</div>
  </div>
  <div class="line not-executable" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.set({</div>
  </div>
  <div class="line not-executable" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logging = { level = &quot;info&quot;, format = &quot;json&quot; },</div>
  </div>
  <div class="line not-executable" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   app = { name = &quot;MyApp&quot;, version = &quot;1.0.0&quot; },</div>
  </div>
  <div class="line not-executable" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   paths = { data = &quot;/var/data&quot;, temp = &quot;/tmp/myapp&quot; }</div>
  </div>
  <div class="line not-executable" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-executable" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Method chaining</div>
  </div>
  <div class="line not-executable" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config</div>
  </div>
  <div class="line not-executable" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .set(&quot;cache.ttl&quot;, 3600)</div>
  </div>
  <div class="line not-executable" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .set(&quot;cache.max_size&quot;, 1024)</div>
  </div>
  <div class="line not-executable" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .set(&quot;cache.storage&quot;, &quot;memory&quot;)</div>
  </div>
  <div class="line covered" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.set(path, value)</div>
  </div>
  <div class="line not-executable" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line covered" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if path ~= nil and type(path) ~= &quot;string&quot; then</div>
  </div>
  <div class="line covered" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Path must be a string or nil&quot;, {</div>
  </div>
  <div class="line covered" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      parameter_name = &quot;path&quot;,</div>
  </div>
  <div class="line covered" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      provided_type = type(path),</div>
  </div>
  <div class="line covered" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      operation = &quot;set&quot;,</div>
  </div>
  <div class="line not-covered" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Handle root config</div>
  </div>
  <div class="line not-covered" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not path or path == &quot;&quot; then</div>
  </div>
  <div class="line not-executable" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Root config must be a table</div>
  </div>
  <div class="line not-covered" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(value) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local err = error_handler.validation_error(&quot;Cannot set root config to non-table value&quot;, {</div>
  </div>
  <div class="line not-covered" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        type = type(value),</div>
  </div>
  <div class="line not-covered" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;set&quot;,</div>
  </div>
  <div class="line not-covered" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return M</div>
  </div>
  <div class="line not-covered" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Set the root config (with deep copy)</div>
  </div>
  <div class="line not-covered" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.values = deep_copy(value)</div>
  </div>
  <div class="line not-covered" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;debug&quot;, &quot;Set complete configuration&quot;, { keys = table.concat({}, &quot;,&quot;) })</div>
  </div>
  <div class="line not-covered" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local parts = path_to_parts(path)</div>
  </div>
  <div class="line not-covered" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if #parts == 0 then</div>
  </div>
  <div class="line not-executable" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Empty path parts (shouldn't normally happen with non-empty path)</div>
  </div>
  <div class="line not-covered" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(value) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      config.values = deep_copy(value)</div>
  </div>
  <div class="line not-covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;debug&quot;, &quot;Set complete configuration (empty parts)&quot;, { path = path })</div>
  </div>
  <div class="line not-covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local err = error_handler.validation_error(&quot;Cannot set root config to non-table value&quot;, {</div>
  </div>
  <div class="line not-covered" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        type = type(value),</div>
  </div>
  <div class="line not-covered" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;set&quot;,</div>
  </div>
  <div class="line not-covered" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the last part (key to set)</div>
  </div>
  <div class="line not-covered" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local last_key = parts[#parts]</div>
  </div>
  <div class="line not-covered" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.remove(parts, #parts)</div>
  </div>
  <div class="line not-executable" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Ensure path exists by creating parent tables as needed</div>
  </div>
  <div class="line not-covered" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local parent</div>
  </div>
  <div class="line not-covered" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if #parts == 0 then</div>
  </div>
  <div class="line not-executable" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If no parent path (direct child of root), use root config</div>
  </div>
  <div class="line not-covered" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    parent = config.values</div>
  </div>
  <div class="line not-covered" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-executable" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Create the parent path structure if needed</div>
  </div>
  <div class="line not-covered" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    parent = config.values</div>
  </div>
  <div class="line not-executable" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count"></div>    <div class="line-content">    ---@diagnostic disable-next-line: unused-local</div>
  </div>
  <div class="line not-covered" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i, part in ipairs(parts) do</div>
  </div>
  <div class="line not-executable" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count"></div>    <div class="line-content">      ---@diagnostic disable-next-line: need-check-nil</div>
  </div>
  <div class="line not-covered" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(parent[part]) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        parent[part] = {}</div>
  </div>
  <div class="line not-covered" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count"></div>    <div class="line-content">      ---@diagnostic disable-next-line: need-check-nil</div>
  </div>
  <div class="line not-covered" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parent = parent[part]</div>
  </div>
  <div class="line not-covered" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Store old value for change detection</div>
  </div>
  <div class="line not-executable" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count"></div>    <div class="line-content">  ---@diagnostic disable-next-line: need-check-nil</div>
  </div>
  <div class="line not-covered" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local old_value = parent[last_key]</div>
  </div>
  <div class="line not-executable" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Set the value (deep copy if it's a table)</div>
  </div>
  <div class="line not-covered" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(value) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    parent[last_key] = deep_copy(value)</div>
  </div>
  <div class="line not-covered" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    parent[last_key] = value</div>
  </div>
  <div class="line not-covered" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log the operation with detailed information for debugging</div>
  </div>
  <div class="line not-covered" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;debug&quot;, &quot;Set configuration value&quot;, {</div>
  </div>
  <div class="line not-covered" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    path = path,</div>
  </div>
  <div class="line not-covered" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    old_value_type = type(old_value),</div>
  </div>
  <div class="line not-covered" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    new_value_type = type(value),</div>
  </div>
  <div class="line not-covered" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    complete_path = path,</div>
  </div>
  <div class="line not-covered" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Notify listeners if value changed</div>
  </div>
  <div class="line not-covered" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not deep_equals(old_value, value) then</div>
  </div>
  <div class="line not-covered" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    M.notify_change(path, old_value, value)</div>
  </div>
  <div class="line not-covered" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Deletes a configuration value at the specified path</div>
  </div>
  <div class="line not-executable" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function removes a value from the configuration system at the specified path.</div>
  </div>
  <div class="line not-executable" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It performs path validation and traversal to find the target value, verifies its</div>
  </div>
  <div class="line not-executable" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- existence, and properly notifies listeners of the change. The function returns</div>
  </div>
  <div class="line not-executable" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- a boolean indicating success or failure and an optional error object with details.</div>
  </div>
  <div class="line not-executable" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string The path to delete the value at (dot-separated, e.g. 'module.setting')</div>
  </div>
  <div class="line not-executable" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean success Whether the delete was successful</div>
  </div>
  <div class="line not-executable" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil error Error if any occurred</div>
  </div>
  <div class="line not-executable" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Delete a configuration value</div>
  </div>
  <div class="line not-executable" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = central_config.delete(&quot;logging.debug_mode&quot;)</div>
  </div>
  <div class="line not-executable" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Failed to delete config: &quot; .. (err and err.message or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Safely delete nested configuration</div>
  </div>
  <div class="line not-executable" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if central_config.get(&quot;database.replica&quot;) then</div>
  </div>
  <div class="line not-executable" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   central_config.delete(&quot;database.replica.host&quot;)</div>
  </div>
  <div class="line not-executable" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   central_config.delete(&quot;database.replica.port&quot;)</div>
  </div>
  <div class="line not-executable" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Delete with error handling</div>
  </div>
  <div class="line not-executable" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local function safe_delete(path)</div>
  </div>
  <div class="line not-executable" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local success, err = central_config.delete(path)</div>
  </div>
  <div class="line not-executable" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if not success then</div>
  </div>
  <div class="line not-executable" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     if err and err.message:match(&quot;path not found&quot;) then</div>
  </div>
  <div class="line not-executable" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       -- Silently ignore if path doesn't exist</div>
  </div>
  <div class="line not-executable" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       return true</div>
  </div>
  <div class="line not-executable" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     end</div>
  </div>
  <div class="line not-executable" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     return false, err</div>
  </div>
  <div class="line not-executable" id="L478">
    <div class="line-number"><a href="#L478">478</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L479">
    <div class="line-number"><a href="#L479">479</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return true</div>
  </div>
  <div class="line not-executable" id="L480">
    <div class="line-number"><a href="#L480">480</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L481">
    <div class="line-number"><a href="#L481">481</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.delete(path)</div>
  </div>
  <div class="line not-executable" id="L482">
    <div class="line-number"><a href="#L482">482</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L483">
    <div class="line-number"><a href="#L483">483</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if path == nil or type(path) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L484">
    <div class="line-number"><a href="#L484">484</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Path must be a non-empty string&quot;, {</div>
  </div>
  <div class="line not-covered" id="L485">
    <div class="line-number"><a href="#L485">485</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;path&quot;,</div>
  </div>
  <div class="line not-covered" id="L486">
    <div class="line-number"><a href="#L486">486</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(path),</div>
  </div>
  <div class="line not-covered" id="L487">
    <div class="line-number"><a href="#L487">487</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;delete&quot;,</div>
  </div>
  <div class="line not-covered" id="L488">
    <div class="line-number"><a href="#L488">488</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L489">
    <div class="line-number"><a href="#L489">489</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L490">
    <div class="line-number"><a href="#L490">490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, err</div>
  </div>
  <div class="line not-covered" id="L491">
    <div class="line-number"><a href="#L491">491</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L492">
    <div class="line-number"><a href="#L492">492</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if path == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L493">
    <div class="line-number"><a href="#L493">493</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Cannot delete root configuration&quot;, {</div>
  </div>
  <div class="line not-covered" id="L494">
    <div class="line-number"><a href="#L494">494</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;delete&quot;,</div>
  </div>
  <div class="line not-covered" id="L495">
    <div class="line-number"><a href="#L495">495</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L496">
    <div class="line-number"><a href="#L496">496</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L497">
    <div class="line-number"><a href="#L497">497</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, err</div>
  </div>
  <div class="line not-covered" id="L498">
    <div class="line-number"><a href="#L498">498</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L499">
    <div class="line-number"><a href="#L499">499</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local parts = path_to_parts(path)</div>
  </div>
  <div class="line not-covered" id="L500">
    <div class="line-number"><a href="#L500">500</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if #parts == 0 then</div>
  </div>
  <div class="line not-covered" id="L501">
    <div class="line-number"><a href="#L501">501</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Cannot delete root configuration&quot;, {</div>
  </div>
  <div class="line not-covered" id="L502">
    <div class="line-number"><a href="#L502">502</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;delete&quot;,</div>
  </div>
  <div class="line not-covered" id="L503">
    <div class="line-number"><a href="#L503">503</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L504">
    <div class="line-number"><a href="#L504">504</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L505">
    <div class="line-number"><a href="#L505">505</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L506">
    <div class="line-number"><a href="#L506">506</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, err</div>
  </div>
  <div class="line not-covered" id="L507">
    <div class="line-number"><a href="#L507">507</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L508">
    <div class="line-number"><a href="#L508">508</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get the last part (key to delete)</div>
  </div>
  <div class="line not-covered" id="L509">
    <div class="line-number"><a href="#L509">509</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local last_key = parts[#parts]</div>
  </div>
  <div class="line not-covered" id="L510">
    <div class="line-number"><a href="#L510">510</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.remove(parts, #parts)</div>
  </div>
  <div class="line not-executable" id="L511">
    <div class="line-number"><a href="#L511">511</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Navigate to parent</div>
  </div>
  <div class="line not-covered" id="L512">
    <div class="line-number"><a href="#L512">512</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local current = config.values</div>
  </div>
  <div class="line not-covered" id="L513">
    <div class="line-number"><a href="#L513">513</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i, part in ipairs(parts) do</div>
  </div>
  <div class="line not-covered" id="L514">
    <div class="line-number"><a href="#L514">514</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(current) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L515">
    <div class="line-number"><a href="#L515">515</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local context = {</div>
  </div>
  <div class="line not-covered" id="L516">
    <div class="line-number"><a href="#L516">516</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path = path,</div>
  </div>
  <div class="line not-covered" id="L517">
    <div class="line-number"><a href="#L517">517</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        failed_at = table.concat(parts, &quot;.&quot;, 1, i),</div>
  </div>
  <div class="line not-covered" id="L518">
    <div class="line-number"><a href="#L518">518</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;delete&quot;,</div>
  </div>
  <div class="line not-covered" id="L519">
    <div class="line-number"><a href="#L519">519</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-covered" id="L520">
    <div class="line-number"><a href="#L520">520</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local err = error_handler.validation_error(&quot;Delete failed: path not found&quot;, context)</div>
  </div>
  <div class="line not-covered" id="L521">
    <div class="line-number"><a href="#L521">521</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;debug&quot;, err.message, context)</div>
  </div>
  <div class="line not-covered" id="L522">
    <div class="line-number"><a href="#L522">522</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, err</div>
  </div>
  <div class="line not-covered" id="L523">
    <div class="line-number"><a href="#L523">523</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L524">
    <div class="line-number"><a href="#L524">524</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    current = current[part]</div>
  </div>
  <div class="line not-covered" id="L525">
    <div class="line-number"><a href="#L525">525</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if current == nil then</div>
  </div>
  <div class="line not-covered" id="L526">
    <div class="line-number"><a href="#L526">526</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local context = {</div>
  </div>
  <div class="line not-covered" id="L527">
    <div class="line-number"><a href="#L527">527</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path = path,</div>
  </div>
  <div class="line not-covered" id="L528">
    <div class="line-number"><a href="#L528">528</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        failed_at = table.concat(parts, &quot;.&quot;, 1, i),</div>
  </div>
  <div class="line not-covered" id="L529">
    <div class="line-number"><a href="#L529">529</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;delete&quot;,</div>
  </div>
  <div class="line not-covered" id="L530">
    <div class="line-number"><a href="#L530">530</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-covered" id="L531">
    <div class="line-number"><a href="#L531">531</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local err = error_handler.validation_error(&quot;Delete failed: path not found&quot;, context)</div>
  </div>
  <div class="line not-covered" id="L532">
    <div class="line-number"><a href="#L532">532</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;debug&quot;, err.message, context)</div>
  </div>
  <div class="line not-covered" id="L533">
    <div class="line-number"><a href="#L533">533</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, err</div>
  </div>
  <div class="line not-covered" id="L534">
    <div class="line-number"><a href="#L534">534</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L535">
    <div class="line-number"><a href="#L535">535</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L536">
    <div class="line-number"><a href="#L536">536</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Delete the key if parent exists</div>
  </div>
  <div class="line not-covered" id="L537">
    <div class="line-number"><a href="#L537">537</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(current) == &quot;table&quot; then</div>
  </div>
  <div class="line not-executable" id="L538">
    <div class="line-number"><a href="#L538">538</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Store old value for change detection</div>
  </div>
  <div class="line not-covered" id="L539">
    <div class="line-number"><a href="#L539">539</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local old_value = current[last_key]</div>
  </div>
  <div class="line not-executable" id="L540">
    <div class="line-number"><a href="#L540">540</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if the key exists</div>
  </div>
  <div class="line not-covered" id="L541">
    <div class="line-number"><a href="#L541">541</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if old_value == nil then</div>
  </div>
  <div class="line not-covered" id="L542">
    <div class="line-number"><a href="#L542">542</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local context = {</div>
  </div>
  <div class="line not-covered" id="L543">
    <div class="line-number"><a href="#L543">543</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path = path,</div>
  </div>
  <div class="line not-covered" id="L544">
    <div class="line-number"><a href="#L544">544</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        key = last_key,</div>
  </div>
  <div class="line not-covered" id="L545">
    <div class="line-number"><a href="#L545">545</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;delete&quot;,</div>
  </div>
  <div class="line not-covered" id="L546">
    <div class="line-number"><a href="#L546">546</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-covered" id="L547">
    <div class="line-number"><a href="#L547">547</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local err = error_handler.validation_error(&quot;Delete failed: key does not exist&quot;, context)</div>
  </div>
  <div class="line not-covered" id="L548">
    <div class="line-number"><a href="#L548">548</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;debug&quot;, err.message, context)</div>
  </div>
  <div class="line not-covered" id="L549">
    <div class="line-number"><a href="#L549">549</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, err</div>
  </div>
  <div class="line not-covered" id="L550">
    <div class="line-number"><a href="#L550">550</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L551">
    <div class="line-number"><a href="#L551">551</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Remove the key</div>
  </div>
  <div class="line not-covered" id="L552">
    <div class="line-number"><a href="#L552">552</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    current[last_key] = nil</div>
  </div>
  <div class="line not-executable" id="L553">
    <div class="line-number"><a href="#L553">553</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Notify listeners</div>
  </div>
  <div class="line not-covered" id="L554">
    <div class="line-number"><a href="#L554">554</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    M.notify_change(path, old_value, nil)</div>
  </div>
  <div class="line not-covered" id="L555">
    <div class="line-number"><a href="#L555">555</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;debug&quot;, &quot;Deleted configuration value&quot;, { path = path })</div>
  </div>
  <div class="line not-covered" id="L556">
    <div class="line-number"><a href="#L556">556</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L557">
    <div class="line-number"><a href="#L557">557</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L558">
    <div class="line-number"><a href="#L558">558</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parent isn't a table</div>
  </div>
  <div class="line not-covered" id="L559">
    <div class="line-number"><a href="#L559">559</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local context = {</div>
  </div>
  <div class="line not-covered" id="L560">
    <div class="line-number"><a href="#L560">560</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    path = path,</div>
  </div>
  <div class="line not-covered" id="L561">
    <div class="line-number"><a href="#L561">561</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    parent_type = type(current),</div>
  </div>
  <div class="line not-covered" id="L562">
    <div class="line-number"><a href="#L562">562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    operation = &quot;delete&quot;,</div>
  </div>
  <div class="line not-covered" id="L563">
    <div class="line-number"><a href="#L563">563</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-covered" id="L564">
    <div class="line-number"><a href="#L564">564</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local err = error_handler.validation_error(&quot;Delete failed: parent is not a table&quot;, context)</div>
  </div>
  <div class="line not-covered" id="L565">
    <div class="line-number"><a href="#L565">565</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;debug&quot;, err.message, context)</div>
  </div>
  <div class="line not-covered" id="L566">
    <div class="line-number"><a href="#L566">566</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return false, err</div>
  </div>
  <div class="line not-covered" id="L567">
    <div class="line-number"><a href="#L567">567</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L568">
    <div class="line-number"><a href="#L568">568</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Registers a callback to be notified when configuration values change</div>
  </div>
  <div class="line not-executable" id="L569">
    <div class="line-number"><a href="#L569">569</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function adds a listener that will be called whenever a specific configuration</div>
  </div>
  <div class="line not-executable" id="L570">
    <div class="line-number"><a href="#L570">570</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- path or any of its children changes. You can register listeners for specific paths</div>
  </div>
  <div class="line not-executable" id="L571">
    <div class="line-number"><a href="#L571">571</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- or for the entire configuration tree (by using nil or &quot;&quot; as the path). Callbacks</div>
  </div>
  <div class="line not-executable" id="L572">
    <div class="line-number"><a href="#L572">572</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- receive the changed path, the old value, and the new value as parameters.</div>
  </div>
  <div class="line not-executable" id="L573">
    <div class="line-number"><a href="#L573">573</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L574">
    <div class="line-number"><a href="#L574">574</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path? string The path to listen for changes on (nil for all changes)</div>
  </div>
  <div class="line not-executable" id="L575">
    <div class="line-number"><a href="#L575">575</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param callback fun(path: string, old_value: any, new_value: any) Function to call when value changes</div>
  </div>
  <div class="line not-executable" id="L576">
    <div class="line-number"><a href="#L576">576</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return central_config The module instance for chaining</div>
  </div>
  <div class="line not-executable" id="L577">
    <div class="line-number"><a href="#L577">577</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L578">
    <div class="line-number"><a href="#L578">578</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L579">
    <div class="line-number"><a href="#L579">579</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Listen for changes to a specific setting</div>
  </div>
  <div class="line not-executable" id="L580">
    <div class="line-number"><a href="#L580">580</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.on_change(&quot;logging.level&quot;, function(path, old_value, new_value)</div>
  </div>
  <div class="line not-executable" id="L581">
    <div class="line-number"><a href="#L581">581</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Logging level changed from &quot; .. old_value .. &quot; to &quot; .. new_value)</div>
  </div>
  <div class="line not-executable" id="L582">
    <div class="line-number"><a href="#L582">582</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   log_system.set_level(new_value)</div>
  </div>
  <div class="line not-executable" id="L583">
    <div class="line-number"><a href="#L583">583</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L584">
    <div class="line-number"><a href="#L584">584</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L585">
    <div class="line-number"><a href="#L585">585</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Listen for changes to an entire module's configuration</div>
  </div>
  <div class="line not-executable" id="L586">
    <div class="line-number"><a href="#L586">586</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.on_change(&quot;database&quot;, function(path, old_value, new_value)</div>
  </div>
  <div class="line not-executable" id="L587">
    <div class="line-number"><a href="#L587">587</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Reconnect to database if configuration changes</div>
  </div>
  <div class="line not-executable" id="L588">
    <div class="line-number"><a href="#L588">588</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if path:match(&quot;database.connection&quot;) then</div>
  </div>
  <div class="line not-executable" id="L589">
    <div class="line-number"><a href="#L589">589</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     db.reconnect(central_config.get(&quot;database.connection&quot;))</div>
  </div>
  <div class="line not-executable" id="L590">
    <div class="line-number"><a href="#L590">590</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L591">
    <div class="line-number"><a href="#L591">591</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L592">
    <div class="line-number"><a href="#L592">592</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L593">
    <div class="line-number"><a href="#L593">593</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Listen for all configuration changes</div>
  </div>
  <div class="line not-executable" id="L594">
    <div class="line-number"><a href="#L594">594</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.on_change(nil, function(path, old_value, new_value)</div>
  </div>
  <div class="line not-executable" id="L595">
    <div class="line-number"><a href="#L595">595</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Config changed: &quot; .. path)</div>
  </div>
  <div class="line not-executable" id="L596">
    <div class="line-number"><a href="#L596">596</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L597">
    <div class="line-number"><a href="#L597">597</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Trigger cache invalidation on core settings changes</div>
  </div>
  <div class="line not-executable" id="L598">
    <div class="line-number"><a href="#L598">598</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if path:match(&quot;^cache%.&quot;) then</div>
  </div>
  <div class="line not-executable" id="L599">
    <div class="line-number"><a href="#L599">599</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     cache_system.invalidate(path)</div>
  </div>
  <div class="line not-executable" id="L600">
    <div class="line-number"><a href="#L600">600</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L601">
    <div class="line-number"><a href="#L601">601</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L602">
    <div class="line-number"><a href="#L602">602</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.on_change(path, callback)</div>
  </div>
  <div class="line not-executable" id="L603">
    <div class="line-number"><a href="#L603">603</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L604">
    <div class="line-number"><a href="#L604">604</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if path ~= nil and type(path) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L605">
    <div class="line-number"><a href="#L605">605</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Path must be a string or nil&quot;, {</div>
  </div>
  <div class="line not-covered" id="L606">
    <div class="line-number"><a href="#L606">606</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;path&quot;,</div>
  </div>
  <div class="line not-covered" id="L607">
    <div class="line-number"><a href="#L607">607</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(path),</div>
  </div>
  <div class="line not-covered" id="L608">
    <div class="line-number"><a href="#L608">608</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;on_change&quot;,</div>
  </div>
  <div class="line not-covered" id="L609">
    <div class="line-number"><a href="#L609">609</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L610">
    <div class="line-number"><a href="#L610">610</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L611">
    <div class="line-number"><a href="#L611">611</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L612">
    <div class="line-number"><a href="#L612">612</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L613">
    <div class="line-number"><a href="#L613">613</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(callback) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L614">
    <div class="line-number"><a href="#L614">614</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Callback must be a function&quot;, {</div>
  </div>
  <div class="line not-covered" id="L615">
    <div class="line-number"><a href="#L615">615</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;callback&quot;,</div>
  </div>
  <div class="line not-covered" id="L616">
    <div class="line-number"><a href="#L616">616</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(callback),</div>
  </div>
  <div class="line not-covered" id="L617">
    <div class="line-number"><a href="#L617">617</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;on_change&quot;,</div>
  </div>
  <div class="line not-covered" id="L618">
    <div class="line-number"><a href="#L618">618</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L619">
    <div class="line-number"><a href="#L619">619</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L620">
    <div class="line-number"><a href="#L620">620</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L621">
    <div class="line-number"><a href="#L621">621</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L622">
    <div class="line-number"><a href="#L622">622</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize the listener array if needed</div>
  </div>
  <div class="line not-covered" id="L623">
    <div class="line-number"><a href="#L623">623</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  path = path or &quot;&quot; -- Convert nil to empty string for root listeners</div>
  </div>
  <div class="line not-covered" id="L624">
    <div class="line-number"><a href="#L624">624</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.listeners[path] = config.listeners[path] or {}</div>
  </div>
  <div class="line not-executable" id="L625">
    <div class="line-number"><a href="#L625">625</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Register the listener</div>
  </div>
  <div class="line not-covered" id="L626">
    <div class="line-number"><a href="#L626">626</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(config.listeners[path], callback)</div>
  </div>
  <div class="line not-covered" id="L627">
    <div class="line-number"><a href="#L627">627</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;debug&quot;, &quot;Registered change listener&quot;, { path = path })</div>
  </div>
  <div class="line not-covered" id="L628">
    <div class="line-number"><a href="#L628">628</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L629">
    <div class="line-number"><a href="#L629">629</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L630">
    <div class="line-number"><a href="#L630">630</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Notifies change listeners about a configuration change</div>
  </div>
  <div class="line not-executable" id="L631">
    <div class="line-number"><a href="#L631">631</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This internal function is called whenever a configuration value changes. It notifies</div>
  </div>
  <div class="line not-executable" id="L632">
    <div class="line-number"><a href="#L632">632</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- all applicable listeners, including those registered for the exact path, parent paths,</div>
  </div>
  <div class="line not-executable" id="L633">
    <div class="line-number"><a href="#L633">633</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and root path. The function handles errors in listeners safely, ensuring configuration</div>
  </div>
  <div class="line not-executable" id="L634">
    <div class="line-number"><a href="#L634">634</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- system stability even if callbacks throw errors.</div>
  </div>
  <div class="line not-executable" id="L635">
    <div class="line-number"><a href="#L635">635</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L636">
    <div class="line-number"><a href="#L636">636</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path string The path that changed</div>
  </div>
  <div class="line not-executable" id="L637">
    <div class="line-number"><a href="#L637">637</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param old_value any The previous value</div>
  </div>
  <div class="line not-executable" id="L638">
    <div class="line-number"><a href="#L638">638</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param new_value any The new value</div>
  </div>
  <div class="line not-executable" id="L639">
    <div class="line-number"><a href="#L639">639</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L640">
    <div class="line-number"><a href="#L640">640</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L641">
    <div class="line-number"><a href="#L641">641</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Typically called internally by set() and delete()</div>
  </div>
  <div class="line not-executable" id="L642">
    <div class="line-number"><a href="#L642">642</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Example of manual notification:</div>
  </div>
  <div class="line not-executable" id="L643">
    <div class="line-number"><a href="#L643">643</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local old_value = central_config.get(&quot;app.version&quot;)</div>
  </div>
  <div class="line not-executable" id="L644">
    <div class="line-number"><a href="#L644">644</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- External process changed version file</div>
  </div>
  <div class="line not-executable" id="L645">
    <div class="line-number"><a href="#L645">645</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local new_version = read_version_from_file()</div>
  </div>
  <div class="line not-executable" id="L646">
    <div class="line-number"><a href="#L646">646</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.set(&quot;app.version&quot;, new_version)</div>
  </div>
  <div class="line not-executable" id="L647">
    <div class="line-number"><a href="#L647">647</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L648">
    <div class="line-number"><a href="#L648">648</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- In rare cases, manually notify if bypass setter:</div>
  </div>
  <div class="line not-executable" id="L649">
    <div class="line-number"><a href="#L649">649</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- central_config.notify_change(&quot;app.version&quot;, old_value, new_version)</div>
  </div>
  <div class="line not-covered" id="L650">
    <div class="line-number"><a href="#L650">650</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.notify_change(path, old_value, new_value)</div>
  </div>
  <div class="line not-executable" id="L651">
    <div class="line-number"><a href="#L651">651</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L652">
    <div class="line-number"><a href="#L652">652</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if path == nil or type(path) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L653">
    <div class="line-number"><a href="#L653">653</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Path must be a string&quot;, {</div>
  </div>
  <div class="line not-covered" id="L654">
    <div class="line-number"><a href="#L654">654</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;path&quot;,</div>
  </div>
  <div class="line not-covered" id="L655">
    <div class="line-number"><a href="#L655">655</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(path),</div>
  </div>
  <div class="line not-covered" id="L656">
    <div class="line-number"><a href="#L656">656</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;notify_change&quot;,</div>
  </div>
  <div class="line not-covered" id="L657">
    <div class="line-number"><a href="#L657">657</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L658">
    <div class="line-number"><a href="#L658">658</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L659">
    <div class="line-number"><a href="#L659">659</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return</div>
  </div>
  <div class="line not-covered" id="L660">
    <div class="line-number"><a href="#L660">660</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L661">
    <div class="line-number"><a href="#L661">661</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log the notification for debugging</div>
  </div>
  <div class="line not-covered" id="L662">
    <div class="line-number"><a href="#L662">662</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;debug&quot;, &quot;Notifying change listeners&quot;, {</div>
  </div>
  <div class="line not-covered" id="L663">
    <div class="line-number"><a href="#L663">663</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    path = path,</div>
  </div>
  <div class="line not-covered" id="L664">
    <div class="line-number"><a href="#L664">664</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    old_value_type = type(old_value),</div>
  </div>
  <div class="line not-covered" id="L665">
    <div class="line-number"><a href="#L665">665</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    new_value_type = type(new_value),</div>
  </div>
  <div class="line not-covered" id="L666">
    <div class="line-number"><a href="#L666">666</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    has_exact_listeners = config.listeners[path] ~= nil and #(config.listeners[path] or {}) &gt; 0,</div>
  </div>
  <div class="line not-covered" id="L667">
    <div class="line-number"><a href="#L667">667</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L668">
    <div class="line-number"><a href="#L668">668</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Notify exact path listeners using error_handler.try for safety</div>
  </div>
  <div class="line not-covered" id="L669">
    <div class="line-number"><a href="#L669">669</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.listeners[path] and #config.listeners[path] &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L670">
    <div class="line-number"><a href="#L670">670</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i, callback in ipairs(config.listeners[path]) do</div>
  </div>
  <div class="line not-covered" id="L671">
    <div class="line-number"><a href="#L671">671</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(callback) == &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L672">
    <div class="line-number"><a href="#L672">672</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local success, err = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L673">
    <div class="line-number"><a href="#L673">673</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          return callback(path, old_value, new_value)</div>
  </div>
  <div class="line not-covered" id="L674">
    <div class="line-number"><a href="#L674">674</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end)</div>
  </div>
  <div class="line not-covered" id="L675">
    <div class="line-number"><a href="#L675">675</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not success then</div>
  </div>
  <div class="line not-covered" id="L676">
    <div class="line-number"><a href="#L676">676</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          log(&quot;error&quot;, &quot;Error in change listener callback&quot;, {</div>
  </div>
  <div class="line not-covered" id="L677">
    <div class="line-number"><a href="#L677">677</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            path = path,</div>
  </div>
  <div class="line not-covered" id="L678">
    <div class="line-number"><a href="#L678">678</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error = err.message,</div>
  </div>
  <div class="line not-covered" id="L679">
    <div class="line-number"><a href="#L679">679</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            traceback = err.traceback,</div>
  </div>
  <div class="line not-covered" id="L680">
    <div class="line-number"><a href="#L680">680</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            listener_index = i,</div>
  </div>
  <div class="line not-covered" id="L681">
    <div class="line-number"><a href="#L681">681</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L682">
    <div class="line-number"><a href="#L682">682</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L683">
    <div class="line-number"><a href="#L683">683</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          log(&quot;debug&quot;, &quot;Successfully called exact path listener&quot;, {</div>
  </div>
  <div class="line not-covered" id="L684">
    <div class="line-number"><a href="#L684">684</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            path = path,</div>
  </div>
  <div class="line not-covered" id="L685">
    <div class="line-number"><a href="#L685">685</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            listener_index = i,</div>
  </div>
  <div class="line not-covered" id="L686">
    <div class="line-number"><a href="#L686">686</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L687">
    <div class="line-number"><a href="#L687">687</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L688">
    <div class="line-number"><a href="#L688">688</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L689">
    <div class="line-number"><a href="#L689">689</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Non-function callback found in listeners&quot;, {</div>
  </div>
  <div class="line not-covered" id="L690">
    <div class="line-number"><a href="#L690">690</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          path = path,</div>
  </div>
  <div class="line not-covered" id="L691">
    <div class="line-number"><a href="#L691">691</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          callback_type = type(callback),</div>
  </div>
  <div class="line not-covered" id="L692">
    <div class="line-number"><a href="#L692">692</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          listener_index = i,</div>
  </div>
  <div class="line not-covered" id="L693">
    <div class="line-number"><a href="#L693">693</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L694">
    <div class="line-number"><a href="#L694">694</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L695">
    <div class="line-number"><a href="#L695">695</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L696">
    <div class="line-number"><a href="#L696">696</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L697">
    <div class="line-number"><a href="#L697">697</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Notify parent path listeners</div>
  </div>
  <div class="line not-covered" id="L698">
    <div class="line-number"><a href="#L698">698</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local parts = path_to_parts(path)</div>
  </div>
  <div class="line not-covered" id="L699">
    <div class="line-number"><a href="#L699">699</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  while #parts &gt; 0 do</div>
  </div>
  <div class="line not-covered" id="L700">
    <div class="line-number"><a href="#L700">700</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.remove(parts, #parts)</div>
  </div>
  <div class="line not-covered" id="L701">
    <div class="line-number"><a href="#L701">701</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local parent_path = table.concat(parts, &quot;.&quot;)</div>
  </div>
  <div class="line not-covered" id="L702">
    <div class="line-number"><a href="#L702">702</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if config.listeners[parent_path] and #config.listeners[parent_path] &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L703">
    <div class="line-number"><a href="#L703">703</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for i, callback in ipairs(config.listeners[parent_path]) do</div>
  </div>
  <div class="line not-covered" id="L704">
    <div class="line-number"><a href="#L704">704</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if type(callback) == &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L705">
    <div class="line-number"><a href="#L705">705</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local success, err = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L706">
    <div class="line-number"><a href="#L706">706</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return callback(path, old_value, new_value)</div>
  </div>
  <div class="line not-covered" id="L707">
    <div class="line-number"><a href="#L707">707</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end)</div>
  </div>
  <div class="line not-covered" id="L708">
    <div class="line-number"><a href="#L708">708</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if not success then</div>
  </div>
  <div class="line not-covered" id="L709">
    <div class="line-number"><a href="#L709">709</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            log(&quot;error&quot;, &quot;Error in parent change listener callback&quot;, {</div>
  </div>
  <div class="line not-covered" id="L710">
    <div class="line-number"><a href="#L710">710</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              parent_path = parent_path,</div>
  </div>
  <div class="line not-covered" id="L711">
    <div class="line-number"><a href="#L711">711</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              changed_path = path,</div>
  </div>
  <div class="line not-covered" id="L712">
    <div class="line-number"><a href="#L712">712</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              error = err.message,</div>
  </div>
  <div class="line not-covered" id="L713">
    <div class="line-number"><a href="#L713">713</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              traceback = err.traceback,</div>
  </div>
  <div class="line not-covered" id="L714">
    <div class="line-number"><a href="#L714">714</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              listener_index = i,</div>
  </div>
  <div class="line not-covered" id="L715">
    <div class="line-number"><a href="#L715">715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L716">
    <div class="line-number"><a href="#L716">716</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          else</div>
  </div>
  <div class="line not-covered" id="L717">
    <div class="line-number"><a href="#L717">717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            log(&quot;debug&quot;, &quot;Successfully called parent path listener&quot;, {</div>
  </div>
  <div class="line not-covered" id="L718">
    <div class="line-number"><a href="#L718">718</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              parent_path = parent_path,</div>
  </div>
  <div class="line not-covered" id="L719">
    <div class="line-number"><a href="#L719">719</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              changed_path = path,</div>
  </div>
  <div class="line not-covered" id="L720">
    <div class="line-number"><a href="#L720">720</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              listener_index = i,</div>
  </div>
  <div class="line not-covered" id="L721">
    <div class="line-number"><a href="#L721">721</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L722">
    <div class="line-number"><a href="#L722">722</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L723">
    <div class="line-number"><a href="#L723">723</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L724">
    <div class="line-number"><a href="#L724">724</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          log(&quot;warn&quot;, &quot;Non-function callback found in parent listeners&quot;, {</div>
  </div>
  <div class="line not-covered" id="L725">
    <div class="line-number"><a href="#L725">725</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            parent_path = parent_path,</div>
  </div>
  <div class="line not-covered" id="L726">
    <div class="line-number"><a href="#L726">726</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            callback_type = type(callback),</div>
  </div>
  <div class="line not-covered" id="L727">
    <div class="line-number"><a href="#L727">727</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            listener_index = i,</div>
  </div>
  <div class="line not-covered" id="L728">
    <div class="line-number"><a href="#L728">728</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L729">
    <div class="line-number"><a href="#L729">729</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L730">
    <div class="line-number"><a href="#L730">730</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L731">
    <div class="line-number"><a href="#L731">731</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L732">
    <div class="line-number"><a href="#L732">732</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L733">
    <div class="line-number"><a href="#L733">733</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Notify root listeners (empty path)</div>
  </div>
  <div class="line not-covered" id="L734">
    <div class="line-number"><a href="#L734">734</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.listeners[&quot;&quot;] and #config.listeners[&quot;&quot;] &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L735">
    <div class="line-number"><a href="#L735">735</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i, callback in ipairs(config.listeners[&quot;&quot;]) do</div>
  </div>
  <div class="line not-covered" id="L736">
    <div class="line-number"><a href="#L736">736</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(callback) == &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L737">
    <div class="line-number"><a href="#L737">737</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local success, err = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L738">
    <div class="line-number"><a href="#L738">738</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          return callback(path, old_value, new_value)</div>
  </div>
  <div class="line not-covered" id="L739">
    <div class="line-number"><a href="#L739">739</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end)</div>
  </div>
  <div class="line not-covered" id="L740">
    <div class="line-number"><a href="#L740">740</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not success then</div>
  </div>
  <div class="line not-covered" id="L741">
    <div class="line-number"><a href="#L741">741</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          log(&quot;error&quot;, &quot;Error in root change listener callback&quot;, {</div>
  </div>
  <div class="line not-covered" id="L742">
    <div class="line-number"><a href="#L742">742</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            changed_path = path,</div>
  </div>
  <div class="line not-covered" id="L743">
    <div class="line-number"><a href="#L743">743</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error = err.message,</div>
  </div>
  <div class="line not-covered" id="L744">
    <div class="line-number"><a href="#L744">744</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            traceback = err.traceback,</div>
  </div>
  <div class="line not-covered" id="L745">
    <div class="line-number"><a href="#L745">745</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            listener_index = i,</div>
  </div>
  <div class="line not-covered" id="L746">
    <div class="line-number"><a href="#L746">746</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L747">
    <div class="line-number"><a href="#L747">747</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L748">
    <div class="line-number"><a href="#L748">748</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          log(&quot;debug&quot;, &quot;Successfully called root listener&quot;, {</div>
  </div>
  <div class="line not-covered" id="L749">
    <div class="line-number"><a href="#L749">749</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            changed_path = path,</div>
  </div>
  <div class="line not-covered" id="L750">
    <div class="line-number"><a href="#L750">750</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            listener_index = i,</div>
  </div>
  <div class="line not-covered" id="L751">
    <div class="line-number"><a href="#L751">751</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L752">
    <div class="line-number"><a href="#L752">752</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L753">
    <div class="line-number"><a href="#L753">753</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L754">
    <div class="line-number"><a href="#L754">754</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Non-function callback found in root listeners&quot;, {</div>
  </div>
  <div class="line not-covered" id="L755">
    <div class="line-number"><a href="#L755">755</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          callback_type = type(callback),</div>
  </div>
  <div class="line not-covered" id="L756">
    <div class="line-number"><a href="#L756">756</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          listener_index = i,</div>
  </div>
  <div class="line not-covered" id="L757">
    <div class="line-number"><a href="#L757">757</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L758">
    <div class="line-number"><a href="#L758">758</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L759">
    <div class="line-number"><a href="#L759">759</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L760">
    <div class="line-number"><a href="#L760">760</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L761">
    <div class="line-number"><a href="#L761">761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L762">
    <div class="line-number"><a href="#L762">762</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Registers a module with the configuration system</div>
  </div>
  <div class="line not-executable" id="L763">
    <div class="line-number"><a href="#L763">763</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function registers a module's configuration schema and default values with</div>
  </div>
  <div class="line not-executable" id="L764">
    <div class="line-number"><a href="#L764">764</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- the central configuration system. The schema is used for validation, and defaults</div>
  </div>
  <div class="line not-executable" id="L765">
    <div class="line-number"><a href="#L765">765</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- are applied if corresponding values don't already exist. This function enables</div>
  </div>
  <div class="line not-executable" id="L766">
    <div class="line-number"><a href="#L766">766</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- modules to define their configuration requirements in a structured way.</div>
  </div>
  <div class="line not-executable" id="L767">
    <div class="line-number"><a href="#L767">767</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L768">
    <div class="line-number"><a href="#L768">768</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name string The name of the module to register</div>
  </div>
  <div class="line not-executable" id="L769">
    <div class="line-number"><a href="#L769">769</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param schema? table Schema definition for validation</div>
  </div>
  <div class="line not-executable" id="L770">
    <div class="line-number"><a href="#L770">770</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param defaults? table Default values for the module</div>
  </div>
  <div class="line not-executable" id="L771">
    <div class="line-number"><a href="#L771">771</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return central_config The module instance for chaining</div>
  </div>
  <div class="line not-executable" id="L772">
    <div class="line-number"><a href="#L772">772</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L773">
    <div class="line-number"><a href="#L773">773</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L774">
    <div class="line-number"><a href="#L774">774</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Register a module with schema and defaults</div>
  </div>
  <div class="line not-executable" id="L775">
    <div class="line-number"><a href="#L775">775</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.register_module(&quot;logging&quot;, {</div>
  </div>
  <div class="line not-executable" id="L776">
    <div class="line-number"><a href="#L776">776</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Schema definition</div>
  </div>
  <div class="line not-executable" id="L777">
    <div class="line-number"><a href="#L777">777</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   required_fields = {&quot;level&quot;, &quot;format&quot;},</div>
  </div>
  <div class="line not-executable" id="L778">
    <div class="line-number"><a href="#L778">778</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   field_types = {</div>
  </div>
  <div class="line not-executable" id="L779">
    <div class="line-number"><a href="#L779">779</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     level = &quot;string&quot;,</div>
  </div>
  <div class="line not-executable" id="L780">
    <div class="line-number"><a href="#L780">780</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     format = &quot;string&quot;,</div>
  </div>
  <div class="line not-executable" id="L781">
    <div class="line-number"><a href="#L781">781</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     file = &quot;string&quot;,</div>
  </div>
  <div class="line not-executable" id="L782">
    <div class="line-number"><a href="#L782">782</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     rotate = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-executable" id="L783">
    <div class="line-number"><a href="#L783">783</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     max_size = &quot;number&quot;</div>
  </div>
  <div class="line not-executable" id="L784">
    <div class="line-number"><a href="#L784">784</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   },</div>
  </div>
  <div class="line not-executable" id="L785">
    <div class="line-number"><a href="#L785">785</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   field_values = {</div>
  </div>
  <div class="line not-executable" id="L786">
    <div class="line-number"><a href="#L786">786</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     level = {&quot;debug&quot;, &quot;info&quot;, &quot;warn&quot;, &quot;error&quot;},</div>
  </div>
  <div class="line not-executable" id="L787">
    <div class="line-number"><a href="#L787">787</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     format = {&quot;text&quot;, &quot;json&quot;, &quot;pretty&quot;}</div>
  </div>
  <div class="line not-executable" id="L788">
    <div class="line-number"><a href="#L788">788</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   }</div>
  </div>
  <div class="line not-executable" id="L789">
    <div class="line-number"><a href="#L789">789</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }, {</div>
  </div>
  <div class="line not-executable" id="L790">
    <div class="line-number"><a href="#L790">790</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Default values</div>
  </div>
  <div class="line not-executable" id="L791">
    <div class="line-number"><a href="#L791">791</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   level = &quot;info&quot;,</div>
  </div>
  <div class="line not-executable" id="L792">
    <div class="line-number"><a href="#L792">792</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   format = &quot;text&quot;,</div>
  </div>
  <div class="line not-executable" id="L793">
    <div class="line-number"><a href="#L793">793</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   rotate = false,</div>
  </div>
  <div class="line not-executable" id="L794">
    <div class="line-number"><a href="#L794">794</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   max_size = 10485760 -- 10MB</div>
  </div>
  <div class="line not-executable" id="L795">
    <div class="line-number"><a href="#L795">795</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-executable" id="L796">
    <div class="line-number"><a href="#L796">796</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L797">
    <div class="line-number"><a href="#L797">797</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Register just defaults (no schema validation)</div>
  </div>
  <div class="line not-executable" id="L798">
    <div class="line-number"><a href="#L798">798</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.register_module(&quot;http_client&quot;, nil, {</div>
  </div>
  <div class="line not-executable" id="L799">
    <div class="line-number"><a href="#L799">799</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   timeout = 30,</div>
  </div>
  <div class="line not-executable" id="L800">
    <div class="line-number"><a href="#L800">800</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   max_retries = 3,</div>
  </div>
  <div class="line not-executable" id="L801">
    <div class="line-number"><a href="#L801">801</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   retry_delay = 1000</div>
  </div>
  <div class="line not-executable" id="L802">
    <div class="line-number"><a href="#L802">802</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-executable" id="L803">
    <div class="line-number"><a href="#L803">803</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L804">
    <div class="line-number"><a href="#L804">804</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Register schema without defaults</div>
  </div>
  <div class="line not-executable" id="L805">
    <div class="line-number"><a href="#L805">805</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.register_module(&quot;database&quot;, {</div>
  </div>
  <div class="line not-executable" id="L806">
    <div class="line-number"><a href="#L806">806</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   required_fields = {&quot;host&quot;, &quot;port&quot;, &quot;username&quot;, &quot;password&quot;},</div>
  </div>
  <div class="line not-executable" id="L807">
    <div class="line-number"><a href="#L807">807</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   field_types = {</div>
  </div>
  <div class="line not-executable" id="L808">
    <div class="line-number"><a href="#L808">808</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     host = &quot;string&quot;,</div>
  </div>
  <div class="line not-executable" id="L809">
    <div class="line-number"><a href="#L809">809</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     port = &quot;number&quot;,</div>
  </div>
  <div class="line not-executable" id="L810">
    <div class="line-number"><a href="#L810">810</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     username = &quot;string&quot;,</div>
  </div>
  <div class="line not-executable" id="L811">
    <div class="line-number"><a href="#L811">811</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     password = &quot;string&quot;,</div>
  </div>
  <div class="line not-executable" id="L812">
    <div class="line-number"><a href="#L812">812</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     pool_size = &quot;number&quot;</div>
  </div>
  <div class="line not-executable" id="L813">
    <div class="line-number"><a href="#L813">813</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   }</div>
  </div>
  <div class="line not-executable" id="L814">
    <div class="line-number"><a href="#L814">814</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L815">
    <div class="line-number"><a href="#L815">815</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.register_module(module_name, schema, defaults)</div>
  </div>
  <div class="line not-executable" id="L816">
    <div class="line-number"><a href="#L816">816</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L817">
    <div class="line-number"><a href="#L817">817</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(module_name) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L818">
    <div class="line-number"><a href="#L818">818</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Module name must be a string&quot;, {</div>
  </div>
  <div class="line not-covered" id="L819">
    <div class="line-number"><a href="#L819">819</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;module_name&quot;,</div>
  </div>
  <div class="line not-covered" id="L820">
    <div class="line-number"><a href="#L820">820</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(module_name),</div>
  </div>
  <div class="line not-covered" id="L821">
    <div class="line-number"><a href="#L821">821</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;register_module&quot;,</div>
  </div>
  <div class="line not-covered" id="L822">
    <div class="line-number"><a href="#L822">822</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L823">
    <div class="line-number"><a href="#L823">823</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L824">
    <div class="line-number"><a href="#L824">824</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L825">
    <div class="line-number"><a href="#L825">825</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L826">
    <div class="line-number"><a href="#L826">826</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if module_name == &quot;&quot; then</div>
  </div>
  <div class="line not-covered" id="L827">
    <div class="line-number"><a href="#L827">827</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Module name cannot be empty&quot;, {</div>
  </div>
  <div class="line not-covered" id="L828">
    <div class="line-number"><a href="#L828">828</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;module_name&quot;,</div>
  </div>
  <div class="line not-covered" id="L829">
    <div class="line-number"><a href="#L829">829</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;register_module&quot;,</div>
  </div>
  <div class="line not-covered" id="L830">
    <div class="line-number"><a href="#L830">830</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L831">
    <div class="line-number"><a href="#L831">831</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L832">
    <div class="line-number"><a href="#L832">832</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L833">
    <div class="line-number"><a href="#L833">833</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L834">
    <div class="line-number"><a href="#L834">834</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log the registration operation</div>
  </div>
  <div class="line not-covered" id="L835">
    <div class="line-number"><a href="#L835">835</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;debug&quot;, &quot;Registering module configuration&quot;, {</div>
  </div>
  <div class="line not-covered" id="L836">
    <div class="line-number"><a href="#L836">836</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    module = module_name,</div>
  </div>
  <div class="line not-covered" id="L837">
    <div class="line-number"><a href="#L837">837</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    has_schema = schema ~= nil,</div>
  </div>
  <div class="line not-covered" id="L838">
    <div class="line-number"><a href="#L838">838</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    has_defaults = defaults ~= nil,</div>
  </div>
  <div class="line not-covered" id="L839">
    <div class="line-number"><a href="#L839">839</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L840">
    <div class="line-number"><a href="#L840">840</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Store schema if provided</div>
  </div>
  <div class="line not-covered" id="L841">
    <div class="line-number"><a href="#L841">841</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if schema ~= nil then</div>
  </div>
  <div class="line not-covered" id="L842">
    <div class="line-number"><a href="#L842">842</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(schema) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L843">
    <div class="line-number"><a href="#L843">843</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local err = error_handler.validation_error(&quot;Schema must be a table or nil&quot;, {</div>
  </div>
  <div class="line not-covered" id="L844">
    <div class="line-number"><a href="#L844">844</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        parameter_name = &quot;schema&quot;,</div>
  </div>
  <div class="line not-covered" id="L845">
    <div class="line-number"><a href="#L845">845</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        provided_type = type(schema),</div>
  </div>
  <div class="line not-covered" id="L846">
    <div class="line-number"><a href="#L846">846</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        module = module_name,</div>
  </div>
  <div class="line not-covered" id="L847">
    <div class="line-number"><a href="#L847">847</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;register_module&quot;,</div>
  </div>
  <div class="line not-covered" id="L848">
    <div class="line-number"><a href="#L848">848</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L849">
    <div class="line-number"><a href="#L849">849</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L850">
    <div class="line-number"><a href="#L850">850</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L851">
    <div class="line-number"><a href="#L851">851</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      config.schemas[module_name] = deep_copy(schema) -- Use deep_copy to prevent modification</div>
  </div>
  <div class="line not-covered" id="L852">
    <div class="line-number"><a href="#L852">852</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;debug&quot;, &quot;Registered schema for module&quot;, {</div>
  </div>
  <div class="line not-covered" id="L853">
    <div class="line-number"><a href="#L853">853</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        module = module_name,</div>
  </div>
  <div class="line not-covered" id="L854">
    <div class="line-number"><a href="#L854">854</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        schema_keys = table.concat(</div>
  </div>
  <div class="line not-covered" id="L855">
    <div class="line-number"><a href="#L855">855</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          (function()</div>
  </div>
  <div class="line not-covered" id="L856">
    <div class="line-number"><a href="#L856">856</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local keys = {}</div>
  </div>
  <div class="line not-covered" id="L857">
    <div class="line-number"><a href="#L857">857</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            for k, _ in pairs(schema) do</div>
  </div>
  <div class="line not-covered" id="L858">
    <div class="line-number"><a href="#L858">858</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              table.insert(keys, k)</div>
  </div>
  <div class="line not-covered" id="L859">
    <div class="line-number"><a href="#L859">859</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L860">
    <div class="line-number"><a href="#L860">860</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return keys</div>
  </div>
  <div class="line not-covered" id="L861">
    <div class="line-number"><a href="#L861">861</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end)(),</div>
  </div>
  <div class="line not-covered" id="L862">
    <div class="line-number"><a href="#L862">862</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;, &quot;</div>
  </div>
  <div class="line not-covered" id="L863">
    <div class="line-number"><a href="#L863">863</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        ),</div>
  </div>
  <div class="line not-covered" id="L864">
    <div class="line-number"><a href="#L864">864</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L865">
    <div class="line-number"><a href="#L865">865</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L866">
    <div class="line-number"><a href="#L866">866</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L867">
    <div class="line-number"><a href="#L867">867</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Apply defaults if provided</div>
  </div>
  <div class="line not-covered" id="L868">
    <div class="line-number"><a href="#L868">868</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if defaults ~= nil then</div>
  </div>
  <div class="line not-covered" id="L869">
    <div class="line-number"><a href="#L869">869</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(defaults) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L870">
    <div class="line-number"><a href="#L870">870</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local err = error_handler.validation_error(&quot;Defaults must be a table or nil&quot;, {</div>
  </div>
  <div class="line not-covered" id="L871">
    <div class="line-number"><a href="#L871">871</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        parameter_name = &quot;defaults&quot;,</div>
  </div>
  <div class="line not-covered" id="L872">
    <div class="line-number"><a href="#L872">872</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        provided_type = type(defaults),</div>
  </div>
  <div class="line not-covered" id="L873">
    <div class="line-number"><a href="#L873">873</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        module = module_name,</div>
  </div>
  <div class="line not-covered" id="L874">
    <div class="line-number"><a href="#L874">874</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;register_module&quot;,</div>
  </div>
  <div class="line not-covered" id="L875">
    <div class="line-number"><a href="#L875">875</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L876">
    <div class="line-number"><a href="#L876">876</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L877">
    <div class="line-number"><a href="#L877">877</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L878">
    <div class="line-number"><a href="#L878">878</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Store defaults (with deep copy to prevent modification)</div>
  </div>
  <div class="line not-covered" id="L879">
    <div class="line-number"><a href="#L879">879</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      config.defaults[module_name] = deep_copy(defaults)</div>
  </div>
  <div class="line not-executable" id="L880">
    <div class="line-number"><a href="#L880">880</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Make sure the module's config section exists</div>
  </div>
  <div class="line not-covered" id="L881">
    <div class="line-number"><a href="#L881">881</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      config.values[module_name] = config.values[module_name] or {}</div>
  </div>
  <div class="line not-executable" id="L882">
    <div class="line-number"><a href="#L882">882</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Simplified and more robust default application function</div>
  </div>
  <div class="line not-covered" id="L883">
    <div class="line-number"><a href="#L883">883</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local function apply_defaults(target, source)</div>
  </div>
  <div class="line not-covered" id="L884">
    <div class="line-number"><a href="#L884">884</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for k, v in pairs(source) do</div>
  </div>
  <div class="line not-covered" id="L885">
    <div class="line-number"><a href="#L885">885</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if target[k] == nil then</div>
  </div>
  <div class="line not-executable" id="L886">
    <div class="line-number"><a href="#L886">886</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- No value exists, so copy from defaults</div>
  </div>
  <div class="line not-covered" id="L887">
    <div class="line-number"><a href="#L887">887</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if type(v) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L888">
    <div class="line-number"><a href="#L888">888</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              target[k] = deep_copy(v) -- Use deep_copy for tables</div>
  </div>
  <div class="line not-covered" id="L889">
    <div class="line-number"><a href="#L889">889</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            else</div>
  </div>
  <div class="line not-covered" id="L890">
    <div class="line-number"><a href="#L890">890</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              target[k] = v -- Direct assignment for simple values</div>
  </div>
  <div class="line not-covered" id="L891">
    <div class="line-number"><a href="#L891">891</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L892">
    <div class="line-number"><a href="#L892">892</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            log(&quot;debug&quot;, &quot;Applied default value for key&quot;, {</div>
  </div>
  <div class="line not-covered" id="L893">
    <div class="line-number"><a href="#L893">893</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              module = module_name,</div>
  </div>
  <div class="line not-covered" id="L894">
    <div class="line-number"><a href="#L894">894</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              key = k,</div>
  </div>
  <div class="line not-covered" id="L895">
    <div class="line-number"><a href="#L895">895</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              value_type = type(v),</div>
  </div>
  <div class="line not-covered" id="L896">
    <div class="line-number"><a href="#L896">896</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L897">
    <div class="line-number"><a href="#L897">897</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          elseif type(target[k]) == &quot;table&quot; and type(v) == &quot;table&quot; then</div>
  </div>
  <div class="line not-executable" id="L898">
    <div class="line-number"><a href="#L898">898</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Both are tables, so merge recursively</div>
  </div>
  <div class="line not-covered" id="L899">
    <div class="line-number"><a href="#L899">899</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            apply_defaults(target[k], v)</div>
  </div>
  <div class="line not-covered" id="L900">
    <div class="line-number"><a href="#L900">900</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-executable" id="L901">
    <div class="line-number"><a href="#L901">901</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- If value exists and is not a table, keep the existing value</div>
  </div>
  <div class="line not-covered" id="L902">
    <div class="line-number"><a href="#L902">902</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L903">
    <div class="line-number"><a href="#L903">903</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L904">
    <div class="line-number"><a href="#L904">904</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Apply defaults to the module's configuration</div>
  </div>
  <div class="line not-covered" id="L905">
    <div class="line-number"><a href="#L905">905</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      apply_defaults(config.values[module_name], defaults)</div>
  </div>
  <div class="line not-covered" id="L906">
    <div class="line-number"><a href="#L906">906</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;debug&quot;, &quot;Applied defaults for module&quot;, {</div>
  </div>
  <div class="line not-covered" id="L907">
    <div class="line-number"><a href="#L907">907</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        module = module_name,</div>
  </div>
  <div class="line not-covered" id="L908">
    <div class="line-number"><a href="#L908">908</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        default_keys = table.concat(</div>
  </div>
  <div class="line not-covered" id="L909">
    <div class="line-number"><a href="#L909">909</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          (function()</div>
  </div>
  <div class="line not-covered" id="L910">
    <div class="line-number"><a href="#L910">910</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local keys = {}</div>
  </div>
  <div class="line not-covered" id="L911">
    <div class="line-number"><a href="#L911">911</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            for k, _ in pairs(defaults) do</div>
  </div>
  <div class="line not-covered" id="L912">
    <div class="line-number"><a href="#L912">912</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              table.insert(keys, k)</div>
  </div>
  <div class="line not-covered" id="L913">
    <div class="line-number"><a href="#L913">913</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L914">
    <div class="line-number"><a href="#L914">914</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return keys</div>
  </div>
  <div class="line not-covered" id="L915">
    <div class="line-number"><a href="#L915">915</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end)(),</div>
  </div>
  <div class="line not-covered" id="L916">
    <div class="line-number"><a href="#L916">916</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;, &quot;</div>
  </div>
  <div class="line not-covered" id="L917">
    <div class="line-number"><a href="#L917">917</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        ),</div>
  </div>
  <div class="line not-covered" id="L918">
    <div class="line-number"><a href="#L918">918</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L919">
    <div class="line-number"><a href="#L919">919</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L920">
    <div class="line-number"><a href="#L920">920</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L921">
    <div class="line-number"><a href="#L921">921</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L922">
    <div class="line-number"><a href="#L922">922</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L923">
    <div class="line-number"><a href="#L923">923</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Validates configuration against registered schemas</div>
  </div>
  <div class="line not-executable" id="L924">
    <div class="line-number"><a href="#L924">924</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function performs comprehensive validation of configuration values against</div>
  </div>
  <div class="line not-executable" id="L925">
    <div class="line-number"><a href="#L925">925</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- their registered schemas. It can validate a specific module or all modules with</div>
  </div>
  <div class="line not-executable" id="L926">
    <div class="line-number"><a href="#L926">926</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- registered schemas. The validation includes type checking, required fields verification,</div>
  </div>
  <div class="line not-executable" id="L927">
    <div class="line-number"><a href="#L927">927</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- range validation, pattern matching, enum value validation, and custom validator functions.</div>
  </div>
  <div class="line not-executable" id="L928">
    <div class="line-number"><a href="#L928">928</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L929">
    <div class="line-number"><a href="#L929">929</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name? string The name of the module to validate (nil for all)</div>
  </div>
  <div class="line not-executable" id="L930">
    <div class="line-number"><a href="#L930">930</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean valid Whether the configuration is valid</div>
  </div>
  <div class="line not-executable" id="L931">
    <div class="line-number"><a href="#L931">931</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil error Error if validation failed, with details on validation errors</div>
  </div>
  <div class="line not-executable" id="L932">
    <div class="line-number"><a href="#L932">932</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L933">
    <div class="line-number"><a href="#L933">933</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L934">
    <div class="line-number"><a href="#L934">934</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Validate a specific module's configuration</div>
  </div>
  <div class="line not-executable" id="L935">
    <div class="line-number"><a href="#L935">935</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local valid, err = central_config.validate(&quot;database&quot;)</div>
  </div>
  <div class="line not-executable" id="L936">
    <div class="line-number"><a href="#L936">936</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not valid then</div>
  </div>
  <div class="line not-executable" id="L937">
    <div class="line-number"><a href="#L937">937</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Database configuration is invalid:&quot;)</div>
  </div>
  <div class="line not-executable" id="L938">
    <div class="line-number"><a href="#L938">938</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   for _, field_err in ipairs(err.context.errors) do</div>
  </div>
  <div class="line not-executable" id="L939">
    <div class="line-number"><a href="#L939">939</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     print(&quot;  - &quot; .. field_err.field .. &quot;: &quot; .. field_err.message)</div>
  </div>
  <div class="line not-executable" id="L940">
    <div class="line-number"><a href="#L940">940</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L941">
    <div class="line-number"><a href="#L941">941</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Use defaults or prompt for configuration</div>
  </div>
  <div class="line not-executable" id="L942">
    <div class="line-number"><a href="#L942">942</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L943">
    <div class="line-number"><a href="#L943">943</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L944">
    <div class="line-number"><a href="#L944">944</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Validate all registered modules</div>
  </div>
  <div class="line not-executable" id="L945">
    <div class="line-number"><a href="#L945">945</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local valid, err = central_config.validate()</div>
  </div>
  <div class="line not-executable" id="L946">
    <div class="line-number"><a href="#L946">946</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not valid then</div>
  </div>
  <div class="line not-executable" id="L947">
    <div class="line-number"><a href="#L947">947</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Configuration validation failed:&quot;)</div>
  </div>
  <div class="line not-executable" id="L948">
    <div class="line-number"><a href="#L948">948</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   for module_name, module_errors in pairs(err.context.modules) do</div>
  </div>
  <div class="line not-executable" id="L949">
    <div class="line-number"><a href="#L949">949</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     print(&quot;Module: &quot; .. module_name)</div>
  </div>
  <div class="line not-executable" id="L950">
    <div class="line-number"><a href="#L950">950</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     for _, field_err in ipairs(module_errors) do</div>
  </div>
  <div class="line not-executable" id="L951">
    <div class="line-number"><a href="#L951">951</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       print(&quot;  - &quot; .. field_err.field .. &quot;: &quot; .. field_err.message)</div>
  </div>
  <div class="line not-executable" id="L952">
    <div class="line-number"><a href="#L952">952</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     end</div>
  </div>
  <div class="line not-executable" id="L953">
    <div class="line-number"><a href="#L953">953</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L954">
    <div class="line-number"><a href="#L954">954</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L955">
    <div class="line-number"><a href="#L955">955</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L956">
    <div class="line-number"><a href="#L956">956</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Validate before saving configuration</div>
  </div>
  <div class="line not-executable" id="L957">
    <div class="line-number"><a href="#L957">957</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local function save_if_valid(path)</div>
  </div>
  <div class="line not-executable" id="L958">
    <div class="line-number"><a href="#L958">958</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if central_config.validate() then</div>
  </div>
  <div class="line not-executable" id="L959">
    <div class="line-number"><a href="#L959">959</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     return central_config.save_to_file(path)</div>
  </div>
  <div class="line not-executable" id="L960">
    <div class="line-number"><a href="#L960">960</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   else</div>
  </div>
  <div class="line not-executable" id="L961">
    <div class="line-number"><a href="#L961">961</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     return false, &quot;Configuration validation failed&quot;</div>
  </div>
  <div class="line not-executable" id="L962">
    <div class="line-number"><a href="#L962">962</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L963">
    <div class="line-number"><a href="#L963">963</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L964">
    <div class="line-number"><a href="#L964">964</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.validate(module_name)</div>
  </div>
  <div class="line not-executable" id="L965">
    <div class="line-number"><a href="#L965">965</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L966">
    <div class="line-number"><a href="#L966">966</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if module_name ~= nil and type(module_name) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L967">
    <div class="line-number"><a href="#L967">967</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Module name must be a string or nil&quot;, {</div>
  </div>
  <div class="line not-covered" id="L968">
    <div class="line-number"><a href="#L968">968</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;module_name&quot;,</div>
  </div>
  <div class="line not-covered" id="L969">
    <div class="line-number"><a href="#L969">969</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(module_name),</div>
  </div>
  <div class="line not-covered" id="L970">
    <div class="line-number"><a href="#L970">970</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;validate&quot;,</div>
  </div>
  <div class="line not-covered" id="L971">
    <div class="line-number"><a href="#L971">971</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L972">
    <div class="line-number"><a href="#L972">972</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L973">
    <div class="line-number"><a href="#L973">973</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, err</div>
  </div>
  <div class="line not-covered" id="L974">
    <div class="line-number"><a href="#L974">974</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L975">
    <div class="line-number"><a href="#L975">975</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local errors = {}</div>
  </div>
  <div class="line not-covered" id="L976">
    <div class="line-number"><a href="#L976">976</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local function validate_module(name)</div>
  </div>
  <div class="line not-executable" id="L977">
    <div class="line-number"><a href="#L977">977</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Verify the module exists in the schema registry</div>
  </div>
  <div class="line not-covered" id="L978">
    <div class="line-number"><a href="#L978">978</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local schema = config.schemas[name]</div>
  </div>
  <div class="line not-covered" id="L979">
    <div class="line-number"><a href="#L979">979</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not schema then</div>
  </div>
  <div class="line not-covered" id="L980">
    <div class="line-number"><a href="#L980">980</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;debug&quot;, &quot;No schema registered for module&quot;, { module = name })</div>
  </div>
  <div class="line not-covered" id="L981">
    <div class="line-number"><a href="#L981">981</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return true</div>
  </div>
  <div class="line not-covered" id="L982">
    <div class="line-number"><a href="#L982">982</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L983">
    <div class="line-number"><a href="#L983">983</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Get the current configuration for this module</div>
  </div>
  <div class="line not-covered" id="L984">
    <div class="line-number"><a href="#L984">984</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local module_config = M.get(name)</div>
  </div>
  <div class="line not-covered" id="L985">
    <div class="line-number"><a href="#L985">985</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not module_config then</div>
  </div>
  <div class="line not-executable" id="L986">
    <div class="line-number"><a href="#L986">986</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- No configuration for this module, which is valid</div>
  </div>
  <div class="line not-covered" id="L987">
    <div class="line-number"><a href="#L987">987</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return true</div>
  </div>
  <div class="line not-covered" id="L988">
    <div class="line-number"><a href="#L988">988</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L989">
    <div class="line-number"><a href="#L989">989</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local module_errors = {}</div>
  </div>
  <div class="line not-executable" id="L990">
    <div class="line-number"><a href="#L990">990</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Basic structural validation (check required fields)</div>
  </div>
  <div class="line not-covered" id="L991">
    <div class="line-number"><a href="#L991">991</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if schema.required_fields then</div>
  </div>
  <div class="line not-covered" id="L992">
    <div class="line-number"><a href="#L992">992</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(schema.required_fields) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L993">
    <div class="line-number"><a href="#L993">993</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Invalid schema.required_fields format&quot;, {</div>
  </div>
  <div class="line not-covered" id="L994">
    <div class="line-number"><a href="#L994">994</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          module = name,</div>
  </div>
  <div class="line not-covered" id="L995">
    <div class="line-number"><a href="#L995">995</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          type = type(schema.required_fields),</div>
  </div>
  <div class="line not-covered" id="L996">
    <div class="line-number"><a href="#L996">996</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L997">
    <div class="line-number"><a href="#L997">997</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L998">
    <div class="line-number"><a href="#L998">998</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _, field in ipairs(schema.required_fields) do</div>
  </div>
  <div class="line not-covered" id="L999">
    <div class="line-number"><a href="#L999">999</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if module_config[field] == nil then</div>
  </div>
  <div class="line not-covered" id="L1000">
    <div class="line-number"><a href="#L1000">1000</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(module_errors, {</div>
  </div>
  <div class="line not-covered" id="L1001">
    <div class="line-number"><a href="#L1001">1001</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              field = field,</div>
  </div>
  <div class="line not-covered" id="L1002">
    <div class="line-number"><a href="#L1002">1002</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              message = &quot;Required field missing&quot;,</div>
  </div>
  <div class="line not-covered" id="L1003">
    <div class="line-number"><a href="#L1003">1003</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L1004">
    <div class="line-number"><a href="#L1004">1004</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L1005">
    <div class="line-number"><a href="#L1005">1005</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1006">
    <div class="line-number"><a href="#L1006">1006</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1007">
    <div class="line-number"><a href="#L1007">1007</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1008">
    <div class="line-number"><a href="#L1008">1008</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Type validation</div>
  </div>
  <div class="line not-covered" id="L1009">
    <div class="line-number"><a href="#L1009">1009</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if schema.field_types then</div>
  </div>
  <div class="line not-covered" id="L1010">
    <div class="line-number"><a href="#L1010">1010</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(schema.field_types) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1011">
    <div class="line-number"><a href="#L1011">1011</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Invalid schema.field_types format&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1012">
    <div class="line-number"><a href="#L1012">1012</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          module = name,</div>
  </div>
  <div class="line not-covered" id="L1013">
    <div class="line-number"><a href="#L1013">1013</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          type = type(schema.field_types),</div>
  </div>
  <div class="line not-covered" id="L1014">
    <div class="line-number"><a href="#L1014">1014</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1015">
    <div class="line-number"><a href="#L1015">1015</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L1016">
    <div class="line-number"><a href="#L1016">1016</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for field, expected_type in pairs(schema.field_types) do</div>
  </div>
  <div class="line not-covered" id="L1017">
    <div class="line-number"><a href="#L1017">1017</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if module_config[field] ~= nil and type(module_config[field]) ~= expected_type then</div>
  </div>
  <div class="line not-covered" id="L1018">
    <div class="line-number"><a href="#L1018">1018</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(module_errors, {</div>
  </div>
  <div class="line not-covered" id="L1019">
    <div class="line-number"><a href="#L1019">1019</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              field = field,</div>
  </div>
  <div class="line not-covered" id="L1020">
    <div class="line-number"><a href="#L1020">1020</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              message = &quot;Field has wrong type&quot;,</div>
  </div>
  <div class="line not-covered" id="L1021">
    <div class="line-number"><a href="#L1021">1021</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              expected = expected_type,</div>
  </div>
  <div class="line not-covered" id="L1022">
    <div class="line-number"><a href="#L1022">1022</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              got = type(module_config[field]),</div>
  </div>
  <div class="line not-covered" id="L1023">
    <div class="line-number"><a href="#L1023">1023</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L1024">
    <div class="line-number"><a href="#L1024">1024</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L1025">
    <div class="line-number"><a href="#L1025">1025</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1026">
    <div class="line-number"><a href="#L1026">1026</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1027">
    <div class="line-number"><a href="#L1027">1027</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1028">
    <div class="line-number"><a href="#L1028">1028</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Range validation</div>
  </div>
  <div class="line not-covered" id="L1029">
    <div class="line-number"><a href="#L1029">1029</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if schema.field_ranges then</div>
  </div>
  <div class="line not-covered" id="L1030">
    <div class="line-number"><a href="#L1030">1030</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(schema.field_ranges) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1031">
    <div class="line-number"><a href="#L1031">1031</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Invalid schema.field_ranges format&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1032">
    <div class="line-number"><a href="#L1032">1032</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          module = name,</div>
  </div>
  <div class="line not-covered" id="L1033">
    <div class="line-number"><a href="#L1033">1033</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          type = type(schema.field_ranges),</div>
  </div>
  <div class="line not-covered" id="L1034">
    <div class="line-number"><a href="#L1034">1034</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1035">
    <div class="line-number"><a href="#L1035">1035</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L1036">
    <div class="line-number"><a href="#L1036">1036</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for field, range in pairs(schema.field_ranges) do</div>
  </div>
  <div class="line not-covered" id="L1037">
    <div class="line-number"><a href="#L1037">1037</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if type(range) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1038">
    <div class="line-number"><a href="#L1038">1038</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            log(&quot;warn&quot;, &quot;Invalid range specification&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1039">
    <div class="line-number"><a href="#L1039">1039</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              module = name,</div>
  </div>
  <div class="line not-covered" id="L1040">
    <div class="line-number"><a href="#L1040">1040</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              field = field,</div>
  </div>
  <div class="line not-covered" id="L1041">
    <div class="line-number"><a href="#L1041">1041</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              range_type = type(range),</div>
  </div>
  <div class="line not-covered" id="L1042">
    <div class="line-number"><a href="#L1042">1042</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L1043">
    <div class="line-number"><a href="#L1043">1043</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          else</div>
  </div>
  <div class="line not-covered" id="L1044">
    <div class="line-number"><a href="#L1044">1044</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local value = module_config[field]</div>
  </div>
  <div class="line not-covered" id="L1045">
    <div class="line-number"><a href="#L1045">1045</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if value ~= nil and type(value) == &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1046">
    <div class="line-number"><a href="#L1046">1046</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              if (range.min and value &lt; range.min) or (range.max and value &gt; range.max) then</div>
  </div>
  <div class="line not-covered" id="L1047">
    <div class="line-number"><a href="#L1047">1047</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(module_errors, {</div>
  </div>
  <div class="line not-covered" id="L1048">
    <div class="line-number"><a href="#L1048">1048</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  field = field,</div>
  </div>
  <div class="line not-covered" id="L1049">
    <div class="line-number"><a href="#L1049">1049</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  message = &quot;Field value out of range&quot;,</div>
  </div>
  <div class="line not-covered" id="L1050">
    <div class="line-number"><a href="#L1050">1050</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  min = range.min,</div>
  </div>
  <div class="line not-covered" id="L1051">
    <div class="line-number"><a href="#L1051">1051</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  max = range.max,</div>
  </div>
  <div class="line not-covered" id="L1052">
    <div class="line-number"><a href="#L1052">1052</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  value = value,</div>
  </div>
  <div class="line not-covered" id="L1053">
    <div class="line-number"><a href="#L1053">1053</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                })</div>
  </div>
  <div class="line not-covered" id="L1054">
    <div class="line-number"><a href="#L1054">1054</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              end</div>
  </div>
  <div class="line not-covered" id="L1055">
    <div class="line-number"><a href="#L1055">1055</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1056">
    <div class="line-number"><a href="#L1056">1056</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L1057">
    <div class="line-number"><a href="#L1057">1057</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1058">
    <div class="line-number"><a href="#L1058">1058</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1059">
    <div class="line-number"><a href="#L1059">1059</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1060">
    <div class="line-number"><a href="#L1060">1060</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Pattern validation</div>
  </div>
  <div class="line not-covered" id="L1061">
    <div class="line-number"><a href="#L1061">1061</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if schema.field_patterns then</div>
  </div>
  <div class="line not-covered" id="L1062">
    <div class="line-number"><a href="#L1062">1062</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(schema.field_patterns) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1063">
    <div class="line-number"><a href="#L1063">1063</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Invalid schema.field_patterns format&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1064">
    <div class="line-number"><a href="#L1064">1064</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          module = name,</div>
  </div>
  <div class="line not-covered" id="L1065">
    <div class="line-number"><a href="#L1065">1065</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          type = type(schema.field_patterns),</div>
  </div>
  <div class="line not-covered" id="L1066">
    <div class="line-number"><a href="#L1066">1066</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1067">
    <div class="line-number"><a href="#L1067">1067</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L1068">
    <div class="line-number"><a href="#L1068">1068</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for field, pattern in pairs(schema.field_patterns) do</div>
  </div>
  <div class="line not-covered" id="L1069">
    <div class="line-number"><a href="#L1069">1069</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if type(pattern) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1070">
    <div class="line-number"><a href="#L1070">1070</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            log(&quot;warn&quot;, &quot;Invalid pattern specification&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1071">
    <div class="line-number"><a href="#L1071">1071</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              module = name,</div>
  </div>
  <div class="line not-covered" id="L1072">
    <div class="line-number"><a href="#L1072">1072</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              field = field,</div>
  </div>
  <div class="line not-covered" id="L1073">
    <div class="line-number"><a href="#L1073">1073</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              pattern_type = type(pattern),</div>
  </div>
  <div class="line not-covered" id="L1074">
    <div class="line-number"><a href="#L1074">1074</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L1075">
    <div class="line-number"><a href="#L1075">1075</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          else</div>
  </div>
  <div class="line not-covered" id="L1076">
    <div class="line-number"><a href="#L1076">1076</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local value = module_config[field]</div>
  </div>
  <div class="line not-covered" id="L1077">
    <div class="line-number"><a href="#L1077">1077</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if value ~= nil and type(value) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1078">
    <div class="line-number"><a href="#L1078">1078</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              local success, result = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L1079">
    <div class="line-number"><a href="#L1079">1079</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return string.match(value, pattern) ~= nil</div>
  </div>
  <div class="line not-covered" id="L1080">
    <div class="line-number"><a href="#L1080">1080</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              end)</div>
  </div>
  <div class="line not-covered" id="L1081">
    <div class="line-number"><a href="#L1081">1081</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              if not success then</div>
  </div>
  <div class="line not-covered" id="L1082">
    <div class="line-number"><a href="#L1082">1082</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(module_errors, {</div>
  </div>
  <div class="line not-covered" id="L1083">
    <div class="line-number"><a href="#L1083">1083</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  field = field,</div>
  </div>
  <div class="line not-covered" id="L1084">
    <div class="line-number"><a href="#L1084">1084</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  message = &quot;Invalid pattern: &quot; .. result.message,</div>
  </div>
  <div class="line not-covered" id="L1085">
    <div class="line-number"><a href="#L1085">1085</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  pattern = pattern,</div>
  </div>
  <div class="line not-covered" id="L1086">
    <div class="line-number"><a href="#L1086">1086</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                })</div>
  </div>
  <div class="line not-covered" id="L1087">
    <div class="line-number"><a href="#L1087">1087</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              elseif not result then</div>
  </div>
  <div class="line not-covered" id="L1088">
    <div class="line-number"><a href="#L1088">1088</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(module_errors, {</div>
  </div>
  <div class="line not-covered" id="L1089">
    <div class="line-number"><a href="#L1089">1089</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  field = field,</div>
  </div>
  <div class="line not-covered" id="L1090">
    <div class="line-number"><a href="#L1090">1090</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  message = &quot;Field value does not match pattern&quot;,</div>
  </div>
  <div class="line not-covered" id="L1091">
    <div class="line-number"><a href="#L1091">1091</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  pattern = pattern,</div>
  </div>
  <div class="line not-covered" id="L1092">
    <div class="line-number"><a href="#L1092">1092</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  value = value,</div>
  </div>
  <div class="line not-covered" id="L1093">
    <div class="line-number"><a href="#L1093">1093</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                })</div>
  </div>
  <div class="line not-covered" id="L1094">
    <div class="line-number"><a href="#L1094">1094</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              end</div>
  </div>
  <div class="line not-covered" id="L1095">
    <div class="line-number"><a href="#L1095">1095</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1096">
    <div class="line-number"><a href="#L1096">1096</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L1097">
    <div class="line-number"><a href="#L1097">1097</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1098">
    <div class="line-number"><a href="#L1098">1098</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1099">
    <div class="line-number"><a href="#L1099">1099</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1100">
    <div class="line-number"><a href="#L1100">1100</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Value validation (enum-like)</div>
  </div>
  <div class="line not-covered" id="L1101">
    <div class="line-number"><a href="#L1101">1101</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if schema.field_values then</div>
  </div>
  <div class="line not-covered" id="L1102">
    <div class="line-number"><a href="#L1102">1102</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(schema.field_values) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1103">
    <div class="line-number"><a href="#L1103">1103</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Invalid schema.field_values format&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1104">
    <div class="line-number"><a href="#L1104">1104</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          module = name,</div>
  </div>
  <div class="line not-covered" id="L1105">
    <div class="line-number"><a href="#L1105">1105</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          type = type(schema.field_values),</div>
  </div>
  <div class="line not-covered" id="L1106">
    <div class="line-number"><a href="#L1106">1106</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1107">
    <div class="line-number"><a href="#L1107">1107</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L1108">
    <div class="line-number"><a href="#L1108">1108</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for field, valid_values in pairs(schema.field_values) do</div>
  </div>
  <div class="line not-covered" id="L1109">
    <div class="line-number"><a href="#L1109">1109</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if type(valid_values) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1110">
    <div class="line-number"><a href="#L1110">1110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            log(&quot;warn&quot;, &quot;Invalid valid_values specification&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1111">
    <div class="line-number"><a href="#L1111">1111</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              module = name,</div>
  </div>
  <div class="line not-covered" id="L1112">
    <div class="line-number"><a href="#L1112">1112</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              field = field,</div>
  </div>
  <div class="line not-covered" id="L1113">
    <div class="line-number"><a href="#L1113">1113</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              values_type = type(valid_values),</div>
  </div>
  <div class="line not-covered" id="L1114">
    <div class="line-number"><a href="#L1114">1114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L1115">
    <div class="line-number"><a href="#L1115">1115</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          else</div>
  </div>
  <div class="line not-covered" id="L1116">
    <div class="line-number"><a href="#L1116">1116</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local value = module_config[field]</div>
  </div>
  <div class="line not-covered" id="L1117">
    <div class="line-number"><a href="#L1117">1117</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if value ~= nil then</div>
  </div>
  <div class="line not-covered" id="L1118">
    <div class="line-number"><a href="#L1118">1118</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              local valid = false</div>
  </div>
  <div class="line not-covered" id="L1119">
    <div class="line-number"><a href="#L1119">1119</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              for _, valid_value in ipairs(valid_values) do</div>
  </div>
  <div class="line not-covered" id="L1120">
    <div class="line-number"><a href="#L1120">1120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                if value == valid_value then</div>
  </div>
  <div class="line not-covered" id="L1121">
    <div class="line-number"><a href="#L1121">1121</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  valid = true</div>
  </div>
  <div class="line not-covered" id="L1122">
    <div class="line-number"><a href="#L1122">1122</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  break</div>
  </div>
  <div class="line not-covered" id="L1123">
    <div class="line-number"><a href="#L1123">1123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                end</div>
  </div>
  <div class="line not-covered" id="L1124">
    <div class="line-number"><a href="#L1124">1124</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              end</div>
  </div>
  <div class="line not-covered" id="L1125">
    <div class="line-number"><a href="#L1125">1125</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              if not valid then</div>
  </div>
  <div class="line not-covered" id="L1126">
    <div class="line-number"><a href="#L1126">1126</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(module_errors, {</div>
  </div>
  <div class="line not-covered" id="L1127">
    <div class="line-number"><a href="#L1127">1127</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  field = field,</div>
  </div>
  <div class="line not-covered" id="L1128">
    <div class="line-number"><a href="#L1128">1128</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  message = &quot;Field has invalid value&quot;,</div>
  </div>
  <div class="line not-covered" id="L1129">
    <div class="line-number"><a href="#L1129">1129</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  valid_values = valid_values,</div>
  </div>
  <div class="line not-covered" id="L1130">
    <div class="line-number"><a href="#L1130">1130</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  value = value,</div>
  </div>
  <div class="line not-covered" id="L1131">
    <div class="line-number"><a href="#L1131">1131</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                })</div>
  </div>
  <div class="line not-covered" id="L1132">
    <div class="line-number"><a href="#L1132">1132</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              end</div>
  </div>
  <div class="line not-covered" id="L1133">
    <div class="line-number"><a href="#L1133">1133</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1134">
    <div class="line-number"><a href="#L1134">1134</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L1135">
    <div class="line-number"><a href="#L1135">1135</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1136">
    <div class="line-number"><a href="#L1136">1136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1137">
    <div class="line-number"><a href="#L1137">1137</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1138">
    <div class="line-number"><a href="#L1138">1138</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Custom validators</div>
  </div>
  <div class="line not-covered" id="L1139">
    <div class="line-number"><a href="#L1139">1139</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if schema.validators then</div>
  </div>
  <div class="line not-covered" id="L1140">
    <div class="line-number"><a href="#L1140">1140</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(schema.validators) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1141">
    <div class="line-number"><a href="#L1141">1141</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Invalid schema.validators format&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1142">
    <div class="line-number"><a href="#L1142">1142</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          module = name,</div>
  </div>
  <div class="line not-covered" id="L1143">
    <div class="line-number"><a href="#L1143">1143</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          type = type(schema.validators),</div>
  </div>
  <div class="line not-covered" id="L1144">
    <div class="line-number"><a href="#L1144">1144</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1145">
    <div class="line-number"><a href="#L1145">1145</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L1146">
    <div class="line-number"><a href="#L1146">1146</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for field, validator in pairs(schema.validators) do</div>
  </div>
  <div class="line not-covered" id="L1147">
    <div class="line-number"><a href="#L1147">1147</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if type(validator) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1148">
    <div class="line-number"><a href="#L1148">1148</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            log(&quot;warn&quot;, &quot;Invalid validator specification&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1149">
    <div class="line-number"><a href="#L1149">1149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              module = name,</div>
  </div>
  <div class="line not-covered" id="L1150">
    <div class="line-number"><a href="#L1150">1150</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              field = field,</div>
  </div>
  <div class="line not-covered" id="L1151">
    <div class="line-number"><a href="#L1151">1151</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              validator_type = type(validator),</div>
  </div>
  <div class="line not-covered" id="L1152">
    <div class="line-number"><a href="#L1152">1152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L1153">
    <div class="line-number"><a href="#L1153">1153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          else</div>
  </div>
  <div class="line not-covered" id="L1154">
    <div class="line-number"><a href="#L1154">1154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local value = module_config[field]</div>
  </div>
  <div class="line not-covered" id="L1155">
    <div class="line-number"><a href="#L1155">1155</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            if value ~= nil then</div>
  </div>
  <div class="line not-covered" id="L1156">
    <div class="line-number"><a href="#L1156">1156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              local success, result, message = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L1157">
    <div class="line-number"><a href="#L1157">1157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                return validator(value, module_config)</div>
  </div>
  <div class="line not-covered" id="L1158">
    <div class="line-number"><a href="#L1158">1158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              end)</div>
  </div>
  <div class="line not-covered" id="L1159">
    <div class="line-number"><a href="#L1159">1159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              if not success then</div>
  </div>
  <div class="line not-covered" id="L1160">
    <div class="line-number"><a href="#L1160">1160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(module_errors, {</div>
  </div>
  <div class="line not-covered" id="L1161">
    <div class="line-number"><a href="#L1161">1161</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  field = field,</div>
  </div>
  <div class="line not-covered" id="L1162">
    <div class="line-number"><a href="#L1162">1162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  message = &quot;Validator error: &quot; .. result.message,</div>
  </div>
  <div class="line not-covered" id="L1163">
    <div class="line-number"><a href="#L1163">1163</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  value = value,</div>
  </div>
  <div class="line not-covered" id="L1164">
    <div class="line-number"><a href="#L1164">1164</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                })</div>
  </div>
  <div class="line not-covered" id="L1165">
    <div class="line-number"><a href="#L1165">1165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              elseif not result then</div>
  </div>
  <div class="line not-covered" id="L1166">
    <div class="line-number"><a href="#L1166">1166</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                table.insert(module_errors, {</div>
  </div>
  <div class="line not-covered" id="L1167">
    <div class="line-number"><a href="#L1167">1167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  field = field,</div>
  </div>
  <div class="line not-covered" id="L1168">
    <div class="line-number"><a href="#L1168">1168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  message = message or &quot;Failed custom validation&quot;,</div>
  </div>
  <div class="line not-covered" id="L1169">
    <div class="line-number"><a href="#L1169">1169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  value = value,</div>
  </div>
  <div class="line not-covered" id="L1170">
    <div class="line-number"><a href="#L1170">1170</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                })</div>
  </div>
  <div class="line not-covered" id="L1171">
    <div class="line-number"><a href="#L1171">1171</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              end</div>
  </div>
  <div class="line not-covered" id="L1172">
    <div class="line-number"><a href="#L1172">1172</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            end</div>
  </div>
  <div class="line not-covered" id="L1173">
    <div class="line-number"><a href="#L1173">1173</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L1174">
    <div class="line-number"><a href="#L1174">1174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1175">
    <div class="line-number"><a href="#L1175">1175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1176">
    <div class="line-number"><a href="#L1176">1176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1177">
    <div class="line-number"><a href="#L1177">1177</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Store errors if any</div>
  </div>
  <div class="line not-covered" id="L1178">
    <div class="line-number"><a href="#L1178">1178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if #module_errors &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L1179">
    <div class="line-number"><a href="#L1179">1179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      errors[name] = module_errors</div>
  </div>
  <div class="line not-covered" id="L1180">
    <div class="line-number"><a href="#L1180">1180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line not-covered" id="L1181">
    <div class="line-number"><a href="#L1181">1181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1182">
    <div class="line-number"><a href="#L1182">1182</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L1183">
    <div class="line-number"><a href="#L1183">1183</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1184">
    <div class="line-number"><a href="#L1184">1184</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Validate specific module if provided</div>
  </div>
  <div class="line not-covered" id="L1185">
    <div class="line-number"><a href="#L1185">1185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if module_name then</div>
  </div>
  <div class="line not-covered" id="L1186">
    <div class="line-number"><a href="#L1186">1186</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = validate_module(module_name)</div>
  </div>
  <div class="line not-covered" id="L1187">
    <div class="line-number"><a href="#L1187">1187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if result then</div>
  </div>
  <div class="line not-covered" id="L1188">
    <div class="line-number"><a href="#L1188">1188</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return true</div>
  </div>
  <div class="line not-covered" id="L1189">
    <div class="line-number"><a href="#L1189">1189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L1190">
    <div class="line-number"><a href="#L1190">1190</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local validation_error =</div>
  </div>
  <div class="line not-covered" id="L1191">
    <div class="line-number"><a href="#L1191">1191</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error_handler.validation_error(&quot;Configuration validation failed for module: &quot; .. module_name, {</div>
  </div>
  <div class="line not-covered" id="L1192">
    <div class="line-number"><a href="#L1192">1192</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          module = module_name,</div>
  </div>
  <div class="line not-covered" id="L1193">
    <div class="line-number"><a href="#L1193">1193</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          errors = errors[module_name],</div>
  </div>
  <div class="line not-covered" id="L1194">
    <div class="line-number"><a href="#L1194">1194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1195">
    <div class="line-number"><a href="#L1195">1195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, validation_error</div>
  </div>
  <div class="line not-covered" id="L1196">
    <div class="line-number"><a href="#L1196">1196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1197">
    <div class="line-number"><a href="#L1197">1197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1198">
    <div class="line-number"><a href="#L1198">1198</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Validate all registered modules</div>
  </div>
  <div class="line not-covered" id="L1199">
    <div class="line-number"><a href="#L1199">1199</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local all_valid = true</div>
  </div>
  <div class="line not-covered" id="L1200">
    <div class="line-number"><a href="#L1200">1200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for name in pairs(config.schemas) do</div>
  </div>
  <div class="line not-covered" id="L1201">
    <div class="line-number"><a href="#L1201">1201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not validate_module(name) then</div>
  </div>
  <div class="line not-covered" id="L1202">
    <div class="line-number"><a href="#L1202">1202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      all_valid = false</div>
  </div>
  <div class="line not-covered" id="L1203">
    <div class="line-number"><a href="#L1203">1203</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1204">
    <div class="line-number"><a href="#L1204">1204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1205">
    <div class="line-number"><a href="#L1205">1205</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return validation result</div>
  </div>
  <div class="line not-covered" id="L1206">
    <div class="line-number"><a href="#L1206">1206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if all_valid then</div>
  </div>
  <div class="line not-covered" id="L1207">
    <div class="line-number"><a href="#L1207">1207</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L1208">
    <div class="line-number"><a href="#L1208">1208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-executable" id="L1209">
    <div class="line-number"><a href="#L1209">1209</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Create error object</div>
  </div>
  <div class="line not-covered" id="L1210">
    <div class="line-number"><a href="#L1210">1210</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local validation_error = error_handler.validation_error(&quot;Configuration validation failed for multiple modules&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1211">
    <div class="line-number"><a href="#L1211">1211</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      modules = errors,</div>
  </div>
  <div class="line not-covered" id="L1212">
    <div class="line-number"><a href="#L1212">1212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1213">
    <div class="line-number"><a href="#L1213">1213</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, validation_error</div>
  </div>
  <div class="line not-covered" id="L1214">
    <div class="line-number"><a href="#L1214">1214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1215">
    <div class="line-number"><a href="#L1215">1215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1216">
    <div class="line-number"><a href="#L1216">1216</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Loads configuration from a file and merges it with existing configuration</div>
  </div>
  <div class="line not-executable" id="L1217">
    <div class="line-number"><a href="#L1217">1217</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function loads configuration data from a Lua file and merges it with the</div>
  </div>
  <div class="line not-executable" id="L1218">
    <div class="line-number"><a href="#L1218">1218</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- current configuration. The file is expected to return a table containing</div>
  </div>
  <div class="line not-executable" id="L1219">
    <div class="line-number"><a href="#L1219">1219</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- configuration data. If the file doesn't exist, it's not considered an error</div>
  </div>
  <div class="line not-executable" id="L1220">
    <div class="line-number"><a href="#L1220">1220</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- (the function simply logs the case and continues with existing configuration).</div>
  </div>
  <div class="line not-executable" id="L1221">
    <div class="line-number"><a href="#L1221">1221</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1222">
    <div class="line-number"><a href="#L1222">1222</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path? string The path to the configuration file (defaults to DEFAULT_CONFIG_PATH)</div>
  </div>
  <div class="line not-executable" id="L1223">
    <div class="line-number"><a href="#L1223">1223</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil config The loaded configuration or nil if failed</div>
  </div>
  <div class="line not-executable" id="L1224">
    <div class="line-number"><a href="#L1224">1224</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil error Error if any occurred</div>
  </div>
  <div class="line not-executable" id="L1225">
    <div class="line-number"><a href="#L1225">1225</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1226">
    <div class="line-number"><a href="#L1226">1226</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1227">
    <div class="line-number"><a href="#L1227">1227</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Load from default configuration path</div>
  </div>
  <div class="line not-executable" id="L1228">
    <div class="line-number"><a href="#L1228">1228</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local config, err = central_config.load_from_file()</div>
  </div>
  <div class="line not-executable" id="L1229">
    <div class="line-number"><a href="#L1229">1229</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not config then</div>
  </div>
  <div class="line not-executable" id="L1230">
    <div class="line-number"><a href="#L1230">1230</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if err.message:match(&quot;not found&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1231">
    <div class="line-number"><a href="#L1231">1231</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     print(&quot;No configuration file found, using defaults&quot;)</div>
  </div>
  <div class="line not-executable" id="L1232">
    <div class="line-number"><a href="#L1232">1232</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   else</div>
  </div>
  <div class="line not-executable" id="L1233">
    <div class="line-number"><a href="#L1233">1233</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     print(&quot;Error loading configuration: &quot; .. err.message)</div>
  </div>
  <div class="line not-executable" id="L1234">
    <div class="line-number"><a href="#L1234">1234</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L1235">
    <div class="line-number"><a href="#L1235">1235</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1236">
    <div class="line-number"><a href="#L1236">1236</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1237">
    <div class="line-number"><a href="#L1237">1237</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Load from custom path</div>
  </div>
  <div class="line not-executable" id="L1238">
    <div class="line-number"><a href="#L1238">1238</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local config, err = central_config.load_from_file(&quot;/etc/myapp/config.lua&quot;)</div>
  </div>
  <div class="line not-executable" id="L1239">
    <div class="line-number"><a href="#L1239">1239</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if config then</div>
  </div>
  <div class="line not-executable" id="L1240">
    <div class="line-number"><a href="#L1240">1240</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Configuration loaded successfully&quot;)</div>
  </div>
  <div class="line not-executable" id="L1241">
    <div class="line-number"><a href="#L1241">1241</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1242">
    <div class="line-number"><a href="#L1242">1242</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1243">
    <div class="line-number"><a href="#L1243">1243</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Load with validation</div>
  </div>
  <div class="line not-executable" id="L1244">
    <div class="line-number"><a href="#L1244">1244</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local config, err = central_config.load_from_file()</div>
  </div>
  <div class="line not-executable" id="L1245">
    <div class="line-number"><a href="#L1245">1245</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if config then</div>
  </div>
  <div class="line not-executable" id="L1246">
    <div class="line-number"><a href="#L1246">1246</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local valid, validate_err = central_config.validate()</div>
  </div>
  <div class="line not-executable" id="L1247">
    <div class="line-number"><a href="#L1247">1247</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if not valid then</div>
  </div>
  <div class="line not-executable" id="L1248">
    <div class="line-number"><a href="#L1248">1248</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     print(&quot;Loaded config is invalid: &quot; .. validate_err.message)</div>
  </div>
  <div class="line not-executable" id="L1249">
    <div class="line-number"><a href="#L1249">1249</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L1250">
    <div class="line-number"><a href="#L1250">1250</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1251">
    <div class="line-number"><a href="#L1251">1251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.load_from_file(path)</div>
  </div>
  <div class="line not-executable" id="L1252">
    <div class="line-number"><a href="#L1252">1252</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L1253">
    <div class="line-number"><a href="#L1253">1253</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if path ~= nil and type(path) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1254">
    <div class="line-number"><a href="#L1254">1254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Path must be a string or nil&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1255">
    <div class="line-number"><a href="#L1255">1255</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;path&quot;,</div>
  </div>
  <div class="line not-covered" id="L1256">
    <div class="line-number"><a href="#L1256">1256</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(path),</div>
  </div>
  <div class="line not-covered" id="L1257">
    <div class="line-number"><a href="#L1257">1257</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;load_from_file&quot;,</div>
  </div>
  <div class="line not-covered" id="L1258">
    <div class="line-number"><a href="#L1258">1258</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1259">
    <div class="line-number"><a href="#L1259">1259</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L1260">
    <div class="line-number"><a href="#L1260">1260</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, err</div>
  </div>
  <div class="line not-covered" id="L1261">
    <div class="line-number"><a href="#L1261">1261</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1262">
    <div class="line-number"><a href="#L1262">1262</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  path = path or M.DEFAULT_CONFIG_PATH</div>
  </div>
  <div class="line not-covered" id="L1263">
    <div class="line-number"><a href="#L1263">1263</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local fs = get_fs()</div>
  </div>
  <div class="line not-executable" id="L1264">
    <div class="line-number"><a href="#L1264">1264</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if filesystem module is available</div>
  </div>
  <div class="line not-covered" id="L1265">
    <div class="line-number"><a href="#L1265">1265</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not fs then</div>
  </div>
  <div class="line not-covered" id="L1266">
    <div class="line-number"><a href="#L1266">1266</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.io_error(&quot;Filesystem module not available for loading config&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1267">
    <div class="line-number"><a href="#L1267">1267</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L1268">
    <div class="line-number"><a href="#L1268">1268</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;load_from_file&quot;,</div>
  </div>
  <div class="line not-covered" id="L1269">
    <div class="line-number"><a href="#L1269">1269</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1270">
    <div class="line-number"><a href="#L1270">1270</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L1271">
    <div class="line-number"><a href="#L1271">1271</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, err</div>
  </div>
  <div class="line not-covered" id="L1272">
    <div class="line-number"><a href="#L1272">1272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1273">
    <div class="line-number"><a href="#L1273">1273</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Use safe_io_operation for checking if file exists</div>
  </div>
  <div class="line not-covered" id="L1274">
    <div class="line-number"><a href="#L1274">1274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local exists, err = error_handler.safe_io_operation(function()</div>
  </div>
  <div class="line not-covered" id="L1275">
    <div class="line-number"><a href="#L1275">1275</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return fs.file_exists(path)</div>
  </div>
  <div class="line not-covered" id="L1276">
    <div class="line-number"><a href="#L1276">1276</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end, path, { operation = &quot;check_file_exists&quot; })</div>
  </div>
  <div class="line not-covered" id="L1277">
    <div class="line-number"><a href="#L1277">1277</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err then</div>
  </div>
  <div class="line not-covered" id="L1278">
    <div class="line-number"><a href="#L1278">1278</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, &quot;Error checking if config file exists&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1279">
    <div class="line-number"><a href="#L1279">1279</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L1280">
    <div class="line-number"><a href="#L1280">1280</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = err.message,</div>
  </div>
  <div class="line not-covered" id="L1281">
    <div class="line-number"><a href="#L1281">1281</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1282">
    <div class="line-number"><a href="#L1282">1282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, err</div>
  </div>
  <div class="line not-covered" id="L1283">
    <div class="line-number"><a href="#L1283">1283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1284">
    <div class="line-number"><a href="#L1284">1284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not exists then</div>
  </div>
  <div class="line not-executable" id="L1285">
    <div class="line-number"><a href="#L1285">1285</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- This is a normal case - config file is optional</div>
  </div>
  <div class="line not-covered" id="L1286">
    <div class="line-number"><a href="#L1286">1286</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;info&quot;, &quot;Config file not found, using defaults&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1287">
    <div class="line-number"><a href="#L1287">1287</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L1288">
    <div class="line-number"><a href="#L1288">1288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;load_from_file&quot;,</div>
  </div>
  <div class="line not-covered" id="L1289">
    <div class="line-number"><a href="#L1289">1289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L1290">
    <div class="line-number"><a href="#L1290">1290</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Create a proper error object for tests</div>
  </div>
  <div class="line not-covered" id="L1291">
    <div class="line-number"><a href="#L1291">1291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.io_error(&quot;Config file not found&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1292">
    <div class="line-number"><a href="#L1292">1292</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L1293">
    <div class="line-number"><a href="#L1293">1293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;load_from_file&quot;,</div>
  </div>
  <div class="line not-covered" id="L1294">
    <div class="line-number"><a href="#L1294">1294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1295">
    <div class="line-number"><a href="#L1295">1295</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, err -- Return nil, err to indicate file not found</div>
  </div>
  <div class="line not-covered" id="L1296">
    <div class="line-number"><a href="#L1296">1296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1297">
    <div class="line-number"><a href="#L1297">1297</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try to load the configuration file</div>
  </div>
  <div class="line not-covered" id="L1298">
    <div class="line-number"><a href="#L1298">1298</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, user_config, err = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L1299">
    <div class="line-number"><a href="#L1299">1299</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return dofile(path)</div>
  </div>
  <div class="line not-covered" id="L1300">
    <div class="line-number"><a href="#L1300">1300</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line not-covered" id="L1301">
    <div class="line-number"><a href="#L1301">1301</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line not-executable" id="L1302">
    <div class="line-number"><a href="#L1302">1302</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle the case where err might not be a structured error</div>
  </div>
  <div class="line not-executable" id="L1303">
    <div class="line-number"><a href="#L1303">1303</a></div>
    <div class="execution-count"></div>    <div class="line-content">    ---@diagnostic disable-next-line: need-check-nil, undefined-field</div>
  </div>
  <div class="line not-covered" id="L1304">
    <div class="line-number"><a href="#L1304">1304</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local error_message = error_handler.is_error(err) and err.message or tostring(err)</div>
  </div>
  <div class="line not-covered" id="L1305">
    <div class="line-number"><a href="#L1305">1305</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local parse_err = error_handler.parse_error(&quot;Error loading config file: &quot; .. error_message, {</div>
  </div>
  <div class="line not-covered" id="L1306">
    <div class="line-number"><a href="#L1306">1306</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L1307">
    <div class="line-number"><a href="#L1307">1307</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;load_from_file&quot;,</div>
  </div>
  <div class="line not-covered" id="L1308">
    <div class="line-number"><a href="#L1308">1308</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    }, error_handler.is_error(err) and err or nil)</div>
  </div>
  <div class="line not-covered" id="L1309">
    <div class="line-number"><a href="#L1309">1309</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, parse_err.message, parse_err.context)</div>
  </div>
  <div class="line not-covered" id="L1310">
    <div class="line-number"><a href="#L1310">1310</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, parse_err</div>
  </div>
  <div class="line not-covered" id="L1311">
    <div class="line-number"><a href="#L1311">1311</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1312">
    <div class="line-number"><a href="#L1312">1312</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(user_config) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1313">
    <div class="line-number"><a href="#L1313">1313</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local format_err =</div>
  </div>
  <div class="line not-covered" id="L1314">
    <div class="line-number"><a href="#L1314">1314</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_handler.validation_error(&quot;Invalid config format: expected a table, got &quot; .. type(user_config), {</div>
  </div>
  <div class="line not-covered" id="L1315">
    <div class="line-number"><a href="#L1315">1315</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path = path,</div>
  </div>
  <div class="line not-covered" id="L1316">
    <div class="line-number"><a href="#L1316">1316</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        expected = &quot;table&quot;,</div>
  </div>
  <div class="line not-covered" id="L1317">
    <div class="line-number"><a href="#L1317">1317</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        got = type(user_config),</div>
  </div>
  <div class="line not-covered" id="L1318">
    <div class="line-number"><a href="#L1318">1318</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;load_from_file&quot;,</div>
  </div>
  <div class="line not-covered" id="L1319">
    <div class="line-number"><a href="#L1319">1319</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L1320">
    <div class="line-number"><a href="#L1320">1320</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, format_err.message, format_err.context)</div>
  </div>
  <div class="line not-covered" id="L1321">
    <div class="line-number"><a href="#L1321">1321</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, format_err</div>
  </div>
  <div class="line not-covered" id="L1322">
    <div class="line-number"><a href="#L1322">1322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1323">
    <div class="line-number"><a href="#L1323">1323</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Apply loaded configuration</div>
  </div>
  <div class="line not-covered" id="L1324">
    <div class="line-number"><a href="#L1324">1324</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local old_config = deep_copy(config.values)</div>
  </div>
  <div class="line not-executable" id="L1325">
    <div class="line-number"><a href="#L1325">1325</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Store and apply the loaded configuration</div>
  </div>
  <div class="line not-covered" id="L1326">
    <div class="line-number"><a href="#L1326">1326</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local merged_config, err = deep_merge(config.values, user_config)</div>
  </div>
  <div class="line not-covered" id="L1327">
    <div class="line-number"><a href="#L1327">1327</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err then</div>
  </div>
  <div class="line not-covered" id="L1328">
    <div class="line-number"><a href="#L1328">1328</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, &quot;Failed to merge configuration&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1329">
    <div class="line-number"><a href="#L1329">1329</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L1330">
    <div class="line-number"><a href="#L1330">1330</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = err.message,</div>
  </div>
  <div class="line not-covered" id="L1331">
    <div class="line-number"><a href="#L1331">1331</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1332">
    <div class="line-number"><a href="#L1332">1332</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, err</div>
  </div>
  <div class="line not-covered" id="L1333">
    <div class="line-number"><a href="#L1333">1333</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1334">
    <div class="line-number"><a href="#L1334">1334</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.values = merged_config</div>
  </div>
  <div class="line not-covered" id="L1335">
    <div class="line-number"><a href="#L1335">1335</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;debug&quot;, &quot;Config file loaded successfully&quot;, { path = path })</div>
  </div>
  <div class="line not-executable" id="L1336">
    <div class="line-number"><a href="#L1336">1336</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Notify listeners of all changed paths</div>
  </div>
  <div class="line not-covered" id="L1337">
    <div class="line-number"><a href="#L1337">1337</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local function notify_changes(prefix, old, new)</div>
  </div>
  <div class="line not-covered" id="L1338">
    <div class="line-number"><a href="#L1338">1338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(old) ~= &quot;table&quot; or type(new) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1339">
    <div class="line-number"><a href="#L1339">1339</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not deep_equals(old, new) then</div>
  </div>
  <div class="line not-covered" id="L1340">
    <div class="line-number"><a href="#L1340">1340</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        M.notify_change(prefix, old, new)</div>
  </div>
  <div class="line not-covered" id="L1341">
    <div class="line-number"><a href="#L1341">1341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1342">
    <div class="line-number"><a href="#L1342">1342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return</div>
  </div>
  <div class="line not-covered" id="L1343">
    <div class="line-number"><a href="#L1343">1343</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1344">
    <div class="line-number"><a href="#L1344">1344</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Notify about changed or added keys</div>
  </div>
  <div class="line not-covered" id="L1345">
    <div class="line-number"><a href="#L1345">1345</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for k, v in pairs(new) do</div>
  </div>
  <div class="line not-covered" id="L1346">
    <div class="line-number"><a href="#L1346">1346</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local new_prefix = prefix == &quot;&quot; and k or (prefix .. &quot;.&quot; .. k)</div>
  </div>
  <div class="line not-covered" id="L1347">
    <div class="line-number"><a href="#L1347">1347</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      notify_changes(new_prefix, old[k], v)</div>
  </div>
  <div class="line not-covered" id="L1348">
    <div class="line-number"><a href="#L1348">1348</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1349">
    <div class="line-number"><a href="#L1349">1349</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Notify about removed keys</div>
  </div>
  <div class="line not-covered" id="L1350">
    <div class="line-number"><a href="#L1350">1350</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for k, v in pairs(old) do</div>
  </div>
  <div class="line not-covered" id="L1351">
    <div class="line-number"><a href="#L1351">1351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if new[k] == nil then</div>
  </div>
  <div class="line not-covered" id="L1352">
    <div class="line-number"><a href="#L1352">1352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local new_prefix = prefix == &quot;&quot; and k or (prefix .. &quot;.&quot; .. k)</div>
  </div>
  <div class="line not-covered" id="L1353">
    <div class="line-number"><a href="#L1353">1353</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        M.notify_change(new_prefix, v, nil)</div>
  </div>
  <div class="line not-covered" id="L1354">
    <div class="line-number"><a href="#L1354">1354</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1355">
    <div class="line-number"><a href="#L1355">1355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1356">
    <div class="line-number"><a href="#L1356">1356</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1357">
    <div class="line-number"><a href="#L1357">1357</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  notify_changes(&quot;&quot;, old_config, config.values)</div>
  </div>
  <div class="line not-covered" id="L1358">
    <div class="line-number"><a href="#L1358">1358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return user_config</div>
  </div>
  <div class="line not-covered" id="L1359">
    <div class="line-number"><a href="#L1359">1359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1360">
    <div class="line-number"><a href="#L1360">1360</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Saves the current configuration to a file</div>
  </div>
  <div class="line not-executable" id="L1361">
    <div class="line-number"><a href="#L1361">1361</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function serializes the current configuration state to a Lua file that can</div>
  </div>
  <div class="line not-executable" id="L1362">
    <div class="line-number"><a href="#L1362">1362</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- later be loaded with load_from_file(). The configuration is saved as a Lua table</div>
  </div>
  <div class="line not-executable" id="L1363">
    <div class="line-number"><a href="#L1363">1363</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- with sorted keys for readability and consistency. The function creates any parent</div>
  </div>
  <div class="line not-executable" id="L1364">
    <div class="line-number"><a href="#L1364">1364</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- directories needed and handles filesystem errors properly.</div>
  </div>
  <div class="line not-executable" id="L1365">
    <div class="line-number"><a href="#L1365">1365</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1366">
    <div class="line-number"><a href="#L1366">1366</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param path? string The path to save the configuration to (defaults to DEFAULT_CONFIG_PATH)</div>
  </div>
  <div class="line not-executable" id="L1367">
    <div class="line-number"><a href="#L1367">1367</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean success Whether the save was successful</div>
  </div>
  <div class="line not-executable" id="L1368">
    <div class="line-number"><a href="#L1368">1368</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil error Error if any occurred</div>
  </div>
  <div class="line not-executable" id="L1369">
    <div class="line-number"><a href="#L1369">1369</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1370">
    <div class="line-number"><a href="#L1370">1370</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1371">
    <div class="line-number"><a href="#L1371">1371</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Save to default configuration file</div>
  </div>
  <div class="line not-executable" id="L1372">
    <div class="line-number"><a href="#L1372">1372</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = central_config.save_to_file()</div>
  </div>
  <div class="line not-executable" id="L1373">
    <div class="line-number"><a href="#L1373">1373</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L1374">
    <div class="line-number"><a href="#L1374">1374</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Failed to save configuration: &quot; .. err.message)</div>
  </div>
  <div class="line not-executable" id="L1375">
    <div class="line-number"><a href="#L1375">1375</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1376">
    <div class="line-number"><a href="#L1376">1376</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1377">
    <div class="line-number"><a href="#L1377">1377</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Save to a specific path</div>
  </div>
  <div class="line not-executable" id="L1378">
    <div class="line-number"><a href="#L1378">1378</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, err = central_config.save_to_file(&quot;/etc/myapp/config.lua&quot;)</div>
  </div>
  <div class="line not-executable" id="L1379">
    <div class="line-number"><a href="#L1379">1379</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if success then</div>
  </div>
  <div class="line not-executable" id="L1380">
    <div class="line-number"><a href="#L1380">1380</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Configuration saved to &quot; .. path)</div>
  </div>
  <div class="line not-executable" id="L1381">
    <div class="line-number"><a href="#L1381">1381</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1382">
    <div class="line-number"><a href="#L1382">1382</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1383">
    <div class="line-number"><a href="#L1383">1383</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Save with validation check</div>
  </div>
  <div class="line not-executable" id="L1384">
    <div class="line-number"><a href="#L1384">1384</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if central_config.validate() then</div>
  </div>
  <div class="line not-executable" id="L1385">
    <div class="line-number"><a href="#L1385">1385</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   central_config.save_to_file()</div>
  </div>
  <div class="line not-executable" id="L1386">
    <div class="line-number"><a href="#L1386">1386</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- else</div>
  </div>
  <div class="line not-executable" id="L1387">
    <div class="line-number"><a href="#L1387">1387</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Cannot save: configuration is invalid&quot;)</div>
  </div>
  <div class="line not-executable" id="L1388">
    <div class="line-number"><a href="#L1388">1388</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1389">
    <div class="line-number"><a href="#L1389">1389</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1390">
    <div class="line-number"><a href="#L1390">1390</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Save after making changes</div>
  </div>
  <div class="line not-executable" id="L1391">
    <div class="line-number"><a href="#L1391">1391</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.set(&quot;logging.level&quot;, &quot;debug&quot;)</div>
  </div>
  <div class="line not-executable" id="L1392">
    <div class="line-number"><a href="#L1392">1392</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .set(&quot;app.name&quot;, &quot;MyApp&quot;)</div>
  </div>
  <div class="line not-executable" id="L1393">
    <div class="line-number"><a href="#L1393">1393</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .set(&quot;app.version&quot;, &quot;1.0.0&quot;)</div>
  </div>
  <div class="line not-executable" id="L1394">
    <div class="line-number"><a href="#L1394">1394</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .save_to_file()</div>
  </div>
  <div class="line not-covered" id="L1395">
    <div class="line-number"><a href="#L1395">1395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.save_to_file(path)</div>
  </div>
  <div class="line not-executable" id="L1396">
    <div class="line-number"><a href="#L1396">1396</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L1397">
    <div class="line-number"><a href="#L1397">1397</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if path ~= nil and type(path) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1398">
    <div class="line-number"><a href="#L1398">1398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Path must be a string or nil&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1399">
    <div class="line-number"><a href="#L1399">1399</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;path&quot;,</div>
  </div>
  <div class="line not-covered" id="L1400">
    <div class="line-number"><a href="#L1400">1400</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(path),</div>
  </div>
  <div class="line not-covered" id="L1401">
    <div class="line-number"><a href="#L1401">1401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;save_to_file&quot;,</div>
  </div>
  <div class="line not-covered" id="L1402">
    <div class="line-number"><a href="#L1402">1402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1403">
    <div class="line-number"><a href="#L1403">1403</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L1404">
    <div class="line-number"><a href="#L1404">1404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, err</div>
  </div>
  <div class="line not-covered" id="L1405">
    <div class="line-number"><a href="#L1405">1405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1406">
    <div class="line-number"><a href="#L1406">1406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  path = path or M.DEFAULT_CONFIG_PATH</div>
  </div>
  <div class="line not-covered" id="L1407">
    <div class="line-number"><a href="#L1407">1407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local fs = get_fs()</div>
  </div>
  <div class="line not-executable" id="L1408">
    <div class="line-number"><a href="#L1408">1408</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if filesystem module is available</div>
  </div>
  <div class="line not-covered" id="L1409">
    <div class="line-number"><a href="#L1409">1409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not fs then</div>
  </div>
  <div class="line not-covered" id="L1410">
    <div class="line-number"><a href="#L1410">1410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.io_error(&quot;Filesystem module not available for saving config&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1411">
    <div class="line-number"><a href="#L1411">1411</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L1412">
    <div class="line-number"><a href="#L1412">1412</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;save_to_file&quot;,</div>
  </div>
  <div class="line not-covered" id="L1413">
    <div class="line-number"><a href="#L1413">1413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1414">
    <div class="line-number"><a href="#L1414">1414</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L1415">
    <div class="line-number"><a href="#L1415">1415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, err</div>
  </div>
  <div class="line not-covered" id="L1416">
    <div class="line-number"><a href="#L1416">1416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1417">
    <div class="line-number"><a href="#L1417">1417</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Generate Lua code for the configuration</div>
  </div>
  <div class="line not-covered" id="L1418">
    <div class="line-number"><a href="#L1418">1418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local function serialize(tbl, indent)</div>
  </div>
  <div class="line not-executable" id="L1419">
    <div class="line-number"><a href="#L1419">1419</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Validate input</div>
  </div>
  <div class="line not-covered" id="L1420">
    <div class="line-number"><a href="#L1420">1420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(tbl) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1421">
    <div class="line-number"><a href="#L1421">1421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return nil,</div>
  </div>
  <div class="line not-covered" id="L1422">
    <div class="line-number"><a href="#L1422">1422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error_handler.validation_error(&quot;Cannot serialize non-table value&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1423">
    <div class="line-number"><a href="#L1423">1423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          provided_type = type(tbl),</div>
  </div>
  <div class="line not-covered" id="L1424">
    <div class="line-number"><a href="#L1424">1424</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          operation = &quot;serialize&quot;,</div>
  </div>
  <div class="line not-covered" id="L1425">
    <div class="line-number"><a href="#L1425">1425</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1426">
    <div class="line-number"><a href="#L1426">1426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1427">
    <div class="line-number"><a href="#L1427">1427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    indent = indent or &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L1428">
    <div class="line-number"><a href="#L1428">1428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = &quot;{\n&quot;</div>
  </div>
  <div class="line not-executable" id="L1429">
    <div class="line-number"><a href="#L1429">1429</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Sort keys for deterministic output</div>
  </div>
  <div class="line not-covered" id="L1430">
    <div class="line-number"><a href="#L1430">1430</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local keys = {}</div>
  </div>
  <div class="line not-covered" id="L1431">
    <div class="line-number"><a href="#L1431">1431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for k in pairs(tbl) do</div>
  </div>
  <div class="line not-covered" id="L1432">
    <div class="line-number"><a href="#L1432">1432</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      table.insert(keys, k)</div>
  </div>
  <div class="line not-covered" id="L1433">
    <div class="line-number"><a href="#L1433">1433</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1434">
    <div class="line-number"><a href="#L1434">1434</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.sort(keys)</div>
  </div>
  <div class="line not-covered" id="L1435">
    <div class="line-number"><a href="#L1435">1435</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, k in ipairs(keys) do</div>
  </div>
  <div class="line not-covered" id="L1436">
    <div class="line-number"><a href="#L1436">1436</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local v = tbl[k]</div>
  </div>
  <div class="line not-covered" id="L1437">
    <div class="line-number"><a href="#L1437">1437</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local key_str</div>
  </div>
  <div class="line not-executable" id="L1438">
    <div class="line-number"><a href="#L1438">1438</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Format key based on type</div>
  </div>
  <div class="line not-covered" id="L1439">
    <div class="line-number"><a href="#L1439">1439</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(k) == &quot;string&quot; and string.match(k, &quot;^[%a_][%w_]*$&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1440">
    <div class="line-number"><a href="#L1440">1440</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        key_str = k</div>
  </div>
  <div class="line not-covered" id="L1441">
    <div class="line-number"><a href="#L1441">1441</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif type(k) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1442">
    <div class="line-number"><a href="#L1442">1442</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        key_str = string.format(&quot;[%q]&quot;, k)</div>
  </div>
  <div class="line not-covered" id="L1443">
    <div class="line-number"><a href="#L1443">1443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif type(k) == &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1444">
    <div class="line-number"><a href="#L1444">1444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        key_str = string.format(&quot;[%d]&quot;, k)</div>
  </div>
  <div class="line not-covered" id="L1445">
    <div class="line-number"><a href="#L1445">1445</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-executable" id="L1446">
    <div class="line-number"><a href="#L1446">1446</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Skip non-string/non-number keys</div>
  </div>
  <div class="line not-covered" id="L1447">
    <div class="line-number"><a href="#L1447">1447</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Skipping unsupported key type in serialization&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1448">
    <div class="line-number"><a href="#L1448">1448</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          key_type = type(k),</div>
  </div>
  <div class="line not-covered" id="L1449">
    <div class="line-number"><a href="#L1449">1449</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          operation = &quot;serialize&quot;,</div>
  </div>
  <div class="line not-covered" id="L1450">
    <div class="line-number"><a href="#L1450">1450</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1451">
    <div class="line-number"><a href="#L1451">1451</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        goto continue</div>
  </div>
  <div class="line not-covered" id="L1452">
    <div class="line-number"><a href="#L1452">1452</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1453">
    <div class="line-number"><a href="#L1453">1453</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Format value based on type</div>
  </div>
  <div class="line not-covered" id="L1454">
    <div class="line-number"><a href="#L1454">1454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1455">
    <div class="line-number"><a href="#L1455">1455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local serialized_value, err = serialize(v, indent .. &quot;  &quot;)</div>
  </div>
  <div class="line not-covered" id="L1456">
    <div class="line-number"><a href="#L1456">1456</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if err then</div>
  </div>
  <div class="line not-covered" id="L1457">
    <div class="line-number"><a href="#L1457">1457</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          return nil, err</div>
  </div>
  <div class="line not-covered" id="L1458">
    <div class="line-number"><a href="#L1458">1458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1459">
    <div class="line-number"><a href="#L1459">1459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result = result .. indent .. &quot;  &quot; .. key_str .. &quot; = &quot; .. serialized_value .. &quot;,\n&quot;</div>
  </div>
  <div class="line not-covered" id="L1460">
    <div class="line-number"><a href="#L1460">1460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif type(v) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1461">
    <div class="line-number"><a href="#L1461">1461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result = result .. indent .. &quot;  &quot; .. key_str .. &quot; = &quot; .. string.format(&quot;%q&quot;, v) .. &quot;,\n&quot;</div>
  </div>
  <div class="line not-covered" id="L1462">
    <div class="line-number"><a href="#L1462">1462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif type(v) == &quot;number&quot; or type(v) == &quot;boolean&quot; then</div>
  </div>
  <div class="line not-covered" id="L1463">
    <div class="line-number"><a href="#L1463">1463</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result = result .. indent .. &quot;  &quot; .. key_str .. &quot; = &quot; .. tostring(v) .. &quot;,\n&quot;</div>
  </div>
  <div class="line not-covered" id="L1464">
    <div class="line-number"><a href="#L1464">1464</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif type(v) == &quot;nil&quot; then</div>
  </div>
  <div class="line not-covered" id="L1465">
    <div class="line-number"><a href="#L1465">1465</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result = result .. indent .. &quot;  &quot; .. key_str .. &quot; = nil,\n&quot;</div>
  </div>
  <div class="line not-covered" id="L1466">
    <div class="line-number"><a href="#L1466">1466</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-executable" id="L1467">
    <div class="line-number"><a href="#L1467">1467</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Skip unsupported types (function, userdata, thread)</div>
  </div>
  <div class="line not-covered" id="L1468">
    <div class="line-number"><a href="#L1468">1468</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Skipping unsupported value type in serialization&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1469">
    <div class="line-number"><a href="#L1469">1469</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          key = tostring(k),</div>
  </div>
  <div class="line not-covered" id="L1470">
    <div class="line-number"><a href="#L1470">1470</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          value_type = type(v),</div>
  </div>
  <div class="line not-covered" id="L1471">
    <div class="line-number"><a href="#L1471">1471</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          operation = &quot;serialize&quot;,</div>
  </div>
  <div class="line not-covered" id="L1472">
    <div class="line-number"><a href="#L1472">1472</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1473">
    <div class="line-number"><a href="#L1473">1473</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1474">
    <div class="line-number"><a href="#L1474">1474</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      ::continue::</div>
  </div>
  <div class="line not-covered" id="L1475">
    <div class="line-number"><a href="#L1475">1475</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1476">
    <div class="line-number"><a href="#L1476">1476</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    result = result .. indent .. &quot;}&quot;</div>
  </div>
  <div class="line not-covered" id="L1477">
    <div class="line-number"><a href="#L1477">1477</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L1478">
    <div class="line-number"><a href="#L1478">1478</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1479">
    <div class="line-number"><a href="#L1479">1479</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a copy of the config to serialize</div>
  </div>
  <div class="line not-covered" id="L1480">
    <div class="line-number"><a href="#L1480">1480</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local config_to_save = deep_copy(config.values)</div>
  </div>
  <div class="line not-executable" id="L1481">
    <div class="line-number"><a href="#L1481">1481</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Generate Lua code</div>
  </div>
  <div class="line not-covered" id="L1482">
    <div class="line-number"><a href="#L1482">1482</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local serialized_config, err = serialize(config_to_save)</div>
  </div>
  <div class="line not-covered" id="L1483">
    <div class="line-number"><a href="#L1483">1483</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not serialized_config then</div>
  </div>
  <div class="line not-covered" id="L1484">
    <div class="line-number"><a href="#L1484">1484</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, &quot;Failed to serialize configuration&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1485">
    <div class="line-number"><a href="#L1485">1485</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-executable" id="L1486">
    <div class="line-number"><a href="#L1486">1486</a></div>
    <div class="execution-count"></div>    <div class="line-content">      ---@diagnostic disable-next-line: need-check-nil</div>
  </div>
  <div class="line not-covered" id="L1487">
    <div class="line-number"><a href="#L1487">1487</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = err.message,</div>
  </div>
  <div class="line not-covered" id="L1488">
    <div class="line-number"><a href="#L1488">1488</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1489">
    <div class="line-number"><a href="#L1489">1489</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, err</div>
  </div>
  <div class="line not-covered" id="L1490">
    <div class="line-number"><a href="#L1490">1490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1491">
    <div class="line-number"><a href="#L1491">1491</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local content = &quot;-- firmo configuration file\n&quot;</div>
  </div>
  <div class="line not-covered" id="L1492">
    <div class="line-number"><a href="#L1492">1492</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  content = content .. &quot;-- This file was automatically generated\n\n&quot;</div>
  </div>
  <div class="line not-covered" id="L1493">
    <div class="line-number"><a href="#L1493">1493</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  content = content .. &quot;return &quot; .. serialized_config .. &quot;\n&quot;</div>
  </div>
  <div class="line not-executable" id="L1494">
    <div class="line-number"><a href="#L1494">1494</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Write to file using safe_io_operation</div>
  </div>
  <div class="line not-covered" id="L1495">
    <div class="line-number"><a href="#L1495">1495</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, err = error_handler.safe_io_operation(function()</div>
  </div>
  <div class="line not-covered" id="L1496">
    <div class="line-number"><a href="#L1496">1496</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return fs.write_file(path, content)</div>
  </div>
  <div class="line not-covered" id="L1497">
    <div class="line-number"><a href="#L1497">1497</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end, path, { operation = &quot;write_config_file&quot; })</div>
  </div>
  <div class="line not-covered" id="L1498">
    <div class="line-number"><a href="#L1498">1498</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line not-covered" id="L1499">
    <div class="line-number"><a href="#L1499">1499</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, &quot;Failed to save config file&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1500">
    <div class="line-number"><a href="#L1500">1500</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L1501">
    <div class="line-number"><a href="#L1501">1501</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = err.message,</div>
  </div>
  <div class="line not-covered" id="L1502">
    <div class="line-number"><a href="#L1502">1502</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1503">
    <div class="line-number"><a href="#L1503">1503</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, err</div>
  </div>
  <div class="line not-covered" id="L1504">
    <div class="line-number"><a href="#L1504">1504</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1505">
    <div class="line-number"><a href="#L1505">1505</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;info&quot;, &quot;Configuration saved to file&quot;, { path = path })</div>
  </div>
  <div class="line not-covered" id="L1506">
    <div class="line-number"><a href="#L1506">1506</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L1507">
    <div class="line-number"><a href="#L1507">1507</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1508">
    <div class="line-number"><a href="#L1508">1508</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Resets configuration values to their defaults</div>
  </div>
  <div class="line not-executable" id="L1509">
    <div class="line-number"><a href="#L1509">1509</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function resets configuration values to their default values as registered</div>
  </div>
  <div class="line not-executable" id="L1510">
    <div class="line-number"><a href="#L1510">1510</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- with register_module(). It can reset a specific module's configuration or the</div>
  </div>
  <div class="line not-executable" id="L1511">
    <div class="line-number"><a href="#L1511">1511</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- entire configuration system. If no defaults are available for a module, its</div>
  </div>
  <div class="line not-executable" id="L1512">
    <div class="line-number"><a href="#L1512">1512</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- configuration will be cleared. The function notifies any listeners of the changes.</div>
  </div>
  <div class="line not-executable" id="L1513">
    <div class="line-number"><a href="#L1513">1513</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1514">
    <div class="line-number"><a href="#L1514">1514</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name? string The name of the module to reset (nil for all)</div>
  </div>
  <div class="line not-executable" id="L1515">
    <div class="line-number"><a href="#L1515">1515</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return central_config The module instance for chaining</div>
  </div>
  <div class="line not-executable" id="L1516">
    <div class="line-number"><a href="#L1516">1516</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1517">
    <div class="line-number"><a href="#L1517">1517</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1518">
    <div class="line-number"><a href="#L1518">1518</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Reset a specific module's configuration</div>
  </div>
  <div class="line not-executable" id="L1519">
    <div class="line-number"><a href="#L1519">1519</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.reset(&quot;logging&quot;)</div>
  </div>
  <div class="line not-executable" id="L1520">
    <div class="line-number"><a href="#L1520">1520</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1521">
    <div class="line-number"><a href="#L1521">1521</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Reset after changing settings temporarily</div>
  </div>
  <div class="line not-executable" id="L1522">
    <div class="line-number"><a href="#L1522">1522</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local original_level = central_config.get(&quot;logging.level&quot;)</div>
  </div>
  <div class="line not-executable" id="L1523">
    <div class="line-number"><a href="#L1523">1523</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.set(&quot;logging.level&quot;, &quot;debug&quot;)</div>
  </div>
  <div class="line not-executable" id="L1524">
    <div class="line-number"><a href="#L1524">1524</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Do some debug operations...</div>
  </div>
  <div class="line not-executable" id="L1525">
    <div class="line-number"><a href="#L1525">1525</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.reset(&quot;logging&quot;) -- Restore defaults including original level</div>
  </div>
  <div class="line not-executable" id="L1526">
    <div class="line-number"><a href="#L1526">1526</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1527">
    <div class="line-number"><a href="#L1527">1527</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Reset the entire configuration system</div>
  </div>
  <div class="line not-executable" id="L1528">
    <div class="line-number"><a href="#L1528">1528</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.reset()</div>
  </div>
  <div class="line not-executable" id="L1529">
    <div class="line-number"><a href="#L1529">1529</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1530">
    <div class="line-number"><a href="#L1530">1530</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Reset as part of a chain of operations</div>
  </div>
  <div class="line not-executable" id="L1531">
    <div class="line-number"><a href="#L1531">1531</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.reset(&quot;database&quot;)</div>
  </div>
  <div class="line not-executable" id="L1532">
    <div class="line-number"><a href="#L1532">1532</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .set(&quot;database.timeout&quot;, 60)</div>
  </div>
  <div class="line not-executable" id="L1533">
    <div class="line-number"><a href="#L1533">1533</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .set(&quot;database.retries&quot;, 3)</div>
  </div>
  <div class="line not-covered" id="L1534">
    <div class="line-number"><a href="#L1534">1534</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.reset(module_name)</div>
  </div>
  <div class="line not-executable" id="L1535">
    <div class="line-number"><a href="#L1535">1535</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L1536">
    <div class="line-number"><a href="#L1536">1536</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if module_name ~= nil and type(module_name) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1537">
    <div class="line-number"><a href="#L1537">1537</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Module name must be a string or nil&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1538">
    <div class="line-number"><a href="#L1538">1538</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;module_name&quot;,</div>
  </div>
  <div class="line not-covered" id="L1539">
    <div class="line-number"><a href="#L1539">1539</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(module_name),</div>
  </div>
  <div class="line not-covered" id="L1540">
    <div class="line-number"><a href="#L1540">1540</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;reset&quot;,</div>
  </div>
  <div class="line not-covered" id="L1541">
    <div class="line-number"><a href="#L1541">1541</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1542">
    <div class="line-number"><a href="#L1542">1542</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L1543">
    <div class="line-number"><a href="#L1543">1543</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L1544">
    <div class="line-number"><a href="#L1544">1544</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1545">
    <div class="line-number"><a href="#L1545">1545</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If module_name is nil, completely reset everything</div>
  </div>
  <div class="line not-covered" id="L1546">
    <div class="line-number"><a href="#L1546">1546</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if module_name == nil then</div>
  </div>
  <div class="line not-executable" id="L1547">
    <div class="line-number"><a href="#L1547">1547</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Reset everything for testing</div>
  </div>
  <div class="line not-covered" id="L1548">
    <div class="line-number"><a href="#L1548">1548</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local old_values = deep_copy(config.values)</div>
  </div>
  <div class="line not-executable" id="L1549">
    <div class="line-number"><a href="#L1549">1549</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Clear all configuration data structures</div>
  </div>
  <div class="line not-covered" id="L1550">
    <div class="line-number"><a href="#L1550">1550</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    init_config()</div>
  </div>
  <div class="line not-covered" id="L1551">
    <div class="line-number"><a href="#L1551">1551</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;info&quot;, &quot;Reset entire configuration system for testing&quot;)</div>
  </div>
  <div class="line not-executable" id="L1552">
    <div class="line-number"><a href="#L1552">1552</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- No listeners to notify after full reset since they were cleared too</div>
  </div>
  <div class="line not-covered" id="L1553">
    <div class="line-number"><a href="#L1553">1553</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L1554">
    <div class="line-number"><a href="#L1554">1554</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1555">
    <div class="line-number"><a href="#L1555">1555</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Reset specific module</div>
  </div>
  <div class="line not-covered" id="L1556">
    <div class="line-number"><a href="#L1556">1556</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not config.defaults[module_name] then</div>
  </div>
  <div class="line not-executable" id="L1557">
    <div class="line-number"><a href="#L1557">1557</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If there are no defaults, just clear the module's configuration</div>
  </div>
  <div class="line not-covered" id="L1558">
    <div class="line-number"><a href="#L1558">1558</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if config.values[module_name] then</div>
  </div>
  <div class="line not-executable" id="L1559">
    <div class="line-number"><a href="#L1559">1559</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Store old config for change notifications</div>
  </div>
  <div class="line not-covered" id="L1560">
    <div class="line-number"><a href="#L1560">1560</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local old_config = deep_copy(config.values[module_name])</div>
  </div>
  <div class="line not-executable" id="L1561">
    <div class="line-number"><a href="#L1561">1561</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Clear the module's config</div>
  </div>
  <div class="line not-covered" id="L1562">
    <div class="line-number"><a href="#L1562">1562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      config.values[module_name] = {}</div>
  </div>
  <div class="line not-covered" id="L1563">
    <div class="line-number"><a href="#L1563">1563</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;info&quot;, &quot;Cleared configuration for module (no defaults)&quot;, { module = module_name })</div>
  </div>
  <div class="line not-executable" id="L1564">
    <div class="line-number"><a href="#L1564">1564</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Notify listeners</div>
  </div>
  <div class="line not-covered" id="L1565">
    <div class="line-number"><a href="#L1565">1565</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      M.notify_change(module_name, old_config, config.values[module_name])</div>
  </div>
  <div class="line not-covered" id="L1566">
    <div class="line-number"><a href="#L1566">1566</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L1567">
    <div class="line-number"><a href="#L1567">1567</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log(&quot;debug&quot;, &quot;No configuration or defaults to reset for module&quot;, { module = module_name })</div>
  </div>
  <div class="line not-covered" id="L1568">
    <div class="line-number"><a href="#L1568">1568</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1569">
    <div class="line-number"><a href="#L1569">1569</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L1570">
    <div class="line-number"><a href="#L1570">1570</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1571">
    <div class="line-number"><a href="#L1571">1571</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Copy the old configuration for change detection</div>
  </div>
  <div class="line not-covered" id="L1572">
    <div class="line-number"><a href="#L1572">1572</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local old_config = deep_copy(config.values[module_name])</div>
  </div>
  <div class="line not-executable" id="L1573">
    <div class="line-number"><a href="#L1573">1573</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Reset to defaults (with deep copy to prevent modification of defaults)</div>
  </div>
  <div class="line not-covered" id="L1574">
    <div class="line-number"><a href="#L1574">1574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.values[module_name] = deep_copy(config.defaults[module_name])</div>
  </div>
  <div class="line not-covered" id="L1575">
    <div class="line-number"><a href="#L1575">1575</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;info&quot;, &quot;Reset configuration for module to defaults&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1576">
    <div class="line-number"><a href="#L1576">1576</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    module = module_name,</div>
  </div>
  <div class="line not-covered" id="L1577">
    <div class="line-number"><a href="#L1577">1577</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    default_count = (function()</div>
  </div>
  <div class="line not-covered" id="L1578">
    <div class="line-number"><a href="#L1578">1578</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local count = 0</div>
  </div>
  <div class="line not-covered" id="L1579">
    <div class="line-number"><a href="#L1579">1579</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, _ in pairs(config.defaults[module_name]) do</div>
  </div>
  <div class="line not-covered" id="L1580">
    <div class="line-number"><a href="#L1580">1580</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        count = count + 1</div>
  </div>
  <div class="line not-covered" id="L1581">
    <div class="line-number"><a href="#L1581">1581</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1582">
    <div class="line-number"><a href="#L1582">1582</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return count</div>
  </div>
  <div class="line not-covered" id="L1583">
    <div class="line-number"><a href="#L1583">1583</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)(),</div>
  </div>
  <div class="line not-covered" id="L1584">
    <div class="line-number"><a href="#L1584">1584</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L1585">
    <div class="line-number"><a href="#L1585">1585</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Notify listeners of change</div>
  </div>
  <div class="line not-covered" id="L1586">
    <div class="line-number"><a href="#L1586">1586</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  M.notify_change(module_name, old_config, config.values[module_name])</div>
  </div>
  <div class="line not-covered" id="L1587">
    <div class="line-number"><a href="#L1587">1587</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1588">
    <div class="line-number"><a href="#L1588">1588</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1589">
    <div class="line-number"><a href="#L1589">1589</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Configures the system from command-line or program options</div>
  </div>
  <div class="line not-executable" id="L1590">
    <div class="line-number"><a href="#L1590">1590</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function applies configuration values from a table of options, typically coming from </div>
  </div>
  <div class="line not-executable" id="L1591">
    <div class="line-number"><a href="#L1591">1591</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- command-line arguments or program initialization parameters. It only processes options</div>
  </div>
  <div class="line not-executable" id="L1592">
    <div class="line-number"><a href="#L1592">1592</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- that follow the &quot;module.setting&quot; dot notation format, ignoring other entries. The function</div>
  </div>
  <div class="line not-executable" id="L1593">
    <div class="line-number"><a href="#L1593">1593</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- safely applies each valid option, logging warnings for any options that fail to apply.</div>
  </div>
  <div class="line not-executable" id="L1594">
    <div class="line-number"><a href="#L1594">1594</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1595">
    <div class="line-number"><a href="#L1595">1595</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param options table Table of options from CLI or other source</div>
  </div>
  <div class="line not-executable" id="L1596">
    <div class="line-number"><a href="#L1596">1596</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return central_config The module instance for chaining</div>
  </div>
  <div class="line not-executable" id="L1597">
    <div class="line-number"><a href="#L1597">1597</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1598">
    <div class="line-number"><a href="#L1598">1598</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1599">
    <div class="line-number"><a href="#L1599">1599</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Configure from command-line arguments</div>
  </div>
  <div class="line not-executable" id="L1600">
    <div class="line-number"><a href="#L1600">1600</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local opts = {</div>
  </div>
  <div class="line not-executable" id="L1601">
    <div class="line-number"><a href="#L1601">1601</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   [&quot;logging.level&quot;] = &quot;debug&quot;,</div>
  </div>
  <div class="line not-executable" id="L1602">
    <div class="line-number"><a href="#L1602">1602</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   [&quot;coverage.enabled&quot;] = true,</div>
  </div>
  <div class="line not-executable" id="L1603">
    <div class="line-number"><a href="#L1603">1603</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   [&quot;reporting.format&quot;] = &quot;junit&quot;,</div>
  </div>
  <div class="line not-executable" id="L1604">
    <div class="line-number"><a href="#L1604">1604</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   non_config_option = &quot;value&quot; -- This will be ignored (no dot)</div>
  </div>
  <div class="line not-executable" id="L1605">
    <div class="line-number"><a href="#L1605">1605</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }</div>
  </div>
  <div class="line not-executable" id="L1606">
    <div class="line-number"><a href="#L1606">1606</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.configure_from_options(opts)</div>
  </div>
  <div class="line not-executable" id="L1607">
    <div class="line-number"><a href="#L1607">1607</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1608">
    <div class="line-number"><a href="#L1608">1608</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Configure from parsed CLI options</div>
  </div>
  <div class="line not-executable" id="L1609">
    <div class="line-number"><a href="#L1609">1609</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local function parse_cli()</div>
  </div>
  <div class="line not-executable" id="L1610">
    <div class="line-number"><a href="#L1610">1610</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local options = {}</div>
  </div>
  <div class="line not-executable" id="L1611">
    <div class="line-number"><a href="#L1611">1611</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   for i = 1, #arg do</div>
  </div>
  <div class="line not-executable" id="L1612">
    <div class="line-number"><a href="#L1612">1612</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     local key, value = arg[i]:match(&quot;^%-%-([%w%.]+)=(.+)$&quot;)</div>
  </div>
  <div class="line not-executable" id="L1613">
    <div class="line-number"><a href="#L1613">1613</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     if key and key:find(&quot;%.&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1614">
    <div class="line-number"><a href="#L1614">1614</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       -- Convert value types</div>
  </div>
  <div class="line not-executable" id="L1615">
    <div class="line-number"><a href="#L1615">1615</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       if value == &quot;true&quot; then value = true</div>
  </div>
  <div class="line not-executable" id="L1616">
    <div class="line-number"><a href="#L1616">1616</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       elseif value == &quot;false&quot; then value = false</div>
  </div>
  <div class="line not-executable" id="L1617">
    <div class="line-number"><a href="#L1617">1617</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       elseif tonumber(value) then value = tonumber(value)</div>
  </div>
  <div class="line not-executable" id="L1618">
    <div class="line-number"><a href="#L1618">1618</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       end</div>
  </div>
  <div class="line not-executable" id="L1619">
    <div class="line-number"><a href="#L1619">1619</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       options[key] = value</div>
  </div>
  <div class="line not-executable" id="L1620">
    <div class="line-number"><a href="#L1620">1620</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     end</div>
  </div>
  <div class="line not-executable" id="L1621">
    <div class="line-number"><a href="#L1621">1621</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L1622">
    <div class="line-number"><a href="#L1622">1622</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return options</div>
  </div>
  <div class="line not-executable" id="L1623">
    <div class="line-number"><a href="#L1623">1623</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1624">
    <div class="line-number"><a href="#L1624">1624</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1625">
    <div class="line-number"><a href="#L1625">1625</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.configure_from_options(parse_cli())</div>
  </div>
  <div class="line not-covered" id="L1626">
    <div class="line-number"><a href="#L1626">1626</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.configure_from_options(options)</div>
  </div>
  <div class="line not-executable" id="L1627">
    <div class="line-number"><a href="#L1627">1627</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L1628">
    <div class="line-number"><a href="#L1628">1628</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options == nil then</div>
  </div>
  <div class="line not-covered" id="L1629">
    <div class="line-number"><a href="#L1629">1629</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;debug&quot;, &quot;No options provided to configure_from_options&quot;)</div>
  </div>
  <div class="line not-covered" id="L1630">
    <div class="line-number"><a href="#L1630">1630</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L1631">
    <div class="line-number"><a href="#L1631">1631</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1632">
    <div class="line-number"><a href="#L1632">1632</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(options) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1633">
    <div class="line-number"><a href="#L1633">1633</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Options must be a table&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1634">
    <div class="line-number"><a href="#L1634">1634</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;options&quot;,</div>
  </div>
  <div class="line not-covered" id="L1635">
    <div class="line-number"><a href="#L1635">1635</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(options),</div>
  </div>
  <div class="line not-covered" id="L1636">
    <div class="line-number"><a href="#L1636">1636</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;configure_from_options&quot;,</div>
  </div>
  <div class="line not-covered" id="L1637">
    <div class="line-number"><a href="#L1637">1637</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1638">
    <div class="line-number"><a href="#L1638">1638</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L1639">
    <div class="line-number"><a href="#L1639">1639</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L1640">
    <div class="line-number"><a href="#L1640">1640</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1641">
    <div class="line-number"><a href="#L1641">1641</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Process options using error_handler.try to catch any errors</div>
  </div>
  <div class="line not-covered" id="L1642">
    <div class="line-number"><a href="#L1642">1642</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for k, v in pairs(options) do</div>
  </div>
  <div class="line not-executable" id="L1643">
    <div class="line-number"><a href="#L1643">1643</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Only handle options with module.option format</div>
  </div>
  <div class="line not-covered" id="L1644">
    <div class="line-number"><a href="#L1644">1644</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(k) == &quot;string&quot; and string.find(k, &quot;%.&quot;) then</div>
  </div>
  <div class="line not-covered" id="L1645">
    <div class="line-number"><a href="#L1645">1645</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local success, err = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L1646">
    <div class="line-number"><a href="#L1646">1646</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        M.set(k, v)</div>
  </div>
  <div class="line not-covered" id="L1647">
    <div class="line-number"><a href="#L1647">1647</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end)</div>
  </div>
  <div class="line not-covered" id="L1648">
    <div class="line-number"><a href="#L1648">1648</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not success then</div>
  </div>
  <div class="line not-covered" id="L1649">
    <div class="line-number"><a href="#L1649">1649</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log(&quot;warn&quot;, &quot;Failed to set option&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1650">
    <div class="line-number"><a href="#L1650">1650</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          key = k,</div>
  </div>
  <div class="line not-covered" id="L1651">
    <div class="line-number"><a href="#L1651">1651</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          value_type = type(v),</div>
  </div>
  <div class="line not-covered" id="L1652">
    <div class="line-number"><a href="#L1652">1652</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          error = err.message,</div>
  </div>
  <div class="line not-covered" id="L1653">
    <div class="line-number"><a href="#L1653">1653</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L1654">
    <div class="line-number"><a href="#L1654">1654</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1655">
    <div class="line-number"><a href="#L1655">1655</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1656">
    <div class="line-number"><a href="#L1656">1656</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1657">
    <div class="line-number"><a href="#L1657">1657</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;debug&quot;, &quot;Applied configuration from options&quot;)</div>
  </div>
  <div class="line not-covered" id="L1658">
    <div class="line-number"><a href="#L1658">1658</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1659">
    <div class="line-number"><a href="#L1659">1659</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1660">
    <div class="line-number"><a href="#L1660">1660</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Configures the system from a global configuration object</div>
  </div>
  <div class="line not-executable" id="L1661">
    <div class="line-number"><a href="#L1661">1661</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function merges a complete configuration object into the current configuration.</div>
  </div>
  <div class="line not-executable" id="L1662">
    <div class="line-number"><a href="#L1662">1662</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Unlike configure_from_options() which handles individual key-value pairs, this function</div>
  </div>
  <div class="line not-executable" id="L1663">
    <div class="line-number"><a href="#L1663">1663</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- takes a complete, potentially nested configuration structure and merges it with the</div>
  </div>
  <div class="line not-executable" id="L1664">
    <div class="line-number"><a href="#L1664">1664</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- existing configuration. This is useful for initializing configuration from a predefined</div>
  </div>
  <div class="line not-executable" id="L1665">
    <div class="line-number"><a href="#L1665">1665</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- state or applying configuration presets.</div>
  </div>
  <div class="line not-executable" id="L1666">
    <div class="line-number"><a href="#L1666">1666</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1667">
    <div class="line-number"><a href="#L1667">1667</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param global_config table Global configuration table to apply</div>
  </div>
  <div class="line not-executable" id="L1668">
    <div class="line-number"><a href="#L1668">1668</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return central_config The module instance for chaining</div>
  </div>
  <div class="line not-executable" id="L1669">
    <div class="line-number"><a href="#L1669">1669</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1670">
    <div class="line-number"><a href="#L1670">1670</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1671">
    <div class="line-number"><a href="#L1671">1671</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Configure from a predefined configuration structure</div>
  </div>
  <div class="line not-executable" id="L1672">
    <div class="line-number"><a href="#L1672">1672</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local default_config = {</div>
  </div>
  <div class="line not-executable" id="L1673">
    <div class="line-number"><a href="#L1673">1673</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logging = {</div>
  </div>
  <div class="line not-executable" id="L1674">
    <div class="line-number"><a href="#L1674">1674</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     level = &quot;info&quot;,</div>
  </div>
  <div class="line not-executable" id="L1675">
    <div class="line-number"><a href="#L1675">1675</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     format = &quot;text&quot;,</div>
  </div>
  <div class="line not-executable" id="L1676">
    <div class="line-number"><a href="#L1676">1676</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     file = nil</div>
  </div>
  <div class="line not-executable" id="L1677">
    <div class="line-number"><a href="#L1677">1677</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   },</div>
  </div>
  <div class="line not-executable" id="L1678">
    <div class="line-number"><a href="#L1678">1678</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   coverage = {</div>
  </div>
  <div class="line not-executable" id="L1679">
    <div class="line-number"><a href="#L1679">1679</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     enabled = true,</div>
  </div>
  <div class="line not-executable" id="L1680">
    <div class="line-number"><a href="#L1680">1680</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     include = {&quot;src/**/*.lua&quot;},</div>
  </div>
  <div class="line not-executable" id="L1681">
    <div class="line-number"><a href="#L1681">1681</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     exclude = {&quot;test/**/*.lua&quot;}</div>
  </div>
  <div class="line not-executable" id="L1682">
    <div class="line-number"><a href="#L1682">1682</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   },</div>
  </div>
  <div class="line not-executable" id="L1683">
    <div class="line-number"><a href="#L1683">1683</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   testing = {</div>
  </div>
  <div class="line not-executable" id="L1684">
    <div class="line-number"><a href="#L1684">1684</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     timeout = 5000,</div>
  </div>
  <div class="line not-executable" id="L1685">
    <div class="line-number"><a href="#L1685">1685</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     parallel = false</div>
  </div>
  <div class="line not-executable" id="L1686">
    <div class="line-number"><a href="#L1686">1686</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   }</div>
  </div>
  <div class="line not-executable" id="L1687">
    <div class="line-number"><a href="#L1687">1687</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }</div>
  </div>
  <div class="line not-executable" id="L1688">
    <div class="line-number"><a href="#L1688">1688</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.configure_from_config(default_config)</div>
  </div>
  <div class="line not-executable" id="L1689">
    <div class="line-number"><a href="#L1689">1689</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1690">
    <div class="line-number"><a href="#L1690">1690</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Load a configuration preset and apply it</div>
  </div>
  <div class="line not-executable" id="L1691">
    <div class="line-number"><a href="#L1691">1691</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local function load_preset(preset_name)</div>
  </div>
  <div class="line not-executable" id="L1692">
    <div class="line-number"><a href="#L1692">1692</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local presets = {</div>
  </div>
  <div class="line not-executable" id="L1693">
    <div class="line-number"><a href="#L1693">1693</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     development = { logging = { level = &quot;debug&quot; }, coverage = { enabled = true } },</div>
  </div>
  <div class="line not-executable" id="L1694">
    <div class="line-number"><a href="#L1694">1694</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     production = { logging = { level = &quot;error&quot; }, coverage = { enabled = false } },</div>
  </div>
  <div class="line not-executable" id="L1695">
    <div class="line-number"><a href="#L1695">1695</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     testing = { logging = { level = &quot;info&quot; }, coverage = { enabled = true } }</div>
  </div>
  <div class="line not-executable" id="L1696">
    <div class="line-number"><a href="#L1696">1696</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   }</div>
  </div>
  <div class="line not-executable" id="L1697">
    <div class="line-number"><a href="#L1697">1697</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return presets[preset_name] or {}</div>
  </div>
  <div class="line not-executable" id="L1698">
    <div class="line-number"><a href="#L1698">1698</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1699">
    <div class="line-number"><a href="#L1699">1699</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1700">
    <div class="line-number"><a href="#L1700">1700</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- central_config.configure_from_config(load_preset(&quot;development&quot;))</div>
  </div>
  <div class="line not-covered" id="L1701">
    <div class="line-number"><a href="#L1701">1701</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.configure_from_config(global_config)</div>
  </div>
  <div class="line not-executable" id="L1702">
    <div class="line-number"><a href="#L1702">1702</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Parameter validation</div>
  </div>
  <div class="line not-covered" id="L1703">
    <div class="line-number"><a href="#L1703">1703</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if global_config == nil then</div>
  </div>
  <div class="line not-covered" id="L1704">
    <div class="line-number"><a href="#L1704">1704</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;debug&quot;, &quot;No global config provided to configure_from_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L1705">
    <div class="line-number"><a href="#L1705">1705</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L1706">
    <div class="line-number"><a href="#L1706">1706</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1707">
    <div class="line-number"><a href="#L1707">1707</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(global_config) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1708">
    <div class="line-number"><a href="#L1708">1708</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = error_handler.validation_error(&quot;Global config must be a table&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1709">
    <div class="line-number"><a href="#L1709">1709</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      parameter_name = &quot;global_config&quot;,</div>
  </div>
  <div class="line not-covered" id="L1710">
    <div class="line-number"><a href="#L1710">1710</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      provided_type = type(global_config),</div>
  </div>
  <div class="line not-covered" id="L1711">
    <div class="line-number"><a href="#L1711">1711</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      operation = &quot;configure_from_config&quot;,</div>
  </div>
  <div class="line not-covered" id="L1712">
    <div class="line-number"><a href="#L1712">1712</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1713">
    <div class="line-number"><a href="#L1713">1713</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, err.message, err.context)</div>
  </div>
  <div class="line not-covered" id="L1714">
    <div class="line-number"><a href="#L1714">1714</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L1715">
    <div class="line-number"><a href="#L1715">1715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1716">
    <div class="line-number"><a href="#L1716">1716</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Merge global config into our config with error handling</div>
  </div>
  <div class="line not-covered" id="L1717">
    <div class="line-number"><a href="#L1717">1717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local merged_config, err = deep_merge(config.values, global_config)</div>
  </div>
  <div class="line not-covered" id="L1718">
    <div class="line-number"><a href="#L1718">1718</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err then</div>
  </div>
  <div class="line not-covered" id="L1719">
    <div class="line-number"><a href="#L1719">1719</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, &quot;Failed to merge global configuration&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1720">
    <div class="line-number"><a href="#L1720">1720</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = err.message,</div>
  </div>
  <div class="line not-covered" id="L1721">
    <div class="line-number"><a href="#L1721">1721</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1722">
    <div class="line-number"><a href="#L1722">1722</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L1723">
    <div class="line-number"><a href="#L1723">1723</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1724">
    <div class="line-number"><a href="#L1724">1724</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.values = merged_config</div>
  </div>
  <div class="line not-covered" id="L1725">
    <div class="line-number"><a href="#L1725">1725</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(&quot;debug&quot;, &quot;Applied configuration from global config&quot;)</div>
  </div>
  <div class="line not-covered" id="L1726">
    <div class="line-number"><a href="#L1726">1726</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1727">
    <div class="line-number"><a href="#L1727">1727</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1728">
    <div class="line-number"><a href="#L1728">1728</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Export public interface with error handling wrappers</div>
  </div>
  <div class="line not-executable" id="L1729">
    <div class="line-number"><a href="#L1729">1729</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Creates a deep copy of an object</div>
  </div>
  <div class="line not-executable" id="L1730">
    <div class="line-number"><a href="#L1730">1730</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function creates a complete deep copy of the provided object, ensuring that </div>
  </div>
  <div class="line not-executable" id="L1731">
    <div class="line-number"><a href="#L1731">1731</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- modifications to the returned object don't affect the original. It's particularly </div>
  </div>
  <div class="line not-executable" id="L1732">
    <div class="line-number"><a href="#L1732">1732</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- useful for tables, where it recursively copies all nested tables. For non-table</div>
  </div>
  <div class="line not-executable" id="L1733">
    <div class="line-number"><a href="#L1733">1733</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- values, it simply returns the value itself. This function is safe to use with any</div>
  </div>
  <div class="line not-executable" id="L1734">
    <div class="line-number"><a href="#L1734">1734</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- value type and handles nil values appropriately.</div>
  </div>
  <div class="line not-executable" id="L1735">
    <div class="line-number"><a href="#L1735">1735</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1736">
    <div class="line-number"><a href="#L1736">1736</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param obj any Object to serialize (deep copy)</div>
  </div>
  <div class="line not-executable" id="L1737">
    <div class="line-number"><a href="#L1737">1737</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return any Serialized (deep-copied) object</div>
  </div>
  <div class="line not-executable" id="L1738">
    <div class="line-number"><a href="#L1738">1738</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1739">
    <div class="line-number"><a href="#L1739">1739</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1740">
    <div class="line-number"><a href="#L1740">1740</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Deep copy a configuration table</div>
  </div>
  <div class="line not-executable" id="L1741">
    <div class="line-number"><a href="#L1741">1741</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local original_config = {</div>
  </div>
  <div class="line not-executable" id="L1742">
    <div class="line-number"><a href="#L1742">1742</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logging = { level = &quot;info&quot;, format = &quot;json&quot; },</div>
  </div>
  <div class="line not-executable" id="L1743">
    <div class="line-number"><a href="#L1743">1743</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   cache = { enabled = true, ttl = 3600 }</div>
  </div>
  <div class="line not-executable" id="L1744">
    <div class="line-number"><a href="#L1744">1744</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }</div>
  </div>
  <div class="line not-executable" id="L1745">
    <div class="line-number"><a href="#L1745">1745</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local config_copy = central_config.serialize(original_config)</div>
  </div>
  <div class="line not-executable" id="L1746">
    <div class="line-number"><a href="#L1746">1746</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L1747">
    <div class="line-number"><a href="#L1747">1747</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Modify the copy without affecting the original</div>
  </div>
  <div class="line not-executable" id="L1748">
    <div class="line-number"><a href="#L1748">1748</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- config_copy.logging.level = &quot;debug&quot;</div>
  </div>
  <div class="line not-executable" id="L1749">
    <div class="line-number"><a href="#L1749">1749</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(original_config.logging.level) -- Still &quot;info&quot;</div>
  </div>
  <div class="line not-executable" id="L1750">
    <div class="line-number"><a href="#L1750">1750</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1751">
    <div class="line-number"><a href="#L1751">1751</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Safe to use with any value type</div>
  </div>
  <div class="line not-executable" id="L1752">
    <div class="line-number"><a href="#L1752">1752</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local str_copy = central_config.serialize(&quot;hello&quot;) -- Returns &quot;hello&quot;</div>
  </div>
  <div class="line not-executable" id="L1753">
    <div class="line-number"><a href="#L1753">1753</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local num_copy = central_config.serialize(42) -- Returns 42</div>
  </div>
  <div class="line not-executable" id="L1754">
    <div class="line-number"><a href="#L1754">1754</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local nil_copy = central_config.serialize(nil) -- Returns nil</div>
  </div>
  <div class="line not-covered" id="L1755">
    <div class="line-number"><a href="#L1755">1755</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.serialize = function(obj)</div>
  </div>
  <div class="line not-covered" id="L1756">
    <div class="line-number"><a href="#L1756">1756</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local result = deep_copy(obj)</div>
  </div>
  <div class="line not-covered" id="L1757">
    <div class="line-number"><a href="#L1757">1757</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(result) ~= &quot;table&quot; and obj ~= nil then</div>
  </div>
  <div class="line not-covered" id="L1758">
    <div class="line-number"><a href="#L1758">1758</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;warn&quot;, &quot;serialize was called on a non-table value&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1759">
    <div class="line-number"><a href="#L1759">1759</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      value_type = type(obj),</div>
  </div>
  <div class="line not-covered" id="L1760">
    <div class="line-number"><a href="#L1760">1760</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1761">
    <div class="line-number"><a href="#L1761">1761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1762">
    <div class="line-number"><a href="#L1762">1762</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return result</div>
  </div>
  <div class="line not-covered" id="L1763">
    <div class="line-number"><a href="#L1763">1763</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1764">
    <div class="line-number"><a href="#L1764">1764</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Deeply merges two tables together</div>
  </div>
  <div class="line not-executable" id="L1765">
    <div class="line-number"><a href="#L1765">1765</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function recursively merges the source table into the target table. For overlapping </div>
  </div>
  <div class="line not-executable" id="L1766">
    <div class="line-number"><a href="#L1766">1766</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- keys that contain tables in both source and target, it performs a deep merge. For other </div>
  </div>
  <div class="line not-executable" id="L1767">
    <div class="line-number"><a href="#L1767">1767</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- value types or when a key exists only in one table, the source value takes precedence.</div>
  </div>
  <div class="line not-executable" id="L1768">
    <div class="line-number"><a href="#L1768">1768</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- If an error occurs during merging, the function logs the error and returns the original</div>
  </div>
  <div class="line not-executable" id="L1769">
    <div class="line-number"><a href="#L1769">1769</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- target table unmodified.</div>
  </div>
  <div class="line not-executable" id="L1770">
    <div class="line-number"><a href="#L1770">1770</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1771">
    <div class="line-number"><a href="#L1771">1771</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param target table Target table to merge into</div>
  </div>
  <div class="line not-executable" id="L1772">
    <div class="line-number"><a href="#L1772">1772</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param source table Source table to merge from</div>
  </div>
  <div class="line not-executable" id="L1773">
    <div class="line-number"><a href="#L1773">1773</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table Merged result</div>
  </div>
  <div class="line not-executable" id="L1774">
    <div class="line-number"><a href="#L1774">1774</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1775">
    <div class="line-number"><a href="#L1775">1775</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1776">
    <div class="line-number"><a href="#L1776">1776</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Merge configuration tables</div>
  </div>
  <div class="line not-executable" id="L1777">
    <div class="line-number"><a href="#L1777">1777</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local base_config = {</div>
  </div>
  <div class="line not-executable" id="L1778">
    <div class="line-number"><a href="#L1778">1778</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logging = { level = &quot;info&quot;, format = &quot;text&quot; },</div>
  </div>
  <div class="line not-executable" id="L1779">
    <div class="line-number"><a href="#L1779">1779</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   timeouts = { connection = 30, request = 10 }</div>
  </div>
  <div class="line not-executable" id="L1780">
    <div class="line-number"><a href="#L1780">1780</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }</div>
  </div>
  <div class="line not-executable" id="L1781">
    <div class="line-number"><a href="#L1781">1781</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L1782">
    <div class="line-number"><a href="#L1782">1782</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local overrides = {</div>
  </div>
  <div class="line not-executable" id="L1783">
    <div class="line-number"><a href="#L1783">1783</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logging = { level = &quot;debug&quot; }, -- Only override the level</div>
  </div>
  <div class="line not-executable" id="L1784">
    <div class="line-number"><a href="#L1784">1784</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   database = { host = &quot;localhost&quot;, port = 5432 } -- Add new section</div>
  </div>
  <div class="line not-executable" id="L1785">
    <div class="line-number"><a href="#L1785">1785</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }</div>
  </div>
  <div class="line not-executable" id="L1786">
    <div class="line-number"><a href="#L1786">1786</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L1787">
    <div class="line-number"><a href="#L1787">1787</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local merged = central_config.merge(base_config, overrides)</div>
  </div>
  <div class="line not-executable" id="L1788">
    <div class="line-number"><a href="#L1788">1788</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Result:</div>
  </div>
  <div class="line not-executable" id="L1789">
    <div class="line-number"><a href="#L1789">1789</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- {</div>
  </div>
  <div class="line not-executable" id="L1790">
    <div class="line-number"><a href="#L1790">1790</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --   logging = { level = &quot;debug&quot;, format = &quot;text&quot; },</div>
  </div>
  <div class="line not-executable" id="L1791">
    <div class="line-number"><a href="#L1791">1791</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --   timeouts = { connection = 30, request = 10 },</div>
  </div>
  <div class="line not-executable" id="L1792">
    <div class="line-number"><a href="#L1792">1792</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --   database = { host = &quot;localhost&quot;, port = 5432 }</div>
  </div>
  <div class="line not-executable" id="L1793">
    <div class="line-number"><a href="#L1793">1793</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- }</div>
  </div>
  <div class="line not-executable" id="L1794">
    <div class="line-number"><a href="#L1794">1794</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1795">
    <div class="line-number"><a href="#L1795">1795</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Merge with error handling</div>
  </div>
  <div class="line not-executable" id="L1796">
    <div class="line-number"><a href="#L1796">1796</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local function safe_merge(target, source)</div>
  </div>
  <div class="line not-executable" id="L1797">
    <div class="line-number"><a href="#L1797">1797</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if type(target) ~= &quot;table&quot; or type(source) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-executable" id="L1798">
    <div class="line-number"><a href="#L1798">1798</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     return central_config.serialize(source or target)</div>
  </div>
  <div class="line not-executable" id="L1799">
    <div class="line-number"><a href="#L1799">1799</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L1800">
    <div class="line-number"><a href="#L1800">1800</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return central_config.merge(target, source)</div>
  </div>
  <div class="line not-executable" id="L1801">
    <div class="line-number"><a href="#L1801">1801</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1802">
    <div class="line-number"><a href="#L1802">1802</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.merge = function(target, source)</div>
  </div>
  <div class="line not-covered" id="L1803">
    <div class="line-number"><a href="#L1803">1803</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local result, err = deep_merge(target, source)</div>
  </div>
  <div class="line not-covered" id="L1804">
    <div class="line-number"><a href="#L1804">1804</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err then</div>
  </div>
  <div class="line not-covered" id="L1805">
    <div class="line-number"><a href="#L1805">1805</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, &quot;Error in merge operation&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1806">
    <div class="line-number"><a href="#L1806">1806</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = err.message,</div>
  </div>
  <div class="line not-covered" id="L1807">
    <div class="line-number"><a href="#L1807">1807</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      target_type = type(target),</div>
  </div>
  <div class="line not-covered" id="L1808">
    <div class="line-number"><a href="#L1808">1808</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      source_type = type(source),</div>
  </div>
  <div class="line not-covered" id="L1809">
    <div class="line-number"><a href="#L1809">1809</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1810">
    <div class="line-number"><a href="#L1810">1810</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return target</div>
  </div>
  <div class="line not-covered" id="L1811">
    <div class="line-number"><a href="#L1811">1811</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1812">
    <div class="line-number"><a href="#L1812">1812</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return result</div>
  </div>
  <div class="line not-covered" id="L1813">
    <div class="line-number"><a href="#L1813">1813</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1814">
    <div class="line-number"><a href="#L1814">1814</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Module initialization function</div>
  </div>
  <div class="line not-executable" id="L1815">
    <div class="line-number"><a href="#L1815">1815</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This private function initializes the central configuration module, setting up</div>
  </div>
  <div class="line not-executable" id="L1816">
    <div class="line-number"><a href="#L1816">1816</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- its default configuration and registering it with itself. It uses error handling</div>
  </div>
  <div class="line not-executable" id="L1817">
    <div class="line-number"><a href="#L1817">1817</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- to ensure the module is always returned, even if initialization fails, preventing</div>
  </div>
  <div class="line not-executable" id="L1818">
    <div class="line-number"><a href="#L1818">1818</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- application crashes. This function is called automatically when the module is required.</div>
  </div>
  <div class="line not-executable" id="L1819">
    <div class="line-number"><a href="#L1819">1819</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1820">
    <div class="line-number"><a href="#L1820">1820</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L1821">
    <div class="line-number"><a href="#L1821">1821</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return central_config Initialized module</div>
  </div>
  <div class="line not-covered" id="L1822">
    <div class="line-number"><a href="#L1822">1822</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function init()</div>
  </div>
  <div class="line not-executable" id="L1823">
    <div class="line-number"><a href="#L1823">1823</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize with proper error handling</div>
  </div>
  <div class="line not-covered" id="L1824">
    <div class="line-number"><a href="#L1824">1824</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, err = error_handler.try(function()</div>
  </div>
  <div class="line not-executable" id="L1825">
    <div class="line-number"><a href="#L1825">1825</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Register this module's defaults</div>
  </div>
  <div class="line not-covered" id="L1826">
    <div class="line-number"><a href="#L1826">1826</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    M.register_module(&quot;central_config&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1827">
    <div class="line-number"><a href="#L1827">1827</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Schema</div>
  </div>
  <div class="line not-covered" id="L1828">
    <div class="line-number"><a href="#L1828">1828</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      required_fields = {},</div>
  </div>
  <div class="line not-covered" id="L1829">
    <div class="line-number"><a href="#L1829">1829</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      field_types = {</div>
  </div>
  <div class="line not-covered" id="L1830">
    <div class="line-number"><a href="#L1830">1830</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        auto_save = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L1831">
    <div class="line-number"><a href="#L1831">1831</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config_path = &quot;string&quot;,</div>
  </div>
  <div class="line not-covered" id="L1832">
    <div class="line-number"><a href="#L1832">1832</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      },</div>
  </div>
  <div class="line not-covered" id="L1833">
    <div class="line-number"><a href="#L1833">1833</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    }, {</div>
  </div>
  <div class="line not-executable" id="L1834">
    <div class="line-number"><a href="#L1834">1834</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Defaults</div>
  </div>
  <div class="line not-covered" id="L1835">
    <div class="line-number"><a href="#L1835">1835</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      auto_save = false,</div>
  </div>
  <div class="line not-covered" id="L1836">
    <div class="line-number"><a href="#L1836">1836</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      config_path = M.DEFAULT_CONFIG_PATH,</div>
  </div>
  <div class="line not-covered" id="L1837">
    <div class="line-number"><a href="#L1837">1837</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L1838">
    <div class="line-number"><a href="#L1838">1838</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;debug&quot;, &quot;Centralized configuration module initialized&quot;)</div>
  </div>
  <div class="line not-covered" id="L1839">
    <div class="line-number"><a href="#L1839">1839</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M</div>
  </div>
  <div class="line not-covered" id="L1840">
    <div class="line-number"><a href="#L1840">1840</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line not-covered" id="L1841">
    <div class="line-number"><a href="#L1841">1841</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line not-covered" id="L1842">
    <div class="line-number"><a href="#L1842">1842</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(&quot;error&quot;, &quot;Failed to initialize central_config module&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1843">
    <div class="line-number"><a href="#L1843">1843</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error = err.message,</div>
  </div>
  <div class="line not-covered" id="L1844">
    <div class="line-number"><a href="#L1844">1844</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      traceback = err.traceback,</div>
  </div>
  <div class="line not-covered" id="L1845">
    <div class="line-number"><a href="#L1845">1845</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L1846">
    <div class="line-number"><a href="#L1846">1846</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Return module anyway to prevent crashes</div>
  </div>
  <div class="line not-covered" id="L1847">
    <div class="line-number"><a href="#L1847">1847</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1848">
    <div class="line-number"><a href="#L1848">1848</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1849">
    <div class="line-number"><a href="#L1849">1849</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L1850">
    <div class="line-number"><a href="#L1850">1850</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return init()</div>
  </div>
</div>
<div class="source-code" id="file---lib-coverage-process-functions-lua">
  <h3>./lib/coverage/process_functions.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">164 / 299 (54%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar medium" style="width: 54%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">5 / 5 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 477      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 299      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 5      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 5      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-coverage-process-functions-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-coverage-process-functions-lua" value="all" checked>
        All <span class="function-count">5</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-coverage-process-functions-lua" value="executed">
        Executed <span class="function-count badge-success">5</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-coverage-process-functions-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-coverage-process-functions-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-coverage-process-functions-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-coverage-process-functions-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-coverage-process-functions-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">3</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-coverage-process-functions-lua" value="closure">
        Closure <span class="function-count function-type-closure">2</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-coverage-process-functions-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="anonymous" data-executed="true">
          <td>anonymous <span class="function-type-badge function-type-anonymous">anonymous</span></td>
          <td>anonymous</td>
          <td><a href="#L0">0-0</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>process_functions_from_file <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L28">28-140</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="anonymous" data-executed="true">
          <td>anonymous <span class="function-type-badge function-type-anonymous">anonymous</span></td>
          <td>anonymous</td>
          <td><a href="#L31">31-33</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>get_function_stats <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L218">218-347</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="anonymous" data-executed="true">
          <td>anonymous <span class="function-type-badge function-type-anonymous">anonymous</span></td>
          <td>anonymous</td>
          <td><a href="#L236">236-238</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for process_functions.lua    const tableId = 'functions---lib-coverage-process-functions-lua';
    const searchId = 'func-search---lib-coverage-process-functions-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-coverage-process-functions-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-coverage-process-functions-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-coverage-process-functions-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-coverage-process-functions-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class coverage.process_functions</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field process_functions_from_file fun(file_path: string, source_text?: string): {functions: {name: string, line: number, end_line: number}[], functions_identified: number} | nil, table? Process functions from a file</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field process_all_functions fun(): boolean | nil, table? Process functions from all tracked files</div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field enhance_report_data fun(report_data: table): boolean | nil, table? Enhance report data with function statistics</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_function_stats fun(): {total_functions: number, executed_functions: number, covered_functions: number, function_coverage_percent: number, functions_by_file: table&lt;string, {total: number, executed: number, coverage_percent: number}&gt;} Get function statistics from debug_hook and other sources</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Function processing module for coverage system</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Analyzes source code to identify functions and their locations, and processes</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- function execution data for reporting.</div>
  </div>
  <div class="line not-executable" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @author Firmo Team</div>
  </div>
  <div class="line not-executable" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @version 1.0.0</div>
  </div>
  <div class="line not-covered" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local M = {}</div>
  </div>
  <div class="line covered" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local fs = require(&quot;lib.tools.filesystem&quot;)</div>
  </div>
  <div class="line not-covered" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local error_handler = require(&quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line covered" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local logging = require(&quot;lib.tools.logging&quot;)</div>
  </div>
  <div class="line covered" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local logger = logging.get_logger(&quot;coverage.process_functions&quot;)</div>
  </div>
  <div class="line not-executable" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Internal state</div>
  </div>
  <div class="line covered" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local debug_hook -- Will be imported when needed</div>
  </div>
  <div class="line not-executable" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Process functions from a file to identify their names and locations</div>
  </div>
  <div class="line not-executable" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param file_path string The path to the file to process</div>
  </div>
  <div class="line not-executable" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param source_text? string Optional source text (if already loaded)</div>
  </div>
  <div class="line not-executable" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return {name: string, line: number, end_line: number}[] | nil functions List of functions found in the file</div>
  </div>
  <div class="line not-executable" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table | nil error Error information if processing failed</div>
  </div>
  <div class="line not-covered" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.process_functions_from_file(file_path, source_text)</div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get source text if not provided</div>
  </div>
  <div class="line not-covered" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not source_text then</div>
  </div>
  <div class="line not-covered" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line covered" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return fs.read_file(file_path)</div>
  </div>
  <div class="line covered" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line covered" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return nil, error_handler.io_error(</div>
  </div>
  <div class="line covered" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        &quot;Failed to read file for function processing&quot;,</div>
  </div>
  <div class="line covered" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        {</div>
  </div>
  <div class="line covered" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          file_path = file_path,</div>
  </div>
  <div class="line covered" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          error = error_handler.format_error(result)</div>
  </div>
  <div class="line covered" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        }</div>
  </div>
  <div class="line covered" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      )</div>
  </div>
  <div class="line covered" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    source_text = result</div>
  </div>
  <div class="line covered" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Simple function pattern for all Lua files</div>
  </div>
  <div class="line covered" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local functions = {}</div>
  </div>
  <div class="line not-executable" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Process all files consistently - no special cases</div>
  </div>
  <div class="line not-executable" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Process the source text to find functions</div>
  </div>
  <div class="line not-executable" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- This is a simple pattern matching approach that works for basic cases</div>
  </div>
  <div class="line not-executable" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Consider using a proper Lua parser for more complex analysis</div>
  </div>
  <div class="line not-executable" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Regular patterns for function declarations</div>
  </div>
  <div class="line covered" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local patterns = {</div>
  </div>
  <div class="line not-executable" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Function name = function(...) pattern</div>
  </div>
  <div class="line covered" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    &quot;([%w_%.]+)%s*=%s*function%s*%([^%)]*%)&quot;,</div>
  </div>
  <div class="line not-executable" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- function name(...) pattern</div>
  </div>
  <div class="line covered" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    &quot;function%s+([%w_%.]+)%s*%([^%)]*%)&quot;,</div>
  </div>
  <div class="line not-executable" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- local function name(...) pattern</div>
  </div>
  <div class="line covered" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    &quot;local%s+function%s+([%w_%.]+)%s*%([^%)]*%)&quot;</div>
  </div>
  <div class="line covered" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Extract line numbers and function names</div>
  </div>
  <div class="line covered" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for i, pattern in ipairs(patterns) do</div>
  </div>
  <div class="line covered" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local pos = 1</div>
  </div>
  <div class="line covered" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    while true do</div>
  </div>
  <div class="line covered" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local start_pos, end_pos, func_name = source_text:find(pattern, pos)</div>
  </div>
  <div class="line covered" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count">4</div>    <div class="line-content">      if not start_pos then break end</div>
  </div>
  <div class="line not-executable" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Calculate line number</div>
  </div>
  <div class="line covered" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count">7</div>    <div class="line-content">      local line_num = 1</div>
  </div>
  <div class="line covered" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count">7</div>    <div class="line-content">      for _ in source_text:sub(1, start_pos):gmatch(&quot;\n&quot;) do</div>
  </div>
  <div class="line covered" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        line_num = line_num + 1</div>
  </div>
  <div class="line covered" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Calculate end line (approximate)</div>
  </div>
  <div class="line covered" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count">50</div>    <div class="line-content">      local end_line = line_num</div>
  </div>
  <div class="line covered" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count">4</div>    <div class="line-content">      local nested_level = 0</div>
  </div>
  <div class="line covered" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local search_pos = end_pos</div>
  </div>
  <div class="line not-executable" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Scan for function end by looking for balanced 'end' tokens</div>
  </div>
  <div class="line covered" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count">4</div>    <div class="line-content">      while search_pos &lt; #source_text do</div>
  </div>
  <div class="line not-executable" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Look for 'function' keyword that increases nesting</div>
  </div>
  <div class="line covered" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        local function_start = source_text:find(&quot;function&quot;, search_pos + 1)</div>
  </div>
  <div class="line covered" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        local end_token = source_text:find(&quot;end&quot;, search_pos + 1)</div>
  </div>
  <div class="line not-executable" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- No more end tokens found</div>
  </div>
  <div class="line covered" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count">4</div>    <div class="line-content">        if not end_token then break end</div>
  </div>
  <div class="line not-executable" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Found nested function before end</div>
  </div>
  <div class="line covered" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if function_start and function_start &lt; end_token then</div>
  </div>
  <div class="line covered" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count">4</div>    <div class="line-content">          nested_level = nested_level + 1</div>
  </div>
  <div class="line covered" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          search_pos = function_start</div>
  </div>
  <div class="line covered" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Found end token</div>
  </div>
  <div class="line covered" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          if nested_level == 0 then</div>
  </div>
  <div class="line not-executable" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- This is our function's end</div>
  </div>
  <div class="line not-executable" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Calculate end line</div>
  </div>
  <div class="line covered" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            for _ in source_text:sub(1, end_token):gmatch(&quot;\n&quot;) do</div>
  </div>
  <div class="line covered" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count">4</div>    <div class="line-content">              end_line = end_line + 1</div>
  </div>
  <div class="line covered" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            end</div>
  </div>
  <div class="line covered" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            break</div>
  </div>
  <div class="line covered" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count">66</div>    <div class="line-content">          else</div>
  </div>
  <div class="line not-executable" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- This ends a nested function</div>
  </div>
  <div class="line covered" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count">4</div>    <div class="line-content">            nested_level = nested_level - 1</div>
  </div>
  <div class="line covered" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count">4</div>    <div class="line-content">            search_pos = end_token</div>
  </div>
  <div class="line covered" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line covered" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Store function info</div>
  </div>
  <div class="line covered" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      table.insert(functions, {</div>
  </div>
  <div class="line covered" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        name = func_name,</div>
  </div>
  <div class="line covered" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        line = line_num,</div>
  </div>
  <div class="line covered" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end_line = end_line</div>
  </div>
  <div class="line covered" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count">8</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-executable" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Continue search from end of this match</div>
  </div>
  <div class="line covered" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count">4</div>    <div class="line-content">      pos = end_pos + 1</div>
  </div>
  <div class="line covered" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Extract basename manually since fs.basename may not be available</div>
  </div>
  <div class="line covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local basename = file_path:match(&quot;([^/\\]+)$&quot;) or file_path</div>
  </div>
  <div class="line not-executable" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.debug(&quot;Processed functions from file&quot;, {</div>
  </div>
  <div class="line covered" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    file_path = basename,</div>
  </div>
  <div class="line covered" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    function_count = #functions</div>
  </div>
  <div class="line covered" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return functions with additional statistics</div>
  </div>
  <div class="line covered" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return {</div>
  </div>
  <div class="line covered" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    functions = functions,</div>
  </div>
  <div class="line covered" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    functions_identified = #functions</div>
  </div>
  <div class="line covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  }</div>
  </div>
  <div class="line covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Process functions from all tracked files</div>
  </div>
  <div class="line not-executable" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean | nil success Whether the operation was successful</div>
  </div>
  <div class="line not-executable" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table | nil error Error information if processing failed</div>
  </div>
  <div class="line covered" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.process_all_functions()</div>
  </div>
  <div class="line not-executable" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Lazy load debug_hook</div>
  </div>
  <div class="line not-covered" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not debug_hook then</div>
  </div>
  <div class="line not-covered" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result = pcall(require, &quot;lib.coverage.debug_hook&quot;)</div>
  </div>
  <div class="line not-covered" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line covered" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return nil, error_handler.runtime_error(</div>
  </div>
  <div class="line not-covered" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Failed to load debug_hook module&quot;,</div>
  </div>
  <div class="line not-covered" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        {</div>
  </div>
  <div class="line not-covered" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          error = tostring(result),</div>
  </div>
  <div class="line not-covered" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          operation = &quot;process_all_functions&quot;</div>
  </div>
  <div class="line not-covered" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        }</div>
  </div>
  <div class="line not-covered" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      )</div>
  </div>
  <div class="line not-covered" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    debug_hook = result</div>
  </div>
  <div class="line not-covered" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get coverage data</div>
  </div>
  <div class="line not-covered" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return debug_hook.get_coverage_data()</div>
  </div>
  <div class="line not-covered" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line not-executable" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line not-covered" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil, error_handler.runtime_error(</div>
  </div>
  <div class="line not-covered" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;Failed to get coverage data&quot;,</div>
  </div>
  <div class="line not-covered" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      {</div>
  </div>
  <div class="line not-covered" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = error_handler.format_error(result),</div>
  </div>
  <div class="line not-covered" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        operation = &quot;process_all_functions&quot;</div>
  </div>
  <div class="line not-covered" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-covered" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    )</div>
  </div>
  <div class="line not-covered" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local data = result</div>
  </div>
  <div class="line not-executable" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Process each file</div>
  </div>
  <div class="line not-covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for file_path, file_data in pairs(data.files or {}) do</div>
  </div>
  <div class="line not-executable" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Skip files without source text</div>
  </div>
  <div class="line not-covered" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not file_data.source_text then</div>
  </div>
  <div class="line not-covered" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.debug(&quot;Skipping file without source text&quot;, {</div>
  </div>
  <div class="line not-covered" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_path = file_path</div>
  </div>
  <div class="line not-covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      goto continue</div>
  </div>
  <div class="line not-covered" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Process functions</div>
  </div>
  <div class="line not-covered" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local functions, err = M.process_functions_from_file(file_path, file_data.source_text)</div>
  </div>
  <div class="line not-covered" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not functions then</div>
  </div>
  <div class="line not-covered" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.warn(&quot;Failed to process functions from file: &quot; .. error_handler.format_error(err), {</div>
  </div>
  <div class="line not-covered" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_path = file_path</div>
  </div>
  <div class="line not-covered" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      goto continue</div>
  </div>
  <div class="line not-covered" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Save functions to debug_hook data</div>
  </div>
  <div class="line not-covered" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, func_info in ipairs(functions) do</div>
  </div>
  <div class="line not-executable" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Create function tracking structures if needed</div>
  </div>
  <div class="line not-covered" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      data.functions = data.functions or {}</div>
  </div>
  <div class="line not-covered" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      data.functions.all = data.functions.all or {}</div>
  </div>
  <div class="line not-covered" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      data.functions.all[file_path] = data.functions.all[file_path] or {}</div>
  </div>
  <div class="line not-executable" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Store function info</div>
  </div>
  <div class="line not-covered" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      data.functions.all[file_path][func_info.line] = func_info.name</div>
  </div>
  <div class="line not-covered" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- No special handling for any specific files</div>
  </div>
  <div class="line not-executable" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    ::continue::</div>
  </div>
  <div class="line not-covered" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get function statistics from debug_hook</div>
  </div>
  <div class="line not-executable" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return {total_functions: number, executed_functions: number, covered_functions: number, function_coverage_percent: number, functions_by_file: table&lt;string, {total: number, executed: number, coverage_percent: number}&gt;} stats Function statistics</div>
  </div>
  <div class="line not-covered" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_function_stats()</div>
  </div>
  <div class="line not-executable" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Lazy load debug_hook</div>
  </div>
  <div class="line covered" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not debug_hook then</div>
  </div>
  <div class="line not-covered" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result = pcall(require, &quot;lib.coverage.debug_hook&quot;)</div>
  </div>
  <div class="line not-covered" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line not-covered" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.warn(&quot;Failed to load debug_hook module: &quot; .. tostring(result))</div>
  </div>
  <div class="line covered" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return {</div>
  </div>
  <div class="line covered" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        total_functions = 0,</div>
  </div>
  <div class="line covered" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        executed_functions = 0,</div>
  </div>
  <div class="line covered" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        covered_functions = 0,</div>
  </div>
  <div class="line covered" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        function_coverage_percent = 0,</div>
  </div>
  <div class="line covered" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        functions_by_file = {}</div>
  </div>
  <div class="line covered" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      }</div>
  </div>
  <div class="line covered" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    debug_hook = result</div>
  </div>
  <div class="line covered" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get coverage data</div>
  </div>
  <div class="line covered" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local success, result = error_handler.try(function()</div>
  </div>
  <div class="line covered" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return debug_hook.get_coverage_data()</div>
  </div>
  <div class="line covered" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line not-executable" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line covered" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    logger.warn(&quot;Failed to get coverage data: &quot; .. error_handler.format_error(result))</div>
  </div>
  <div class="line covered" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    return {</div>
  </div>
  <div class="line covered" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      total_functions = 0,</div>
  </div>
  <div class="line covered" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      executed_functions = 0,</div>
  </div>
  <div class="line covered" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      covered_functions = 0,</div>
  </div>
  <div class="line covered" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count">2</div>    <div class="line-content">      function_coverage_percent = 0,</div>
  </div>
  <div class="line covered" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      functions_by_file = {}</div>
  </div>
  <div class="line covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    }</div>
  </div>
  <div class="line covered" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local data = result</div>
  </div>
  <div class="line not-executable" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize stats</div>
  </div>
  <div class="line covered" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local stats = {</div>
  </div>
  <div class="line covered" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    total_functions = 0,</div>
  </div>
  <div class="line covered" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    executed_functions = 0,</div>
  </div>
  <div class="line covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    covered_functions = 0,</div>
  </div>
  <div class="line covered" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    function_coverage_percent = 0,</div>
  </div>
  <div class="line covered" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    functions_by_file = {}</div>
  </div>
  <div class="line covered" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Process function data</div>
  </div>
  <div class="line covered" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  if data.functions then</div>
  </div>
  <div class="line not-executable" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Process all functions</div>
  </div>
  <div class="line covered" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    for file_path, funcs in pairs(data.functions.all or {}) do</div>
  </div>
  <div class="line not-executable" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Initialize file stats</div>
  </div>
  <div class="line covered" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      stats.functions_by_file[file_path] = {</div>
  </div>
  <div class="line covered" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        total = 0,</div>
  </div>
  <div class="line covered" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count">2</div>    <div class="line-content">        executed = 0,</div>
  </div>
  <div class="line covered" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        coverage_percent = 0</div>
  </div>
  <div class="line covered" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-executable" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Count total functions</div>
  </div>
  <div class="line covered" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      for line, func_name in pairs(funcs) do</div>
  </div>
  <div class="line covered" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        stats.total_functions = stats.total_functions + 1</div>
  </div>
  <div class="line covered" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        stats.functions_by_file[file_path].total = stats.functions_by_file[file_path].total + 1</div>
  </div>
  <div class="line not-executable" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Check if the function is executed by looking at the function's starting line</div>
  </div>
  <div class="line not-executable" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- First check direct function execution tracking</div>
  </div>
  <div class="line covered" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        local executed = data.functions.executed and </div>
  </div>
  <div class="line covered" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                        data.functions.executed[file_path] and </div>
  </div>
  <div class="line covered" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                        data.functions.executed[file_path][line]</div>
  </div>
  <div class="line not-executable" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Then check if its starting line was executed (line coverage)</div>
  </div>
  <div class="line covered" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if not executed and data.files and data.files[file_path] and </div>
  </div>
  <div class="line covered" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count">1</div>    <div class="line-content">           data.files[file_path]._executed_lines and </div>
  </div>
  <div class="line covered" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count">1</div>    <div class="line-content">           data.files[file_path]._executed_lines[line] then</div>
  </div>
  <div class="line covered" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          executed = true</div>
  </div>
  <div class="line not-executable" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Also mark function as executed in function tracking</div>
  </div>
  <div class="line covered" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          data.functions.executed = data.functions.executed or {}</div>
  </div>
  <div class="line covered" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          data.functions.executed[file_path] = data.functions.executed[file_path] or {}</div>
  </div>
  <div class="line covered" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          data.functions.executed[file_path][line] = true</div>
  </div>
  <div class="line covered" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line covered" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if executed then</div>
  </div>
  <div class="line covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          stats.executed_functions = stats.executed_functions + 1</div>
  </div>
  <div class="line covered" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          stats.functions_by_file[file_path].executed = stats.functions_by_file[file_path].executed + 1</div>
  </div>
  <div class="line not-executable" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- CRITICAL FIX: Always mark executed functions as covered</div>
  </div>
  <div class="line not-executable" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- This ensures consistency with line coverage behavior</div>
  </div>
  <div class="line not-executable" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Ensure the covered table exists and is updated</div>
  </div>
  <div class="line covered" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          data.functions.covered = data.functions.covered or {}</div>
  </div>
  <div class="line covered" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          data.functions.covered[file_path] = data.functions.covered[file_path] or {}</div>
  </div>
  <div class="line covered" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          data.functions.covered[file_path][line] = true</div>
  </div>
  <div class="line not-executable" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Count it as covered</div>
  </div>
  <div class="line covered" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          stats.covered_functions = stats.covered_functions + 1</div>
  </div>
  <div class="line covered" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Check existing covered status (from assertions or other sources)</div>
  </div>
  <div class="line covered" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          local already_covered = (data.functions.covered and </div>
  </div>
  <div class="line covered" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                           data.functions.covered[file_path] and </div>
  </div>
  <div class="line covered" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count">1</div>    <div class="line-content">                           data.functions.covered[file_path][line])</div>
  </div>
  <div class="line not-executable" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count"></div>    <div class="line-content">                           </div>
  </div>
  <div class="line covered" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          if already_covered then</div>
  </div>
  <div class="line covered" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            stats.covered_functions = stats.covered_functions + 1</div>
  </div>
  <div class="line covered" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line covered" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Calculate file coverage percentage</div>
  </div>
  <div class="line covered" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if stats.functions_by_file[file_path].total &gt; 0 then</div>
  </div>
  <div class="line not-executable" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Track covered functions per file</div>
  </div>
  <div class="line covered" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        stats.functions_by_file[file_path].covered = 0</div>
  </div>
  <div class="line not-executable" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Count covered functions for this file</div>
  </div>
  <div class="line covered" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if data.functions.covered and data.functions.covered[file_path] then</div>
  </div>
  <div class="line covered" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          for line, _ in pairs(data.functions.covered[file_path]) do</div>
  </div>
  <div class="line covered" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            stats.functions_by_file[file_path].covered = stats.functions_by_file[file_path].covered + 1</div>
  </div>
  <div class="line covered" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line covered" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Use covered functions (not executed) for coverage percentage</div>
  </div>
  <div class="line covered" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        stats.functions_by_file[file_path].coverage_percent = </div>
  </div>
  <div class="line covered" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          stats.functions_by_file[file_path].covered / stats.functions_by_file[file_path].total * 100</div>
  </div>
  <div class="line covered" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Calculate overall coverage percentage</div>
  </div>
  <div class="line covered" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if stats.total_functions &gt; 0 then</div>
  </div>
  <div class="line covered" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      stats.function_coverage_percent = stats.covered_functions / stats.total_functions * 100</div>
  </div>
  <div class="line covered" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return stats</div>
  </div>
  <div class="line covered" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Function to ensure executed functions are properly marked as covered</div>
  </div>
  <div class="line not-executable" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param report_data table The report data to process</div>
  </div>
  <div class="line not-executable" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean success Whether the operation was successful</div>
  </div>
  <div class="line covered" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.ensure_function_coverage_consistency(report_data)</div>
  </div>
  <div class="line covered" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  if not report_data or not report_data.files then</div>
  </div>
  <div class="line covered" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- For each file in the report</div>
  </div>
  <div class="line not-covered" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for file_path, file_data in pairs(report_data.files) do</div>
  </div>
  <div class="line not-executable" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Skip files without function data</div>
  </div>
  <div class="line not-covered" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not file_data.functions then</div>
  </div>
  <div class="line not-covered" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      goto continue</div>
  </div>
  <div class="line not-covered" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Count executed vs covered functions</div>
  </div>
  <div class="line not-covered" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local total_functions = 0</div>
  </div>
  <div class="line not-covered" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local executed_functions = 0</div>
  </div>
  <div class="line not-covered" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local covered_functions = 0</div>
  </div>
  <div class="line not-executable" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Ensure all executed functions are marked as covered</div>
  </div>
  <div class="line not-covered" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for line_num, func_data in pairs(file_data.functions) do</div>
  </div>
  <div class="line not-covered" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      total_functions = total_functions + 1</div>
  </div>
  <div class="line not-executable" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Check if the function was executed</div>
  </div>
  <div class="line not-covered" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if func_data.executed then</div>
  </div>
  <div class="line not-covered" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        executed_functions = executed_functions + 1</div>
  </div>
  <div class="line not-executable" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- CRITICAL FIX: Always mark executed functions as covered</div>
  </div>
  <div class="line not-covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        func_data.covered = true</div>
  </div>
  <div class="line not-covered" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        covered_functions = covered_functions + 1</div>
  </div>
  <div class="line not-covered" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Update file's function coverage statistics</div>
  </div>
  <div class="line not-covered" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_data.total_functions = total_functions</div>
  </div>
  <div class="line not-covered" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_data.executed_functions = executed_functions</div>
  </div>
  <div class="line not-covered" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_data.covered_functions = covered_functions</div>
  </div>
  <div class="line not-covered" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_data.function_coverage_percent = </div>
  </div>
  <div class="line not-covered" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      total_functions &gt; 0 and (covered_functions / total_functions * 100) or 0</div>
  </div>
  <div class="line not-executable" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    ::continue::</div>
  </div>
  <div class="line not-covered" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Enhance report data with function statistics</div>
  </div>
  <div class="line not-executable" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param report_data table The report data to enhance</div>
  </div>
  <div class="line not-executable" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean | nil success Whether the operation was successful</div>
  </div>
  <div class="line not-executable" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table | nil error Error information if enhancement failed</div>
  </div>
  <div class="line not-covered" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.enhance_report_data(report_data)</div>
  </div>
  <div class="line not-covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not report_data then</div>
  </div>
  <div class="line covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return nil, error_handler.validation_error(</div>
  </div>
  <div class="line not-covered" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;Report data must be provided&quot;,</div>
  </div>
  <div class="line not-covered" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      {operation = &quot;enhance_report_data&quot;}</div>
  </div>
  <div class="line not-covered" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    )</div>
  </div>
  <div class="line not-covered" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Ensure executed functions are consistently marked as covered</div>
  </div>
  <div class="line not-covered" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  M.ensure_function_coverage_consistency(report_data)</div>
  </div>
  <div class="line not-executable" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Get function statistics</div>
  </div>
  <div class="line not-covered" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local function_stats = M.get_function_stats()</div>
  </div>
  <div class="line not-executable" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update report summary with function statistics</div>
  </div>
  <div class="line not-covered" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  report_data.summary = report_data.summary or {}</div>
  </div>
  <div class="line not-covered" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  report_data.summary.total_functions = function_stats.total_functions</div>
  </div>
  <div class="line not-covered" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  report_data.summary.covered_functions = function_stats.covered_functions</div>
  </div>
  <div class="line not-covered" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  report_data.summary.function_coverage_percent = function_stats.function_coverage_percent</div>
  </div>
  <div class="line not-executable" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Process all files to ensure line coverage data is consistent</div>
  </div>
  <div class="line not-covered" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for file_path, file_data in pairs(report_data.files or {}) do</div>
  </div>
  <div class="line not-executable" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Initialize or update file stats</div>
  </div>
  <div class="line not-covered" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    file_data.stats = file_data.stats or {</div>
  </div>
  <div class="line not-covered" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      total = 0,</div>
  </div>
  <div class="line not-covered" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      covered = 0,</div>
  </div>
  <div class="line not-covered" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      executable = 0,</div>
  </div>
  <div class="line not-covered" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      percentage = 0</div>
  </div>
  <div class="line not-covered" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    }</div>
  </div>
  <div class="line not-executable" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Count executed and executable lines</div>
  </div>
  <div class="line not-covered" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local executable_lines = 0</div>
  </div>
  <div class="line not-covered" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local covered_lines = 0</div>
  </div>
  <div class="line not-executable" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Mark any executed lines as both executable and covered</div>
  </div>
  <div class="line not-covered" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if file_data._executed_lines then</div>
  </div>
  <div class="line not-covered" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for line_num, _ in pairs(file_data._executed_lines) do</div>
  </div>
  <div class="line not-executable" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Initialize lines table if needed</div>
  </div>
  <div class="line not-covered" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_data.lines = file_data.lines or {}</div>
  </div>
  <div class="line not-covered" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_data.lines[line_num] = file_data.lines[line_num] or {}</div>
  </div>
  <div class="line not-executable" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Mark the line as executable, executed, and covered</div>
  </div>
  <div class="line not-covered" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_data.lines[line_num].executable = true</div>
  </div>
  <div class="line not-covered" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_data.lines[line_num].covered = true</div>
  </div>
  <div class="line not-covered" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        file_data.lines[line_num].executed = true</div>
  </div>
  <div class="line not-executable" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-covered" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        executable_lines = executable_lines + 1</div>
  </div>
  <div class="line not-covered" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        covered_lines = covered_lines + 1</div>
  </div>
  <div class="line not-covered" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Update file stats</div>
  </div>
  <div class="line not-covered" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_data.stats.total = executable_lines</div>
  </div>
  <div class="line not-covered" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_data.stats.covered = covered_lines</div>
  </div>
  <div class="line not-covered" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_data.stats.executable = executable_lines</div>
  </div>
  <div class="line not-covered" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      file_data.stats.percentage = executable_lines &gt; 0 and (covered_lines / executable_lines * 100) or 0</div>
  </div>
  <div class="line not-executable" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Also update the global summary</div>
  </div>
  <div class="line not-covered" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      report_data.summary.total_lines = (report_data.summary.total_lines or 0) + executable_lines</div>
  </div>
  <div class="line not-covered" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      report_data.summary.covered_lines = (report_data.summary.covered_lines or 0) + covered_lines</div>
  </div>
  <div class="line not-covered" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      report_data.summary.line_coverage_percent = </div>
  </div>
  <div class="line not-covered" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        report_data.summary.total_lines &gt; 0 and </div>
  </div>
  <div class="line not-covered" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        (report_data.summary.covered_lines / report_data.summary.total_lines * 100) or 0</div>
  </div>
  <div class="line not-covered" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update individual files with function statistics</div>
  </div>
  <div class="line not-covered" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for file_path, file_stats in pairs(function_stats.functions_by_file or {}) do</div>
  </div>
  <div class="line not-covered" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if report_data.files[file_path] then</div>
  </div>
  <div class="line not-covered" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      report_data.files[file_path].total_functions = file_stats.total</div>
  </div>
  <div class="line not-covered" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      report_data.files[file_path].covered_functions = file_stats.covered</div>
  </div>
  <div class="line not-covered" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      report_data.files[file_path].function_coverage_percent = file_stats.coverage_percent</div>
  </div>
  <div class="line not-covered" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return M</div>
  </div>
  <div class="line not-executable" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 469</div>
  </div>
  <div class="line not-executable" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 470</div>
  </div>
  <div class="line not-executable" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 471</div>
  </div>
  <div class="line not-executable" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 472</div>
  </div>
  <div class="line not-executable" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 473</div>
  </div>
  <div class="line not-executable" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 474</div>
  </div>
  <div class="line not-executable" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 475</div>
  </div>
  <div class="line not-executable" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 476</div>
  </div>
  <div class="line not-executable" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 477</div>
  </div>
</div>
<div class="source-code" id="file---lib-assertion-lua">
  <h3>./lib/assertion.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">188 / 1495 (12%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 12%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">17 / 17 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 2082      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 1495      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 17      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 17      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-assertion-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-assertion-lua" value="all" checked>
        All <span class="function-count">17</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-assertion-lua" value="executed">
        Executed <span class="function-count badge-success">17</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-assertion-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-assertion-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-assertion-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-assertion-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-assertion-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">1</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-assertion-lua" value="closure">
        Closure <span class="function-count function-type-closure">16</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-assertion-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>get_error_handler <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L63">63-69</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>20</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>get_logging <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L73">73-79</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>10</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>get_logger <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L83">83-106</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>10</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>has <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L117">117-124</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>20</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>stringify <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L132">132-202</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>8</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>eq <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L255">255-341</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>4</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>test <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L542">542-544</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>2</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>test <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L595">595-612</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>4</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>test <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L1601">1601-1613</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>2</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>test <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L1736">1736-1740</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>2</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>expect <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L1981">1981-2083</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>10</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>index <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L2001">2001-2011</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>20</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>exist <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L2012">2012-2079</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>2</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>be_truthy <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L2012">2012-2079</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>2</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>be_greater_than <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L2012">2012-2079</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>2</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>equal <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L2012">2012-2079</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>4</td>
        </tr>
        <tr class="executed covered" data-function-type="anonymous" data-executed="true">
          <td>anonymous <span class="function-type-badge function-type-anonymous">anonymous</span></td>
          <td>anonymous</td>
          <td><a href="#L2020">2020-2023</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>10</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for assertion.lua    const tableId = 'functions---lib-assertion-lua';
    const searchId = 'func-search---lib-assertion-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-assertion-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-assertion-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-assertion-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-assertion-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class AssertionModule</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field create_expectation fun(value: any): ExpectChain Create an expectation chain for value assertions</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field eq fun(v1: any, v2: any, depth?: number): boolean Deep equality comparison between two values</div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field type_of fun(value: any, expected_type: string): boolean Type checking with enhanced type detection</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field same fun(v1: any, v2: any): boolean Shallow equality comparison (alias for ==)</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field isa fun(value: any, expected_class: string|table): boolean Check if value is instance of class</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field near fun(v1: number, v2: number, tolerance?: number): boolean Check if numbers are close within tolerance</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field has_error fun(fn: function, expected_error?: string): boolean Check if function raises expected error</div>
  </div>
  <div class="line not-executable" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field has_key fun(tbl: table, key: any): boolean Check if table has specific key</div>
  </div>
  <div class="line not-executable" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field has_keys fun(tbl: table, keys: table): boolean Check if table has all specified keys</div>
  </div>
  <div class="line not-executable" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field contains fun(tbl: table, value: any): boolean Check if table contains value</div>
  </div>
  <div class="line not-executable" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field contains_all fun(tbl: table, values: table): boolean Check if table contains all specified values</div>
  </div>
  <div class="line not-executable" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field matches fun(str: string, pattern: string): boolean Check if string matches Lua pattern</div>
  </div>
  <div class="line not-executable" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_callable fun(value: any): boolean Check if value is callable (function or has __call metatable)</div>
  </div>
  <div class="line not-executable" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field normalize_type fun(value: any): string Get normalized type including metatable-based types</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field array_contains fun(array: table, value: any): boolean Check if array contains specific value</div>
  </div>
  <div class="line not-executable" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_array fun(value: any): boolean Check if value is an array-like table</div>
  </div>
  <div class="line not-executable" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_empty fun(value: table|string): boolean Check if collection is empty</div>
  </div>
  <div class="line not-executable" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field has_metatable fun(value: any, mt: table): boolean Check if value has specific metatable</div>
  </div>
  <div class="line not-executable" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field register_assertion fun(name: string, fn: function): boolean Register a custom assertion function</div>
  </div>
  <div class="line not-executable" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field stringify fun(value: any, depth?: number, visited?: table): string Convert any value to a readable string</div>
  </div>
  <div class="line not-executable" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field check_and_throw fun(condition: boolean, message: string, category?: string): boolean Check condition and throw error if false</div>
  </div>
  <div class="line not-executable" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field diff_values fun(v1: any, v2: any): string Generate a human-readable diff between values</div>
  </div>
  <div class="line not-executable" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count"></div>    <div class="line-content">--[[</div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">    Assertion Module for the Firmo testing framework</div>
  </div>
  <div class="line not-executable" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count"></div>    <div class="line-content">    This is a standalone module for assertions that resolves circular dependencies</div>
  </div>
  <div class="line not-executable" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count"></div>    <div class="line-content">    and provides consistent error handling patterns. It implements the expect-style</div>
  </div>
  <div class="line not-executable" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count"></div>    <div class="line-content">    assertion chain API and includes comprehensive equality testing, type checking,</div>
  </div>
  <div class="line not-executable" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count"></div>    <div class="line-content">    and formatted error messages for test failures.</div>
  </div>
  <div class="line not-executable" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count"></div>    <div class="line-content">    Features:</div>
  </div>
  <div class="line not-executable" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Fluent, chainable assertion API with expect() function</div>
  </div>
  <div class="line not-executable" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Deep equality comparison with cycle detection and diff generation</div>
  </div>
  <div class="line not-executable" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Enhanced type checking beyond Lua's basic types (detects class instances)</div>
  </div>
  <div class="line not-executable" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Rich error messages with detailed value formatting</div>
  </div>
  <div class="line not-executable" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Support for custom assertions through registration</div>
  </div>
  <div class="line not-executable" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Collection and string validation utilities</div>
  </div>
  <div class="line not-executable" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Metatable-aware comparison operations</div>
  </div>
  <div class="line not-executable" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Expectation negation through to_not chain</div>
  </div>
  <div class="line not-executable" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Structured error reporting with categories and context</div>
  </div>
  <div class="line not-executable" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Enhanced diff algorithm for readable failure messages</div>
  </div>
  <div class="line not-executable" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @module assertion</div>
  </div>
  <div class="line not-executable" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @author Firmo Team</div>
  </div>
  <div class="line not-executable" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @license MIT</div>
  </div>
  <div class="line not-executable" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @copyright 2023-2025</div>
  </div>
  <div class="line not-executable" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @version 1.0.0</div>
  </div>
  <div class="line not-executable" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count"></div>    <div class="line-content">]]</div>
  </div>
  <div class="line not-covered" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local M = {}</div>
  </div>
  <div class="line not-executable" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Compatibility function for table unpacking (works with both Lua 5.1 and 5.2+)</div>
  </div>
  <div class="line not-covered" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local unpack = table.unpack or _G.unpack</div>
  </div>
  <div class="line not-executable" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Lazy-load dependencies to avoid circular dependencies</div>
  </div>
  <div class="line not-executable" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@diagnostic disable-next-line: unused-local</div>
  </div>
  <div class="line not-covered" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local _error_handler, _logging, _firmo</div>
  </div>
  <div class="line not-executable" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the error handler module with lazy loading to avoid circular dependencies</div>
  </div>
  <div class="line not-executable" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil The error handler module or nil if not available</div>
  </div>
  <div class="line not-covered" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_error_handler()</div>
  </div>
  <div class="line not-covered" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not _error_handler then</div>
  </div>
  <div class="line not-covered" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, error_handler = pcall(require, &quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line not-covered" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    _error_handler = success and error_handler or nil</div>
  </div>
  <div class="line not-covered" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return _error_handler</div>
  </div>
  <div class="line covered" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count">20</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the logging module with lazy loading to avoid circular dependencies</div>
  </div>
  <div class="line not-executable" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil The logging module or nil if not available</div>
  </div>
  <div class="line covered" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local function get_logging()</div>
  </div>
  <div class="line covered" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count">20</div>    <div class="line-content">  if not _logging then</div>
  </div>
  <div class="line covered" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local success, logging = pcall(require, &quot;lib.tools.logging&quot;)</div>
  </div>
  <div class="line not-covered" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    _logging = success and logging or nil</div>
  </div>
  <div class="line not-covered" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return _logging</div>
  </div>
  <div class="line covered" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get a logger instance for this module</div>
  </div>
  <div class="line not-executable" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table A logger instance (either real or stub)</div>
  </div>
  <div class="line covered" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local function get_logger()</div>
  </div>
  <div class="line covered" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local logging = get_logging()</div>
  </div>
  <div class="line covered" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  if logging then</div>
  </div>
  <div class="line covered" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return logging.get_logger(&quot;assertion&quot;)</div>
  </div>
  <div class="line not-covered" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return a stub logger if logging module isn't available</div>
  </div>
  <div class="line not-covered" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return {</div>
  </div>
  <div class="line covered" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    error = function(msg)</div>
  </div>
  <div class="line covered" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count">10</div>    <div class="line-content">      print(&quot;[ERROR] &quot; .. msg)</div>
  </div>
  <div class="line covered" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line covered" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    warn = function(msg)</div>
  </div>
  <div class="line covered" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      print(&quot;[WARN] &quot; .. msg)</div>
  </div>
  <div class="line covered" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line covered" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    info = function(msg)</div>
  </div>
  <div class="line covered" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      print(&quot;[INFO] &quot; .. msg)</div>
  </div>
  <div class="line covered" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line covered" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    debug = function(msg)</div>
  </div>
  <div class="line covered" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      print(&quot;[DEBUG] &quot; .. msg)</div>
  </div>
  <div class="line covered" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line covered" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    trace = function(msg)</div>
  </div>
  <div class="line covered" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      print(&quot;[TRACE] &quot; .. msg)</div>
  </div>
  <div class="line covered" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line covered" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  }</div>
  </div>
  <div class="line covered" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@diagnostic disable-next-line: unused-local</div>
  </div>
  <div class="line covered" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local logger = get_logger()</div>
  </div>
  <div class="line not-executable" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Utility functions</div>
  </div>
  <div class="line not-executable" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if a table contains a specific value</div>
  </div>
  <div class="line not-executable" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param t table The table to search in</div>
  </div>
  <div class="line not-executable" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param x any The value to search for</div>
  </div>
  <div class="line not-executable" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean True if the value is found, false otherwise</div>
  </div>
  <div class="line not-covered" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function has(t, x)</div>
  </div>
  <div class="line not-covered" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, v in pairs(t) do</div>
  </div>
  <div class="line not-covered" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if v == x then</div>
  </div>
  <div class="line not-covered" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return true</div>
  </div>
  <div class="line not-covered" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return false</div>
  </div>
  <div class="line not-covered" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Enhanced stringify function with better formatting for different types</div>
  </div>
  <div class="line not-executable" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and protection against cyclic references</div>
  </div>
  <div class="line not-executable" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param t any The value to stringify</div>
  </div>
  <div class="line not-executable" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param depth? number The current depth level (for recursive calls)</div>
  </div>
  <div class="line not-executable" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param visited? table Table of already visited objects (for cycle detection)</div>
  </div>
  <div class="line not-executable" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string A string representation of the value</div>
  </div>
  <div class="line covered" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local function stringify(t, depth, visited)</div>
  </div>
  <div class="line covered" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  depth = depth or 0</div>
  </div>
  <div class="line covered" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  visited = visited or {}</div>
  </div>
  <div class="line covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local indent_str = string.rep(&quot;  &quot;, depth)</div>
  </div>
  <div class="line not-executable" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Handle basic types directly</div>
  </div>
  <div class="line not-covered" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(t) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return &quot;'&quot; .. tostring(t) .. &quot;'&quot;</div>
  </div>
  <div class="line not-covered" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif type(t) == &quot;number&quot; or type(t) == &quot;boolean&quot; or type(t) == &quot;nil&quot; then</div>
  </div>
  <div class="line not-covered" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return tostring(t)</div>
  </div>
  <div class="line not-covered" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif type(t) ~= &quot;table&quot; or (getmetatable(t) and getmetatable(t).__tostring) then</div>
  </div>
  <div class="line not-covered" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return tostring(t)</div>
  </div>
  <div class="line covered" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Handle cyclic references</div>
  </div>
  <div class="line covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">8</div>    <div class="line-content">  if visited[t] then</div>
  </div>
  <div class="line covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return &quot;[Circular Reference]&quot;</div>
  </div>
  <div class="line covered" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Mark this table as visited</div>
  </div>
  <div class="line covered" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count">8</div>    <div class="line-content">  visited[t] = true</div>
  </div>
  <div class="line not-executable" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Handle empty tables</div>
  </div>
  <div class="line covered" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if next(t) == nil then</div>
  </div>
  <div class="line covered" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return &quot;{}&quot;</div>
  </div>
  <div class="line covered" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Handle tables with careful formatting</div>
  </div>
  <div class="line covered" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local strings = {}</div>
  </div>
  <div class="line covered" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local multiline = false</div>
  </div>
  <div class="line not-executable" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Format array part first</div>
  </div>
  <div class="line not-executable" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count"></div>    <div class="line-content">  ---@diagnostic disable-next-line: unused-local</div>
  </div>
  <div class="line covered" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for i, v in ipairs(t) do</div>
  </div>
  <div class="line covered" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if type(v) == &quot;table&quot; and next(v) ~= nil and depth &lt; 2 then</div>
  </div>
  <div class="line covered" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      multiline = true</div>
  </div>
  <div class="line covered" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      strings[#strings + 1] = indent_str .. &quot;  &quot; .. stringify(v, depth + 1, visited)</div>
  </div>
  <div class="line covered" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    else</div>
  </div>
  <div class="line covered" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      strings[#strings + 1] = stringify(v, depth + 1, visited)</div>
  </div>
  <div class="line covered" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Format hash part next</div>
  </div>
  <div class="line covered" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local hash_entries = {}</div>
  </div>
  <div class="line covered" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for k, v in pairs(t) do</div>
  </div>
  <div class="line covered" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if type(k) ~= &quot;number&quot; or k &gt; #t or k &lt; 1 then</div>
  </div>
  <div class="line covered" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local key_str = type(k) == &quot;string&quot; and k or &quot;[&quot; .. stringify(k, depth + 1, visited) .. &quot;]&quot;</div>
  </div>
  <div class="line covered" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if type(v) == &quot;table&quot; and next(v) ~= nil and depth &lt; 2 then</div>
  </div>
  <div class="line covered" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        multiline = true</div>
  </div>
  <div class="line covered" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        hash_entries[#hash_entries + 1] = indent_str .. &quot;  &quot; .. key_str .. &quot; = &quot; .. stringify(v, depth + 1, visited)</div>
  </div>
  <div class="line covered" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      else</div>
  </div>
  <div class="line covered" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        hash_entries[#hash_entries + 1] = key_str .. &quot; = &quot; .. stringify(v, depth + 1, visited)</div>
  </div>
  <div class="line covered" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Combine array and hash parts</div>
  </div>
  <div class="line covered" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for _, entry in ipairs(hash_entries) do</div>
  </div>
  <div class="line covered" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    strings[#strings + 1] = entry</div>
  </div>
  <div class="line covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Format based on content complexity</div>
  </div>
  <div class="line covered" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if multiline and depth == 0 then</div>
  </div>
  <div class="line covered" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return &quot;{\n  &quot; .. table.concat(strings, &quot;,\n  &quot;) .. &quot;\n&quot; .. indent_str .. &quot;}&quot;</div>
  </div>
  <div class="line covered" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  elseif #strings &gt; 5 or multiline then</div>
  </div>
  <div class="line covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return &quot;{ &quot; .. table.concat(strings, &quot;, &quot;) .. &quot; }&quot;</div>
  </div>
  <div class="line covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  else</div>
  </div>
  <div class="line covered" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return &quot;{ &quot; .. table.concat(strings, &quot;, &quot;) .. &quot; }&quot;</div>
  </div>
  <div class="line covered" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Generate a simple diff between two values</div>
  </div>
  <div class="line not-executable" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param v1 any The first value to compare</div>
  </div>
  <div class="line not-executable" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param v2 any The second value to compare</div>
  </div>
  <div class="line not-executable" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string A string representation of the differences</div>
  </div>
  <div class="line covered" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local function diff_values(v1, v2)</div>
  </div>
  <div class="line not-executable" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a shared visited table for cyclic reference detection</div>
  </div>
  <div class="line covered" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local visited = {}</div>
  </div>
  <div class="line not-executable" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if type(v1) ~= &quot;table&quot; or type(v2) ~= &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return &quot;Expected: &quot; .. stringify(v2, 0, visited) .. &quot;\nGot:      &quot; .. stringify(v1, 0, visited)</div>
  </div>
  <div class="line covered" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local differences = {}</div>
  </div>
  <div class="line not-executable" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check for missing keys in v1</div>
  </div>
  <div class="line covered" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for k, v in pairs(v2) do</div>
  </div>
  <div class="line covered" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if v1[k] == nil then</div>
  </div>
  <div class="line covered" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      table.insert(differences, &quot;Missing key: &quot; .. stringify(k, 0, visited) .. &quot; (expected &quot; .. stringify(v, 0, visited) .. &quot;)&quot;)</div>
  </div>
  <div class="line covered" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    elseif not M.eq(v1[k], v, 0) then</div>
  </div>
  <div class="line covered" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      table.insert(</div>
  </div>
  <div class="line covered" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        differences,</div>
  </div>
  <div class="line not-covered" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Different value for key &quot;</div>
  </div>
  <div class="line not-covered" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          .. stringify(k, 0, visited)</div>
  </div>
  <div class="line not-covered" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          .. &quot;:\n  Expected: &quot;</div>
  </div>
  <div class="line not-covered" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          .. stringify(v, 0, visited)</div>
  </div>
  <div class="line not-covered" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          .. &quot;\n  Got:      &quot;</div>
  </div>
  <div class="line not-covered" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          .. stringify(v1[k], 0, visited)</div>
  </div>
  <div class="line not-covered" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      )</div>
  </div>
  <div class="line not-covered" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check for extra keys in v1</div>
  </div>
  <div class="line not-covered" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for k, v in pairs(v1) do</div>
  </div>
  <div class="line not-covered" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if v2[k] == nil then</div>
  </div>
  <div class="line not-covered" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      table.insert(differences, &quot;Extra key: &quot; .. stringify(k, 0, visited) .. &quot; = &quot; .. stringify(v, 0, visited))</div>
  </div>
  <div class="line not-covered" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if #differences == 0 then</div>
  </div>
  <div class="line not-covered" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return &quot;Values appear equal but are not identical (may be due to metatable differences)&quot;</div>
  </div>
  <div class="line not-covered" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return &quot;Differences:\n  &quot; .. table.concat(differences, &quot;\n  &quot;)</div>
  </div>
  <div class="line not-covered" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Deep equality check function with cycle detection</div>
  </div>
  <div class="line not-executable" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param t1 any First value to compare</div>
  </div>
  <div class="line not-executable" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param t2 any Second value to compare</div>
  </div>
  <div class="line not-executable" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param eps? number Epsilon for floating point comparison (default 0)</div>
  </div>
  <div class="line not-executable" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param visited? table Table to track visited objects for cycle detection</div>
  </div>
  <div class="line not-executable" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean True if the values are considered equal</div>
  </div>
  <div class="line not-covered" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.eq(t1, t2, eps, visited)</div>
  </div>
  <div class="line not-executable" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Initialize visited tables on first call</div>
  </div>
  <div class="line not-covered" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  visited = visited or {}</div>
  </div>
  <div class="line not-executable" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Direct reference equality check for identical tables</div>
  </div>
  <div class="line not-covered" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if t1 == t2 then</div>
  </div>
  <div class="line not-covered" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a unique key for this comparison pair to detect cycles</div>
  </div>
  <div class="line not-covered" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local pair_key</div>
  </div>
  <div class="line not-covered" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(t1) == &quot;table&quot; and type(t2) == &quot;table&quot; then</div>
  </div>
  <div class="line not-executable" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Create a string that uniquely identifies this pair</div>
  </div>
  <div class="line not-covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    pair_key = tostring(t1) .. &quot;:&quot; .. tostring(t2)</div>
  </div>
  <div class="line not-executable" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If we've seen this pair before, we're in a cycle</div>
  </div>
  <div class="line not-covered" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if visited[pair_key] then</div>
  </div>
  <div class="line not-covered" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return true -- Assume equality for cyclic structures</div>
  </div>
  <div class="line not-covered" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Mark this pair as visited</div>
  </div>
  <div class="line not-covered" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    visited[pair_key] = true</div>
  </div>
  <div class="line not-covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Special case for strings and numbers</div>
  </div>
  <div class="line not-covered" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if (type(t1) == &quot;string&quot; and type(t2) == &quot;number&quot;) or (type(t1) == &quot;number&quot; and type(t2) == &quot;string&quot;) then</div>
  </div>
  <div class="line not-executable" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try string comparison</div>
  </div>
  <div class="line covered" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if tostring(t1) == tostring(t2) then</div>
  </div>
  <div class="line covered" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count">4</div>    <div class="line-content">      return true</div>
  </div>
  <div class="line covered" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try number comparison if possible</div>
  </div>
  <div class="line covered" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    local n1 = type(t1) == &quot;string&quot; and tonumber(t1) or t1</div>
  </div>
  <div class="line covered" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count">4</div>    <div class="line-content">    local n2 = type(t2) == &quot;string&quot; and tonumber(t2) or t2</div>
  </div>
  <div class="line covered" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if type(n1) == &quot;number&quot; and type(n2) == &quot;number&quot; then</div>
  </div>
  <div class="line covered" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local ok, result = pcall(function()</div>
  </div>
  <div class="line covered" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        return math.abs(n1 - n2) &lt;= (eps or 0)</div>
  </div>
  <div class="line covered" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end)</div>
  </div>
  <div class="line covered" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if ok then</div>
  </div>
  <div class="line covered" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        return result</div>
  </div>
  <div class="line covered" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If types are different, return false</div>
  </div>
  <div class="line covered" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if type(t1) ~= type(t2) then</div>
  </div>
  <div class="line covered" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- For numbers, do epsilon comparison</div>
  </div>
  <div class="line covered" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if type(t1) == &quot;number&quot; then</div>
  </div>
  <div class="line covered" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local ok, result = pcall(function()</div>
  </div>
  <div class="line covered" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return math.abs(t1 - t2) &lt;= (eps or 0)</div>
  </div>
  <div class="line covered" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If comparison failed (e.g., NaN), fall back to direct equality</div>
  </div>
  <div class="line covered" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if not ok then</div>
  </div>
  <div class="line covered" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return t1 == t2</div>
  </div>
  <div class="line covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line covered" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- For non-tables, simple equality</div>
  </div>
  <div class="line covered" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if type(t1) ~= &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return t1 == t2</div>
  </div>
  <div class="line covered" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- For tables, recursive equality check</div>
  </div>
  <div class="line covered" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for k, v in pairs(t1) do</div>
  </div>
  <div class="line covered" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if not M.eq(v, t2[k], eps, visited) then</div>
  </div>
  <div class="line covered" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line covered" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count"></div>    <div class="line-content">  ---@diagnostic disable-next-line: unused-local</div>
  </div>
  <div class="line covered" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  for k, v in pairs(t2) do</div>
  </div>
  <div class="line covered" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if t1[k] == nil then</div>
  </div>
  <div class="line covered" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line covered" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line covered" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Type checking function that checks if a value is of a specific type</div>
  </div>
  <div class="line not-executable" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param v any The value to check</div>
  </div>
  <div class="line not-executable" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param x string|table The type string or metatable to check against</div>
  </div>
  <div class="line not-executable" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean, string, string success, success_message, failure_message</div>
  </div>
  <div class="line covered" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.isa(v, x)</div>
  </div>
  <div class="line covered" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if type(x) == &quot;string&quot; then</div>
  </div>
  <div class="line covered" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return type(v) == x,</div>
  </div>
  <div class="line covered" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be a &quot; .. x,</div>
  </div>
  <div class="line covered" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be a &quot; .. x</div>
  </div>
  <div class="line covered" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  elseif type(x) == &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if type(v) ~= &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return false,</div>
  </div>
  <div class="line covered" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be a &quot; .. tostring(x),</div>
  </div>
  <div class="line covered" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be a &quot; .. tostring(x)</div>
  </div>
  <div class="line covered" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local seen = {}</div>
  </div>
  <div class="line covered" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local meta = v</div>
  </div>
  <div class="line covered" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    while meta and not seen[meta] do</div>
  </div>
  <div class="line covered" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if meta == x then</div>
  </div>
  <div class="line covered" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line covered" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      seen[meta] = true</div>
  </div>
  <div class="line covered" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      meta = getmetatable(meta) and getmetatable(meta).__index</div>
  </div>
  <div class="line covered" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false,</div>
  </div>
  <div class="line covered" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be a &quot; .. tostring(x),</div>
  </div>
  <div class="line covered" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be a &quot; .. tostring(x)</div>
  </div>
  <div class="line covered" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  error(&quot;invalid type &quot; .. tostring(x))</div>
  </div>
  <div class="line covered" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- ==========================================</div>
  </div>
  <div class="line not-executable" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Assertion Path Definitions</div>
  </div>
  <div class="line not-executable" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- ==========================================</div>
  </div>
  <div class="line not-executable" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Define all the assertion paths</div>
  </div>
  <div class="line not-executable" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- These form the chain of methods that can be called on the expect() assertion object</div>
  </div>
  <div class="line not-executable" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @type table&lt;string, table|function&gt; Table of assertion paths and their test functions</div>
  </div>
  <div class="line covered" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local paths = {</div>
  </div>
  <div class="line not-covered" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [&quot;&quot;] = { &quot;to&quot;, &quot;to_not&quot; },</div>
  </div>
  <div class="line not-covered" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  to = {</div>
  </div>
  <div class="line not-covered" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;have&quot;,</div>
  </div>
  <div class="line not-covered" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;equal&quot;,</div>
  </div>
  <div class="line not-covered" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be&quot;,</div>
  </div>
  <div class="line not-covered" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;exist&quot;,</div>
  </div>
  <div class="line not-covered" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;fail&quot;,</div>
  </div>
  <div class="line not-covered" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;match&quot;,</div>
  </div>
  <div class="line not-covered" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;contain&quot;,</div>
  </div>
  <div class="line not-covered" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;start_with&quot;,</div>
  </div>
  <div class="line not-covered" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;end_with&quot;,</div>
  </div>
  <div class="line not-covered" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_type&quot;,</div>
  </div>
  <div class="line not-covered" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_greater_than&quot;,</div>
  </div>
  <div class="line not-covered" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_less_than&quot;,</div>
  </div>
  <div class="line not-covered" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_between&quot;,</div>
  </div>
  <div class="line not-covered" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_approximately&quot;,</div>
  </div>
  <div class="line not-covered" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;throw&quot;,</div>
  </div>
  <div class="line not-covered" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;satisfy&quot;,</div>
  </div>
  <div class="line not-covered" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;implement_interface&quot;,</div>
  </div>
  <div class="line not-covered" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_truthy&quot;,</div>
  </div>
  <div class="line not-covered" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_falsy&quot;,</div>
  </div>
  <div class="line not-covered" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_falsey&quot;,</div>
  </div>
  <div class="line not-covered" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;is_exact_type&quot;,</div>
  </div>
  <div class="line not-covered" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;is_instance_of&quot;,</div>
  </div>
  <div class="line not-covered" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;implements&quot;,</div>
  </div>
  <div class="line not-covered" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;have_length&quot;,</div>
  </div>
  <div class="line not-covered" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;have_size&quot;,</div>
  </div>
  <div class="line not-covered" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;have_property&quot;,</div>
  </div>
  <div class="line not-covered" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;match_schema&quot;,</div>
  </div>
  <div class="line not-covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;change&quot;,</div>
  </div>
  <div class="line not-covered" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;increase&quot;,</div>
  </div>
  <div class="line not-covered" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;decrease&quot;,</div>
  </div>
  <div class="line not-covered" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;deep_equal&quot;,</div>
  </div>
  <div class="line not-covered" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;match_regex&quot;,</div>
  </div>
  <div class="line not-covered" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_date&quot;,</div>
  </div>
  <div class="line not-covered" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_iso_date&quot;,</div>
  </div>
  <div class="line not-covered" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_before&quot;,</div>
  </div>
  <div class="line not-covered" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_after&quot;,</div>
  </div>
  <div class="line not-covered" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_same_day_as&quot;,</div>
  </div>
  <div class="line not-covered" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;complete&quot;,</div>
  </div>
  <div class="line not-covered" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;complete_within&quot;,</div>
  </div>
  <div class="line not-covered" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;resolve_with&quot;,</div>
  </div>
  <div class="line not-covered" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;reject&quot;,</div>
  </div>
  <div class="line not-covered" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  to_not = {</div>
  </div>
  <div class="line not-covered" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;have&quot;,</div>
  </div>
  <div class="line not-covered" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;equal&quot;,</div>
  </div>
  <div class="line not-covered" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be&quot;,</div>
  </div>
  <div class="line not-covered" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;exist&quot;,</div>
  </div>
  <div class="line not-covered" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;fail&quot;,</div>
  </div>
  <div class="line not-covered" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;match&quot;,</div>
  </div>
  <div class="line not-covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;contain&quot;,</div>
  </div>
  <div class="line not-covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;start_with&quot;,</div>
  </div>
  <div class="line not-covered" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;end_with&quot;,</div>
  </div>
  <div class="line not-covered" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_type&quot;,</div>
  </div>
  <div class="line not-covered" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_greater_than&quot;,</div>
  </div>
  <div class="line not-covered" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_less_than&quot;,</div>
  </div>
  <div class="line not-covered" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_between&quot;,</div>
  </div>
  <div class="line not-covered" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_approximately&quot;,</div>
  </div>
  <div class="line not-covered" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;throw&quot;,</div>
  </div>
  <div class="line not-covered" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;satisfy&quot;,</div>
  </div>
  <div class="line not-covered" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;implement_interface&quot;,</div>
  </div>
  <div class="line not-covered" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_truthy&quot;,</div>
  </div>
  <div class="line not-covered" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_falsy&quot;,</div>
  </div>
  <div class="line not-covered" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_falsey&quot;,</div>
  </div>
  <div class="line not-covered" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;is_exact_type&quot;,</div>
  </div>
  <div class="line not-covered" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;is_instance_of&quot;,</div>
  </div>
  <div class="line not-covered" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;implements&quot;,</div>
  </div>
  <div class="line not-covered" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;have_length&quot;,</div>
  </div>
  <div class="line not-covered" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;have_size&quot;,</div>
  </div>
  <div class="line not-covered" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;have_property&quot;,</div>
  </div>
  <div class="line not-covered" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;match_schema&quot;,</div>
  </div>
  <div class="line not-covered" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;change&quot;,</div>
  </div>
  <div class="line not-covered" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;increase&quot;,</div>
  </div>
  <div class="line not-covered" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;decrease&quot;,</div>
  </div>
  <div class="line not-covered" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;deep_equal&quot;,</div>
  </div>
  <div class="line not-covered" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;match_regex&quot;,</div>
  </div>
  <div class="line not-covered" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_date&quot;,</div>
  </div>
  <div class="line not-covered" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_iso_date&quot;,</div>
  </div>
  <div class="line not-covered" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_before&quot;,</div>
  </div>
  <div class="line not-covered" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_after&quot;,</div>
  </div>
  <div class="line not-covered" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;be_same_day_as&quot;,</div>
  </div>
  <div class="line not-covered" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;complete&quot;,</div>
  </div>
  <div class="line not-covered" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;complete_within&quot;,</div>
  </div>
  <div class="line not-covered" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;resolve_with&quot;,</div>
  </div>
  <div class="line not-covered" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;reject&quot;,</div>
  </div>
  <div class="line not-covered" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    chain = function(a)</div>
  </div>
  <div class="line not-covered" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      a.negate = not a.negate</div>
  </div>
  <div class="line not-covered" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  a = { test = M.isa },</div>
  </div>
  <div class="line not-covered" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  an = { test = M.isa },</div>
  </div>
  <div class="line not-covered" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  falsey = {</div>
  </div>
  <div class="line not-covered" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v)</div>
  </div>
  <div class="line not-covered" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return not v, &quot;expected &quot; .. tostring(v) .. &quot; to be falsey&quot;, &quot;expected &quot; .. tostring(v) .. &quot; to not be falsey&quot;</div>
  </div>
  <div class="line not-covered" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  be = {</div>
  </div>
  <div class="line not-covered" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;a&quot;,</div>
  </div>
  <div class="line not-covered" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;an&quot;,</div>
  </div>
  <div class="line not-covered" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;truthy&quot;,</div>
  </div>
  <div class="line not-covered" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;falsy&quot;,</div>
  </div>
  <div class="line not-covered" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;falsey&quot;,</div>
  </div>
  <div class="line not-covered" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;nil&quot;,</div>
  </div>
  <div class="line not-covered" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;type&quot;,</div>
  </div>
  <div class="line not-covered" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;at_least&quot;,</div>
  </div>
  <div class="line not-covered" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;greater_than&quot;,</div>
  </div>
  <div class="line not-covered" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;less_than&quot;,</div>
  </div>
  <div class="line not-covered" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;empty&quot;,</div>
  </div>
  <div class="line not-covered" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;positive&quot;,</div>
  </div>
  <div class="line not-covered" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;negative&quot;,</div>
  </div>
  <div class="line not-covered" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;integer&quot;,</div>
  </div>
  <div class="line not-covered" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;uppercase&quot;,</div>
  </div>
  <div class="line not-covered" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;lowercase&quot;,</div>
  </div>
  <div class="line not-covered" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return v == x,</div>
  </div>
  <div class="line not-covered" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; and &quot; .. tostring(x) .. &quot; to be the same&quot;,</div>
  </div>
  <div class="line not-covered" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; and &quot; .. tostring(x) .. &quot; to not be the same&quot;</div>
  </div>
  <div class="line not-covered" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  at_least = {</div>
  </div>
  <div class="line not-covered" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) ~= &quot;number&quot; or type(x) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected both values to be numbers for at_least comparison&quot;)</div>
  </div>
  <div class="line not-covered" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return v &gt;= x,</div>
  </div>
  <div class="line not-covered" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be at least &quot; .. tostring(x),</div>
  </div>
  <div class="line not-covered" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be at least &quot; .. tostring(x)</div>
  </div>
  <div class="line not-covered" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  greater_than = {</div>
  </div>
  <div class="line not-covered" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) ~= &quot;number&quot; or type(x) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected both values to be numbers for greater_than comparison&quot;)</div>
  </div>
  <div class="line not-covered" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return v &gt; x,</div>
  </div>
  <div class="line not-covered" id="L478">
    <div class="line-number"><a href="#L478">478</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be greater than &quot; .. tostring(x),</div>
  </div>
  <div class="line not-covered" id="L479">
    <div class="line-number"><a href="#L479">479</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be greater than &quot; .. tostring(x)</div>
  </div>
  <div class="line not-covered" id="L480">
    <div class="line-number"><a href="#L480">480</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L481">
    <div class="line-number"><a href="#L481">481</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L482">
    <div class="line-number"><a href="#L482">482</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  less_than = {</div>
  </div>
  <div class="line not-covered" id="L483">
    <div class="line-number"><a href="#L483">483</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L484">
    <div class="line-number"><a href="#L484">484</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) ~= &quot;number&quot; or type(x) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L485">
    <div class="line-number"><a href="#L485">485</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected both values to be numbers for less_than comparison&quot;)</div>
  </div>
  <div class="line not-covered" id="L486">
    <div class="line-number"><a href="#L486">486</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L487">
    <div class="line-number"><a href="#L487">487</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return v &lt; x,</div>
  </div>
  <div class="line not-covered" id="L488">
    <div class="line-number"><a href="#L488">488</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be less than &quot; .. tostring(x),</div>
  </div>
  <div class="line not-covered" id="L489">
    <div class="line-number"><a href="#L489">489</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be less than &quot; .. tostring(x)</div>
  </div>
  <div class="line not-covered" id="L490">
    <div class="line-number"><a href="#L490">490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L491">
    <div class="line-number"><a href="#L491">491</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L492">
    <div class="line-number"><a href="#L492">492</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Test if a value exists (is not nil)</div>
  </div>
  <div class="line not-covered" id="L493">
    <div class="line-number"><a href="#L493">493</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  exist = {</div>
  </div>
  <div class="line not-executable" id="L494">
    <div class="line-number"><a href="#L494">494</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @param v any The value to check for existence</div>
  </div>
  <div class="line not-executable" id="L495">
    <div class="line-number"><a href="#L495">495</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @return boolean, string, string result, success_message, failure_message</div>
  </div>
  <div class="line not-covered" id="L496">
    <div class="line-number"><a href="#L496">496</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v)</div>
  </div>
  <div class="line not-covered" id="L497">
    <div class="line-number"><a href="#L497">497</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return v ~= nil, &quot;expected &quot; .. tostring(v) .. &quot; to exist&quot;, &quot;expected &quot; .. tostring(v) .. &quot; to not exist&quot;</div>
  </div>
  <div class="line not-covered" id="L498">
    <div class="line-number"><a href="#L498">498</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L499">
    <div class="line-number"><a href="#L499">499</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L500">
    <div class="line-number"><a href="#L500">500</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L501">
    <div class="line-number"><a href="#L501">501</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Test if a value is truthy</div>
  </div>
  <div class="line not-covered" id="L502">
    <div class="line-number"><a href="#L502">502</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  truthy = {</div>
  </div>
  <div class="line not-executable" id="L503">
    <div class="line-number"><a href="#L503">503</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @param v any The value to check if truthy</div>
  </div>
  <div class="line not-executable" id="L504">
    <div class="line-number"><a href="#L504">504</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @return boolean, string, string result, success_message, failure_message</div>
  </div>
  <div class="line not-covered" id="L505">
    <div class="line-number"><a href="#L505">505</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v)</div>
  </div>
  <div class="line not-covered" id="L506">
    <div class="line-number"><a href="#L506">506</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return v and true or false,</div>
  </div>
  <div class="line not-covered" id="L507">
    <div class="line-number"><a href="#L507">507</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be truthy&quot;,</div>
  </div>
  <div class="line not-covered" id="L508">
    <div class="line-number"><a href="#L508">508</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be truthy&quot;</div>
  </div>
  <div class="line not-covered" id="L509">
    <div class="line-number"><a href="#L509">509</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L510">
    <div class="line-number"><a href="#L510">510</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L511">
    <div class="line-number"><a href="#L511">511</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L512">
    <div class="line-number"><a href="#L512">512</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Test if a value is falsy</div>
  </div>
  <div class="line not-covered" id="L513">
    <div class="line-number"><a href="#L513">513</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  falsy = {</div>
  </div>
  <div class="line not-executable" id="L514">
    <div class="line-number"><a href="#L514">514</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @param v any The value to check if falsy</div>
  </div>
  <div class="line not-executable" id="L515">
    <div class="line-number"><a href="#L515">515</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @return boolean, string, string result, success_message, failure_message</div>
  </div>
  <div class="line not-covered" id="L516">
    <div class="line-number"><a href="#L516">516</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v)</div>
  </div>
  <div class="line not-covered" id="L517">
    <div class="line-number"><a href="#L517">517</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return not v and true or false,</div>
  </div>
  <div class="line not-covered" id="L518">
    <div class="line-number"><a href="#L518">518</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be falsy&quot;,</div>
  </div>
  <div class="line not-covered" id="L519">
    <div class="line-number"><a href="#L519">519</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be falsy&quot;</div>
  </div>
  <div class="line not-covered" id="L520">
    <div class="line-number"><a href="#L520">520</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L521">
    <div class="line-number"><a href="#L521">521</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L522">
    <div class="line-number"><a href="#L522">522</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L523">
    <div class="line-number"><a href="#L523">523</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Test if a value is nil</div>
  </div>
  <div class="line not-covered" id="L524">
    <div class="line-number"><a href="#L524">524</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [&quot;nil&quot;] = {</div>
  </div>
  <div class="line not-executable" id="L525">
    <div class="line-number"><a href="#L525">525</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @param v any The value to check if nil</div>
  </div>
  <div class="line not-executable" id="L526">
    <div class="line-number"><a href="#L526">526</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @return boolean, string, string result, success_message, failure_message</div>
  </div>
  <div class="line not-covered" id="L527">
    <div class="line-number"><a href="#L527">527</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v)</div>
  </div>
  <div class="line not-covered" id="L528">
    <div class="line-number"><a href="#L528">528</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return v == nil, &quot;expected &quot; .. tostring(v) .. &quot; to be nil&quot;, &quot;expected &quot; .. tostring(v) .. &quot; to not be nil&quot;</div>
  </div>
  <div class="line not-covered" id="L529">
    <div class="line-number"><a href="#L529">529</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L530">
    <div class="line-number"><a href="#L530">530</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L531">
    <div class="line-number"><a href="#L531">531</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L532">
    <div class="line-number"><a href="#L532">532</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Test if a value is of a specific type</div>
  </div>
  <div class="line not-covered" id="L533">
    <div class="line-number"><a href="#L533">533</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  type = {</div>
  </div>
  <div class="line not-executable" id="L534">
    <div class="line-number"><a href="#L534">534</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @param v any The value to check the type of</div>
  </div>
  <div class="line not-executable" id="L535">
    <div class="line-number"><a href="#L535">535</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @param expected_type string The expected type string</div>
  </div>
  <div class="line not-executable" id="L536">
    <div class="line-number"><a href="#L536">536</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @return boolean, string, string result, success_message, failure_message</div>
  </div>
  <div class="line not-covered" id="L537">
    <div class="line-number"><a href="#L537">537</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, expected_type)</div>
  </div>
  <div class="line not-covered" id="L538">
    <div class="line-number"><a href="#L538">538</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return type(v) == expected_type,</div>
  </div>
  <div class="line not-covered" id="L539">
    <div class="line-number"><a href="#L539">539</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be of type &quot; .. expected_type .. &quot;, got &quot; .. type(v),</div>
  </div>
  <div class="line not-covered" id="L540">
    <div class="line-number"><a href="#L540">540</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be of type &quot; .. expected_type</div>
  </div>
  <div class="line not-covered" id="L541">
    <div class="line-number"><a href="#L541">541</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line covered" id="L542">
    <div class="line-number"><a href="#L542">542</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L543">
    <div class="line-number"><a href="#L543">543</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Test if two values are equal using deep equality comparison</div>
  </div>
  <div class="line covered" id="L544">
    <div class="line-number"><a href="#L544">544</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  equal = {</div>
  </div>
  <div class="line not-executable" id="L545">
    <div class="line-number"><a href="#L545">545</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @param v any The actual value to check</div>
  </div>
  <div class="line not-executable" id="L546">
    <div class="line-number"><a href="#L546">546</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @param x any The expected value to compare against</div>
  </div>
  <div class="line not-executable" id="L547">
    <div class="line-number"><a href="#L547">547</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @param eps? number Optional epsilon for floating-point comparisons</div>
  </div>
  <div class="line not-executable" id="L548">
    <div class="line-number"><a href="#L548">548</a></div>
    <div class="execution-count"></div>    <div class="line-content">    --- @return boolean, string, string result, success_message, failure_message</div>
  </div>
  <div class="line not-covered" id="L549">
    <div class="line-number"><a href="#L549">549</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, x, eps)</div>
  </div>
  <div class="line not-covered" id="L550">
    <div class="line-number"><a href="#L550">550</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local equal = M.eq(v, x, eps)</div>
  </div>
  <div class="line not-covered" id="L551">
    <div class="line-number"><a href="#L551">551</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local comparison = &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L552">
    <div class="line-number"><a href="#L552">552</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not equal then</div>
  </div>
  <div class="line not-covered" id="L553">
    <div class="line-number"><a href="#L553">553</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if type(v) == &quot;table&quot; or type(x) == &quot;table&quot; then</div>
  </div>
  <div class="line not-executable" id="L554">
    <div class="line-number"><a href="#L554">554</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- For tables, generate a detailed diff</div>
  </div>
  <div class="line not-covered" id="L555">
    <div class="line-number"><a href="#L555">555</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          comparison = &quot;\n&quot; .. diff_values(v, x)</div>
  </div>
  <div class="line not-covered" id="L556">
    <div class="line-number"><a href="#L556">556</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L557">
    <div class="line-number"><a href="#L557">557</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- For primitive types, show a simple comparison</div>
  </div>
  <div class="line not-covered" id="L558">
    <div class="line-number"><a href="#L558">558</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          comparison = &quot;\n&quot; .. &quot;Expected: &quot; .. stringify(x) .. &quot;\n&quot; .. &quot;Got:      &quot; .. stringify(v)</div>
  </div>
  <div class="line not-covered" id="L559">
    <div class="line-number"><a href="#L559">559</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L560">
    <div class="line-number"><a href="#L560">560</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L561">
    <div class="line-number"><a href="#L561">561</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return equal,</div>
  </div>
  <div class="line not-covered" id="L562">
    <div class="line-number"><a href="#L562">562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Values are not equal: &quot; .. comparison,</div>
  </div>
  <div class="line not-covered" id="L563">
    <div class="line-number"><a href="#L563">563</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. stringify(v) .. &quot; and &quot; .. stringify(x) .. &quot; to not be equal&quot;</div>
  </div>
  <div class="line not-covered" id="L564">
    <div class="line-number"><a href="#L564">564</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L565">
    <div class="line-number"><a href="#L565">565</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L566">
    <div class="line-number"><a href="#L566">566</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  have = {</div>
  </div>
  <div class="line not-covered" id="L567">
    <div class="line-number"><a href="#L567">567</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L568">
    <div class="line-number"><a href="#L568">568</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L569">
    <div class="line-number"><a href="#L569">569</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected &quot; .. stringify(v) .. &quot; to be a table&quot;)</div>
  </div>
  <div class="line not-covered" id="L570">
    <div class="line-number"><a href="#L570">570</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L571">
    <div class="line-number"><a href="#L571">571</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Create a formatted table representation for better error messages</div>
  </div>
  <div class="line not-covered" id="L572">
    <div class="line-number"><a href="#L572">572</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local table_str = stringify(v)</div>
  </div>
  <div class="line not-covered" id="L573">
    <div class="line-number"><a href="#L573">573</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local content_preview = #table_str &gt; 70 and table_str:sub(1, 67) .. &quot;...&quot; or table_str</div>
  </div>
  <div class="line not-covered" id="L574">
    <div class="line-number"><a href="#L574">574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return has(v, x),</div>
  </div>
  <div class="line not-covered" id="L575">
    <div class="line-number"><a href="#L575">575</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected table to contain &quot; .. stringify(x) .. &quot;\nTable contents: &quot; .. content_preview,</div>
  </div>
  <div class="line not-covered" id="L576">
    <div class="line-number"><a href="#L576">576</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected table not to contain &quot; .. stringify(x) .. &quot; but it was found\nTable contents: &quot; .. content_preview</div>
  </div>
  <div class="line not-covered" id="L577">
    <div class="line-number"><a href="#L577">577</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L578">
    <div class="line-number"><a href="#L578">578</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L579">
    <div class="line-number"><a href="#L579">579</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  fail = {</div>
  </div>
  <div class="line not-covered" id="L580">
    <div class="line-number"><a href="#L580">580</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;with&quot;,</div>
  </div>
  <div class="line not-covered" id="L581">
    <div class="line-number"><a href="#L581">581</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v)</div>
  </div>
  <div class="line not-covered" id="L582">
    <div class="line-number"><a href="#L582">582</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return not pcall(v), &quot;expected &quot; .. tostring(v) .. &quot; to fail&quot;, &quot;expected &quot; .. tostring(v) .. &quot; to not fail&quot;</div>
  </div>
  <div class="line not-covered" id="L583">
    <div class="line-number"><a href="#L583">583</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L584">
    <div class="line-number"><a href="#L584">584</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L585">
    <div class="line-number"><a href="#L585">585</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  with = {</div>
  </div>
  <div class="line not-covered" id="L586">
    <div class="line-number"><a href="#L586">586</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, pattern)</div>
  </div>
  <div class="line not-covered" id="L587">
    <div class="line-number"><a href="#L587">587</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local ok, message = pcall(v)</div>
  </div>
  <div class="line not-covered" id="L588">
    <div class="line-number"><a href="#L588">588</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return not ok and message:match(pattern),</div>
  </div>
  <div class="line not-covered" id="L589">
    <div class="line-number"><a href="#L589">589</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. ' to fail with error matching &quot;' .. pattern .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L590">
    <div class="line-number"><a href="#L590">590</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. ' to not fail with error matching &quot;' .. pattern .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L591">
    <div class="line-number"><a href="#L591">591</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L592">
    <div class="line-number"><a href="#L592">592</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-covered" id="L593">
    <div class="line-number"><a href="#L593">593</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  match = {</div>
  </div>
  <div class="line not-covered" id="L594">
    <div class="line-number"><a href="#L594">594</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, p)</div>
  </div>
  <div class="line covered" id="L595">
    <div class="line-number"><a href="#L595">595</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if type(v) ~= &quot;string&quot; then</div>
  </div>
  <div class="line covered" id="L596">
    <div class="line-number"><a href="#L596">596</a></div>
    <div class="execution-count">4</div>    <div class="line-content">        v = tostring(v)</div>
  </div>
  <div class="line covered" id="L597">
    <div class="line-number"><a href="#L597">597</a></div>
    <div class="execution-count">4</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L598">
    <div class="line-number"><a href="#L598">598</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local result = string.find(v, p) ~= nil</div>
  </div>
  <div class="line covered" id="L599">
    <div class="line-number"><a href="#L599">599</a></div>
    <div class="execution-count">4</div>    <div class="line-content">      return result,</div>
  </div>
  <div class="line covered" id="L600">
    <div class="line-number"><a href="#L600">600</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; to match pattern &quot;' .. p .. '&quot;',</div>
  </div>
  <div class="line covered" id="L601">
    <div class="line-number"><a href="#L601">601</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; to not match pattern &quot;' .. p .. '&quot;'</div>
  </div>
  <div class="line covered" id="L602">
    <div class="line-number"><a href="#L602">602</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line covered" id="L603">
    <div class="line-number"><a href="#L603">603</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L604">
    <div class="line-number"><a href="#L604">604</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Interface implementation checking</div>
  </div>
  <div class="line covered" id="L605">
    <div class="line-number"><a href="#L605">605</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  implement_interface = {</div>
  </div>
  <div class="line covered" id="L606">
    <div class="line-number"><a href="#L606">606</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    test = function(v, interface)</div>
  </div>
  <div class="line covered" id="L607">
    <div class="line-number"><a href="#L607">607</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if type(v) ~= &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L608">
    <div class="line-number"><a href="#L608">608</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        return false, &quot;expected &quot; .. tostring(v) .. &quot; to be a table&quot;, nil</div>
  </div>
  <div class="line covered" id="L609">
    <div class="line-number"><a href="#L609">609</a></div>
    <div class="execution-count">4</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L610">
    <div class="line-number"><a href="#L610">610</a></div>
    <div class="execution-count">4</div>    <div class="line-content">      if type(interface) ~= &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L611">
    <div class="line-number"><a href="#L611">611</a></div>
    <div class="execution-count">4</div>    <div class="line-content">        return false, &quot;expected interface to be a table&quot;, nil</div>
  </div>
  <div class="line covered" id="L612">
    <div class="line-number"><a href="#L612">612</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L613">
    <div class="line-number"><a href="#L613">613</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local missing_keys = {}</div>
  </div>
  <div class="line not-covered" id="L614">
    <div class="line-number"><a href="#L614">614</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local wrong_types = {}</div>
  </div>
  <div class="line not-covered" id="L615">
    <div class="line-number"><a href="#L615">615</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for key, expected in pairs(interface) do</div>
  </div>
  <div class="line not-covered" id="L616">
    <div class="line-number"><a href="#L616">616</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local actual = v[key]</div>
  </div>
  <div class="line not-covered" id="L617">
    <div class="line-number"><a href="#L617">617</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if actual == nil then</div>
  </div>
  <div class="line not-covered" id="L618">
    <div class="line-number"><a href="#L618">618</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          table.insert(missing_keys, key)</div>
  </div>
  <div class="line not-covered" id="L619">
    <div class="line-number"><a href="#L619">619</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif type(expected) == &quot;function&quot; and type(actual) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L620">
    <div class="line-number"><a href="#L620">620</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          table.insert(wrong_types, key .. &quot; (expected function, got &quot; .. type(actual) .. &quot;)&quot;)</div>
  </div>
  <div class="line not-covered" id="L621">
    <div class="line-number"><a href="#L621">621</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L622">
    <div class="line-number"><a href="#L622">622</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L623">
    <div class="line-number"><a href="#L623">623</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if #missing_keys &gt; 0 or #wrong_types &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L624">
    <div class="line-number"><a href="#L624">624</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local msg = &quot;expected object to implement interface, but: &quot;</div>
  </div>
  <div class="line not-covered" id="L625">
    <div class="line-number"><a href="#L625">625</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if #missing_keys &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L626">
    <div class="line-number"><a href="#L626">626</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          msg = msg .. &quot;missing: &quot; .. table.concat(missing_keys, &quot;, &quot;)</div>
  </div>
  <div class="line not-covered" id="L627">
    <div class="line-number"><a href="#L627">627</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L628">
    <div class="line-number"><a href="#L628">628</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if #wrong_types &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L629">
    <div class="line-number"><a href="#L629">629</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if #missing_keys &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L630">
    <div class="line-number"><a href="#L630">630</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            msg = msg .. &quot;; &quot;</div>
  </div>
  <div class="line not-covered" id="L631">
    <div class="line-number"><a href="#L631">631</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L632">
    <div class="line-number"><a href="#L632">632</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          msg = msg .. &quot;wrong types: &quot; .. table.concat(wrong_types, &quot;, &quot;)</div>
  </div>
  <div class="line not-covered" id="L633">
    <div class="line-number"><a href="#L633">633</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L634">
    <div class="line-number"><a href="#L634">634</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false, msg, &quot;expected object not to implement interface&quot;</div>
  </div>
  <div class="line not-covered" id="L635">
    <div class="line-number"><a href="#L635">635</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L636">
    <div class="line-number"><a href="#L636">636</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return true, &quot;expected object to implement interface&quot;, &quot;expected object not to implement interface&quot;</div>
  </div>
  <div class="line not-covered" id="L637">
    <div class="line-number"><a href="#L637">637</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L638">
    <div class="line-number"><a href="#L638">638</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L639">
    <div class="line-number"><a href="#L639">639</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Table inspection assertions</div>
  </div>
  <div class="line not-covered" id="L640">
    <div class="line-number"><a href="#L640">640</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  contain = {</div>
  </div>
  <div class="line not-covered" id="L641">
    <div class="line-number"><a href="#L641">641</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;keys&quot;,</div>
  </div>
  <div class="line not-covered" id="L642">
    <div class="line-number"><a href="#L642">642</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;values&quot;,</div>
  </div>
  <div class="line not-covered" id="L643">
    <div class="line-number"><a href="#L643">643</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;key&quot;,</div>
  </div>
  <div class="line not-covered" id="L644">
    <div class="line-number"><a href="#L644">644</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;value&quot;,</div>
  </div>
  <div class="line not-covered" id="L645">
    <div class="line-number"><a href="#L645">645</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;subset&quot;,</div>
  </div>
  <div class="line not-covered" id="L646">
    <div class="line-number"><a href="#L646">646</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    &quot;exactly&quot;,</div>
  </div>
  <div class="line not-covered" id="L647">
    <div class="line-number"><a href="#L647">647</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, x)</div>
  </div>
  <div class="line not-executable" id="L648">
    <div class="line-number"><a href="#L648">648</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Simple implementation first</div>
  </div>
  <div class="line not-covered" id="L649">
    <div class="line-number"><a href="#L649">649</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) == &quot;string&quot; then</div>
  </div>
  <div class="line not-executable" id="L650">
    <div class="line-number"><a href="#L650">650</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Handle string containment</div>
  </div>
  <div class="line not-covered" id="L651">
    <div class="line-number"><a href="#L651">651</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local x_str = tostring(x)</div>
  </div>
  <div class="line not-covered" id="L652">
    <div class="line-number"><a href="#L652">652</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return string.find(v, x_str, 1, true) ~= nil,</div>
  </div>
  <div class="line not-covered" id="L653">
    <div class="line-number"><a href="#L653">653</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected string &quot;' .. v .. '&quot; to contain &quot;' .. x_str .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L654">
    <div class="line-number"><a href="#L654">654</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected string &quot;' .. v .. '&quot; to not contain &quot;' .. x_str .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L655">
    <div class="line-number"><a href="#L655">655</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif type(v) == &quot;table&quot; then</div>
  </div>
  <div class="line not-executable" id="L656">
    <div class="line-number"><a href="#L656">656</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Handle table containment</div>
  </div>
  <div class="line not-covered" id="L657">
    <div class="line-number"><a href="#L657">657</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return has(v, x),</div>
  </div>
  <div class="line not-covered" id="L658">
    <div class="line-number"><a href="#L658">658</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. tostring(v) .. &quot; to contain &quot; .. tostring(x),</div>
  </div>
  <div class="line not-covered" id="L659">
    <div class="line-number"><a href="#L659">659</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. tostring(v) .. &quot; to not contain &quot; .. tostring(x)</div>
  </div>
  <div class="line not-covered" id="L660">
    <div class="line-number"><a href="#L660">660</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-executable" id="L661">
    <div class="line-number"><a href="#L661">661</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Error for unsupported types</div>
  </div>
  <div class="line not-covered" id="L662">
    <div class="line-number"><a href="#L662">662</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;cannot check containment in a &quot; .. type(v))</div>
  </div>
  <div class="line not-covered" id="L663">
    <div class="line-number"><a href="#L663">663</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L664">
    <div class="line-number"><a href="#L664">664</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L665">
    <div class="line-number"><a href="#L665">665</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L666">
    <div class="line-number"><a href="#L666">666</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L667">
    <div class="line-number"><a href="#L667">667</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Length assertion for strings and tables</div>
  </div>
  <div class="line not-covered" id="L668">
    <div class="line-number"><a href="#L668">668</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  have_length = {</div>
  </div>
  <div class="line not-covered" id="L669">
    <div class="line-number"><a href="#L669">669</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, expected_length)</div>
  </div>
  <div class="line not-covered" id="L670">
    <div class="line-number"><a href="#L670">670</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local length</div>
  </div>
  <div class="line not-covered" id="L671">
    <div class="line-number"><a href="#L671">671</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L672">
    <div class="line-number"><a href="#L672">672</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        length = string.len(v)</div>
  </div>
  <div class="line not-covered" id="L673">
    <div class="line-number"><a href="#L673">673</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif type(v) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L674">
    <div class="line-number"><a href="#L674">674</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        length = #v</div>
  </div>
  <div class="line not-covered" id="L675">
    <div class="line-number"><a href="#L675">675</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L676">
    <div class="line-number"><a href="#L676">676</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a string or table for length check, got &quot; .. type(v))</div>
  </div>
  <div class="line not-covered" id="L677">
    <div class="line-number"><a href="#L677">677</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L678">
    <div class="line-number"><a href="#L678">678</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L679">
    <div class="line-number"><a href="#L679">679</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return length == expected_length,</div>
  </div>
  <div class="line not-covered" id="L680">
    <div class="line-number"><a href="#L680">680</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. stringify(v) .. &quot; to have length &quot; .. tostring(expected_length) .. &quot;, got &quot; .. tostring(length),</div>
  </div>
  <div class="line not-covered" id="L681">
    <div class="line-number"><a href="#L681">681</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. stringify(v) .. &quot; to not have length &quot; .. tostring(expected_length)</div>
  </div>
  <div class="line not-covered" id="L682">
    <div class="line-number"><a href="#L682">682</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L683">
    <div class="line-number"><a href="#L683">683</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L684">
    <div class="line-number"><a href="#L684">684</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L685">
    <div class="line-number"><a href="#L685">685</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Alias for have_length</div>
  </div>
  <div class="line not-covered" id="L686">
    <div class="line-number"><a href="#L686">686</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  have_size = {</div>
  </div>
  <div class="line not-covered" id="L687">
    <div class="line-number"><a href="#L687">687</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, expected_size)</div>
  </div>
  <div class="line not-covered" id="L688">
    <div class="line-number"><a href="#L688">688</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local length</div>
  </div>
  <div class="line not-covered" id="L689">
    <div class="line-number"><a href="#L689">689</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L690">
    <div class="line-number"><a href="#L690">690</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        length = string.len(v)</div>
  </div>
  <div class="line not-covered" id="L691">
    <div class="line-number"><a href="#L691">691</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      elseif type(v) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L692">
    <div class="line-number"><a href="#L692">692</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        length = #v</div>
  </div>
  <div class="line not-covered" id="L693">
    <div class="line-number"><a href="#L693">693</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-covered" id="L694">
    <div class="line-number"><a href="#L694">694</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a string or table for size check, got &quot; .. type(v))</div>
  </div>
  <div class="line not-covered" id="L695">
    <div class="line-number"><a href="#L695">695</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L696">
    <div class="line-number"><a href="#L696">696</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L697">
    <div class="line-number"><a href="#L697">697</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return length == expected_size,</div>
  </div>
  <div class="line not-covered" id="L698">
    <div class="line-number"><a href="#L698">698</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. stringify(v) .. &quot; to have size &quot; .. tostring(expected_size) .. &quot;, got &quot; .. tostring(length),</div>
  </div>
  <div class="line not-covered" id="L699">
    <div class="line-number"><a href="#L699">699</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. stringify(v) .. &quot; to not have size &quot; .. tostring(expected_size)</div>
  </div>
  <div class="line not-covered" id="L700">
    <div class="line-number"><a href="#L700">700</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L701">
    <div class="line-number"><a href="#L701">701</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L702">
    <div class="line-number"><a href="#L702">702</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L703">
    <div class="line-number"><a href="#L703">703</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Property existence and value checking</div>
  </div>
  <div class="line not-covered" id="L704">
    <div class="line-number"><a href="#L704">704</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  have_property = {</div>
  </div>
  <div class="line not-covered" id="L705">
    <div class="line-number"><a href="#L705">705</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, property_name, expected_value)</div>
  </div>
  <div class="line not-covered" id="L706">
    <div class="line-number"><a href="#L706">706</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L707">
    <div class="line-number"><a href="#L707">707</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a table for property check, got &quot; .. type(v))</div>
  </div>
  <div class="line not-covered" id="L708">
    <div class="line-number"><a href="#L708">708</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L709">
    <div class="line-number"><a href="#L709">709</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L710">
    <div class="line-number"><a href="#L710">710</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local has_property = v[property_name] ~= nil</div>
  </div>
  <div class="line not-executable" id="L711">
    <div class="line-number"><a href="#L711">711</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L712">
    <div class="line-number"><a href="#L712">712</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If we're just checking for property existence</div>
  </div>
  <div class="line not-covered" id="L713">
    <div class="line-number"><a href="#L713">713</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if expected_value == nil then</div>
  </div>
  <div class="line not-covered" id="L714">
    <div class="line-number"><a href="#L714">714</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return has_property,</div>
  </div>
  <div class="line not-covered" id="L715">
    <div class="line-number"><a href="#L715">715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. stringify(v) .. &quot; to have property &quot; .. tostring(property_name),</div>
  </div>
  <div class="line not-covered" id="L716">
    <div class="line-number"><a href="#L716">716</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. stringify(v) .. &quot; to not have property &quot; .. tostring(property_name)</div>
  </div>
  <div class="line not-covered" id="L717">
    <div class="line-number"><a href="#L717">717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L718">
    <div class="line-number"><a href="#L718">718</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L719">
    <div class="line-number"><a href="#L719">719</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If we're checking for property value</div>
  </div>
  <div class="line not-covered" id="L720">
    <div class="line-number"><a href="#L720">720</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local property_matches = has_property and M.eq(v[property_name], expected_value)</div>
  </div>
  <div class="line not-executable" id="L721">
    <div class="line-number"><a href="#L721">721</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L722">
    <div class="line-number"><a href="#L722">722</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return property_matches,</div>
  </div>
  <div class="line not-covered" id="L723">
    <div class="line-number"><a href="#L723">723</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. stringify(v) .. &quot; to have property &quot; .. tostring(property_name) .. </div>
  </div>
  <div class="line not-covered" id="L724">
    <div class="line-number"><a href="#L724">724</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot; with value &quot; .. stringify(expected_value) .. &quot;, got &quot; .. </div>
  </div>
  <div class="line not-covered" id="L725">
    <div class="line-number"><a href="#L725">725</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        (has_property and stringify(v[property_name]) or &quot;undefined&quot;),</div>
  </div>
  <div class="line not-covered" id="L726">
    <div class="line-number"><a href="#L726">726</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. stringify(v) .. &quot; to not have property &quot; .. tostring(property_name) .. </div>
  </div>
  <div class="line not-covered" id="L727">
    <div class="line-number"><a href="#L727">727</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot; with value &quot; .. stringify(expected_value)</div>
  </div>
  <div class="line not-covered" id="L728">
    <div class="line-number"><a href="#L728">728</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L729">
    <div class="line-number"><a href="#L729">729</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L730">
    <div class="line-number"><a href="#L730">730</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L731">
    <div class="line-number"><a href="#L731">731</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Schema validation</div>
  </div>
  <div class="line not-covered" id="L732">
    <div class="line-number"><a href="#L732">732</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  match_schema = {</div>
  </div>
  <div class="line not-covered" id="L733">
    <div class="line-number"><a href="#L733">733</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, schema)</div>
  </div>
  <div class="line not-covered" id="L734">
    <div class="line-number"><a href="#L734">734</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L735">
    <div class="line-number"><a href="#L735">735</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a table for schema validation, got &quot; .. type(v))</div>
  </div>
  <div class="line not-covered" id="L736">
    <div class="line-number"><a href="#L736">736</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L737">
    <div class="line-number"><a href="#L737">737</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L738">
    <div class="line-number"><a href="#L738">738</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(schema) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L739">
    <div class="line-number"><a href="#L739">739</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a table schema, got &quot; .. type(schema))</div>
  </div>
  <div class="line not-covered" id="L740">
    <div class="line-number"><a href="#L740">740</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L741">
    <div class="line-number"><a href="#L741">741</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L742">
    <div class="line-number"><a href="#L742">742</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local missing_props = {}</div>
  </div>
  <div class="line not-covered" id="L743">
    <div class="line-number"><a href="#L743">743</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local type_mismatches = {}</div>
  </div>
  <div class="line not-covered" id="L744">
    <div class="line-number"><a href="#L744">744</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local value_mismatches = {}</div>
  </div>
  <div class="line not-executable" id="L745">
    <div class="line-number"><a href="#L745">745</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L746">
    <div class="line-number"><a href="#L746">746</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for prop_name, prop_def in pairs(schema) do</div>
  </div>
  <div class="line not-executable" id="L747">
    <div class="line-number"><a href="#L747">747</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Handle missing properties first</div>
  </div>
  <div class="line not-covered" id="L748">
    <div class="line-number"><a href="#L748">748</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if v[prop_name] == nil then</div>
  </div>
  <div class="line not-covered" id="L749">
    <div class="line-number"><a href="#L749">749</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          table.insert(missing_props, prop_name)</div>
  </div>
  <div class="line not-executable" id="L750">
    <div class="line-number"><a href="#L750">750</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Handle type check schema (e.g., {name = &quot;string&quot;})</div>
  </div>
  <div class="line not-covered" id="L751">
    <div class="line-number"><a href="#L751">751</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif type(prop_def) == &quot;string&quot; and prop_def:match(&quot;^[a-z]+$&quot;) and </div>
  </div>
  <div class="line not-covered" id="L752">
    <div class="line-number"><a href="#L752">752</a></div>
    <div class="execution-count">0</div>    <div class="line-content">               (prop_def == &quot;string&quot; or prop_def == &quot;number&quot; or prop_def == &quot;boolean&quot; or </div>
  </div>
  <div class="line not-covered" id="L753">
    <div class="line-number"><a href="#L753">753</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                prop_def == &quot;table&quot; or prop_def == &quot;function&quot; or prop_def == &quot;thread&quot; or </div>
  </div>
  <div class="line not-covered" id="L754">
    <div class="line-number"><a href="#L754">754</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                prop_def == &quot;userdata&quot; or prop_def == &quot;nil&quot;) then</div>
  </div>
  <div class="line not-covered" id="L755">
    <div class="line-number"><a href="#L755">755</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if type(v[prop_name]) ~= prop_def then</div>
  </div>
  <div class="line not-covered" id="L756">
    <div class="line-number"><a href="#L756">756</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(type_mismatches, prop_name .. &quot; (expected &quot; .. prop_def .. </div>
  </div>
  <div class="line not-covered" id="L757">
    <div class="line-number"><a href="#L757">757</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                         &quot;, got &quot; .. type(v[prop_name]) .. &quot;)&quot;)</div>
  </div>
  <div class="line not-covered" id="L758">
    <div class="line-number"><a href="#L758">758</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-executable" id="L759">
    <div class="line-number"><a href="#L759">759</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Handle exact value schema (e.g., {status = &quot;active&quot;})</div>
  </div>
  <div class="line not-covered" id="L760">
    <div class="line-number"><a href="#L760">760</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        elseif prop_def ~= nil then</div>
  </div>
  <div class="line not-covered" id="L761">
    <div class="line-number"><a href="#L761">761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if not M.eq(v[prop_name], prop_def) then</div>
  </div>
  <div class="line not-covered" id="L762">
    <div class="line-number"><a href="#L762">762</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            table.insert(value_mismatches, prop_name .. &quot; (expected &quot; .. </div>
  </div>
  <div class="line not-covered" id="L763">
    <div class="line-number"><a href="#L763">763</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                         stringify(prop_def) .. &quot;, got &quot; .. stringify(v[prop_name]) .. &quot;)&quot;)</div>
  </div>
  <div class="line not-covered" id="L764">
    <div class="line-number"><a href="#L764">764</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L765">
    <div class="line-number"><a href="#L765">765</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L766">
    <div class="line-number"><a href="#L766">766</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L767">
    <div class="line-number"><a href="#L767">767</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L768">
    <div class="line-number"><a href="#L768">768</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local valid = #missing_props == 0 and #type_mismatches == 0 and #value_mismatches == 0</div>
  </div>
  <div class="line not-executable" id="L769">
    <div class="line-number"><a href="#L769">769</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L770">
    <div class="line-number"><a href="#L770">770</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local error_msg = &quot;expected object to match schema, but:\n&quot;</div>
  </div>
  <div class="line not-covered" id="L771">
    <div class="line-number"><a href="#L771">771</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if #missing_props &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L772">
    <div class="line-number"><a href="#L772">772</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error_msg = error_msg .. &quot;  Missing properties: &quot; .. table.concat(missing_props, &quot;, &quot;) .. &quot;\n&quot;</div>
  </div>
  <div class="line not-covered" id="L773">
    <div class="line-number"><a href="#L773">773</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L774">
    <div class="line-number"><a href="#L774">774</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if #type_mismatches &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L775">
    <div class="line-number"><a href="#L775">775</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error_msg = error_msg .. &quot;  Type mismatches: &quot; .. table.concat(type_mismatches, &quot;, &quot;) .. &quot;\n&quot;</div>
  </div>
  <div class="line not-covered" id="L776">
    <div class="line-number"><a href="#L776">776</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L777">
    <div class="line-number"><a href="#L777">777</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if #value_mismatches &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L778">
    <div class="line-number"><a href="#L778">778</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error_msg = error_msg .. &quot;  Value mismatches: &quot; .. table.concat(value_mismatches, &quot;, &quot;) .. &quot;\n&quot;</div>
  </div>
  <div class="line not-covered" id="L779">
    <div class="line-number"><a href="#L779">779</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L780">
    <div class="line-number"><a href="#L780">780</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L781">
    <div class="line-number"><a href="#L781">781</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return valid, error_msg, &quot;expected object to not match schema&quot;</div>
  </div>
  <div class="line not-covered" id="L782">
    <div class="line-number"><a href="#L782">782</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L783">
    <div class="line-number"><a href="#L783">783</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L784">
    <div class="line-number"><a href="#L784">784</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L785">
    <div class="line-number"><a href="#L785">785</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Function behavior assertions</div>
  </div>
  <div class="line not-covered" id="L786">
    <div class="line-number"><a href="#L786">786</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  change = {</div>
  </div>
  <div class="line not-covered" id="L787">
    <div class="line-number"><a href="#L787">787</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(fn, value_fn, change_fn)</div>
  </div>
  <div class="line not-covered" id="L788">
    <div class="line-number"><a href="#L788">788</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L789">
    <div class="line-number"><a href="#L789">789</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a function to execute, got &quot; .. type(fn))</div>
  </div>
  <div class="line not-covered" id="L790">
    <div class="line-number"><a href="#L790">790</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L791">
    <div class="line-number"><a href="#L791">791</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L792">
    <div class="line-number"><a href="#L792">792</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(value_fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L793">
    <div class="line-number"><a href="#L793">793</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a function that returns value to check, got &quot; .. type(value_fn))</div>
  </div>
  <div class="line not-covered" id="L794">
    <div class="line-number"><a href="#L794">794</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L795">
    <div class="line-number"><a href="#L795">795</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L796">
    <div class="line-number"><a href="#L796">796</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local before_value = value_fn()</div>
  </div>
  <div class="line not-covered" id="L797">
    <div class="line-number"><a href="#L797">797</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local success, result = pcall(fn)</div>
  </div>
  <div class="line not-executable" id="L798">
    <div class="line-number"><a href="#L798">798</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L799">
    <div class="line-number"><a href="#L799">799</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not success then</div>
  </div>
  <div class="line not-covered" id="L800">
    <div class="line-number"><a href="#L800">800</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;function being tested threw an error: &quot; .. tostring(result))</div>
  </div>
  <div class="line not-covered" id="L801">
    <div class="line-number"><a href="#L801">801</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L802">
    <div class="line-number"><a href="#L802">802</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L803">
    <div class="line-number"><a href="#L803">803</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local after_value = value_fn()</div>
  </div>
  <div class="line not-executable" id="L804">
    <div class="line-number"><a href="#L804">804</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L805">
    <div class="line-number"><a href="#L805">805</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If a specific change function was provided, use it</div>
  </div>
  <div class="line not-covered" id="L806">
    <div class="line-number"><a href="#L806">806</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if change_fn and type(change_fn) == &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L807">
    <div class="line-number"><a href="#L807">807</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local changed = change_fn(before_value, after_value)</div>
  </div>
  <div class="line not-covered" id="L808">
    <div class="line-number"><a href="#L808">808</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return changed,</div>
  </div>
  <div class="line not-covered" id="L809">
    <div class="line-number"><a href="#L809">809</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected function to change value according to criteria, but it didn't&quot;,</div>
  </div>
  <div class="line not-covered" id="L810">
    <div class="line-number"><a href="#L810">810</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected function to not change value according to criteria, but it did&quot;</div>
  </div>
  <div class="line not-covered" id="L811">
    <div class="line-number"><a href="#L811">811</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L812">
    <div class="line-number"><a href="#L812">812</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L813">
    <div class="line-number"><a href="#L813">813</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Otherwise just check for any change</div>
  </div>
  <div class="line not-covered" id="L814">
    <div class="line-number"><a href="#L814">814</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local changed = not M.eq(before_value, after_value)</div>
  </div>
  <div class="line not-executable" id="L815">
    <div class="line-number"><a href="#L815">815</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L816">
    <div class="line-number"><a href="#L816">816</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return changed,</div>
  </div>
  <div class="line not-covered" id="L817">
    <div class="line-number"><a href="#L817">817</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected function to change value (before: &quot; .. stringify(before_value) .. </div>
  </div>
  <div class="line not-covered" id="L818">
    <div class="line-number"><a href="#L818">818</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;, after: &quot; .. stringify(after_value) .. &quot;)&quot;,</div>
  </div>
  <div class="line not-covered" id="L819">
    <div class="line-number"><a href="#L819">819</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected function to not change value, but it did change from &quot; .. </div>
  </div>
  <div class="line not-covered" id="L820">
    <div class="line-number"><a href="#L820">820</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        stringify(before_value) .. &quot; to &quot; .. stringify(after_value)</div>
  </div>
  <div class="line not-covered" id="L821">
    <div class="line-number"><a href="#L821">821</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L822">
    <div class="line-number"><a href="#L822">822</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L823">
    <div class="line-number"><a href="#L823">823</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L824">
    <div class="line-number"><a href="#L824">824</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if a function increases a value</div>
  </div>
  <div class="line not-covered" id="L825">
    <div class="line-number"><a href="#L825">825</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  increase = {</div>
  </div>
  <div class="line not-covered" id="L826">
    <div class="line-number"><a href="#L826">826</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(fn, value_fn)</div>
  </div>
  <div class="line not-covered" id="L827">
    <div class="line-number"><a href="#L827">827</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L828">
    <div class="line-number"><a href="#L828">828</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a function to execute, got &quot; .. type(fn))</div>
  </div>
  <div class="line not-covered" id="L829">
    <div class="line-number"><a href="#L829">829</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L830">
    <div class="line-number"><a href="#L830">830</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L831">
    <div class="line-number"><a href="#L831">831</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(value_fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L832">
    <div class="line-number"><a href="#L832">832</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a function that returns value to check, got &quot; .. type(value_fn))</div>
  </div>
  <div class="line not-covered" id="L833">
    <div class="line-number"><a href="#L833">833</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L834">
    <div class="line-number"><a href="#L834">834</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L835">
    <div class="line-number"><a href="#L835">835</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local before_value = value_fn()</div>
  </div>
  <div class="line not-executable" id="L836">
    <div class="line-number"><a href="#L836">836</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L837">
    <div class="line-number"><a href="#L837">837</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Validate that the before value is numeric</div>
  </div>
  <div class="line not-covered" id="L838">
    <div class="line-number"><a href="#L838">838</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(before_value) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L839">
    <div class="line-number"><a href="#L839">839</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected value_fn to return a number, got &quot; .. type(before_value))</div>
  </div>
  <div class="line not-covered" id="L840">
    <div class="line-number"><a href="#L840">840</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L841">
    <div class="line-number"><a href="#L841">841</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L842">
    <div class="line-number"><a href="#L842">842</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local success, result = pcall(fn)</div>
  </div>
  <div class="line not-executable" id="L843">
    <div class="line-number"><a href="#L843">843</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L844">
    <div class="line-number"><a href="#L844">844</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not success then</div>
  </div>
  <div class="line not-covered" id="L845">
    <div class="line-number"><a href="#L845">845</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;function being tested threw an error: &quot; .. tostring(result))</div>
  </div>
  <div class="line not-covered" id="L846">
    <div class="line-number"><a href="#L846">846</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L847">
    <div class="line-number"><a href="#L847">847</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L848">
    <div class="line-number"><a href="#L848">848</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local after_value = value_fn()</div>
  </div>
  <div class="line not-executable" id="L849">
    <div class="line-number"><a href="#L849">849</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L850">
    <div class="line-number"><a href="#L850">850</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Validate that the after value is numeric</div>
  </div>
  <div class="line not-covered" id="L851">
    <div class="line-number"><a href="#L851">851</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(after_value) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L852">
    <div class="line-number"><a href="#L852">852</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected value_fn to return a number after function call, got &quot; .. type(after_value))</div>
  </div>
  <div class="line not-covered" id="L853">
    <div class="line-number"><a href="#L853">853</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L854">
    <div class="line-number"><a href="#L854">854</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L855">
    <div class="line-number"><a href="#L855">855</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local increased = after_value &gt; before_value</div>
  </div>
  <div class="line not-executable" id="L856">
    <div class="line-number"><a href="#L856">856</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L857">
    <div class="line-number"><a href="#L857">857</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return increased,</div>
  </div>
  <div class="line not-covered" id="L858">
    <div class="line-number"><a href="#L858">858</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected function to increase value from &quot; .. tostring(before_value) .. </div>
  </div>
  <div class="line not-covered" id="L859">
    <div class="line-number"><a href="#L859">859</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot; but got &quot; .. tostring(after_value),</div>
  </div>
  <div class="line not-covered" id="L860">
    <div class="line-number"><a href="#L860">860</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected function to not increase value from &quot; .. tostring(before_value) .. </div>
  </div>
  <div class="line not-covered" id="L861">
    <div class="line-number"><a href="#L861">861</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot; but it did increase to &quot; .. tostring(after_value)</div>
  </div>
  <div class="line not-covered" id="L862">
    <div class="line-number"><a href="#L862">862</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L863">
    <div class="line-number"><a href="#L863">863</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L864">
    <div class="line-number"><a href="#L864">864</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L865">
    <div class="line-number"><a href="#L865">865</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if a function decreases a value</div>
  </div>
  <div class="line not-covered" id="L866">
    <div class="line-number"><a href="#L866">866</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  decrease = {</div>
  </div>
  <div class="line not-covered" id="L867">
    <div class="line-number"><a href="#L867">867</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(fn, value_fn)</div>
  </div>
  <div class="line not-covered" id="L868">
    <div class="line-number"><a href="#L868">868</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L869">
    <div class="line-number"><a href="#L869">869</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a function to execute, got &quot; .. type(fn))</div>
  </div>
  <div class="line not-covered" id="L870">
    <div class="line-number"><a href="#L870">870</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L871">
    <div class="line-number"><a href="#L871">871</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L872">
    <div class="line-number"><a href="#L872">872</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(value_fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L873">
    <div class="line-number"><a href="#L873">873</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected a function that returns value to check, got &quot; .. type(value_fn))</div>
  </div>
  <div class="line not-covered" id="L874">
    <div class="line-number"><a href="#L874">874</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L875">
    <div class="line-number"><a href="#L875">875</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L876">
    <div class="line-number"><a href="#L876">876</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local before_value = value_fn()</div>
  </div>
  <div class="line not-executable" id="L877">
    <div class="line-number"><a href="#L877">877</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L878">
    <div class="line-number"><a href="#L878">878</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Validate that the before value is numeric</div>
  </div>
  <div class="line not-covered" id="L879">
    <div class="line-number"><a href="#L879">879</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(before_value) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L880">
    <div class="line-number"><a href="#L880">880</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected value_fn to return a number, got &quot; .. type(before_value))</div>
  </div>
  <div class="line not-covered" id="L881">
    <div class="line-number"><a href="#L881">881</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L882">
    <div class="line-number"><a href="#L882">882</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L883">
    <div class="line-number"><a href="#L883">883</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local success, result = pcall(fn)</div>
  </div>
  <div class="line not-executable" id="L884">
    <div class="line-number"><a href="#L884">884</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L885">
    <div class="line-number"><a href="#L885">885</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not success then</div>
  </div>
  <div class="line not-covered" id="L886">
    <div class="line-number"><a href="#L886">886</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;function being tested threw an error: &quot; .. tostring(result))</div>
  </div>
  <div class="line not-covered" id="L887">
    <div class="line-number"><a href="#L887">887</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L888">
    <div class="line-number"><a href="#L888">888</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L889">
    <div class="line-number"><a href="#L889">889</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local after_value = value_fn()</div>
  </div>
  <div class="line not-executable" id="L890">
    <div class="line-number"><a href="#L890">890</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L891">
    <div class="line-number"><a href="#L891">891</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Validate that the after value is numeric</div>
  </div>
  <div class="line not-covered" id="L892">
    <div class="line-number"><a href="#L892">892</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(after_value) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L893">
    <div class="line-number"><a href="#L893">893</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;expected value_fn to return a number after function call, got &quot; .. type(after_value))</div>
  </div>
  <div class="line not-covered" id="L894">
    <div class="line-number"><a href="#L894">894</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L895">
    <div class="line-number"><a href="#L895">895</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L896">
    <div class="line-number"><a href="#L896">896</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local decreased = after_value &lt; before_value</div>
  </div>
  <div class="line not-executable" id="L897">
    <div class="line-number"><a href="#L897">897</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L898">
    <div class="line-number"><a href="#L898">898</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return decreased,</div>
  </div>
  <div class="line not-covered" id="L899">
    <div class="line-number"><a href="#L899">899</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected function to decrease value from &quot; .. tostring(before_value) .. </div>
  </div>
  <div class="line not-covered" id="L900">
    <div class="line-number"><a href="#L900">900</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot; but got &quot; .. tostring(after_value),</div>
  </div>
  <div class="line not-covered" id="L901">
    <div class="line-number"><a href="#L901">901</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected function to not decrease value from &quot; .. tostring(before_value) .. </div>
  </div>
  <div class="line not-covered" id="L902">
    <div class="line-number"><a href="#L902">902</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot; but it did decrease to &quot; .. tostring(after_value)</div>
  </div>
  <div class="line not-covered" id="L903">
    <div class="line-number"><a href="#L903">903</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L904">
    <div class="line-number"><a href="#L904">904</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  },</div>
  </div>
  <div class="line not-executable" id="L905">
    <div class="line-number"><a href="#L905">905</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L906">
    <div class="line-number"><a href="#L906">906</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Alias for equal with clearer name for deep comparison</div>
  </div>
  <div class="line not-covered" id="L907">
    <div class="line-number"><a href="#L907">907</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  deep_equal = {</div>
  </div>
  <div class="line not-covered" id="L908">
    <div class="line-number"><a href="#L908">908</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v, x, eps)</div>
  </div>
  <div class="line not-covered" id="L909">
    <div class="line-number"><a href="#L909">909</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return M.eq(v, x, eps),</div>
  </div>
  <div class="line not-covered" id="L910">
    <div class="line-number"><a href="#L910">910</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. stringify(v) .. &quot; to deeply equal &quot; .. stringify(x),</div>
  </div>
  <div class="line not-covered" id="L911">
    <div class="line-number"><a href="#L911">911</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. stringify(v) .. &quot; to not deeply equal &quot; .. stringify(x)</div>
  </div>
  <div class="line not-covered" id="L912">
    <div class="line-number"><a href="#L912">912</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L913">
    <div class="line-number"><a href="#L913">913</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-covered" id="L914">
    <div class="line-number"><a href="#L914">914</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L915">
    <div class="line-number"><a href="#L915">915</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Advanced regex matching with options</div>
  </div>
  <div class="line not-covered" id="L916">
    <div class="line-number"><a href="#L916">916</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.match_regex = {</div>
  </div>
  <div class="line not-covered" id="L917">
    <div class="line-number"><a href="#L917">917</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, pattern, options)</div>
  </div>
  <div class="line not-covered" id="L918">
    <div class="line-number"><a href="#L918">918</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L919">
    <div class="line-number"><a href="#L919">919</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Expected a string, got &quot; .. type(v))</div>
  </div>
  <div class="line not-covered" id="L920">
    <div class="line-number"><a href="#L920">920</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L921">
    <div class="line-number"><a href="#L921">921</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L922">
    <div class="line-number"><a href="#L922">922</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(pattern) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L923">
    <div class="line-number"><a href="#L923">923</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Expected a string pattern, got &quot; .. type(pattern))</div>
  </div>
  <div class="line not-covered" id="L924">
    <div class="line-number"><a href="#L924">924</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L925">
    <div class="line-number"><a href="#L925">925</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L926">
    <div class="line-number"><a href="#L926">926</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if options ~= nil and type(options) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L927">
    <div class="line-number"><a href="#L927">927</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Expected options to be a table, got &quot; .. type(options))</div>
  </div>
  <div class="line not-covered" id="L928">
    <div class="line-number"><a href="#L928">928</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L929">
    <div class="line-number"><a href="#L929">929</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L930">
    <div class="line-number"><a href="#L930">930</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    options = options or {}</div>
  </div>
  <div class="line not-covered" id="L931">
    <div class="line-number"><a href="#L931">931</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local case_insensitive = options.case_insensitive or false</div>
  </div>
  <div class="line not-covered" id="L932">
    <div class="line-number"><a href="#L932">932</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local multiline = options.multiline or false</div>
  </div>
  <div class="line not-executable" id="L933">
    <div class="line-number"><a href="#L933">933</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L934">
    <div class="line-number"><a href="#L934">934</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Apply case insensitivity by converting to lowercase if requested</div>
  </div>
  <div class="line not-covered" id="L935">
    <div class="line-number"><a href="#L935">935</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local compare_v = v</div>
  </div>
  <div class="line not-covered" id="L936">
    <div class="line-number"><a href="#L936">936</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local compare_pattern = pattern</div>
  </div>
  <div class="line not-executable" id="L937">
    <div class="line-number"><a href="#L937">937</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L938">
    <div class="line-number"><a href="#L938">938</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if case_insensitive then</div>
  </div>
  <div class="line not-covered" id="L939">
    <div class="line-number"><a href="#L939">939</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      compare_v = string.lower(compare_v)</div>
  </div>
  <div class="line not-covered" id="L940">
    <div class="line-number"><a href="#L940">940</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      compare_pattern = string.lower(compare_pattern)</div>
  </div>
  <div class="line not-covered" id="L941">
    <div class="line-number"><a href="#L941">941</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L942">
    <div class="line-number"><a href="#L942">942</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L943">
    <div class="line-number"><a href="#L943">943</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle multiline flag</div>
  </div>
  <div class="line not-covered" id="L944">
    <div class="line-number"><a href="#L944">944</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if multiline then</div>
  </div>
  <div class="line not-executable" id="L945">
    <div class="line-number"><a href="#L945">945</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- In multiline mode, ^ and $ match the start/end of each line</div>
  </div>
  <div class="line not-executable" id="L946">
    <div class="line-number"><a href="#L946">946</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Replace with markers that accomplish this in Lua patterns</div>
  </div>
  <div class="line not-covered" id="L947">
    <div class="line-number"><a href="#L947">947</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      compare_pattern = compare_pattern:gsub(&quot;%^&quot;, &quot;(^|\n)&quot;)</div>
  </div>
  <div class="line not-covered" id="L948">
    <div class="line-number"><a href="#L948">948</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      compare_pattern = compare_pattern:gsub(&quot;%$&quot;, &quot;($|\n)&quot;)</div>
  </div>
  <div class="line not-covered" id="L949">
    <div class="line-number"><a href="#L949">949</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L950">
    <div class="line-number"><a href="#L950">950</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L951">
    <div class="line-number"><a href="#L951">951</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Perform the match</div>
  </div>
  <div class="line not-covered" id="L952">
    <div class="line-number"><a href="#L952">952</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = string.find(compare_v, compare_pattern) ~= nil</div>
  </div>
  <div class="line not-executable" id="L953">
    <div class="line-number"><a href="#L953">953</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L954">
    <div class="line-number"><a href="#L954">954</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Create user-friendly options string for error messages</div>
  </div>
  <div class="line not-covered" id="L955">
    <div class="line-number"><a href="#L955">955</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local options_str = &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L956">
    <div class="line-number"><a href="#L956">956</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if next(options) then</div>
  </div>
  <div class="line not-covered" id="L957">
    <div class="line-number"><a href="#L957">957</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local opts = {}</div>
  </div>
  <div class="line not-covered" id="L958">
    <div class="line-number"><a href="#L958">958</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if options.case_insensitive then table.insert(opts, &quot;case_insensitive&quot;) end</div>
  </div>
  <div class="line not-covered" id="L959">
    <div class="line-number"><a href="#L959">959</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if options.multiline then table.insert(opts, &quot;multiline&quot;) end</div>
  </div>
  <div class="line not-covered" id="L960">
    <div class="line-number"><a href="#L960">960</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options_str = &quot; (with options: &quot; .. table.concat(opts, &quot;, &quot;) .. &quot;)&quot;</div>
  </div>
  <div class="line not-covered" id="L961">
    <div class="line-number"><a href="#L961">961</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L962">
    <div class="line-number"><a href="#L962">962</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L963">
    <div class="line-number"><a href="#L963">963</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result,</div>
  </div>
  <div class="line not-covered" id="L964">
    <div class="line-number"><a href="#L964">964</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to match regex pattern &quot;' .. pattern .. '&quot;' .. options_str,</div>
  </div>
  <div class="line not-covered" id="L965">
    <div class="line-number"><a href="#L965">965</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to not match regex pattern &quot;' .. pattern .. '&quot;' .. options_str</div>
  </div>
  <div class="line not-covered" id="L966">
    <div class="line-number"><a href="#L966">966</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L967">
    <div class="line-number"><a href="#L967">967</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L968">
    <div class="line-number"><a href="#L968">968</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L969">
    <div class="line-number"><a href="#L969">969</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Date validation</div>
  </div>
  <div class="line not-covered" id="L970">
    <div class="line-number"><a href="#L970">970</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_date = {</div>
  </div>
  <div class="line not-covered" id="L971">
    <div class="line-number"><a href="#L971">971</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v)</div>
  </div>
  <div class="line not-executable" id="L972">
    <div class="line-number"><a href="#L972">972</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Check if the value is a string that can be parsed as a date</div>
  </div>
  <div class="line not-covered" id="L973">
    <div class="line-number"><a href="#L973">973</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L974">
    <div class="line-number"><a href="#L974">974</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false, </div>
  </div>
  <div class="line not-covered" id="L975">
    <div class="line-number"><a href="#L975">975</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. stringify(v) .. &quot; to be a valid date string&quot;, </div>
  </div>
  <div class="line not-covered" id="L976">
    <div class="line-number"><a href="#L976">976</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. stringify(v) .. &quot; to not be a valid date string&quot;</div>
  </div>
  <div class="line not-covered" id="L977">
    <div class="line-number"><a href="#L977">977</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L978">
    <div class="line-number"><a href="#L978">978</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L979">
    <div class="line-number"><a href="#L979">979</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Try to parse as a date using various formats</div>
  </div>
  <div class="line not-covered" id="L980">
    <div class="line-number"><a href="#L980">980</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local year, month, day</div>
  </div>
  <div class="line not-executable" id="L981">
    <div class="line-number"><a href="#L981">981</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L982">
    <div class="line-number"><a href="#L982">982</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Try YYYY-MM-DD format with optional time</div>
  </div>
  <div class="line not-covered" id="L983">
    <div class="line-number"><a href="#L983">983</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      year, month, day = v:match(&quot;^(%d%d%d%d)%-(%d%d)%-(%d%d)&quot;)</div>
  </div>
  <div class="line not-covered" id="L984">
    <div class="line-number"><a href="#L984">984</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not year then</div>
  </div>
  <div class="line not-executable" id="L985">
    <div class="line-number"><a href="#L985">985</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Try MM/DD/YYYY format</div>
  </div>
  <div class="line not-covered" id="L986">
    <div class="line-number"><a href="#L986">986</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        month, day, year = v:match(&quot;^(%d%d)/(%d%d)/(%d%d%d%d)&quot;)</div>
  </div>
  <div class="line not-covered" id="L987">
    <div class="line-number"><a href="#L987">987</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L988">
    <div class="line-number"><a href="#L988">988</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not year then</div>
  </div>
  <div class="line not-executable" id="L989">
    <div class="line-number"><a href="#L989">989</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Try DD/MM/YYYY format</div>
  </div>
  <div class="line not-covered" id="L990">
    <div class="line-number"><a href="#L990">990</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        day, month, year = v:match(&quot;^(%d%d)/(%d%d)/(%d%d%d%d)&quot;)</div>
  </div>
  <div class="line not-covered" id="L991">
    <div class="line-number"><a href="#L991">991</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L992">
    <div class="line-number"><a href="#L992">992</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L993">
    <div class="line-number"><a href="#L993">993</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not (year and month and day) then</div>
  </div>
  <div class="line not-covered" id="L994">
    <div class="line-number"><a href="#L994">994</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L995">
    <div class="line-number"><a href="#L995">995</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to be a valid date string',</div>
  </div>
  <div class="line not-covered" id="L996">
    <div class="line-number"><a href="#L996">996</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to not be a valid date string'</div>
  </div>
  <div class="line not-covered" id="L997">
    <div class="line-number"><a href="#L997">997</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L998">
    <div class="line-number"><a href="#L998">998</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L999">
    <div class="line-number"><a href="#L999">999</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Convert to numbers</div>
  </div>
  <div class="line not-covered" id="L1000">
    <div class="line-number"><a href="#L1000">1000</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      year, month, day = tonumber(year), tonumber(month), tonumber(day)</div>
  </div>
  <div class="line not-executable" id="L1001">
    <div class="line-number"><a href="#L1001">1001</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1002">
    <div class="line-number"><a href="#L1002">1002</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Basic validation of date components</div>
  </div>
  <div class="line not-covered" id="L1003">
    <div class="line-number"><a href="#L1003">1003</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if month &lt; 1 or month &gt; 12 or day &lt; 1 or day &gt; 31 then</div>
  </div>
  <div class="line not-covered" id="L1004">
    <div class="line-number"><a href="#L1004">1004</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L1005">
    <div class="line-number"><a href="#L1005">1005</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to be a valid date (invalid month or day)',</div>
  </div>
  <div class="line not-covered" id="L1006">
    <div class="line-number"><a href="#L1006">1006</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to not be a valid date'</div>
  </div>
  <div class="line not-covered" id="L1007">
    <div class="line-number"><a href="#L1007">1007</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1008">
    <div class="line-number"><a href="#L1008">1008</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1009">
    <div class="line-number"><a href="#L1009">1009</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Additional validation for days in month</div>
  </div>
  <div class="line not-covered" id="L1010">
    <div class="line-number"><a href="#L1010">1010</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local days_in_month = {31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}</div>
  </div>
  <div class="line not-executable" id="L1011">
    <div class="line-number"><a href="#L1011">1011</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1012">
    <div class="line-number"><a href="#L1012">1012</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Adjust February for leap years</div>
  </div>
  <div class="line not-covered" id="L1013">
    <div class="line-number"><a href="#L1013">1013</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if month == 2 and (year % 4 == 0 and (year % 100 ~= 0 or year % 400 == 0)) then</div>
  </div>
  <div class="line not-covered" id="L1014">
    <div class="line-number"><a href="#L1014">1014</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        days_in_month[2] = 29</div>
  </div>
  <div class="line not-covered" id="L1015">
    <div class="line-number"><a href="#L1015">1015</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1016">
    <div class="line-number"><a href="#L1016">1016</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1017">
    <div class="line-number"><a href="#L1017">1017</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if day &gt; days_in_month[month] then</div>
  </div>
  <div class="line not-covered" id="L1018">
    <div class="line-number"><a href="#L1018">1018</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L1019">
    <div class="line-number"><a href="#L1019">1019</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to be a valid date (invalid days for month)',</div>
  </div>
  <div class="line not-covered" id="L1020">
    <div class="line-number"><a href="#L1020">1020</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to not be a valid date'</div>
  </div>
  <div class="line not-covered" id="L1021">
    <div class="line-number"><a href="#L1021">1021</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1022">
    <div class="line-number"><a href="#L1022">1022</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1023">
    <div class="line-number"><a href="#L1023">1023</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return true,</div>
  </div>
  <div class="line not-covered" id="L1024">
    <div class="line-number"><a href="#L1024">1024</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; to be a valid date',</div>
  </div>
  <div class="line not-covered" id="L1025">
    <div class="line-number"><a href="#L1025">1025</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; to not be a valid date'</div>
  </div>
  <div class="line not-covered" id="L1026">
    <div class="line-number"><a href="#L1026">1026</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1027">
    <div class="line-number"><a href="#L1027">1027</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1028">
    <div class="line-number"><a href="#L1028">1028</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- ISO date format validation</div>
  </div>
  <div class="line not-covered" id="L1029">
    <div class="line-number"><a href="#L1029">1029</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_iso_date = {</div>
  </div>
  <div class="line not-covered" id="L1030">
    <div class="line-number"><a href="#L1030">1030</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1031">
    <div class="line-number"><a href="#L1031">1031</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if type(v) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1032">
    <div class="line-number"><a href="#L1032">1032</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false, </div>
  </div>
  <div class="line not-covered" id="L1033">
    <div class="line-number"><a href="#L1033">1033</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. stringify(v) .. &quot; to be a valid ISO date string&quot;, </div>
  </div>
  <div class="line not-covered" id="L1034">
    <div class="line-number"><a href="#L1034">1034</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. stringify(v) .. &quot; to not be a valid ISO date string&quot;</div>
  </div>
  <div class="line not-covered" id="L1035">
    <div class="line-number"><a href="#L1035">1035</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1036">
    <div class="line-number"><a href="#L1036">1036</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1037">
    <div class="line-number"><a href="#L1037">1037</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Check for ISO 8601 format (YYYY-MM-DDTHH:MM:SS.sssZ)</div>
  </div>
  <div class="line not-covered" id="L1038">
    <div class="line-number"><a href="#L1038">1038</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local year, month, day, hour, minute, second = </div>
  </div>
  <div class="line not-covered" id="L1039">
    <div class="line-number"><a href="#L1039">1039</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        v:match(&quot;^(%d%d%d%d)%-(%d%d)%-(%d%d)[Tt](%d%d):(%d%d):(%d%d)&quot;)</div>
  </div>
  <div class="line not-executable" id="L1040">
    <div class="line-number"><a href="#L1040">1040</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1041">
    <div class="line-number"><a href="#L1041">1041</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If no match, check for simple ISO date (YYYY-MM-DD)</div>
  </div>
  <div class="line not-covered" id="L1042">
    <div class="line-number"><a href="#L1042">1042</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not year then</div>
  </div>
  <div class="line not-covered" id="L1043">
    <div class="line-number"><a href="#L1043">1043</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        year, month, day = v:match(&quot;^(%d%d%d%d)%-(%d%d)%-(%d%d)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1044">
    <div class="line-number"><a href="#L1044">1044</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        hour, minute, second = &quot;00&quot;, &quot;00&quot;, &quot;00&quot;</div>
  </div>
  <div class="line not-covered" id="L1045">
    <div class="line-number"><a href="#L1045">1045</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1046">
    <div class="line-number"><a href="#L1046">1046</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1047">
    <div class="line-number"><a href="#L1047">1047</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not (year and month and day) then</div>
  </div>
  <div class="line not-covered" id="L1048">
    <div class="line-number"><a href="#L1048">1048</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L1049">
    <div class="line-number"><a href="#L1049">1049</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to be a valid ISO date string',</div>
  </div>
  <div class="line not-covered" id="L1050">
    <div class="line-number"><a href="#L1050">1050</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to not be a valid ISO date string'</div>
  </div>
  <div class="line not-covered" id="L1051">
    <div class="line-number"><a href="#L1051">1051</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1052">
    <div class="line-number"><a href="#L1052">1052</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1053">
    <div class="line-number"><a href="#L1053">1053</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Convert to numbers</div>
  </div>
  <div class="line not-covered" id="L1054">
    <div class="line-number"><a href="#L1054">1054</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      year, month, day = tonumber(year), tonumber(month), tonumber(day)</div>
  </div>
  <div class="line not-covered" id="L1055">
    <div class="line-number"><a href="#L1055">1055</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      hour = hour and tonumber(hour) or 0</div>
  </div>
  <div class="line not-covered" id="L1056">
    <div class="line-number"><a href="#L1056">1056</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      minute = minute and tonumber(minute) or 0</div>
  </div>
  <div class="line not-covered" id="L1057">
    <div class="line-number"><a href="#L1057">1057</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      second = second and tonumber(second) or 0</div>
  </div>
  <div class="line not-executable" id="L1058">
    <div class="line-number"><a href="#L1058">1058</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1059">
    <div class="line-number"><a href="#L1059">1059</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Validate date components</div>
  </div>
  <div class="line not-covered" id="L1060">
    <div class="line-number"><a href="#L1060">1060</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if month &lt; 1 or month &gt; 12 or day &lt; 1 or day &gt; 31 then</div>
  </div>
  <div class="line not-covered" id="L1061">
    <div class="line-number"><a href="#L1061">1061</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L1062">
    <div class="line-number"><a href="#L1062">1062</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to be a valid ISO date (invalid month or day)',</div>
  </div>
  <div class="line not-covered" id="L1063">
    <div class="line-number"><a href="#L1063">1063</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to not be a valid ISO date'</div>
  </div>
  <div class="line not-covered" id="L1064">
    <div class="line-number"><a href="#L1064">1064</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1065">
    <div class="line-number"><a href="#L1065">1065</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1066">
    <div class="line-number"><a href="#L1066">1066</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Validate time components if present</div>
  </div>
  <div class="line not-covered" id="L1067">
    <div class="line-number"><a href="#L1067">1067</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if hour and (hour &lt; 0 or hour &gt; 23) then</div>
  </div>
  <div class="line not-covered" id="L1068">
    <div class="line-number"><a href="#L1068">1068</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L1069">
    <div class="line-number"><a href="#L1069">1069</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to be a valid ISO date (invalid hour)',</div>
  </div>
  <div class="line not-covered" id="L1070">
    <div class="line-number"><a href="#L1070">1070</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to not be a valid ISO date'</div>
  </div>
  <div class="line not-covered" id="L1071">
    <div class="line-number"><a href="#L1071">1071</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1072">
    <div class="line-number"><a href="#L1072">1072</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1073">
    <div class="line-number"><a href="#L1073">1073</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if minute and (minute &lt; 0 or minute &gt; 59) then</div>
  </div>
  <div class="line not-covered" id="L1074">
    <div class="line-number"><a href="#L1074">1074</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L1075">
    <div class="line-number"><a href="#L1075">1075</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to be a valid ISO date (invalid minute)',</div>
  </div>
  <div class="line not-covered" id="L1076">
    <div class="line-number"><a href="#L1076">1076</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to not be a valid ISO date'</div>
  </div>
  <div class="line not-covered" id="L1077">
    <div class="line-number"><a href="#L1077">1077</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1078">
    <div class="line-number"><a href="#L1078">1078</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1079">
    <div class="line-number"><a href="#L1079">1079</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if second and (second &lt; 0 or second &gt; 59) then</div>
  </div>
  <div class="line not-covered" id="L1080">
    <div class="line-number"><a href="#L1080">1080</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L1081">
    <div class="line-number"><a href="#L1081">1081</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to be a valid ISO date (invalid second)',</div>
  </div>
  <div class="line not-covered" id="L1082">
    <div class="line-number"><a href="#L1082">1082</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to not be a valid ISO date'</div>
  </div>
  <div class="line not-covered" id="L1083">
    <div class="line-number"><a href="#L1083">1083</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1084">
    <div class="line-number"><a href="#L1084">1084</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1085">
    <div class="line-number"><a href="#L1085">1085</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Check days in month</div>
  </div>
  <div class="line not-covered" id="L1086">
    <div class="line-number"><a href="#L1086">1086</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local days_in_month = {31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}</div>
  </div>
  <div class="line not-executable" id="L1087">
    <div class="line-number"><a href="#L1087">1087</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1088">
    <div class="line-number"><a href="#L1088">1088</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Adjust February for leap years</div>
  </div>
  <div class="line not-covered" id="L1089">
    <div class="line-number"><a href="#L1089">1089</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if month == 2 and (year % 4 == 0 and (year % 100 ~= 0 or year % 400 == 0)) then</div>
  </div>
  <div class="line not-covered" id="L1090">
    <div class="line-number"><a href="#L1090">1090</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        days_in_month[2] = 29</div>
  </div>
  <div class="line not-covered" id="L1091">
    <div class="line-number"><a href="#L1091">1091</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1092">
    <div class="line-number"><a href="#L1092">1092</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1093">
    <div class="line-number"><a href="#L1093">1093</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if day &gt; days_in_month[month] then</div>
  </div>
  <div class="line not-covered" id="L1094">
    <div class="line-number"><a href="#L1094">1094</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L1095">
    <div class="line-number"><a href="#L1095">1095</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to be a valid ISO date (invalid days for month)',</div>
  </div>
  <div class="line not-covered" id="L1096">
    <div class="line-number"><a href="#L1096">1096</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          'expected &quot;' .. v .. '&quot; to not be a valid ISO date'</div>
  </div>
  <div class="line not-covered" id="L1097">
    <div class="line-number"><a href="#L1097">1097</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1098">
    <div class="line-number"><a href="#L1098">1098</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1099">
    <div class="line-number"><a href="#L1099">1099</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return true,</div>
  </div>
  <div class="line not-covered" id="L1100">
    <div class="line-number"><a href="#L1100">1100</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; to be a valid ISO date',</div>
  </div>
  <div class="line not-covered" id="L1101">
    <div class="line-number"><a href="#L1101">1101</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; to not be a valid ISO date'</div>
  </div>
  <div class="line not-covered" id="L1102">
    <div class="line-number"><a href="#L1102">1102</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1103">
    <div class="line-number"><a href="#L1103">1103</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1104">
    <div class="line-number"><a href="#L1104">1104</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Helper function to parse date strings into components</div>
  </div>
  <div class="line not-covered" id="L1105">
    <div class="line-number"><a href="#L1105">1105</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function parse_date(date_string)</div>
  </div>
  <div class="line not-covered" id="L1106">
    <div class="line-number"><a href="#L1106">1106</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(date_string) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1107">
    <div class="line-number"><a href="#L1107">1107</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L1108">
    <div class="line-number"><a href="#L1108">1108</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1109">
    <div class="line-number"><a href="#L1109">1109</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1110">
    <div class="line-number"><a href="#L1110">1110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local year, month, day, hour, minute, second</div>
  </div>
  <div class="line not-executable" id="L1111">
    <div class="line-number"><a href="#L1111">1111</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1112">
    <div class="line-number"><a href="#L1112">1112</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try ISO format (YYYY-MM-DDTHH:MM:SS)</div>
  </div>
  <div class="line not-covered" id="L1113">
    <div class="line-number"><a href="#L1113">1113</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  year, month, day, hour, minute, second = </div>
  </div>
  <div class="line not-covered" id="L1114">
    <div class="line-number"><a href="#L1114">1114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    date_string:match(&quot;^(%d%d%d%d)%-(%d%d)%-(%d%d)[Tt](%d%d):(%d%d):(%d%d)&quot;)</div>
  </div>
  <div class="line not-executable" id="L1115">
    <div class="line-number"><a href="#L1115">1115</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1116">
    <div class="line-number"><a href="#L1116">1116</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If no match, try simple ISO date (YYYY-MM-DD)</div>
  </div>
  <div class="line not-covered" id="L1117">
    <div class="line-number"><a href="#L1117">1117</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not year then</div>
  </div>
  <div class="line not-covered" id="L1118">
    <div class="line-number"><a href="#L1118">1118</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    year, month, day = date_string:match(&quot;^(%d%d%d%d)%-(%d%d)%-(%d%d)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1119">
    <div class="line-number"><a href="#L1119">1119</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    hour, minute, second = &quot;00&quot;, &quot;00&quot;, &quot;00&quot;</div>
  </div>
  <div class="line not-covered" id="L1120">
    <div class="line-number"><a href="#L1120">1120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1121">
    <div class="line-number"><a href="#L1121">1121</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1122">
    <div class="line-number"><a href="#L1122">1122</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If still no match, try MM/DD/YYYY format</div>
  </div>
  <div class="line not-covered" id="L1123">
    <div class="line-number"><a href="#L1123">1123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not year then</div>
  </div>
  <div class="line not-covered" id="L1124">
    <div class="line-number"><a href="#L1124">1124</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    month, day, year = date_string:match(&quot;^(%d%d)/(%d%d)/(%d%d%d%d)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1125">
    <div class="line-number"><a href="#L1125">1125</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    hour, minute, second = &quot;00&quot;, &quot;00&quot;, &quot;00&quot;</div>
  </div>
  <div class="line not-covered" id="L1126">
    <div class="line-number"><a href="#L1126">1126</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1127">
    <div class="line-number"><a href="#L1127">1127</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1128">
    <div class="line-number"><a href="#L1128">1128</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If still no match, try DD/MM/YYYY format</div>
  </div>
  <div class="line not-covered" id="L1129">
    <div class="line-number"><a href="#L1129">1129</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not year then</div>
  </div>
  <div class="line not-covered" id="L1130">
    <div class="line-number"><a href="#L1130">1130</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    day, month, year = date_string:match(&quot;^(%d%d)/(%d%d)/(%d%d%d%d)$&quot;)</div>
  </div>
  <div class="line not-covered" id="L1131">
    <div class="line-number"><a href="#L1131">1131</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    hour, minute, second = &quot;00&quot;, &quot;00&quot;, &quot;00&quot;</div>
  </div>
  <div class="line not-covered" id="L1132">
    <div class="line-number"><a href="#L1132">1132</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1133">
    <div class="line-number"><a href="#L1133">1133</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1134">
    <div class="line-number"><a href="#L1134">1134</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not (year and month and day) then</div>
  </div>
  <div class="line not-covered" id="L1135">
    <div class="line-number"><a href="#L1135">1135</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L1136">
    <div class="line-number"><a href="#L1136">1136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1137">
    <div class="line-number"><a href="#L1137">1137</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1138">
    <div class="line-number"><a href="#L1138">1138</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return {</div>
  </div>
  <div class="line not-covered" id="L1139">
    <div class="line-number"><a href="#L1139">1139</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    year = tonumber(year),</div>
  </div>
  <div class="line not-covered" id="L1140">
    <div class="line-number"><a href="#L1140">1140</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    month = tonumber(month),</div>
  </div>
  <div class="line not-covered" id="L1141">
    <div class="line-number"><a href="#L1141">1141</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    day = tonumber(day),</div>
  </div>
  <div class="line not-covered" id="L1142">
    <div class="line-number"><a href="#L1142">1142</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    hour = hour and tonumber(hour) or 0,</div>
  </div>
  <div class="line not-covered" id="L1143">
    <div class="line-number"><a href="#L1143">1143</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    minute = minute and tonumber(minute) or 0,</div>
  </div>
  <div class="line not-covered" id="L1144">
    <div class="line-number"><a href="#L1144">1144</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    second = second and tonumber(second) or 0</div>
  </div>
  <div class="line not-covered" id="L1145">
    <div class="line-number"><a href="#L1145">1145</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-covered" id="L1146">
    <div class="line-number"><a href="#L1146">1146</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1147">
    <div class="line-number"><a href="#L1147">1147</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Helper function to compare dates</div>
  </div>
  <div class="line not-covered" id="L1148">
    <div class="line-number"><a href="#L1148">1148</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function compare_dates(date1, date2)</div>
  </div>
  <div class="line not-covered" id="L1149">
    <div class="line-number"><a href="#L1149">1149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local d1 = parse_date(date1)</div>
  </div>
  <div class="line not-covered" id="L1150">
    <div class="line-number"><a href="#L1150">1150</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local d2 = parse_date(date2)</div>
  </div>
  <div class="line not-executable" id="L1151">
    <div class="line-number"><a href="#L1151">1151</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1152">
    <div class="line-number"><a href="#L1152">1152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not d1 or not d2 then</div>
  </div>
  <div class="line not-covered" id="L1153">
    <div class="line-number"><a href="#L1153">1153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L1154">
    <div class="line-number"><a href="#L1154">1154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1155">
    <div class="line-number"><a href="#L1155">1155</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1156">
    <div class="line-number"><a href="#L1156">1156</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Compare full timestamps</div>
  </div>
  <div class="line not-covered" id="L1157">
    <div class="line-number"><a href="#L1157">1157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if d1.year ~= d2.year then return d1.year - d2.year end</div>
  </div>
  <div class="line not-covered" id="L1158">
    <div class="line-number"><a href="#L1158">1158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if d1.month ~= d2.month then return d1.month - d2.month end</div>
  </div>
  <div class="line not-covered" id="L1159">
    <div class="line-number"><a href="#L1159">1159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if d1.day ~= d2.day then return d1.day - d2.day end</div>
  </div>
  <div class="line not-covered" id="L1160">
    <div class="line-number"><a href="#L1160">1160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if d1.hour ~= d2.hour then return d1.hour - d2.hour end</div>
  </div>
  <div class="line not-covered" id="L1161">
    <div class="line-number"><a href="#L1161">1161</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if d1.minute ~= d2.minute then return d1.minute - d2.minute end</div>
  </div>
  <div class="line not-covered" id="L1162">
    <div class="line-number"><a href="#L1162">1162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return d1.second - d2.second</div>
  </div>
  <div class="line not-covered" id="L1163">
    <div class="line-number"><a href="#L1163">1163</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1164">
    <div class="line-number"><a href="#L1164">1164</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Add date and async assertions to the paths table</div>
  </div>
  <div class="line not-covered" id="L1165">
    <div class="line-number"><a href="#L1165">1165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_before = {</div>
  </div>
  <div class="line not-covered" id="L1166">
    <div class="line-number"><a href="#L1166">1166</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, expected_date)</div>
  </div>
  <div class="line not-covered" id="L1167">
    <div class="line-number"><a href="#L1167">1167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;string&quot; or type(expected_date) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1168">
    <div class="line-number"><a href="#L1168">1168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, </div>
  </div>
  <div class="line not-covered" id="L1169">
    <div class="line-number"><a href="#L1169">1169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Expected a date string, got &quot; .. type(v),</div>
  </div>
  <div class="line not-covered" id="L1170">
    <div class="line-number"><a href="#L1170">1170</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Expected a non-date string&quot;</div>
  </div>
  <div class="line not-covered" id="L1171">
    <div class="line-number"><a href="#L1171">1171</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1172">
    <div class="line-number"><a href="#L1172">1172</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1173">
    <div class="line-number"><a href="#L1173">1173</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = compare_dates(v, expected_date)</div>
  </div>
  <div class="line not-executable" id="L1174">
    <div class="line-number"><a href="#L1174">1174</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1175">
    <div class="line-number"><a href="#L1175">1175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if result == nil then</div>
  </div>
  <div class="line not-covered" id="L1176">
    <div class="line-number"><a href="#L1176">1176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false,</div>
  </div>
  <div class="line not-covered" id="L1177">
    <div class="line-number"><a href="#L1177">1177</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; and &quot;' .. expected_date .. '&quot; to be valid dates for comparison',</div>
  </div>
  <div class="line not-covered" id="L1178">
    <div class="line-number"><a href="#L1178">1178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; and &quot;' .. expected_date .. '&quot; to not be valid dates for comparison'</div>
  </div>
  <div class="line not-covered" id="L1179">
    <div class="line-number"><a href="#L1179">1179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1180">
    <div class="line-number"><a href="#L1180">1180</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1181">
    <div class="line-number"><a href="#L1181">1181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result &lt; 0,</div>
  </div>
  <div class="line not-covered" id="L1182">
    <div class="line-number"><a href="#L1182">1182</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to be before &quot;' .. expected_date .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L1183">
    <div class="line-number"><a href="#L1183">1183</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to not be before &quot;' .. expected_date .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L1184">
    <div class="line-number"><a href="#L1184">1184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1185">
    <div class="line-number"><a href="#L1185">1185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1186">
    <div class="line-number"><a href="#L1186">1186</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_after = {</div>
  </div>
  <div class="line not-covered" id="L1187">
    <div class="line-number"><a href="#L1187">1187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, expected_date)</div>
  </div>
  <div class="line not-covered" id="L1188">
    <div class="line-number"><a href="#L1188">1188</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;string&quot; or type(expected_date) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1189">
    <div class="line-number"><a href="#L1189">1189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, </div>
  </div>
  <div class="line not-covered" id="L1190">
    <div class="line-number"><a href="#L1190">1190</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Expected a date string, got &quot; .. type(v),</div>
  </div>
  <div class="line not-covered" id="L1191">
    <div class="line-number"><a href="#L1191">1191</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Expected a non-date string&quot;</div>
  </div>
  <div class="line not-covered" id="L1192">
    <div class="line-number"><a href="#L1192">1192</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1193">
    <div class="line-number"><a href="#L1193">1193</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1194">
    <div class="line-number"><a href="#L1194">1194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = compare_dates(v, expected_date)</div>
  </div>
  <div class="line not-executable" id="L1195">
    <div class="line-number"><a href="#L1195">1195</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1196">
    <div class="line-number"><a href="#L1196">1196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if result == nil then</div>
  </div>
  <div class="line not-covered" id="L1197">
    <div class="line-number"><a href="#L1197">1197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false,</div>
  </div>
  <div class="line not-covered" id="L1198">
    <div class="line-number"><a href="#L1198">1198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; and &quot;' .. expected_date .. '&quot; to be valid dates for comparison',</div>
  </div>
  <div class="line not-covered" id="L1199">
    <div class="line-number"><a href="#L1199">1199</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; and &quot;' .. expected_date .. '&quot; to not be valid dates for comparison'</div>
  </div>
  <div class="line not-covered" id="L1200">
    <div class="line-number"><a href="#L1200">1200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1201">
    <div class="line-number"><a href="#L1201">1201</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1202">
    <div class="line-number"><a href="#L1202">1202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result &gt; 0,</div>
  </div>
  <div class="line not-covered" id="L1203">
    <div class="line-number"><a href="#L1203">1203</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to be after &quot;' .. expected_date .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L1204">
    <div class="line-number"><a href="#L1204">1204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to not be after &quot;' .. expected_date .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L1205">
    <div class="line-number"><a href="#L1205">1205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1206">
    <div class="line-number"><a href="#L1206">1206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1207">
    <div class="line-number"><a href="#L1207">1207</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_same_day_as = {</div>
  </div>
  <div class="line not-covered" id="L1208">
    <div class="line-number"><a href="#L1208">1208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, expected_date)</div>
  </div>
  <div class="line not-covered" id="L1209">
    <div class="line-number"><a href="#L1209">1209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;string&quot; or type(expected_date) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1210">
    <div class="line-number"><a href="#L1210">1210</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, </div>
  </div>
  <div class="line not-covered" id="L1211">
    <div class="line-number"><a href="#L1211">1211</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Expected a date string, got &quot; .. type(v),</div>
  </div>
  <div class="line not-covered" id="L1212">
    <div class="line-number"><a href="#L1212">1212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;Expected a non-date string&quot;</div>
  </div>
  <div class="line not-covered" id="L1213">
    <div class="line-number"><a href="#L1213">1213</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1214">
    <div class="line-number"><a href="#L1214">1214</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1215">
    <div class="line-number"><a href="#L1215">1215</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local d1 = parse_date(v)</div>
  </div>
  <div class="line not-covered" id="L1216">
    <div class="line-number"><a href="#L1216">1216</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local d2 = parse_date(expected_date)</div>
  </div>
  <div class="line not-executable" id="L1217">
    <div class="line-number"><a href="#L1217">1217</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1218">
    <div class="line-number"><a href="#L1218">1218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not d1 or not d2 then</div>
  </div>
  <div class="line not-covered" id="L1219">
    <div class="line-number"><a href="#L1219">1219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false,</div>
  </div>
  <div class="line not-covered" id="L1220">
    <div class="line-number"><a href="#L1220">1220</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; and &quot;' .. expected_date .. '&quot; to be valid dates for comparison',</div>
  </div>
  <div class="line not-covered" id="L1221">
    <div class="line-number"><a href="#L1221">1221</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected &quot;' .. v .. '&quot; and &quot;' .. expected_date .. '&quot; to not be valid dates for comparison'</div>
  </div>
  <div class="line not-covered" id="L1222">
    <div class="line-number"><a href="#L1222">1222</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1223">
    <div class="line-number"><a href="#L1223">1223</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1224">
    <div class="line-number"><a href="#L1224">1224</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return d1.year == d2.year and d1.month == d2.month and d1.day == d2.day,</div>
  </div>
  <div class="line not-covered" id="L1225">
    <div class="line-number"><a href="#L1225">1225</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to be the same day as &quot;' .. expected_date .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L1226">
    <div class="line-number"><a href="#L1226">1226</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to not be the same day as &quot;' .. expected_date .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L1227">
    <div class="line-number"><a href="#L1227">1227</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1228">
    <div class="line-number"><a href="#L1228">1228</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1229">
    <div class="line-number"><a href="#L1229">1229</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Async assertions</div>
  </div>
  <div class="line not-covered" id="L1230">
    <div class="line-number"><a href="#L1230">1230</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.complete = {</div>
  </div>
  <div class="line not-covered" id="L1231">
    <div class="line-number"><a href="#L1231">1231</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(async_fn, timeout)</div>
  </div>
  <div class="line not-covered" id="L1232">
    <div class="line-number"><a href="#L1232">1232</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(async_fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1233">
    <div class="line-number"><a href="#L1233">1233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Expected a promise, got &quot; .. type(async_fn))</div>
  </div>
  <div class="line not-covered" id="L1234">
    <div class="line-number"><a href="#L1234">1234</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1235">
    <div class="line-number"><a href="#L1235">1235</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1236">
    <div class="line-number"><a href="#L1236">1236</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    timeout = timeout or 1000 -- Default 1 second timeout</div>
  </div>
  <div class="line not-executable" id="L1237">
    <div class="line-number"><a href="#L1237">1237</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1238">
    <div class="line-number"><a href="#L1238">1238</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if we're in an async context</div>
  </div>
  <div class="line not-covered" id="L1239">
    <div class="line-number"><a href="#L1239">1239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local async_module = package.loaded[&quot;lib.async&quot;] or package.loaded[&quot;lib.async.init&quot;]</div>
  </div>
  <div class="line not-covered" id="L1240">
    <div class="line-number"><a href="#L1240">1240</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not async_module or not async_module.is_in_async_context then</div>
  </div>
  <div class="line not-covered" id="L1241">
    <div class="line-number"><a href="#L1241">1241</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Async assertions can only be used in async test contexts&quot;)</div>
  </div>
  <div class="line not-covered" id="L1242">
    <div class="line-number"><a href="#L1242">1242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1243">
    <div class="line-number"><a href="#L1243">1243</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1244">
    <div class="line-number"><a href="#L1244">1244</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not async_module.is_in_async_context() then</div>
  </div>
  <div class="line not-covered" id="L1245">
    <div class="line-number"><a href="#L1245">1245</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Async assertions can only be used in async test contexts&quot;)</div>
  </div>
  <div class="line not-covered" id="L1246">
    <div class="line-number"><a href="#L1246">1246</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1247">
    <div class="line-number"><a href="#L1247">1247</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1248">
    <div class="line-number"><a href="#L1248">1248</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local completed = false</div>
  </div>
  <div class="line not-covered" id="L1249">
    <div class="line-number"><a href="#L1249">1249</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result_value</div>
  </div>
  <div class="line not-covered" id="L1250">
    <div class="line-number"><a href="#L1250">1250</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local error_value</div>
  </div>
  <div class="line not-executable" id="L1251">
    <div class="line-number"><a href="#L1251">1251</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1252">
    <div class="line-number"><a href="#L1252">1252</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Function to capture the result</div>
  </div>
  <div class="line not-covered" id="L1253">
    <div class="line-number"><a href="#L1253">1253</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local function capture_result(...)</div>
  </div>
  <div class="line not-covered" id="L1254">
    <div class="line-number"><a href="#L1254">1254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completed = true</div>
  </div>
  <div class="line not-covered" id="L1255">
    <div class="line-number"><a href="#L1255">1255</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if select('#', ...) &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L1256">
    <div class="line-number"><a href="#L1256">1256</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result_value = ...</div>
  </div>
  <div class="line not-covered" id="L1257">
    <div class="line-number"><a href="#L1257">1257</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1258">
    <div class="line-number"><a href="#L1258">1258</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1259">
    <div class="line-number"><a href="#L1259">1259</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1260">
    <div class="line-number"><a href="#L1260">1260</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Start the async operation</div>
  </div>
  <div class="line not-covered" id="L1261">
    <div class="line-number"><a href="#L1261">1261</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, err = pcall(function()</div>
  </div>
  <div class="line not-executable" id="L1262">
    <div class="line-number"><a href="#L1262">1262</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Start the async function and pass the capture function as a callback</div>
  </div>
  <div class="line not-covered" id="L1263">
    <div class="line-number"><a href="#L1263">1263</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      async_fn(capture_result)</div>
  </div>
  <div class="line not-covered" id="L1264">
    <div class="line-number"><a href="#L1264">1264</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1265">
    <div class="line-number"><a href="#L1265">1265</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1266">
    <div class="line-number"><a href="#L1266">1266</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line not-covered" id="L1267">
    <div class="line-number"><a href="#L1267">1267</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_value = err</div>
  </div>
  <div class="line not-covered" id="L1268">
    <div class="line-number"><a href="#L1268">1268</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completed = true</div>
  </div>
  <div class="line not-covered" id="L1269">
    <div class="line-number"><a href="#L1269">1269</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1270">
    <div class="line-number"><a href="#L1270">1270</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1271">
    <div class="line-number"><a href="#L1271">1271</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Wait for the async operation to complete or timeout</div>
  </div>
  <div class="line not-covered" id="L1272">
    <div class="line-number"><a href="#L1272">1272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local wait_result = pcall(function()</div>
  </div>
  <div class="line not-covered" id="L1273">
    <div class="line-number"><a href="#L1273">1273</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      async_module.wait_until(function() return completed end, timeout)</div>
  </div>
  <div class="line not-covered" id="L1274">
    <div class="line-number"><a href="#L1274">1274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1275">
    <div class="line-number"><a href="#L1275">1275</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1276">
    <div class="line-number"><a href="#L1276">1276</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If there was an error running the function, throw it</div>
  </div>
  <div class="line not-covered" id="L1277">
    <div class="line-number"><a href="#L1277">1277</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if error_value then</div>
  </div>
  <div class="line not-covered" id="L1278">
    <div class="line-number"><a href="#L1278">1278</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(error_value)</div>
  </div>
  <div class="line not-covered" id="L1279">
    <div class="line-number"><a href="#L1279">1279</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1280">
    <div class="line-number"><a href="#L1280">1280</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1281">
    <div class="line-number"><a href="#L1281">1281</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If wait_until timed out, wait_result will be false</div>
  </div>
  <div class="line not-covered" id="L1282">
    <div class="line-number"><a href="#L1282">1282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return wait_result,</div>
  </div>
  <div class="line not-covered" id="L1283">
    <div class="line-number"><a href="#L1283">1283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;async operation did not complete within &quot; .. timeout .. &quot;ms&quot;,</div>
  </div>
  <div class="line not-covered" id="L1284">
    <div class="line-number"><a href="#L1284">1284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;async operation completed when it was expected to timeout&quot;</div>
  </div>
  <div class="line not-covered" id="L1285">
    <div class="line-number"><a href="#L1285">1285</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1286">
    <div class="line-number"><a href="#L1286">1286</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1287">
    <div class="line-number"><a href="#L1287">1287</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.complete_within = {</div>
  </div>
  <div class="line not-covered" id="L1288">
    <div class="line-number"><a href="#L1288">1288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(async_fn, timeout)</div>
  </div>
  <div class="line not-covered" id="L1289">
    <div class="line-number"><a href="#L1289">1289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(async_fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1290">
    <div class="line-number"><a href="#L1290">1290</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Expected a promise, got &quot; .. type(async_fn))</div>
  </div>
  <div class="line not-covered" id="L1291">
    <div class="line-number"><a href="#L1291">1291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1292">
    <div class="line-number"><a href="#L1292">1292</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1293">
    <div class="line-number"><a href="#L1293">1293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(timeout) ~= &quot;number&quot; or timeout &lt;= 0 then</div>
  </div>
  <div class="line not-covered" id="L1294">
    <div class="line-number"><a href="#L1294">1294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;timeout must be a positive number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1295">
    <div class="line-number"><a href="#L1295">1295</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1296">
    <div class="line-number"><a href="#L1296">1296</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1297">
    <div class="line-number"><a href="#L1297">1297</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if we're in an async context</div>
  </div>
  <div class="line not-covered" id="L1298">
    <div class="line-number"><a href="#L1298">1298</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local async_module = package.loaded[&quot;lib.async&quot;] or package.loaded[&quot;lib.async.init&quot;]</div>
  </div>
  <div class="line not-covered" id="L1299">
    <div class="line-number"><a href="#L1299">1299</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not async_module or not async_module.is_in_async_context then</div>
  </div>
  <div class="line not-covered" id="L1300">
    <div class="line-number"><a href="#L1300">1300</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Async assertions can only be used in async test contexts&quot;)</div>
  </div>
  <div class="line not-covered" id="L1301">
    <div class="line-number"><a href="#L1301">1301</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1302">
    <div class="line-number"><a href="#L1302">1302</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1303">
    <div class="line-number"><a href="#L1303">1303</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not async_module.is_in_async_context() then</div>
  </div>
  <div class="line not-covered" id="L1304">
    <div class="line-number"><a href="#L1304">1304</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Async assertions can only be used in async test contexts&quot;)</div>
  </div>
  <div class="line not-covered" id="L1305">
    <div class="line-number"><a href="#L1305">1305</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1306">
    <div class="line-number"><a href="#L1306">1306</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1307">
    <div class="line-number"><a href="#L1307">1307</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local completed = false</div>
  </div>
  <div class="line not-covered" id="L1308">
    <div class="line-number"><a href="#L1308">1308</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local start_time = os.clock() * 1000</div>
  </div>
  <div class="line not-covered" id="L1309">
    <div class="line-number"><a href="#L1309">1309</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result_value</div>
  </div>
  <div class="line not-covered" id="L1310">
    <div class="line-number"><a href="#L1310">1310</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local error_value</div>
  </div>
  <div class="line not-executable" id="L1311">
    <div class="line-number"><a href="#L1311">1311</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1312">
    <div class="line-number"><a href="#L1312">1312</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Function to capture the result</div>
  </div>
  <div class="line not-covered" id="L1313">
    <div class="line-number"><a href="#L1313">1313</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local function capture_result(...)</div>
  </div>
  <div class="line not-covered" id="L1314">
    <div class="line-number"><a href="#L1314">1314</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completed = true</div>
  </div>
  <div class="line not-covered" id="L1315">
    <div class="line-number"><a href="#L1315">1315</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if select('#', ...) &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L1316">
    <div class="line-number"><a href="#L1316">1316</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result_value = ...</div>
  </div>
  <div class="line not-covered" id="L1317">
    <div class="line-number"><a href="#L1317">1317</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1318">
    <div class="line-number"><a href="#L1318">1318</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1319">
    <div class="line-number"><a href="#L1319">1319</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1320">
    <div class="line-number"><a href="#L1320">1320</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Start the async operation</div>
  </div>
  <div class="line not-covered" id="L1321">
    <div class="line-number"><a href="#L1321">1321</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, err = pcall(function()</div>
  </div>
  <div class="line not-executable" id="L1322">
    <div class="line-number"><a href="#L1322">1322</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Start the async function and pass the capture function as a callback</div>
  </div>
  <div class="line not-covered" id="L1323">
    <div class="line-number"><a href="#L1323">1323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      async_fn(capture_result)</div>
  </div>
  <div class="line not-covered" id="L1324">
    <div class="line-number"><a href="#L1324">1324</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1325">
    <div class="line-number"><a href="#L1325">1325</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1326">
    <div class="line-number"><a href="#L1326">1326</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line not-covered" id="L1327">
    <div class="line-number"><a href="#L1327">1327</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_value = err</div>
  </div>
  <div class="line not-covered" id="L1328">
    <div class="line-number"><a href="#L1328">1328</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completed = true</div>
  </div>
  <div class="line not-covered" id="L1329">
    <div class="line-number"><a href="#L1329">1329</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1330">
    <div class="line-number"><a href="#L1330">1330</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1331">
    <div class="line-number"><a href="#L1331">1331</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Wait for the async operation to complete or timeout</div>
  </div>
  <div class="line not-covered" id="L1332">
    <div class="line-number"><a href="#L1332">1332</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local wait_result = pcall(function()</div>
  </div>
  <div class="line not-covered" id="L1333">
    <div class="line-number"><a href="#L1333">1333</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      async_module.wait_until(function() return completed end, timeout)</div>
  </div>
  <div class="line not-covered" id="L1334">
    <div class="line-number"><a href="#L1334">1334</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1335">
    <div class="line-number"><a href="#L1335">1335</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1336">
    <div class="line-number"><a href="#L1336">1336</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If there was an error running the function, throw it</div>
  </div>
  <div class="line not-covered" id="L1337">
    <div class="line-number"><a href="#L1337">1337</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if error_value then</div>
  </div>
  <div class="line not-covered" id="L1338">
    <div class="line-number"><a href="#L1338">1338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(error_value)</div>
  </div>
  <div class="line not-covered" id="L1339">
    <div class="line-number"><a href="#L1339">1339</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1340">
    <div class="line-number"><a href="#L1340">1340</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1341">
    <div class="line-number"><a href="#L1341">1341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local elapsed = (os.clock() * 1000) - start_time</div>
  </div>
  <div class="line not-executable" id="L1342">
    <div class="line-number"><a href="#L1342">1342</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1343">
    <div class="line-number"><a href="#L1343">1343</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If wait_until timed out, wait_result will be false</div>
  </div>
  <div class="line not-covered" id="L1344">
    <div class="line-number"><a href="#L1344">1344</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return wait_result,</div>
  </div>
  <div class="line not-covered" id="L1345">
    <div class="line-number"><a href="#L1345">1345</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;async operation did not complete within &quot; .. timeout .. &quot;ms&quot;,</div>
  </div>
  <div class="line not-covered" id="L1346">
    <div class="line-number"><a href="#L1346">1346</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;async operation completed within &quot; .. timeout .. &quot;ms when it was expected to timeout&quot;</div>
  </div>
  <div class="line not-covered" id="L1347">
    <div class="line-number"><a href="#L1347">1347</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1348">
    <div class="line-number"><a href="#L1348">1348</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1349">
    <div class="line-number"><a href="#L1349">1349</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.resolve_with = {</div>
  </div>
  <div class="line not-covered" id="L1350">
    <div class="line-number"><a href="#L1350">1350</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(async_fn, expected_value, timeout)</div>
  </div>
  <div class="line not-covered" id="L1351">
    <div class="line-number"><a href="#L1351">1351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(async_fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1352">
    <div class="line-number"><a href="#L1352">1352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Expected a promise, got &quot; .. type(async_fn))</div>
  </div>
  <div class="line not-covered" id="L1353">
    <div class="line-number"><a href="#L1353">1353</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1354">
    <div class="line-number"><a href="#L1354">1354</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1355">
    <div class="line-number"><a href="#L1355">1355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    timeout = timeout or 1000 -- Default 1 second timeout</div>
  </div>
  <div class="line not-executable" id="L1356">
    <div class="line-number"><a href="#L1356">1356</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1357">
    <div class="line-number"><a href="#L1357">1357</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if we're in an async context</div>
  </div>
  <div class="line not-covered" id="L1358">
    <div class="line-number"><a href="#L1358">1358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local async_module = package.loaded[&quot;lib.async&quot;] or package.loaded[&quot;lib.async.init&quot;]</div>
  </div>
  <div class="line not-covered" id="L1359">
    <div class="line-number"><a href="#L1359">1359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not async_module or not async_module.is_in_async_context then</div>
  </div>
  <div class="line not-covered" id="L1360">
    <div class="line-number"><a href="#L1360">1360</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Async assertions can only be used in async test contexts&quot;)</div>
  </div>
  <div class="line not-covered" id="L1361">
    <div class="line-number"><a href="#L1361">1361</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1362">
    <div class="line-number"><a href="#L1362">1362</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1363">
    <div class="line-number"><a href="#L1363">1363</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not async_module.is_in_async_context() then</div>
  </div>
  <div class="line not-covered" id="L1364">
    <div class="line-number"><a href="#L1364">1364</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Async assertions can only be used in async test contexts&quot;)</div>
  </div>
  <div class="line not-covered" id="L1365">
    <div class="line-number"><a href="#L1365">1365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1366">
    <div class="line-number"><a href="#L1366">1366</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1367">
    <div class="line-number"><a href="#L1367">1367</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local completed = false</div>
  </div>
  <div class="line not-covered" id="L1368">
    <div class="line-number"><a href="#L1368">1368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result_value</div>
  </div>
  <div class="line not-covered" id="L1369">
    <div class="line-number"><a href="#L1369">1369</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local error_value</div>
  </div>
  <div class="line not-executable" id="L1370">
    <div class="line-number"><a href="#L1370">1370</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1371">
    <div class="line-number"><a href="#L1371">1371</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Function to capture the result</div>
  </div>
  <div class="line not-covered" id="L1372">
    <div class="line-number"><a href="#L1372">1372</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local function capture_result(...)</div>
  </div>
  <div class="line not-covered" id="L1373">
    <div class="line-number"><a href="#L1373">1373</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completed = true</div>
  </div>
  <div class="line not-covered" id="L1374">
    <div class="line-number"><a href="#L1374">1374</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if select('#', ...) &gt; 0 then</div>
  </div>
  <div class="line not-covered" id="L1375">
    <div class="line-number"><a href="#L1375">1375</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        result_value = ...</div>
  </div>
  <div class="line not-covered" id="L1376">
    <div class="line-number"><a href="#L1376">1376</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1377">
    <div class="line-number"><a href="#L1377">1377</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1378">
    <div class="line-number"><a href="#L1378">1378</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1379">
    <div class="line-number"><a href="#L1379">1379</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Start the async operation</div>
  </div>
  <div class="line not-covered" id="L1380">
    <div class="line-number"><a href="#L1380">1380</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, err = pcall(function()</div>
  </div>
  <div class="line not-executable" id="L1381">
    <div class="line-number"><a href="#L1381">1381</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Start the async function and pass the capture function as a callback</div>
  </div>
  <div class="line not-covered" id="L1382">
    <div class="line-number"><a href="#L1382">1382</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      async_fn(capture_result)</div>
  </div>
  <div class="line not-covered" id="L1383">
    <div class="line-number"><a href="#L1383">1383</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1384">
    <div class="line-number"><a href="#L1384">1384</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1385">
    <div class="line-number"><a href="#L1385">1385</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line not-covered" id="L1386">
    <div class="line-number"><a href="#L1386">1386</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_value = err</div>
  </div>
  <div class="line not-covered" id="L1387">
    <div class="line-number"><a href="#L1387">1387</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completed = true</div>
  </div>
  <div class="line not-covered" id="L1388">
    <div class="line-number"><a href="#L1388">1388</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1389">
    <div class="line-number"><a href="#L1389">1389</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1390">
    <div class="line-number"><a href="#L1390">1390</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Wait for the async operation to complete or timeout</div>
  </div>
  <div class="line not-covered" id="L1391">
    <div class="line-number"><a href="#L1391">1391</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local wait_result = pcall(function()</div>
  </div>
  <div class="line not-covered" id="L1392">
    <div class="line-number"><a href="#L1392">1392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      async_module.wait_until(function() return completed end, timeout)</div>
  </div>
  <div class="line not-covered" id="L1393">
    <div class="line-number"><a href="#L1393">1393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1394">
    <div class="line-number"><a href="#L1394">1394</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1395">
    <div class="line-number"><a href="#L1395">1395</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If there was an error running the function, throw it</div>
  </div>
  <div class="line not-covered" id="L1396">
    <div class="line-number"><a href="#L1396">1396</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if error_value then</div>
  </div>
  <div class="line not-covered" id="L1397">
    <div class="line-number"><a href="#L1397">1397</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(error_value)</div>
  </div>
  <div class="line not-covered" id="L1398">
    <div class="line-number"><a href="#L1398">1398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1399">
    <div class="line-number"><a href="#L1399">1399</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1400">
    <div class="line-number"><a href="#L1400">1400</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If wait_until timed out</div>
  </div>
  <div class="line not-covered" id="L1401">
    <div class="line-number"><a href="#L1401">1401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not wait_result then</div>
  </div>
  <div class="line not-covered" id="L1402">
    <div class="line-number"><a href="#L1402">1402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, &quot;async operation did not complete within &quot; .. timeout .. &quot;ms&quot;, nil</div>
  </div>
  <div class="line not-covered" id="L1403">
    <div class="line-number"><a href="#L1403">1403</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1404">
    <div class="line-number"><a href="#L1404">1404</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1405">
    <div class="line-number"><a href="#L1405">1405</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if the result value matches the expected value</div>
  </div>
  <div class="line not-covered" id="L1406">
    <div class="line-number"><a href="#L1406">1406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return M.eq(result_value, expected_value),</div>
  </div>
  <div class="line not-covered" id="L1407">
    <div class="line-number"><a href="#L1407">1407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected async operation to resolve with &quot; .. stringify(expected_value) .. </div>
  </div>
  <div class="line not-covered" id="L1408">
    <div class="line-number"><a href="#L1408">1408</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot; but got &quot; .. stringify(result_value),</div>
  </div>
  <div class="line not-covered" id="L1409">
    <div class="line-number"><a href="#L1409">1409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected async operation to not resolve with &quot; .. stringify(expected_value)</div>
  </div>
  <div class="line not-covered" id="L1410">
    <div class="line-number"><a href="#L1410">1410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1411">
    <div class="line-number"><a href="#L1411">1411</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1412">
    <div class="line-number"><a href="#L1412">1412</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.reject = {</div>
  </div>
  <div class="line not-covered" id="L1413">
    <div class="line-number"><a href="#L1413">1413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(async_fn, error_pattern, timeout)</div>
  </div>
  <div class="line not-covered" id="L1414">
    <div class="line-number"><a href="#L1414">1414</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(async_fn) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1415">
    <div class="line-number"><a href="#L1415">1415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Expected a promise, got &quot; .. type(async_fn))</div>
  </div>
  <div class="line not-covered" id="L1416">
    <div class="line-number"><a href="#L1416">1416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1417">
    <div class="line-number"><a href="#L1417">1417</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1418">
    <div class="line-number"><a href="#L1418">1418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    timeout = timeout or 1000 -- Default 1 second timeout</div>
  </div>
  <div class="line not-executable" id="L1419">
    <div class="line-number"><a href="#L1419">1419</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1420">
    <div class="line-number"><a href="#L1420">1420</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if we're in an async context</div>
  </div>
  <div class="line not-covered" id="L1421">
    <div class="line-number"><a href="#L1421">1421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local async_module = package.loaded[&quot;lib.async&quot;] or package.loaded[&quot;lib.async.init&quot;]</div>
  </div>
  <div class="line not-covered" id="L1422">
    <div class="line-number"><a href="#L1422">1422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not async_module or not async_module.is_in_async_context then</div>
  </div>
  <div class="line not-covered" id="L1423">
    <div class="line-number"><a href="#L1423">1423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Async assertions can only be used in async test contexts&quot;)</div>
  </div>
  <div class="line not-covered" id="L1424">
    <div class="line-number"><a href="#L1424">1424</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1425">
    <div class="line-number"><a href="#L1425">1425</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1426">
    <div class="line-number"><a href="#L1426">1426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not async_module.is_in_async_context() then</div>
  </div>
  <div class="line not-covered" id="L1427">
    <div class="line-number"><a href="#L1427">1427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;Async assertions can only be used in async test contexts&quot;)</div>
  </div>
  <div class="line not-covered" id="L1428">
    <div class="line-number"><a href="#L1428">1428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1429">
    <div class="line-number"><a href="#L1429">1429</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1430">
    <div class="line-number"><a href="#L1430">1430</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local completed = false</div>
  </div>
  <div class="line not-covered" id="L1431">
    <div class="line-number"><a href="#L1431">1431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local rejected = false</div>
  </div>
  <div class="line not-covered" id="L1432">
    <div class="line-number"><a href="#L1432">1432</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local error_message</div>
  </div>
  <div class="line not-executable" id="L1433">
    <div class="line-number"><a href="#L1433">1433</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1434">
    <div class="line-number"><a href="#L1434">1434</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Function to capture success</div>
  </div>
  <div class="line not-covered" id="L1435">
    <div class="line-number"><a href="#L1435">1435</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local function success_callback()</div>
  </div>
  <div class="line not-covered" id="L1436">
    <div class="line-number"><a href="#L1436">1436</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completed = true</div>
  </div>
  <div class="line not-covered" id="L1437">
    <div class="line-number"><a href="#L1437">1437</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1438">
    <div class="line-number"><a href="#L1438">1438</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1439">
    <div class="line-number"><a href="#L1439">1439</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Function to capture error</div>
  </div>
  <div class="line not-covered" id="L1440">
    <div class="line-number"><a href="#L1440">1440</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local function error_callback(err)</div>
  </div>
  <div class="line not-covered" id="L1441">
    <div class="line-number"><a href="#L1441">1441</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completed = true</div>
  </div>
  <div class="line not-covered" id="L1442">
    <div class="line-number"><a href="#L1442">1442</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      rejected = true</div>
  </div>
  <div class="line not-covered" id="L1443">
    <div class="line-number"><a href="#L1443">1443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_message = err</div>
  </div>
  <div class="line not-covered" id="L1444">
    <div class="line-number"><a href="#L1444">1444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1445">
    <div class="line-number"><a href="#L1445">1445</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1446">
    <div class="line-number"><a href="#L1446">1446</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Start the async operation</div>
  </div>
  <div class="line not-covered" id="L1447">
    <div class="line-number"><a href="#L1447">1447</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, err = pcall(function()</div>
  </div>
  <div class="line not-executable" id="L1448">
    <div class="line-number"><a href="#L1448">1448</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Start the async function with success and error callbacks</div>
  </div>
  <div class="line not-covered" id="L1449">
    <div class="line-number"><a href="#L1449">1449</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      async_fn(success_callback, error_callback)</div>
  </div>
  <div class="line not-covered" id="L1450">
    <div class="line-number"><a href="#L1450">1450</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1451">
    <div class="line-number"><a href="#L1451">1451</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1452">
    <div class="line-number"><a href="#L1452">1452</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line not-executable" id="L1453">
    <div class="line-number"><a href="#L1453">1453</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- The function itself threw an error (not an async rejection)</div>
  </div>
  <div class="line not-covered" id="L1454">
    <div class="line-number"><a href="#L1454">1454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      rejected = true</div>
  </div>
  <div class="line not-covered" id="L1455">
    <div class="line-number"><a href="#L1455">1455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_message = err</div>
  </div>
  <div class="line not-covered" id="L1456">
    <div class="line-number"><a href="#L1456">1456</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completed = true</div>
  </div>
  <div class="line not-covered" id="L1457">
    <div class="line-number"><a href="#L1457">1457</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1458">
    <div class="line-number"><a href="#L1458">1458</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1459">
    <div class="line-number"><a href="#L1459">1459</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Wait for the async operation to complete or timeout</div>
  </div>
  <div class="line not-covered" id="L1460">
    <div class="line-number"><a href="#L1460">1460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local wait_result = pcall(function()</div>
  </div>
  <div class="line not-covered" id="L1461">
    <div class="line-number"><a href="#L1461">1461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      async_module.wait_until(function() return completed end, timeout)</div>
  </div>
  <div class="line not-covered" id="L1462">
    <div class="line-number"><a href="#L1462">1462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end)</div>
  </div>
  <div class="line not-executable" id="L1463">
    <div class="line-number"><a href="#L1463">1463</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1464">
    <div class="line-number"><a href="#L1464">1464</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If wait_until timed out</div>
  </div>
  <div class="line not-covered" id="L1465">
    <div class="line-number"><a href="#L1465">1465</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not wait_result then</div>
  </div>
  <div class="line not-covered" id="L1466">
    <div class="line-number"><a href="#L1466">1466</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, &quot;async operation did not complete within &quot; .. timeout .. &quot;ms&quot;, nil</div>
  </div>
  <div class="line not-covered" id="L1467">
    <div class="line-number"><a href="#L1467">1467</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1468">
    <div class="line-number"><a href="#L1468">1468</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1469">
    <div class="line-number"><a href="#L1469">1469</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If error pattern is provided, check that the error matches</div>
  </div>
  <div class="line not-covered" id="L1470">
    <div class="line-number"><a href="#L1470">1470</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if error_pattern and rejected then</div>
  </div>
  <div class="line not-covered" id="L1471">
    <div class="line-number"><a href="#L1471">1471</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local matches_pattern = type(error_message) == &quot;string&quot; and </div>
  </div>
  <div class="line not-covered" id="L1472">
    <div class="line-number"><a href="#L1472">1472</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                            string.find(error_message, error_pattern) ~= nil</div>
  </div>
  <div class="line not-executable" id="L1473">
    <div class="line-number"><a href="#L1473">1473</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1474">
    <div class="line-number"><a href="#L1474">1474</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if not matches_pattern then</div>
  </div>
  <div class="line not-covered" id="L1475">
    <div class="line-number"><a href="#L1475">1475</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false, </div>
  </div>
  <div class="line not-covered" id="L1476">
    <div class="line-number"><a href="#L1476">1476</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected async operation to reject with error matching &quot; .. </div>
  </div>
  <div class="line not-covered" id="L1477">
    <div class="line-number"><a href="#L1477">1477</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          stringify(error_pattern) .. &quot; but got &quot; .. stringify(error_message),</div>
  </div>
  <div class="line not-covered" id="L1478">
    <div class="line-number"><a href="#L1478">1478</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          nil</div>
  </div>
  <div class="line not-covered" id="L1479">
    <div class="line-number"><a href="#L1479">1479</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1480">
    <div class="line-number"><a href="#L1480">1480</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1481">
    <div class="line-number"><a href="#L1481">1481</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1482">
    <div class="line-number"><a href="#L1482">1482</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return rejected,</div>
  </div>
  <div class="line not-covered" id="L1483">
    <div class="line-number"><a href="#L1483">1483</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected async operation to reject with an error&quot; .. </div>
  </div>
  <div class="line not-covered" id="L1484">
    <div class="line-number"><a href="#L1484">1484</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      (error_pattern and &quot; matching &quot; .. stringify(error_pattern) or &quot;&quot;),</div>
  </div>
  <div class="line not-covered" id="L1485">
    <div class="line-number"><a href="#L1485">1485</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected async operation to not reject with an error&quot;</div>
  </div>
  <div class="line not-covered" id="L1486">
    <div class="line-number"><a href="#L1486">1486</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1487">
    <div class="line-number"><a href="#L1487">1487</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1488">
    <div class="line-number"><a href="#L1488">1488</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Continue adding assertions to the paths table</div>
  </div>
  <div class="line not-executable" id="L1489">
    <div class="line-number"><a href="#L1489">1489</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Check if a table contains all specified keys </div>
  </div>
  <div class="line not-covered" id="L1490">
    <div class="line-number"><a href="#L1490">1490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.keys = {</div>
  </div>
  <div class="line not-covered" id="L1491">
    <div class="line-number"><a href="#L1491">1491</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L1492">
    <div class="line-number"><a href="#L1492">1492</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1493">
    <div class="line-number"><a href="#L1493">1493</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a table&quot;)</div>
  </div>
  <div class="line not-covered" id="L1494">
    <div class="line-number"><a href="#L1494">1494</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1495">
    <div class="line-number"><a href="#L1495">1495</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(x) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1496">
    <div class="line-number"><a href="#L1496">1496</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(x) .. &quot; to be a table containing keys to check for&quot;)</div>
  </div>
  <div class="line not-covered" id="L1497">
    <div class="line-number"><a href="#L1497">1497</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1498">
    <div class="line-number"><a href="#L1498">1498</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, key in ipairs(x) do</div>
  </div>
  <div class="line not-covered" id="L1499">
    <div class="line-number"><a href="#L1499">1499</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if v[key] == nil then</div>
  </div>
  <div class="line not-covered" id="L1500">
    <div class="line-number"><a href="#L1500">1500</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false,</div>
  </div>
  <div class="line not-covered" id="L1501">
    <div class="line-number"><a href="#L1501">1501</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. stringify(v) .. &quot; to contain key &quot; .. tostring(key),</div>
  </div>
  <div class="line not-covered" id="L1502">
    <div class="line-number"><a href="#L1502">1502</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          &quot;expected &quot; .. stringify(v) .. &quot; to not contain key &quot; .. tostring(key)</div>
  </div>
  <div class="line not-covered" id="L1503">
    <div class="line-number"><a href="#L1503">1503</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1504">
    <div class="line-number"><a href="#L1504">1504</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1505">
    <div class="line-number"><a href="#L1505">1505</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true,</div>
  </div>
  <div class="line not-covered" id="L1506">
    <div class="line-number"><a href="#L1506">1506</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. stringify(v) .. &quot; to contain keys &quot; .. stringify(x),</div>
  </div>
  <div class="line not-covered" id="L1507">
    <div class="line-number"><a href="#L1507">1507</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. stringify(v) .. &quot; to not contain keys &quot; .. stringify(x)</div>
  </div>
  <div class="line not-covered" id="L1508">
    <div class="line-number"><a href="#L1508">1508</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1509">
    <div class="line-number"><a href="#L1509">1509</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1510">
    <div class="line-number"><a href="#L1510">1510</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Check if a table contains a specific key</div>
  </div>
  <div class="line not-covered" id="L1511">
    <div class="line-number"><a href="#L1511">1511</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.key = {</div>
  </div>
  <div class="line not-covered" id="L1512">
    <div class="line-number"><a href="#L1512">1512</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L1513">
    <div class="line-number"><a href="#L1513">1513</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1514">
    <div class="line-number"><a href="#L1514">1514</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a table&quot;)</div>
  </div>
  <div class="line not-covered" id="L1515">
    <div class="line-number"><a href="#L1515">1515</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1516">
    <div class="line-number"><a href="#L1516">1516</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v[x] ~= nil,</div>
  </div>
  <div class="line not-covered" id="L1517">
    <div class="line-number"><a href="#L1517">1517</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. stringify(v) .. &quot; to contain key &quot; .. tostring(x),</div>
  </div>
  <div class="line not-covered" id="L1518">
    <div class="line-number"><a href="#L1518">1518</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. stringify(v) .. &quot; to not contain key &quot; .. tostring(x)</div>
  </div>
  <div class="line not-covered" id="L1519">
    <div class="line-number"><a href="#L1519">1519</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1520">
    <div class="line-number"><a href="#L1520">1520</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1521">
    <div class="line-number"><a href="#L1521">1521</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Numeric comparison assertions</div>
  </div>
  <div class="line not-covered" id="L1522">
    <div class="line-number"><a href="#L1522">1522</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_greater_than = {</div>
  </div>
  <div class="line not-covered" id="L1523">
    <div class="line-number"><a href="#L1523">1523</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L1524">
    <div class="line-number"><a href="#L1524">1524</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1525">
    <div class="line-number"><a href="#L1525">1525</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1526">
    <div class="line-number"><a href="#L1526">1526</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1527">
    <div class="line-number"><a href="#L1527">1527</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(x) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1528">
    <div class="line-number"><a href="#L1528">1528</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(x) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1529">
    <div class="line-number"><a href="#L1529">1529</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1530">
    <div class="line-number"><a href="#L1530">1530</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v &gt; x,</div>
  </div>
  <div class="line not-covered" id="L1531">
    <div class="line-number"><a href="#L1531">1531</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be greater than &quot; .. tostring(x),</div>
  </div>
  <div class="line not-covered" id="L1532">
    <div class="line-number"><a href="#L1532">1532</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be greater than &quot; .. tostring(x)</div>
  </div>
  <div class="line not-covered" id="L1533">
    <div class="line-number"><a href="#L1533">1533</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1534">
    <div class="line-number"><a href="#L1534">1534</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1535">
    <div class="line-number"><a href="#L1535">1535</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_less_than = {</div>
  </div>
  <div class="line not-covered" id="L1536">
    <div class="line-number"><a href="#L1536">1536</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L1537">
    <div class="line-number"><a href="#L1537">1537</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1538">
    <div class="line-number"><a href="#L1538">1538</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1539">
    <div class="line-number"><a href="#L1539">1539</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1540">
    <div class="line-number"><a href="#L1540">1540</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(x) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1541">
    <div class="line-number"><a href="#L1541">1541</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(x) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1542">
    <div class="line-number"><a href="#L1542">1542</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1543">
    <div class="line-number"><a href="#L1543">1543</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v &lt; x,</div>
  </div>
  <div class="line not-covered" id="L1544">
    <div class="line-number"><a href="#L1544">1544</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be less than &quot; .. tostring(x),</div>
  </div>
  <div class="line not-covered" id="L1545">
    <div class="line-number"><a href="#L1545">1545</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be less than &quot; .. tostring(x)</div>
  </div>
  <div class="line not-covered" id="L1546">
    <div class="line-number"><a href="#L1546">1546</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1547">
    <div class="line-number"><a href="#L1547">1547</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1548">
    <div class="line-number"><a href="#L1548">1548</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1549">
    <div class="line-number"><a href="#L1549">1549</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Check if a value is empty (string, table)</div>
  </div>
  <div class="line not-covered" id="L1550">
    <div class="line-number"><a href="#L1550">1550</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.empty = {</div>
  </div>
  <div class="line not-covered" id="L1551">
    <div class="line-number"><a href="#L1551">1551</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1552">
    <div class="line-number"><a href="#L1552">1552</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1553">
    <div class="line-number"><a href="#L1553">1553</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return v == &quot;&quot;,</div>
  </div>
  <div class="line not-covered" id="L1554">
    <div class="line-number"><a href="#L1554">1554</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected string &quot;' .. v .. '&quot; to be empty',</div>
  </div>
  <div class="line not-covered" id="L1555">
    <div class="line-number"><a href="#L1555">1555</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected string to not be empty'</div>
  </div>
  <div class="line not-covered" id="L1556">
    <div class="line-number"><a href="#L1556">1556</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif type(v) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1557">
    <div class="line-number"><a href="#L1557">1557</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return next(v) == nil,</div>
  </div>
  <div class="line not-covered" id="L1558">
    <div class="line-number"><a href="#L1558">1558</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected table to be empty, but it has &quot; .. </div>
  </div>
  <div class="line not-covered" id="L1559">
    <div class="line-number"><a href="#L1559">1559</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        (function() </div>
  </div>
  <div class="line not-covered" id="L1560">
    <div class="line-number"><a href="#L1560">1560</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local count = 0</div>
  </div>
  <div class="line not-covered" id="L1561">
    <div class="line-number"><a href="#L1561">1561</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          for _ in pairs(v) do count = count + 1 end</div>
  </div>
  <div class="line not-covered" id="L1562">
    <div class="line-number"><a href="#L1562">1562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          return count</div>
  </div>
  <div class="line not-covered" id="L1563">
    <div class="line-number"><a href="#L1563">1563</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end)() .. &quot; elements&quot;,</div>
  </div>
  <div class="line not-covered" id="L1564">
    <div class="line-number"><a href="#L1564">1564</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected table to not be empty&quot;</div>
  </div>
  <div class="line not-covered" id="L1565">
    <div class="line-number"><a href="#L1565">1565</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L1566">
    <div class="line-number"><a href="#L1566">1566</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;cannot check emptiness of a &quot; .. type(v))</div>
  </div>
  <div class="line not-covered" id="L1567">
    <div class="line-number"><a href="#L1567">1567</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1568">
    <div class="line-number"><a href="#L1568">1568</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1569">
    <div class="line-number"><a href="#L1569">1569</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1570">
    <div class="line-number"><a href="#L1570">1570</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1571">
    <div class="line-number"><a href="#L1571">1571</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Check if a number is positive</div>
  </div>
  <div class="line not-covered" id="L1572">
    <div class="line-number"><a href="#L1572">1572</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.positive = {</div>
  </div>
  <div class="line not-covered" id="L1573">
    <div class="line-number"><a href="#L1573">1573</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1574">
    <div class="line-number"><a href="#L1574">1574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1575">
    <div class="line-number"><a href="#L1575">1575</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1576">
    <div class="line-number"><a href="#L1576">1576</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1577">
    <div class="line-number"><a href="#L1577">1577</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1578">
    <div class="line-number"><a href="#L1578">1578</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v &gt; 0,</div>
  </div>
  <div class="line not-covered" id="L1579">
    <div class="line-number"><a href="#L1579">1579</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be positive&quot;,</div>
  </div>
  <div class="line not-covered" id="L1580">
    <div class="line-number"><a href="#L1580">1580</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be positive&quot;</div>
  </div>
  <div class="line not-covered" id="L1581">
    <div class="line-number"><a href="#L1581">1581</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1582">
    <div class="line-number"><a href="#L1582">1582</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1583">
    <div class="line-number"><a href="#L1583">1583</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1584">
    <div class="line-number"><a href="#L1584">1584</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Check if a number is negative</div>
  </div>
  <div class="line not-covered" id="L1585">
    <div class="line-number"><a href="#L1585">1585</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.negative = {</div>
  </div>
  <div class="line not-covered" id="L1586">
    <div class="line-number"><a href="#L1586">1586</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1587">
    <div class="line-number"><a href="#L1587">1587</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1588">
    <div class="line-number"><a href="#L1588">1588</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1589">
    <div class="line-number"><a href="#L1589">1589</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1590">
    <div class="line-number"><a href="#L1590">1590</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1591">
    <div class="line-number"><a href="#L1591">1591</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v &lt; 0,</div>
  </div>
  <div class="line not-covered" id="L1592">
    <div class="line-number"><a href="#L1592">1592</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be negative&quot;,</div>
  </div>
  <div class="line not-covered" id="L1593">
    <div class="line-number"><a href="#L1593">1593</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be negative&quot;</div>
  </div>
  <div class="line not-covered" id="L1594">
    <div class="line-number"><a href="#L1594">1594</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1595">
    <div class="line-number"><a href="#L1595">1595</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1596">
    <div class="line-number"><a href="#L1596">1596</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1597">
    <div class="line-number"><a href="#L1597">1597</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Check if a number is an integer</div>
  </div>
  <div class="line not-covered" id="L1598">
    <div class="line-number"><a href="#L1598">1598</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.integer = {</div>
  </div>
  <div class="line not-covered" id="L1599">
    <div class="line-number"><a href="#L1599">1599</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1600">
    <div class="line-number"><a href="#L1600">1600</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;number&quot; then</div>
  </div>
  <div class="line covered" id="L1601">
    <div class="line-number"><a href="#L1601">1601</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line covered" id="L1602">
    <div class="line-number"><a href="#L1602">1602</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1603">
    <div class="line-number"><a href="#L1603">1603</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L1604">
    <div class="line-number"><a href="#L1604">1604</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return v == math.floor(v),</div>
  </div>
  <div class="line covered" id="L1605">
    <div class="line-number"><a href="#L1605">1605</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be an integer&quot;,</div>
  </div>
  <div class="line covered" id="L1606">
    <div class="line-number"><a href="#L1606">1606</a></div>
    <div class="execution-count">2</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be an integer&quot;</div>
  </div>
  <div class="line covered" id="L1607">
    <div class="line-number"><a href="#L1607">1607</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L1608">
    <div class="line-number"><a href="#L1608">1608</a></div>
    <div class="execution-count">1</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1609">
    <div class="line-number"><a href="#L1609">1609</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1610">
    <div class="line-number"><a href="#L1610">1610</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Check if a string is all uppercase</div>
  </div>
  <div class="line covered" id="L1611">
    <div class="line-number"><a href="#L1611">1611</a></div>
    <div class="execution-count">2</div>    <div class="line-content">paths.uppercase = {</div>
  </div>
  <div class="line covered" id="L1612">
    <div class="line-number"><a href="#L1612">1612</a></div>
    <div class="execution-count">2</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line covered" id="L1613">
    <div class="line-number"><a href="#L1613">1613</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if type(v) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1614">
    <div class="line-number"><a href="#L1614">1614</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a string&quot;)</div>
  </div>
  <div class="line not-covered" id="L1615">
    <div class="line-number"><a href="#L1615">1615</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1616">
    <div class="line-number"><a href="#L1616">1616</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1617">
    <div class="line-number"><a href="#L1617">1617</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v == string.upper(v),</div>
  </div>
  <div class="line not-covered" id="L1618">
    <div class="line-number"><a href="#L1618">1618</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected string &quot;' .. v .. '&quot; to be uppercase',</div>
  </div>
  <div class="line not-covered" id="L1619">
    <div class="line-number"><a href="#L1619">1619</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected string &quot;' .. v .. '&quot; to not be uppercase'</div>
  </div>
  <div class="line not-covered" id="L1620">
    <div class="line-number"><a href="#L1620">1620</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1621">
    <div class="line-number"><a href="#L1621">1621</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1622">
    <div class="line-number"><a href="#L1622">1622</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1623">
    <div class="line-number"><a href="#L1623">1623</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Check if a string is all lowercase</div>
  </div>
  <div class="line not-covered" id="L1624">
    <div class="line-number"><a href="#L1624">1624</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.lowercase = {</div>
  </div>
  <div class="line not-covered" id="L1625">
    <div class="line-number"><a href="#L1625">1625</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1626">
    <div class="line-number"><a href="#L1626">1626</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1627">
    <div class="line-number"><a href="#L1627">1627</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a string&quot;)</div>
  </div>
  <div class="line not-covered" id="L1628">
    <div class="line-number"><a href="#L1628">1628</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1629">
    <div class="line-number"><a href="#L1629">1629</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L1630">
    <div class="line-number"><a href="#L1630">1630</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v == string.lower(v),</div>
  </div>
  <div class="line not-covered" id="L1631">
    <div class="line-number"><a href="#L1631">1631</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected string &quot;' .. v .. '&quot; to be lowercase',</div>
  </div>
  <div class="line not-covered" id="L1632">
    <div class="line-number"><a href="#L1632">1632</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected string &quot;' .. v .. '&quot; to not be lowercase'</div>
  </div>
  <div class="line not-covered" id="L1633">
    <div class="line-number"><a href="#L1633">1633</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1634">
    <div class="line-number"><a href="#L1634">1634</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1635">
    <div class="line-number"><a href="#L1635">1635</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_between = {</div>
  </div>
  <div class="line not-covered" id="L1636">
    <div class="line-number"><a href="#L1636">1636</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, min, max)</div>
  </div>
  <div class="line not-covered" id="L1637">
    <div class="line-number"><a href="#L1637">1637</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1638">
    <div class="line-number"><a href="#L1638">1638</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1639">
    <div class="line-number"><a href="#L1639">1639</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1640">
    <div class="line-number"><a href="#L1640">1640</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(min) ~= &quot;number&quot; or type(max) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1641">
    <div class="line-number"><a href="#L1641">1641</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected min and max to be numbers&quot;)</div>
  </div>
  <div class="line not-covered" id="L1642">
    <div class="line-number"><a href="#L1642">1642</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1643">
    <div class="line-number"><a href="#L1643">1643</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v &gt;= min and v &lt;= max,</div>
  </div>
  <div class="line not-covered" id="L1644">
    <div class="line-number"><a href="#L1644">1644</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be between &quot; .. tostring(min) .. &quot; and &quot; .. tostring(max),</div>
  </div>
  <div class="line not-covered" id="L1645">
    <div class="line-number"><a href="#L1645">1645</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be between &quot; .. tostring(min) .. &quot; and &quot; .. tostring(max)</div>
  </div>
  <div class="line not-covered" id="L1646">
    <div class="line-number"><a href="#L1646">1646</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1647">
    <div class="line-number"><a href="#L1647">1647</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1648">
    <div class="line-number"><a href="#L1648">1648</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_truthy = {</div>
  </div>
  <div class="line not-covered" id="L1649">
    <div class="line-number"><a href="#L1649">1649</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1650">
    <div class="line-number"><a href="#L1650">1650</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v and true or false,</div>
  </div>
  <div class="line not-covered" id="L1651">
    <div class="line-number"><a href="#L1651">1651</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be truthy&quot;,</div>
  </div>
  <div class="line not-covered" id="L1652">
    <div class="line-number"><a href="#L1652">1652</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be truthy&quot;</div>
  </div>
  <div class="line not-covered" id="L1653">
    <div class="line-number"><a href="#L1653">1653</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1654">
    <div class="line-number"><a href="#L1654">1654</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1655">
    <div class="line-number"><a href="#L1655">1655</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_falsy = {</div>
  </div>
  <div class="line not-covered" id="L1656">
    <div class="line-number"><a href="#L1656">1656</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1657">
    <div class="line-number"><a href="#L1657">1657</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return not v, &quot;expected &quot; .. tostring(v) .. &quot; to be falsy&quot;, &quot;expected &quot; .. tostring(v) .. &quot; to not be falsy&quot;</div>
  </div>
  <div class="line not-covered" id="L1658">
    <div class="line-number"><a href="#L1658">1658</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1659">
    <div class="line-number"><a href="#L1659">1659</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1660">
    <div class="line-number"><a href="#L1660">1660</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_falsey = {</div>
  </div>
  <div class="line not-covered" id="L1661">
    <div class="line-number"><a href="#L1661">1661</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1662">
    <div class="line-number"><a href="#L1662">1662</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return not v, &quot;expected &quot; .. tostring(v) .. &quot; to be falsey&quot;, &quot;expected &quot; .. tostring(v) .. &quot; to not be falsey&quot;</div>
  </div>
  <div class="line not-covered" id="L1663">
    <div class="line-number"><a href="#L1663">1663</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1664">
    <div class="line-number"><a href="#L1664">1664</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1665">
    <div class="line-number"><a href="#L1665">1665</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_approximately = {</div>
  </div>
  <div class="line not-covered" id="L1666">
    <div class="line-number"><a href="#L1666">1666</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, x, delta)</div>
  </div>
  <div class="line not-covered" id="L1667">
    <div class="line-number"><a href="#L1667">1667</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1668">
    <div class="line-number"><a href="#L1668">1668</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1669">
    <div class="line-number"><a href="#L1669">1669</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1670">
    <div class="line-number"><a href="#L1670">1670</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(x) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1671">
    <div class="line-number"><a href="#L1671">1671</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(x) .. &quot; to be a number&quot;)</div>
  </div>
  <div class="line not-covered" id="L1672">
    <div class="line-number"><a href="#L1672">1672</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1673">
    <div class="line-number"><a href="#L1673">1673</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    delta = delta or 0.0001</div>
  </div>
  <div class="line not-covered" id="L1674">
    <div class="line-number"><a href="#L1674">1674</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return math.abs(v - x) &lt;= delta,</div>
  </div>
  <div class="line not-covered" id="L1675">
    <div class="line-number"><a href="#L1675">1675</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to be approximately &quot; .. tostring(x) .. &quot; (±&quot; .. tostring(delta) .. &quot;)&quot;,</div>
  </div>
  <div class="line not-covered" id="L1676">
    <div class="line-number"><a href="#L1676">1676</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected &quot; .. tostring(v) .. &quot; to not be approximately &quot; .. tostring(x) .. &quot; (±&quot; .. tostring(delta) .. &quot;)&quot;</div>
  </div>
  <div class="line not-covered" id="L1677">
    <div class="line-number"><a href="#L1677">1677</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1678">
    <div class="line-number"><a href="#L1678">1678</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1679">
    <div class="line-number"><a href="#L1679">1679</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Satisfy assertion for custom predicates</div>
  </div>
  <div class="line not-covered" id="L1680">
    <div class="line-number"><a href="#L1680">1680</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.satisfy = {</div>
  </div>
  <div class="line not-covered" id="L1681">
    <div class="line-number"><a href="#L1681">1681</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, predicate)</div>
  </div>
  <div class="line not-covered" id="L1682">
    <div class="line-number"><a href="#L1682">1682</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(predicate) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1683">
    <div class="line-number"><a href="#L1683">1683</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected predicate to be a function, got &quot; .. type(predicate))</div>
  </div>
  <div class="line not-covered" id="L1684">
    <div class="line-number"><a href="#L1684">1684</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1685">
    <div class="line-number"><a href="#L1685">1685</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, result = pcall(predicate, v)</div>
  </div>
  <div class="line not-covered" id="L1686">
    <div class="line-number"><a href="#L1686">1686</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line not-covered" id="L1687">
    <div class="line-number"><a href="#L1687">1687</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;predicate function failed with error: &quot; .. tostring(result))</div>
  </div>
  <div class="line not-covered" id="L1688">
    <div class="line-number"><a href="#L1688">1688</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1689">
    <div class="line-number"><a href="#L1689">1689</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result,</div>
  </div>
  <div class="line not-covered" id="L1690">
    <div class="line-number"><a href="#L1690">1690</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected value to satisfy the given predicate function&quot;,</div>
  </div>
  <div class="line not-covered" id="L1691">
    <div class="line-number"><a href="#L1691">1691</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected value to not satisfy the given predicate function&quot;</div>
  </div>
  <div class="line not-covered" id="L1692">
    <div class="line-number"><a href="#L1692">1692</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1693">
    <div class="line-number"><a href="#L1693">1693</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1694">
    <div class="line-number"><a href="#L1694">1694</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- String assertions</div>
  </div>
  <div class="line not-covered" id="L1695">
    <div class="line-number"><a href="#L1695">1695</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.start_with = {</div>
  </div>
  <div class="line not-covered" id="L1696">
    <div class="line-number"><a href="#L1696">1696</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L1697">
    <div class="line-number"><a href="#L1697">1697</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1698">
    <div class="line-number"><a href="#L1698">1698</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a string&quot;)</div>
  </div>
  <div class="line not-covered" id="L1699">
    <div class="line-number"><a href="#L1699">1699</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1700">
    <div class="line-number"><a href="#L1700">1700</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(x) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1701">
    <div class="line-number"><a href="#L1701">1701</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(x) .. &quot; to be a string&quot;)</div>
  </div>
  <div class="line not-covered" id="L1702">
    <div class="line-number"><a href="#L1702">1702</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1703">
    <div class="line-number"><a href="#L1703">1703</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v:sub(1, #x) == x,</div>
  </div>
  <div class="line not-covered" id="L1704">
    <div class="line-number"><a href="#L1704">1704</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to start with &quot;' .. x .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L1705">
    <div class="line-number"><a href="#L1705">1705</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to not start with &quot;' .. x .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L1706">
    <div class="line-number"><a href="#L1706">1706</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1707">
    <div class="line-number"><a href="#L1707">1707</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1708">
    <div class="line-number"><a href="#L1708">1708</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.end_with = {</div>
  </div>
  <div class="line not-covered" id="L1709">
    <div class="line-number"><a href="#L1709">1709</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, x)</div>
  </div>
  <div class="line not-covered" id="L1710">
    <div class="line-number"><a href="#L1710">1710</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1711">
    <div class="line-number"><a href="#L1711">1711</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a string&quot;)</div>
  </div>
  <div class="line not-covered" id="L1712">
    <div class="line-number"><a href="#L1712">1712</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1713">
    <div class="line-number"><a href="#L1713">1713</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(x) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1714">
    <div class="line-number"><a href="#L1714">1714</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(x) .. &quot; to be a string&quot;)</div>
  </div>
  <div class="line not-covered" id="L1715">
    <div class="line-number"><a href="#L1715">1715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1716">
    <div class="line-number"><a href="#L1716">1716</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return v:sub(-#x) == x,</div>
  </div>
  <div class="line not-covered" id="L1717">
    <div class="line-number"><a href="#L1717">1717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to end with &quot;' .. x .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L1718">
    <div class="line-number"><a href="#L1718">1718</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected &quot;' .. v .. '&quot; to not end with &quot;' .. x .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L1719">
    <div class="line-number"><a href="#L1719">1719</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1720">
    <div class="line-number"><a href="#L1720">1720</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1721">
    <div class="line-number"><a href="#L1721">1721</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Type checking assertions</div>
  </div>
  <div class="line not-covered" id="L1722">
    <div class="line-number"><a href="#L1722">1722</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.be_type = {</div>
  </div>
  <div class="line not-covered" id="L1723">
    <div class="line-number"><a href="#L1723">1723</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  callable = true,</div>
  </div>
  <div class="line not-covered" id="L1724">
    <div class="line-number"><a href="#L1724">1724</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  comparable = true,</div>
  </div>
  <div class="line not-covered" id="L1725">
    <div class="line-number"><a href="#L1725">1725</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  iterable = true,</div>
  </div>
  <div class="line not-covered" id="L1726">
    <div class="line-number"><a href="#L1726">1726</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, expected_type)</div>
  </div>
  <div class="line not-covered" id="L1727">
    <div class="line-number"><a href="#L1727">1727</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if expected_type == &quot;callable&quot; then</div>
  </div>
  <div class="line not-covered" id="L1728">
    <div class="line-number"><a href="#L1728">1728</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local is_callable = type(v) == &quot;function&quot; or (type(v) == &quot;table&quot; and getmetatable(v) and getmetatable(v).__call)</div>
  </div>
  <div class="line not-covered" id="L1729">
    <div class="line-number"><a href="#L1729">1729</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return is_callable,</div>
  </div>
  <div class="line not-covered" id="L1730">
    <div class="line-number"><a href="#L1730">1730</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be callable&quot;,</div>
  </div>
  <div class="line not-covered" id="L1731">
    <div class="line-number"><a href="#L1731">1731</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be callable&quot;</div>
  </div>
  <div class="line not-covered" id="L1732">
    <div class="line-number"><a href="#L1732">1732</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif expected_type == &quot;comparable&quot; then</div>
  </div>
  <div class="line not-covered" id="L1733">
    <div class="line-number"><a href="#L1733">1733</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local success = pcall(function()</div>
  </div>
  <div class="line not-covered" id="L1734">
    <div class="line-number"><a href="#L1734">1734</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return v &lt; v</div>
  </div>
  <div class="line not-covered" id="L1735">
    <div class="line-number"><a href="#L1735">1735</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end)</div>
  </div>
  <div class="line covered" id="L1736">
    <div class="line-number"><a href="#L1736">1736</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return success,</div>
  </div>
  <div class="line covered" id="L1737">
    <div class="line-number"><a href="#L1737">1737</a></div>
    <div class="execution-count">2</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be comparable&quot;,</div>
  </div>
  <div class="line covered" id="L1738">
    <div class="line-number"><a href="#L1738">1738</a></div>
    <div class="execution-count">2</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be comparable&quot;</div>
  </div>
  <div class="line covered" id="L1739">
    <div class="line-number"><a href="#L1739">1739</a></div>
    <div class="execution-count">2</div>    <div class="line-content">    elseif expected_type == &quot;iterable&quot; then</div>
  </div>
  <div class="line covered" id="L1740">
    <div class="line-number"><a href="#L1740">1740</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local success = pcall(function()</div>
  </div>
  <div class="line not-covered" id="L1741">
    <div class="line-number"><a href="#L1741">1741</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        for _ in pairs(v) do</div>
  </div>
  <div class="line not-covered" id="L1742">
    <div class="line-number"><a href="#L1742">1742</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          break</div>
  </div>
  <div class="line not-covered" id="L1743">
    <div class="line-number"><a href="#L1743">1743</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1744">
    <div class="line-number"><a href="#L1744">1744</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end)</div>
  </div>
  <div class="line not-covered" id="L1745">
    <div class="line-number"><a href="#L1745">1745</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return success,</div>
  </div>
  <div class="line not-covered" id="L1746">
    <div class="line-number"><a href="#L1746">1746</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to be iterable&quot;,</div>
  </div>
  <div class="line not-covered" id="L1747">
    <div class="line-number"><a href="#L1747">1747</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected &quot; .. tostring(v) .. &quot; to not be iterable&quot;</div>
  </div>
  <div class="line not-covered" id="L1748">
    <div class="line-number"><a href="#L1748">1748</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L1749">
    <div class="line-number"><a href="#L1749">1749</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;unknown type check: &quot; .. tostring(expected_type))</div>
  </div>
  <div class="line not-covered" id="L1750">
    <div class="line-number"><a href="#L1750">1750</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1751">
    <div class="line-number"><a href="#L1751">1751</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1752">
    <div class="line-number"><a href="#L1752">1752</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1753">
    <div class="line-number"><a href="#L1753">1753</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Enhanced error assertions</div>
  </div>
  <div class="line not-covered" id="L1754">
    <div class="line-number"><a href="#L1754">1754</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.throw = {</div>
  </div>
  <div class="line not-covered" id="L1755">
    <div class="line-number"><a href="#L1755">1755</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error = true,</div>
  </div>
  <div class="line not-covered" id="L1756">
    <div class="line-number"><a href="#L1756">1756</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_matching = true,</div>
  </div>
  <div class="line not-covered" id="L1757">
    <div class="line-number"><a href="#L1757">1757</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error_type = true,</div>
  </div>
  <div class="line not-covered" id="L1758">
    <div class="line-number"><a href="#L1758">1758</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1759">
    <div class="line-number"><a href="#L1759">1759</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1760">
    <div class="line-number"><a href="#L1760">1760</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a function&quot;)</div>
  </div>
  <div class="line not-covered" id="L1761">
    <div class="line-number"><a href="#L1761">1761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1762">
    <div class="line-number"><a href="#L1762">1762</a></div>
    <div class="execution-count"></div>    <div class="line-content">    ---@diagnostic disable-next-line: unused-local</div>
  </div>
  <div class="line not-covered" id="L1763">
    <div class="line-number"><a href="#L1763">1763</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local ok, err = pcall(v)</div>
  </div>
  <div class="line not-covered" id="L1764">
    <div class="line-number"><a href="#L1764">1764</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return not ok, &quot;expected function to throw an error&quot;, &quot;expected function to not throw an error&quot;</div>
  </div>
  <div class="line not-covered" id="L1765">
    <div class="line-number"><a href="#L1765">1765</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1766">
    <div class="line-number"><a href="#L1766">1766</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1767">
    <div class="line-number"><a href="#L1767">1767</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.error = {</div>
  </div>
  <div class="line not-covered" id="L1768">
    <div class="line-number"><a href="#L1768">1768</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v)</div>
  </div>
  <div class="line not-covered" id="L1769">
    <div class="line-number"><a href="#L1769">1769</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1770">
    <div class="line-number"><a href="#L1770">1770</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a function&quot;)</div>
  </div>
  <div class="line not-covered" id="L1771">
    <div class="line-number"><a href="#L1771">1771</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1772">
    <div class="line-number"><a href="#L1772">1772</a></div>
    <div class="execution-count"></div>    <div class="line-content">    ---@diagnostic disable-next-line: unused-local</div>
  </div>
  <div class="line not-covered" id="L1773">
    <div class="line-number"><a href="#L1773">1773</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local ok, err = pcall(v)</div>
  </div>
  <div class="line not-covered" id="L1774">
    <div class="line-number"><a href="#L1774">1774</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return not ok, &quot;expected function to throw an error&quot;, &quot;expected function to not throw an error&quot;</div>
  </div>
  <div class="line not-covered" id="L1775">
    <div class="line-number"><a href="#L1775">1775</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1776">
    <div class="line-number"><a href="#L1776">1776</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1777">
    <div class="line-number"><a href="#L1777">1777</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.error_matching = {</div>
  </div>
  <div class="line not-covered" id="L1778">
    <div class="line-number"><a href="#L1778">1778</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, pattern)</div>
  </div>
  <div class="line not-covered" id="L1779">
    <div class="line-number"><a href="#L1779">1779</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1780">
    <div class="line-number"><a href="#L1780">1780</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a function&quot;)</div>
  </div>
  <div class="line not-covered" id="L1781">
    <div class="line-number"><a href="#L1781">1781</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1782">
    <div class="line-number"><a href="#L1782">1782</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(pattern) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1783">
    <div class="line-number"><a href="#L1783">1783</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected pattern to be a string&quot;)</div>
  </div>
  <div class="line not-covered" id="L1784">
    <div class="line-number"><a href="#L1784">1784</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1785">
    <div class="line-number"><a href="#L1785">1785</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local ok, err = pcall(v)</div>
  </div>
  <div class="line not-covered" id="L1786">
    <div class="line-number"><a href="#L1786">1786</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if ok then</div>
  </div>
  <div class="line not-covered" id="L1787">
    <div class="line-number"><a href="#L1787">1787</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false,</div>
  </div>
  <div class="line not-covered" id="L1788">
    <div class="line-number"><a href="#L1788">1788</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected function to throw an error matching pattern &quot;' .. pattern .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L1789">
    <div class="line-number"><a href="#L1789">1789</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        'expected function to not throw an error matching pattern &quot;' .. pattern .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L1790">
    <div class="line-number"><a href="#L1790">1790</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1791">
    <div class="line-number"><a href="#L1791">1791</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    err = tostring(err)</div>
  </div>
  <div class="line not-covered" id="L1792">
    <div class="line-number"><a href="#L1792">1792</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return err:match(pattern) ~= nil,</div>
  </div>
  <div class="line not-covered" id="L1793">
    <div class="line-number"><a href="#L1793">1793</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected error &quot;' .. err .. '&quot; to match pattern &quot;' .. pattern .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L1794">
    <div class="line-number"><a href="#L1794">1794</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      'expected error &quot;' .. err .. '&quot; to not match pattern &quot;' .. pattern .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L1795">
    <div class="line-number"><a href="#L1795">1795</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1796">
    <div class="line-number"><a href="#L1796">1796</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-covered" id="L1797">
    <div class="line-number"><a href="#L1797">1797</a></div>
    <div class="execution-count">0</div>    <div class="line-content">paths.error_type = {</div>
  </div>
  <div class="line not-covered" id="L1798">
    <div class="line-number"><a href="#L1798">1798</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test = function(v, expected_type)</div>
  </div>
  <div class="line not-covered" id="L1799">
    <div class="line-number"><a href="#L1799">1799</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(v) ~= &quot;function&quot; then</div>
  </div>
  <div class="line not-covered" id="L1800">
    <div class="line-number"><a href="#L1800">1800</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(&quot;expected &quot; .. tostring(v) .. &quot; to be a function&quot;)</div>
  </div>
  <div class="line not-covered" id="L1801">
    <div class="line-number"><a href="#L1801">1801</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1802">
    <div class="line-number"><a href="#L1802">1802</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local ok, err = pcall(v)</div>
  </div>
  <div class="line not-covered" id="L1803">
    <div class="line-number"><a href="#L1803">1803</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if ok then</div>
  </div>
  <div class="line not-covered" id="L1804">
    <div class="line-number"><a href="#L1804">1804</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false,</div>
  </div>
  <div class="line not-covered" id="L1805">
    <div class="line-number"><a href="#L1805">1805</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected function to throw an error of type &quot; .. tostring(expected_type),</div>
  </div>
  <div class="line not-covered" id="L1806">
    <div class="line-number"><a href="#L1806">1806</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        &quot;expected function to not throw an error of type &quot; .. tostring(expected_type)</div>
  </div>
  <div class="line not-covered" id="L1807">
    <div class="line-number"><a href="#L1807">1807</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1808">
    <div class="line-number"><a href="#L1808">1808</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Try to determine the error type</div>
  </div>
  <div class="line not-covered" id="L1809">
    <div class="line-number"><a href="#L1809">1809</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local error_type</div>
  </div>
  <div class="line not-covered" id="L1810">
    <div class="line-number"><a href="#L1810">1810</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(err) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1811">
    <div class="line-number"><a href="#L1811">1811</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_type = &quot;string&quot;</div>
  </div>
  <div class="line not-covered" id="L1812">
    <div class="line-number"><a href="#L1812">1812</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif type(err) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L1813">
    <div class="line-number"><a href="#L1813">1813</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_type = err.__name or &quot;table&quot;</div>
  </div>
  <div class="line not-covered" id="L1814">
    <div class="line-number"><a href="#L1814">1814</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L1815">
    <div class="line-number"><a href="#L1815">1815</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_type = type(err)</div>
  </div>
  <div class="line not-covered" id="L1816">
    <div class="line-number"><a href="#L1816">1816</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1817">
    <div class="line-number"><a href="#L1817">1817</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return error_type == expected_type,</div>
  </div>
  <div class="line not-covered" id="L1818">
    <div class="line-number"><a href="#L1818">1818</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected error of type &quot; .. error_type .. &quot; to be of type &quot; .. expected_type,</div>
  </div>
  <div class="line not-covered" id="L1819">
    <div class="line-number"><a href="#L1819">1819</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      &quot;expected error of type &quot; .. error_type .. &quot; to not be of type &quot; .. expected_type</div>
  </div>
  <div class="line not-covered" id="L1820">
    <div class="line-number"><a href="#L1820">1820</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1821">
    <div class="line-number"><a href="#L1821">1821</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L1822">
    <div class="line-number"><a href="#L1822">1822</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class ExpectChain</div>
  </div>
  <div class="line not-executable" id="L1823">
    <div class="line-number"><a href="#L1823">1823</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field val any The value being tested</div>
  </div>
  <div class="line not-executable" id="L1824">
    <div class="line-number"><a href="#L1824">1824</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field action string The current assertion action</div>
  </div>
  <div class="line not-executable" id="L1825">
    <div class="line-number"><a href="#L1825">1825</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field negate boolean Whether the assertion is negated</div>
  </div>
  <div class="line not-executable" id="L1826">
    <div class="line-number"><a href="#L1826">1826</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field to ExpectChain Reference to self for chaining positive assertions</div>
  </div>
  <div class="line not-executable" id="L1827">
    <div class="line-number"><a href="#L1827">1827</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field to_not ExpectChain Reference to self for chaining negated assertions</div>
  </div>
  <div class="line not-executable" id="L1828">
    <div class="line-number"><a href="#L1828">1828</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field a fun(type: string): ExpectChain Assert value is of specified type (shorthand for be.a)</div>
  </div>
  <div class="line not-executable" id="L1829">
    <div class="line-number"><a href="#L1829">1829</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field an fun(type: string): ExpectChain Assert value is of specified type (alias for a)</div>
  </div>
  <div class="line not-executable" id="L1830">
    <div class="line-number"><a href="#L1830">1830</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be table&lt;string, function&gt; Group of assertions for value state/type</div>
  </div>
  <div class="line not-executable" id="L1831">
    <div class="line-number"><a href="#L1831">1831</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be.a fun(type: string): ExpectChain Assert value is of specified type</div>
  </div>
  <div class="line not-executable" id="L1832">
    <div class="line-number"><a href="#L1832">1832</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be.truthy fun(): ExpectChain Assert value is truthy (evaluates to true in a conditional)</div>
  </div>
  <div class="line not-executable" id="L1833">
    <div class="line-number"><a href="#L1833">1833</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be.falsy fun(): ExpectChain Assert value is falsy (evaluates to false in a conditional)</div>
  </div>
  <div class="line not-executable" id="L1834">
    <div class="line-number"><a href="#L1834">1834</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be.empty fun(): ExpectChain Assert value is an empty collection</div>
  </div>
  <div class="line not-executable" id="L1835">
    <div class="line-number"><a href="#L1835">1835</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be.positive fun(): ExpectChain Assert value is a positive number</div>
  </div>
  <div class="line not-executable" id="L1836">
    <div class="line-number"><a href="#L1836">1836</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be.negative fun(): ExpectChain Assert value is a negative number</div>
  </div>
  <div class="line not-executable" id="L1837">
    <div class="line-number"><a href="#L1837">1837</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be.integer fun(): ExpectChain Assert value is an integer (no decimal component)</div>
  </div>
  <div class="line not-executable" id="L1838">
    <div class="line-number"><a href="#L1838">1838</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be.uppercase fun(): ExpectChain Assert string is all uppercase</div>
  </div>
  <div class="line not-executable" id="L1839">
    <div class="line-number"><a href="#L1839">1839</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be.lowercase fun(): ExpectChain Assert string is all lowercase</div>
  </div>
  <div class="line not-executable" id="L1840">
    <div class="line-number"><a href="#L1840">1840</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field equal fun(expected: any): ExpectChain Assert deep equality with expected value</div>
  </div>
  <div class="line not-executable" id="L1841">
    <div class="line-number"><a href="#L1841">1841</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field exist fun(): ExpectChain Assert value is not nil</div>
  </div>
  <div class="line not-executable" id="L1842">
    <div class="line-number"><a href="#L1842">1842</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field match fun(pattern: string): ExpectChain Assert string matches Lua pattern</div>
  </div>
  <div class="line not-executable" id="L1843">
    <div class="line-number"><a href="#L1843">1843</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field contain fun(value: any): ExpectChain Assert collection contains value</div>
  </div>
  <div class="line not-executable" id="L1844">
    <div class="line-number"><a href="#L1844">1844</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field have fun(key: any): ExpectChain Assert table has specific key</div>
  </div>
  <div class="line not-executable" id="L1845">
    <div class="line-number"><a href="#L1845">1845</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field have_length fun(length: number): ExpectChain Assert collection has specific length</div>
  </div>
  <div class="line not-executable" id="L1846">
    <div class="line-number"><a href="#L1846">1846</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field have_property fun(property: string, value?: any): ExpectChain Assert object has property with optional value</div>
  </div>
  <div class="line not-executable" id="L1847">
    <div class="line-number"><a href="#L1847">1847</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be_type fun(type: string): ExpectChain Assert value is of specified type</div>
  </div>
  <div class="line not-executable" id="L1848">
    <div class="line-number"><a href="#L1848">1848</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be_greater_than fun(value: number): ExpectChain Assert number is greater than value</div>
  </div>
  <div class="line not-executable" id="L1849">
    <div class="line-number"><a href="#L1849">1849</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be_less_than fun(value: number): ExpectChain Assert number is less than value</div>
  </div>
  <div class="line not-executable" id="L1850">
    <div class="line-number"><a href="#L1850">1850</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field be_between fun(min: number, max: number): ExpectChain Assert number is between min and max</div>
  </div>
  <div class="line not-executable" id="L1851">
    <div class="line-number"><a href="#L1851">1851</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field start_with fun(prefix: string): ExpectChain Assert string starts with prefix</div>
  </div>
  <div class="line not-executable" id="L1852">
    <div class="line-number"><a href="#L1852">1852</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field end_with fun(suffix: string): ExpectChain Assert string ends with suffix</div>
  </div>
  <div class="line not-executable" id="L1853">
    <div class="line-number"><a href="#L1853">1853</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field throw fun(): ExpectChain Assert function throws an error</div>
  </div>
  <div class="line not-executable" id="L1854">
    <div class="line-number"><a href="#L1854">1854</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field throw.error fun(): ExpectChain Assert function throws an error (alias)</div>
  </div>
  <div class="line not-executable" id="L1855">
    <div class="line-number"><a href="#L1855">1855</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field throw.error_matching fun(pattern: string): ExpectChain Assert function throws error matching pattern</div>
  </div>
  <div class="line not-executable" id="L1856">
    <div class="line-number"><a href="#L1856">1856</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field throw.error_type fun(type: string): ExpectChain Assert function throws error of specific type</div>
  </div>
  <div class="line not-executable" id="L1857">
    <div class="line-number"><a href="#L1857">1857</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field match_schema fun(schema: table): ExpectChain Assert object matches specified schema</div>
  </div>
  <div class="line not-executable" id="L1858">
    <div class="line-number"><a href="#L1858">1858</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field change fun(getter: function): ExpectChain Assert function changes value returned by getter</div>
  </div>
  <div class="line not-executable" id="L1859">
    <div class="line-number"><a href="#L1859">1859</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field increase fun(getter: function): ExpectChain Assert function increases value returned by getter</div>
  </div>
  <div class="line not-executable" id="L1860">
    <div class="line-number"><a href="#L1860">1860</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field decrease fun(getter: function): ExpectChain Assert function decreases value returned by getter</div>
  </div>
  <div class="line not-executable" id="L1861">
    <div class="line-number"><a href="#L1861">1861</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Main expect function for creating assertions</div>
  </div>
  <div class="line not-executable" id="L1862">
    <div class="line-number"><a href="#L1862">1862</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param v any The value to create assertions for</div>
  </div>
  <div class="line not-executable" id="L1863">
    <div class="line-number"><a href="#L1863">1863</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return ExpectChain An assertion object with chainable assertion methods</div>
  </div>
  <div class="line not-covered" id="L1864">
    <div class="line-number"><a href="#L1864">1864</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.expect(v)</div>
  </div>
  <div class="line not-executable" id="L1865">
    <div class="line-number"><a href="#L1865">1865</a></div>
    <div class="execution-count"></div>    <div class="line-content">  ---@diagnostic disable-next-line: unused-local</div>
  </div>
  <div class="line not-covered" id="L1866">
    <div class="line-number"><a href="#L1866">1866</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local error_handler = get_error_handler()</div>
  </div>
  <div class="line not-covered" id="L1867">
    <div class="line-number"><a href="#L1867">1867</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local logger = get_logger()</div>
  </div>
  <div class="line not-executable" id="L1868">
    <div class="line-number"><a href="#L1868">1868</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Track assertion count (for test quality metrics)</div>
  </div>
  <div class="line not-covered" id="L1869">
    <div class="line-number"><a href="#L1869">1869</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  M.assertion_count = (M.assertion_count or 0) + 1</div>
  </div>
  <div class="line not-covered" id="L1870">
    <div class="line-number"><a href="#L1870">1870</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.trace(&quot;Assertion started&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1871">
    <div class="line-number"><a href="#L1871">1871</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    value = tostring(v),</div>
  </div>
  <div class="line not-covered" id="L1872">
    <div class="line-number"><a href="#L1872">1872</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    type = type(v),</div>
  </div>
  <div class="line not-covered" id="L1873">
    <div class="line-number"><a href="#L1873">1873</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    assertion_count = M.assertion_count,</div>
  </div>
  <div class="line not-covered" id="L1874">
    <div class="line-number"><a href="#L1874">1874</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-covered" id="L1875">
    <div class="line-number"><a href="#L1875">1875</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local assertion = {}</div>
  </div>
  <div class="line not-covered" id="L1876">
    <div class="line-number"><a href="#L1876">1876</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  assertion.val = v</div>
  </div>
  <div class="line not-covered" id="L1877">
    <div class="line-number"><a href="#L1877">1877</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  assertion.action = &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L1878">
    <div class="line-number"><a href="#L1878">1878</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  assertion.negate = false</div>
  </div>
  <div class="line not-covered" id="L1879">
    <div class="line-number"><a href="#L1879">1879</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  setmetatable(assertion, {</div>
  </div>
  <div class="line not-covered" id="L1880">
    <div class="line-number"><a href="#L1880">1880</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    __index = function(t, k)</div>
  </div>
  <div class="line not-covered" id="L1881">
    <div class="line-number"><a href="#L1881">1881</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if has(paths[rawget(t, &quot;action&quot;)], k) then</div>
  </div>
  <div class="line not-covered" id="L1882">
    <div class="line-number"><a href="#L1882">1882</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        rawset(t, &quot;action&quot;, k)</div>
  </div>
  <div class="line not-covered" id="L1883">
    <div class="line-number"><a href="#L1883">1883</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local chain = paths[rawget(t, &quot;action&quot;)].chain</div>
  </div>
  <div class="line not-covered" id="L1884">
    <div class="line-number"><a href="#L1884">1884</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if chain then</div>
  </div>
  <div class="line not-covered" id="L1885">
    <div class="line-number"><a href="#L1885">1885</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          chain(t)</div>
  </div>
  <div class="line not-covered" id="L1886">
    <div class="line-number"><a href="#L1886">1886</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1887">
    <div class="line-number"><a href="#L1887">1887</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return t</div>
  </div>
  <div class="line not-covered" id="L1888">
    <div class="line-number"><a href="#L1888">1888</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1889">
    <div class="line-number"><a href="#L1889">1889</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return rawget(t, k)</div>
  </div>
  <div class="line not-covered" id="L1890">
    <div class="line-number"><a href="#L1890">1890</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L1891">
    <div class="line-number"><a href="#L1891">1891</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    __call = function(t, ...)</div>
  </div>
  <div class="line not-covered" id="L1892">
    <div class="line-number"><a href="#L1892">1892</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if paths[t.action].test then</div>
  </div>
  <div class="line not-covered" id="L1893">
    <div class="line-number"><a href="#L1893">1893</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local success, err, nerr</div>
  </div>
  <div class="line not-executable" id="L1894">
    <div class="line-number"><a href="#L1894">1894</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Use error_handler.try if available for structured error handling</div>
  </div>
  <div class="line not-covered" id="L1895">
    <div class="line-number"><a href="#L1895">1895</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        local error_handler = get_error_handler()</div>
  </div>
  <div class="line not-covered" id="L1896">
    <div class="line-number"><a href="#L1896">1896</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if error_handler then</div>
  </div>
  <div class="line not-covered" id="L1897">
    <div class="line-number"><a href="#L1897">1897</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local args = { ... }</div>
  </div>
  <div class="line not-covered" id="L1898">
    <div class="line-number"><a href="#L1898">1898</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local try_success, try_result = error_handler.try(function()</div>
  </div>
  <div class="line not-covered" id="L1899">
    <div class="line-number"><a href="#L1899">1899</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local res, e, ne = paths[t.action].test(t.val, unpack(args))</div>
  </div>
  <div class="line not-covered" id="L1900">
    <div class="line-number"><a href="#L1900">1900</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            return { res = res, err = e, nerr = ne }</div>
  </div>
  <div class="line not-covered" id="L1901">
    <div class="line-number"><a href="#L1901">1901</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end)</div>
  </div>
  <div class="line not-covered" id="L1902">
    <div class="line-number"><a href="#L1902">1902</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if try_success then</div>
  </div>
  <div class="line not-covered" id="L1903">
    <div class="line-number"><a href="#L1903">1903</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            success, err, nerr = try_result.res, try_result.err, try_result.nerr</div>
  </div>
  <div class="line not-covered" id="L1904">
    <div class="line-number"><a href="#L1904">1904</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          else</div>
  </div>
  <div class="line not-executable" id="L1905">
    <div class="line-number"><a href="#L1905">1905</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Handle error in test function</div>
  </div>
  <div class="line not-covered" id="L1906">
    <div class="line-number"><a href="#L1906">1906</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            logger.error(&quot;Error in assertion test function&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1907">
    <div class="line-number"><a href="#L1907">1907</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              action = t.action,</div>
  </div>
  <div class="line not-covered" id="L1908">
    <div class="line-number"><a href="#L1908">1908</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              error = error_handler.format_error(try_result),</div>
  </div>
  <div class="line not-covered" id="L1909">
    <div class="line-number"><a href="#L1909">1909</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L1910">
    <div class="line-number"><a href="#L1910">1910</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error(try_result.message or &quot;Error in assertion test function&quot;, 2)</div>
  </div>
  <div class="line not-covered" id="L1911">
    <div class="line-number"><a href="#L1911">1911</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L1912">
    <div class="line-number"><a href="#L1912">1912</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-executable" id="L1913">
    <div class="line-number"><a href="#L1913">1913</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Fallback if error_handler is not available</div>
  </div>
  <div class="line not-covered" id="L1914">
    <div class="line-number"><a href="#L1914">1914</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          local args = { ... }</div>
  </div>
  <div class="line not-covered" id="L1915">
    <div class="line-number"><a href="#L1915">1915</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          success, err, nerr = paths[t.action].test(t.val, unpack(args))</div>
  </div>
  <div class="line not-covered" id="L1916">
    <div class="line-number"><a href="#L1916">1916</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1917">
    <div class="line-number"><a href="#L1917">1917</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if assertion.negate then</div>
  </div>
  <div class="line not-covered" id="L1918">
    <div class="line-number"><a href="#L1918">1918</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          success = not success</div>
  </div>
  <div class="line not-covered" id="L1919">
    <div class="line-number"><a href="#L1919">1919</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          err = nerr or err</div>
  </div>
  <div class="line not-covered" id="L1920">
    <div class="line-number"><a href="#L1920">1920</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1921">
    <div class="line-number"><a href="#L1921">1921</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        if not success then</div>
  </div>
  <div class="line not-covered" id="L1922">
    <div class="line-number"><a href="#L1922">1922</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          if error_handler then</div>
  </div>
  <div class="line not-executable" id="L1923">
    <div class="line-number"><a href="#L1923">1923</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Create a structured error</div>
  </div>
  <div class="line not-covered" id="L1924">
    <div class="line-number"><a href="#L1924">1924</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local context = {</div>
  </div>
  <div class="line not-covered" id="L1925">
    <div class="line-number"><a href="#L1925">1925</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              expected = select(1, ...),</div>
  </div>
  <div class="line not-covered" id="L1926">
    <div class="line-number"><a href="#L1926">1926</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              actual = t.val,</div>
  </div>
  <div class="line not-covered" id="L1927">
    <div class="line-number"><a href="#L1927">1927</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              action = t.action,</div>
  </div>
  <div class="line not-covered" id="L1928">
    <div class="line-number"><a href="#L1928">1928</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              negate = assertion.negate,</div>
  </div>
  <div class="line not-covered" id="L1929">
    <div class="line-number"><a href="#L1929">1929</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            }</div>
  </div>
  <div class="line not-covered" id="L1930">
    <div class="line-number"><a href="#L1930">1930</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            local error_obj = error_handler.create(</div>
  </div>
  <div class="line not-covered" id="L1931">
    <div class="line-number"><a href="#L1931">1931</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              err or &quot;Assertion failed&quot;,</div>
  </div>
  <div class="line not-covered" id="L1932">
    <div class="line-number"><a href="#L1932">1932</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              error_handler.CATEGORY.VALIDATION,</div>
  </div>
  <div class="line not-covered" id="L1933">
    <div class="line-number"><a href="#L1933">1933</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              error_handler.SEVERITY.ERROR,</div>
  </div>
  <div class="line not-covered" id="L1934">
    <div class="line-number"><a href="#L1934">1934</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              context</div>
  </div>
  <div class="line not-covered" id="L1935">
    <div class="line-number"><a href="#L1935">1935</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            )</div>
  </div>
  <div class="line not-covered" id="L1936">
    <div class="line-number"><a href="#L1936">1936</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            logger.debug(&quot;Assertion failed&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1937">
    <div class="line-number"><a href="#L1937">1937</a></div>
    <div class="execution-count">0</div>    <div class="line-content">              error = error_handler.format_error(error_obj, false),</div>
  </div>
  <div class="line not-covered" id="L1938">
    <div class="line-number"><a href="#L1938">1938</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            })</div>
  </div>
  <div class="line not-covered" id="L1939">
    <div class="line-number"><a href="#L1939">1939</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error(error_handler.format_error(error_obj, false), 2)</div>
  </div>
  <div class="line not-covered" id="L1940">
    <div class="line-number"><a href="#L1940">1940</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          else</div>
  </div>
  <div class="line not-executable" id="L1941">
    <div class="line-number"><a href="#L1941">1941</a></div>
    <div class="execution-count"></div>    <div class="line-content">            -- Fallback without error_handler</div>
  </div>
  <div class="line not-covered" id="L1942">
    <div class="line-number"><a href="#L1942">1942</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            error(err or &quot;unknown failure&quot;, 2)</div>
  </div>
  <div class="line not-covered" id="L1943">
    <div class="line-number"><a href="#L1943">1943</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-covered" id="L1944">
    <div class="line-number"><a href="#L1944">1944</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        else</div>
  </div>
  <div class="line not-covered" id="L1945">
    <div class="line-number"><a href="#L1945">1945</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          logger.trace(&quot;Assertion passed&quot;, {</div>
  </div>
  <div class="line not-covered" id="L1946">
    <div class="line-number"><a href="#L1946">1946</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            action = t.action,</div>
  </div>
  <div class="line not-covered" id="L1947">
    <div class="line-number"><a href="#L1947">1947</a></div>
    <div class="execution-count">0</div>    <div class="line-content">            value = tostring(t.val),</div>
  </div>
  <div class="line not-covered" id="L1948">
    <div class="line-number"><a href="#L1948">1948</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          })</div>
  </div>
  <div class="line not-covered" id="L1949">
    <div class="line-number"><a href="#L1949">1949</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-covered" id="L1950">
    <div class="line-number"><a href="#L1950">1950</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1951">
    <div class="line-number"><a href="#L1951">1951</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L1952">
    <div class="line-number"><a href="#L1952">1952</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-covered" id="L1953">
    <div class="line-number"><a href="#L1953">1953</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return assertion</div>
  </div>
  <div class="line not-covered" id="L1954">
    <div class="line-number"><a href="#L1954">1954</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1955">
    <div class="line-number"><a href="#L1955">1955</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Export paths to allow extensions</div>
  </div>
  <div class="line not-covered" id="L1956">
    <div class="line-number"><a href="#L1956">1956</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.paths = paths</div>
  </div>
  <div class="line not-executable" id="L1957">
    <div class="line-number"><a href="#L1957">1957</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Return the module</div>
  </div>
  <div class="line not-covered" id="L1958">
    <div class="line-number"><a href="#L1958">1958</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return M</div>
  </div>
  <div class="line not-executable" id="L1959">
    <div class="line-number"><a href="#L1959">1959</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1959</div>
  </div>
  <div class="line not-executable" id="L1960">
    <div class="line-number"><a href="#L1960">1960</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1960</div>
  </div>
  <div class="line not-executable" id="L1961">
    <div class="line-number"><a href="#L1961">1961</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1961</div>
  </div>
  <div class="line not-executable" id="L1962">
    <div class="line-number"><a href="#L1962">1962</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1962</div>
  </div>
  <div class="line not-executable" id="L1963">
    <div class="line-number"><a href="#L1963">1963</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1963</div>
  </div>
  <div class="line not-executable" id="L1964">
    <div class="line-number"><a href="#L1964">1964</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1964</div>
  </div>
  <div class="line not-executable" id="L1965">
    <div class="line-number"><a href="#L1965">1965</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1965</div>
  </div>
  <div class="line not-executable" id="L1966">
    <div class="line-number"><a href="#L1966">1966</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1966</div>
  </div>
  <div class="line not-executable" id="L1967">
    <div class="line-number"><a href="#L1967">1967</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1967</div>
  </div>
  <div class="line not-executable" id="L1968">
    <div class="line-number"><a href="#L1968">1968</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1968</div>
  </div>
  <div class="line not-executable" id="L1969">
    <div class="line-number"><a href="#L1969">1969</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1969</div>
  </div>
  <div class="line not-executable" id="L1970">
    <div class="line-number"><a href="#L1970">1970</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1970</div>
  </div>
  <div class="line not-executable" id="L1971">
    <div class="line-number"><a href="#L1971">1971</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1971</div>
  </div>
  <div class="line not-executable" id="L1972">
    <div class="line-number"><a href="#L1972">1972</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1972</div>
  </div>
  <div class="line not-executable" id="L1973">
    <div class="line-number"><a href="#L1973">1973</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1973</div>
  </div>
  <div class="line not-executable" id="L1974">
    <div class="line-number"><a href="#L1974">1974</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1974</div>
  </div>
  <div class="line not-executable" id="L1975">
    <div class="line-number"><a href="#L1975">1975</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1975</div>
  </div>
  <div class="line not-executable" id="L1976">
    <div class="line-number"><a href="#L1976">1976</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1976</div>
  </div>
  <div class="line not-executable" id="L1977">
    <div class="line-number"><a href="#L1977">1977</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1977</div>
  </div>
  <div class="line not-executable" id="L1978">
    <div class="line-number"><a href="#L1978">1978</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1978</div>
  </div>
  <div class="line not-executable" id="L1979">
    <div class="line-number"><a href="#L1979">1979</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1979</div>
  </div>
  <div class="line not-executable" id="L1980">
    <div class="line-number"><a href="#L1980">1980</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1980</div>
  </div>
  <div class="line not-executable" id="L1981">
    <div class="line-number"><a href="#L1981">1981</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1981</div>
  </div>
  <div class="line not-executable" id="L1982">
    <div class="line-number"><a href="#L1982">1982</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1982</div>
  </div>
  <div class="line not-executable" id="L1983">
    <div class="line-number"><a href="#L1983">1983</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1983</div>
  </div>
  <div class="line not-executable" id="L1984">
    <div class="line-number"><a href="#L1984">1984</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1984</div>
  </div>
  <div class="line not-executable" id="L1985">
    <div class="line-number"><a href="#L1985">1985</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1985</div>
  </div>
  <div class="line not-executable" id="L1986">
    <div class="line-number"><a href="#L1986">1986</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1986</div>
  </div>
  <div class="line not-executable" id="L1987">
    <div class="line-number"><a href="#L1987">1987</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1987</div>
  </div>
  <div class="line not-executable" id="L1988">
    <div class="line-number"><a href="#L1988">1988</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1988</div>
  </div>
  <div class="line not-executable" id="L1989">
    <div class="line-number"><a href="#L1989">1989</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1989</div>
  </div>
  <div class="line not-executable" id="L1990">
    <div class="line-number"><a href="#L1990">1990</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1990</div>
  </div>
  <div class="line not-executable" id="L1991">
    <div class="line-number"><a href="#L1991">1991</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1991</div>
  </div>
  <div class="line not-executable" id="L1992">
    <div class="line-number"><a href="#L1992">1992</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1992</div>
  </div>
  <div class="line not-executable" id="L1993">
    <div class="line-number"><a href="#L1993">1993</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1993</div>
  </div>
  <div class="line not-executable" id="L1994">
    <div class="line-number"><a href="#L1994">1994</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1994</div>
  </div>
  <div class="line not-executable" id="L1995">
    <div class="line-number"><a href="#L1995">1995</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1995</div>
  </div>
  <div class="line not-executable" id="L1996">
    <div class="line-number"><a href="#L1996">1996</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1996</div>
  </div>
  <div class="line not-executable" id="L1997">
    <div class="line-number"><a href="#L1997">1997</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1997</div>
  </div>
  <div class="line not-executable" id="L1998">
    <div class="line-number"><a href="#L1998">1998</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1998</div>
  </div>
  <div class="line not-executable" id="L1999">
    <div class="line-number"><a href="#L1999">1999</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 1999</div>
  </div>
  <div class="line not-executable" id="L2000">
    <div class="line-number"><a href="#L2000">2000</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2000</div>
  </div>
  <div class="line not-executable" id="L2001">
    <div class="line-number"><a href="#L2001">2001</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2001</div>
  </div>
  <div class="line not-executable" id="L2002">
    <div class="line-number"><a href="#L2002">2002</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2002</div>
  </div>
  <div class="line not-executable" id="L2003">
    <div class="line-number"><a href="#L2003">2003</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2003</div>
  </div>
  <div class="line not-executable" id="L2004">
    <div class="line-number"><a href="#L2004">2004</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2004</div>
  </div>
  <div class="line not-executable" id="L2005">
    <div class="line-number"><a href="#L2005">2005</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2005</div>
  </div>
  <div class="line not-executable" id="L2006">
    <div class="line-number"><a href="#L2006">2006</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2006</div>
  </div>
  <div class="line not-executable" id="L2007">
    <div class="line-number"><a href="#L2007">2007</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2007</div>
  </div>
  <div class="line not-executable" id="L2008">
    <div class="line-number"><a href="#L2008">2008</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2008</div>
  </div>
  <div class="line not-executable" id="L2009">
    <div class="line-number"><a href="#L2009">2009</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2009</div>
  </div>
  <div class="line not-executable" id="L2010">
    <div class="line-number"><a href="#L2010">2010</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2010</div>
  </div>
  <div class="line not-executable" id="L2011">
    <div class="line-number"><a href="#L2011">2011</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2011</div>
  </div>
  <div class="line not-executable" id="L2012">
    <div class="line-number"><a href="#L2012">2012</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2012</div>
  </div>
  <div class="line not-executable" id="L2013">
    <div class="line-number"><a href="#L2013">2013</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2013</div>
  </div>
  <div class="line not-executable" id="L2014">
    <div class="line-number"><a href="#L2014">2014</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2014</div>
  </div>
  <div class="line not-executable" id="L2015">
    <div class="line-number"><a href="#L2015">2015</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2015</div>
  </div>
  <div class="line not-executable" id="L2016">
    <div class="line-number"><a href="#L2016">2016</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2016</div>
  </div>
  <div class="line not-executable" id="L2017">
    <div class="line-number"><a href="#L2017">2017</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2017</div>
  </div>
  <div class="line not-executable" id="L2018">
    <div class="line-number"><a href="#L2018">2018</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2018</div>
  </div>
  <div class="line not-executable" id="L2019">
    <div class="line-number"><a href="#L2019">2019</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2019</div>
  </div>
  <div class="line not-executable" id="L2020">
    <div class="line-number"><a href="#L2020">2020</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2020</div>
  </div>
  <div class="line not-executable" id="L2021">
    <div class="line-number"><a href="#L2021">2021</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2021</div>
  </div>
  <div class="line not-executable" id="L2022">
    <div class="line-number"><a href="#L2022">2022</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2022</div>
  </div>
  <div class="line not-executable" id="L2023">
    <div class="line-number"><a href="#L2023">2023</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2023</div>
  </div>
  <div class="line not-executable" id="L2024">
    <div class="line-number"><a href="#L2024">2024</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2024</div>
  </div>
  <div class="line not-executable" id="L2025">
    <div class="line-number"><a href="#L2025">2025</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2025</div>
  </div>
  <div class="line not-executable" id="L2026">
    <div class="line-number"><a href="#L2026">2026</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2026</div>
  </div>
  <div class="line not-executable" id="L2027">
    <div class="line-number"><a href="#L2027">2027</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2027</div>
  </div>
  <div class="line not-executable" id="L2028">
    <div class="line-number"><a href="#L2028">2028</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2028</div>
  </div>
  <div class="line not-executable" id="L2029">
    <div class="line-number"><a href="#L2029">2029</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2029</div>
  </div>
  <div class="line not-executable" id="L2030">
    <div class="line-number"><a href="#L2030">2030</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2030</div>
  </div>
  <div class="line not-executable" id="L2031">
    <div class="line-number"><a href="#L2031">2031</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2031</div>
  </div>
  <div class="line not-executable" id="L2032">
    <div class="line-number"><a href="#L2032">2032</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2032</div>
  </div>
  <div class="line not-executable" id="L2033">
    <div class="line-number"><a href="#L2033">2033</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2033</div>
  </div>
  <div class="line not-executable" id="L2034">
    <div class="line-number"><a href="#L2034">2034</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2034</div>
  </div>
  <div class="line not-executable" id="L2035">
    <div class="line-number"><a href="#L2035">2035</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2035</div>
  </div>
  <div class="line not-executable" id="L2036">
    <div class="line-number"><a href="#L2036">2036</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2036</div>
  </div>
  <div class="line not-executable" id="L2037">
    <div class="line-number"><a href="#L2037">2037</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2037</div>
  </div>
  <div class="line not-executable" id="L2038">
    <div class="line-number"><a href="#L2038">2038</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2038</div>
  </div>
  <div class="line not-executable" id="L2039">
    <div class="line-number"><a href="#L2039">2039</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2039</div>
  </div>
  <div class="line not-executable" id="L2040">
    <div class="line-number"><a href="#L2040">2040</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2040</div>
  </div>
  <div class="line not-executable" id="L2041">
    <div class="line-number"><a href="#L2041">2041</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2041</div>
  </div>
  <div class="line not-executable" id="L2042">
    <div class="line-number"><a href="#L2042">2042</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2042</div>
  </div>
  <div class="line not-executable" id="L2043">
    <div class="line-number"><a href="#L2043">2043</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2043</div>
  </div>
  <div class="line not-executable" id="L2044">
    <div class="line-number"><a href="#L2044">2044</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2044</div>
  </div>
  <div class="line not-executable" id="L2045">
    <div class="line-number"><a href="#L2045">2045</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2045</div>
  </div>
  <div class="line not-executable" id="L2046">
    <div class="line-number"><a href="#L2046">2046</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2046</div>
  </div>
  <div class="line not-executable" id="L2047">
    <div class="line-number"><a href="#L2047">2047</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2047</div>
  </div>
  <div class="line not-executable" id="L2048">
    <div class="line-number"><a href="#L2048">2048</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2048</div>
  </div>
  <div class="line not-executable" id="L2049">
    <div class="line-number"><a href="#L2049">2049</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2049</div>
  </div>
  <div class="line not-executable" id="L2050">
    <div class="line-number"><a href="#L2050">2050</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2050</div>
  </div>
  <div class="line not-executable" id="L2051">
    <div class="line-number"><a href="#L2051">2051</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2051</div>
  </div>
  <div class="line not-executable" id="L2052">
    <div class="line-number"><a href="#L2052">2052</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2052</div>
  </div>
  <div class="line not-executable" id="L2053">
    <div class="line-number"><a href="#L2053">2053</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2053</div>
  </div>
  <div class="line not-executable" id="L2054">
    <div class="line-number"><a href="#L2054">2054</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2054</div>
  </div>
  <div class="line not-executable" id="L2055">
    <div class="line-number"><a href="#L2055">2055</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2055</div>
  </div>
  <div class="line not-executable" id="L2056">
    <div class="line-number"><a href="#L2056">2056</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2056</div>
  </div>
  <div class="line not-executable" id="L2057">
    <div class="line-number"><a href="#L2057">2057</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2057</div>
  </div>
  <div class="line not-executable" id="L2058">
    <div class="line-number"><a href="#L2058">2058</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2058</div>
  </div>
  <div class="line not-executable" id="L2059">
    <div class="line-number"><a href="#L2059">2059</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2059</div>
  </div>
  <div class="line not-executable" id="L2060">
    <div class="line-number"><a href="#L2060">2060</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2060</div>
  </div>
  <div class="line not-executable" id="L2061">
    <div class="line-number"><a href="#L2061">2061</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2061</div>
  </div>
  <div class="line not-executable" id="L2062">
    <div class="line-number"><a href="#L2062">2062</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2062</div>
  </div>
  <div class="line not-executable" id="L2063">
    <div class="line-number"><a href="#L2063">2063</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2063</div>
  </div>
  <div class="line not-executable" id="L2064">
    <div class="line-number"><a href="#L2064">2064</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2064</div>
  </div>
  <div class="line not-executable" id="L2065">
    <div class="line-number"><a href="#L2065">2065</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2065</div>
  </div>
  <div class="line not-executable" id="L2066">
    <div class="line-number"><a href="#L2066">2066</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2066</div>
  </div>
  <div class="line not-executable" id="L2067">
    <div class="line-number"><a href="#L2067">2067</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2067</div>
  </div>
  <div class="line not-executable" id="L2068">
    <div class="line-number"><a href="#L2068">2068</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2068</div>
  </div>
  <div class="line not-executable" id="L2069">
    <div class="line-number"><a href="#L2069">2069</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2069</div>
  </div>
  <div class="line not-executable" id="L2070">
    <div class="line-number"><a href="#L2070">2070</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2070</div>
  </div>
  <div class="line not-executable" id="L2071">
    <div class="line-number"><a href="#L2071">2071</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2071</div>
  </div>
  <div class="line not-executable" id="L2072">
    <div class="line-number"><a href="#L2072">2072</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2072</div>
  </div>
  <div class="line not-executable" id="L2073">
    <div class="line-number"><a href="#L2073">2073</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2073</div>
  </div>
  <div class="line not-executable" id="L2074">
    <div class="line-number"><a href="#L2074">2074</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2074</div>
  </div>
  <div class="line not-executable" id="L2075">
    <div class="line-number"><a href="#L2075">2075</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2075</div>
  </div>
  <div class="line not-executable" id="L2076">
    <div class="line-number"><a href="#L2076">2076</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2076</div>
  </div>
  <div class="line not-executable" id="L2077">
    <div class="line-number"><a href="#L2077">2077</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2077</div>
  </div>
  <div class="line not-executable" id="L2078">
    <div class="line-number"><a href="#L2078">2078</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2078</div>
  </div>
  <div class="line not-executable" id="L2079">
    <div class="line-number"><a href="#L2079">2079</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2079</div>
  </div>
  <div class="line not-executable" id="L2080">
    <div class="line-number"><a href="#L2080">2080</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2080</div>
  </div>
  <div class="line not-executable" id="L2081">
    <div class="line-number"><a href="#L2081">2081</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2081</div>
  </div>
  <div class="line not-executable" id="L2082">
    <div class="line-number"><a href="#L2082">2082</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 2082</div>
  </div>
</div>
<div class="source-code" id="file---lib-samples-calculator-lua">
  <h3>./lib/samples/calculator.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">15 / 21 (71%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar medium" style="width: 71%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">4 / 4 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 26      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 21      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 4      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 4      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-samples-calculator-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-samples-calculator-lua" value="all" checked>
        All <span class="function-count">4</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-samples-calculator-lua" value="executed">
        Executed <span class="function-count badge-success">4</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-samples-calculator-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-samples-calculator-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-samples-calculator-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-samples-calculator-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-samples-calculator-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">0</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-samples-calculator-lua" value="closure">
        Closure <span class="function-count function-type-closure">4</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-samples-calculator-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>add <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L6">6-9</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>subtract <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L11">11-14</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>multiply <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L16">16-19</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>divide <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L21">21-27</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for calculator.lua    const tableId = 'functions---lib-samples-calculator-lua';
    const searchId = 'func-search---lib-samples-calculator-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-samples-calculator-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-samples-calculator-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-samples-calculator-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-samples-calculator-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Simple Calculator Module</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Used for testing coverage functionality</div>
  </div>
  <div class="line not-covered" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local calculator = {}</div>
  </div>
  <div class="line not-covered" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function calculator.add(a, b)</div>
  </div>
  <div class="line not-covered" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = a + b</div>
  </div>
  <div class="line covered" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line covered" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line covered" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function calculator.subtract(a, b)</div>
  </div>
  <div class="line covered" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local result = a - b</div>
  </div>
  <div class="line not-covered" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line covered" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line covered" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function calculator.multiply(a, b)</div>
  </div>
  <div class="line covered" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local result = a * b</div>
  </div>
  <div class="line covered" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line covered" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function calculator.divide(a, b)</div>
  </div>
  <div class="line covered" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if b == 0 then</div>
  </div>
  <div class="line covered" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        error(&quot;Division by zero&quot;)</div>
  </div>
  <div class="line covered" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = a / b</div>
  </div>
  <div class="line covered" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line covered" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line covered" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count">1</div>    <div class="line-content">return calculator</div>
  </div>
  <div class="line not-executable" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 24</div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 25</div>
  </div>
  <div class="line not-executable" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Dynamically added line 26</div>
  </div>
</div>
<div class="source-code" id="file---lib-core-test-definition-lua">
  <h3>./lib/core/test_definition.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">5 / 359 (1%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 1%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">0 / 0 (0%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 0%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 942      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 359      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 0      </div>
      <div style="background-color: #ffccbc; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 0      </div>
    </div>
  </div>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Test definition module for Firmo</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This module provides the core functionality for defining and structuring tests</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- in Firmo's BDD-style testing framework. It offers a hierarchical approach to testing</div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- with describe blocks for grouping tests, before/after hooks for setup and teardown,</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and various options for controlling test execution.</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Key features:</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Hierarchical test organization using nested describe blocks</div>
  </div>
  <div class="line not-executable" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Test cases defined with 'it' functions</div>
  </div>
  <div class="line not-executable" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Setup and teardown with before/after hooks</div>
  </div>
  <div class="line not-executable" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Focus mode with fdescribe/fit for running specific tests</div>
  </div>
  <div class="line not-executable" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Skipping tests with xdescribe/xit</div>
  </div>
  <div class="line not-executable" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Test filtering by tags and patterns</div>
  </div>
  <div class="line not-executable" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Structured test results for reporting</div>
  </div>
  <div class="line not-executable" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Support for expected errors in tests</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Test isolation with automatic file cleanup</div>
  </div>
  <div class="line not-executable" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @version 0.4.0</div>
  </div>
  <div class="line not-executable" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @author Firmo Team</div>
  </div>
  <div class="line not-executable" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class TestDefinition</div>
  </div>
  <div class="line not-executable" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field describe fun(name: string, fn: function, options?: {focused?: boolean, excluded?: boolean, _parent_focused?: boolean}): nil Create a test group</div>
  </div>
  <div class="line not-executable" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field fdescribe fun(name: string, fn: function): nil Create a focused test group</div>
  </div>
  <div class="line not-executable" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field xdescribe fun(name: string, fn: function): nil Create a skipped test group</div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field it fun(name: string, options_or_fn: table|function, fn?: function): nil Create a test case</div>
  </div>
  <div class="line not-executable" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field fit fun(name: string, options_or_fn: table|function, fn?: function): nil Create a focused test case</div>
  </div>
  <div class="line not-executable" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field xit fun(name: string, options_or_fn: table|function, fn?: function): nil Create a skipped test case</div>
  </div>
  <div class="line not-executable" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field before fun(fn: function): nil Add a setup hook for the current block</div>
  </div>
  <div class="line not-executable" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field after fun(fn: function): nil Add a teardown hook for the current block</div>
  </div>
  <div class="line not-executable" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field pending fun(message?: string): string Mark a test as pending</div>
  </div>
  <div class="line not-covered" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local M = {}</div>
  </div>
  <div class="line not-executable" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Forward declaration of module-level variables</div>
  </div>
  <div class="line not-covered" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local level = 0</div>
  </div>
  <div class="line not-covered" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local befores = {}</div>
  </div>
  <div class="line not-covered" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local afters = {}</div>
  </div>
  <div class="line not-covered" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local current_tags = {}</div>
  </div>
  <div class="line not-covered" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local active_tags = {}</div>
  </div>
  <div class="line not-covered" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local filter_pattern = nil</div>
  </div>
  <div class="line not-covered" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local focus_mode = false</div>
  </div>
  <div class="line not-covered" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local current_describe_block = nil</div>
  </div>
  <div class="line not-executable" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Define test status constants</div>
  </div>
  <div class="line not-executable" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class TestStatus</div>
  </div>
  <div class="line not-executable" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field PASS string Test passed successfully</div>
  </div>
  <div class="line not-executable" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field FAIL string Test failed</div>
  </div>
  <div class="line not-executable" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field SKIP string Test was skipped</div>
  </div>
  <div class="line not-executable" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field PENDING string Test is pending implementation</div>
  </div>
  <div class="line not-covered" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local TEST_STATUS = {</div>
  </div>
  <div class="line not-covered" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  PASS = &quot;pass&quot;,</div>
  </div>
  <div class="line not-covered" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  FAIL = &quot;fail&quot;,</div>
  </div>
  <div class="line not-covered" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  SKIP = &quot;skip&quot;,</div>
  </div>
  <div class="line not-covered" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  PENDING = &quot;pending&quot;</div>
  </div>
  <div class="line not-covered" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Track tests</div>
  </div>
  <div class="line not-covered" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local passes = 0</div>
  </div>
  <div class="line not-covered" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local errors = 0</div>
  </div>
  <div class="line not-covered" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local skipped = 0</div>
  </div>
  <div class="line not-covered" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local test_blocks = {}</div>
  </div>
  <div class="line not-covered" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local test_paths = {}</div>
  </div>
  <div class="line not-executable" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class TestResult</div>
  </div>
  <div class="line not-executable" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field status string The test status (pass, fail, skip, pending)</div>
  </div>
  <div class="line not-executable" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field name string The name of the test</div>
  </div>
  <div class="line not-executable" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field path string[] The path to the test (array of describe block names plus test name)</div>
  </div>
  <div class="line not-executable" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field path_string string The path to the test as a string (separated by &quot; / &quot;)</div>
  </div>
  <div class="line not-executable" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field timestamp number When the test was executed (os.time() value)</div>
  </div>
  <div class="line not-executable" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field execution_time? number Optional execution time in seconds</div>
  </div>
  <div class="line not-executable" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field options? table Optional test options that were provided</div>
  </div>
  <div class="line not-executable" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field error? any Optional error object if the test failed</div>
  </div>
  <div class="line not-executable" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field error_message? string Optional formatted error message</div>
  </div>
  <div class="line not-executable" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field expect_error? boolean Whether the test was expected to produce an error</div>
  </div>
  <div class="line not-executable" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field reason? string Optional reason for skipping or pending</div>
  </div>
  <div class="line not-executable" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Collection of structured test result objects</div>
  </div>
  <div class="line not-covered" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local test_results = {}</div>
  </div>
  <div class="line not-executable" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Error handling and logging</div>
  </div>
  <div class="line not-covered" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local error_handler = require(&quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line not-covered" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local logging = require(&quot;lib.tools.logging&quot;)</div>
  </div>
  <div class="line not-covered" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local logger = logging.get_logger(&quot;TestDefinition&quot;)</div>
  </div>
  <div class="line not-executable" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Safely require a module without raising an error if it doesn't exist</div>
  </div>
  <div class="line not-executable" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param name string The name of the module to require</div>
  </div>
  <div class="line not-executable" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil The loaded module or nil if it couldn't be loaded</div>
  </div>
  <div class="line not-covered" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function try_require(name)</div>
  </div>
  <div class="line not-covered" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, mod = pcall(require, name)</div>
  </div>
  <div class="line not-covered" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if success then return mod end</div>
  </div>
  <div class="line not-covered" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return nil</div>
  </div>
  <div class="line not-covered" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Try to load temp_file module for test isolation</div>
  </div>
  <div class="line not-covered" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local temp_file = try_require(&quot;lib.tools.temp_file&quot;)</div>
  </div>
  <div class="line not-executable" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Local utility functions</div>
  </div>
  <div class="line not-executable" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Merge provided options with defaults</div>
  </div>
  <div class="line not-executable" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param options table|nil The options provided by the user</div>
  </div>
  <div class="line not-executable" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param defaults table The default options to use when not provided</div>
  </div>
  <div class="line not-executable" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The merged options</div>
  </div>
  <div class="line not-covered" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function merge_options(options, defaults)</div>
  </div>
  <div class="line not-covered" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  options = options or {}</div>
  </div>
  <div class="line not-covered" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local result = {}</div>
  </div>
  <div class="line not-covered" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for k, v in pairs(defaults) do</div>
  </div>
  <div class="line not-covered" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    result[k] = options[k] ~= nil and options[k] or v</div>
  </div>
  <div class="line not-covered" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return result</div>
  </div>
  <div class="line not-covered" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Tag validation and management</div>
  </div>
  <div class="line not-executable" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if a test has any of the required tags</div>
  </div>
  <div class="line not-executable" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param test_tags table Array of tags applied to the test</div>
  </div>
  <div class="line not-executable" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean True if the test has any required tags or if no tags are required</div>
  </div>
  <div class="line not-covered" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function has_required_tags(test_tags)</div>
  </div>
  <div class="line not-covered" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not active_tags or #active_tags == 0 then</div>
  </div>
  <div class="line not-covered" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, tag in ipairs(active_tags) do</div>
  </div>
  <div class="line not-covered" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, test_tag in ipairs(test_tags) do</div>
  </div>
  <div class="line not-covered" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if test_tag == tag then</div>
  </div>
  <div class="line not-covered" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return true</div>
  </div>
  <div class="line not-covered" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return false</div>
  </div>
  <div class="line not-covered" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Public interface</div>
  </div>
  <div class="line not-executable" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Set active tags for test filtering</div>
  </div>
  <div class="line not-executable" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function specifies which tags must be present on a test for it to be run.</div>
  </div>
  <div class="line not-executable" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Tests without at least one of the specified tags will be skipped during execution.</div>
  </div>
  <div class="line not-executable" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This provides a way to selectively run subsets of tests, such as running only</div>
  </div>
  <div class="line not-executable" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- &quot;integration&quot; or &quot;performance&quot; tests.</div>
  </div>
  <div class="line not-executable" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param ... string Tags to filter by</div>
  </div>
  <div class="line not-executable" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The module instance for method chaining</div>
  </div>
  <div class="line not-executable" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Only run tests tagged with &quot;integration&quot;</div>
  </div>
  <div class="line not-executable" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.only_tags(&quot;integration&quot;)</div>
  </div>
  <div class="line not-executable" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Run tests tagged with either &quot;fast&quot; or &quot;critical&quot;</div>
  </div>
  <div class="line not-executable" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.only_tags(&quot;fast&quot;, &quot;critical&quot;)</div>
  </div>
  <div class="line not-covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.only_tags(...)</div>
  </div>
  <div class="line not-covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  active_tags = {...}</div>
  </div>
  <div class="line not-covered" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Set tags for the current test block</div>
  </div>
  <div class="line not-executable" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function applies tags to the current test block and all tests within it.</div>
  </div>
  <div class="line not-executable" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Tags can be used to categorize tests and later filter test execution.</div>
  </div>
  <div class="line not-executable" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Common tags might include &quot;unit&quot;, &quot;integration&quot;, &quot;slow&quot;, or feature names.</div>
  </div>
  <div class="line not-executable" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param ... string Tags to apply</div>
  </div>
  <div class="line not-executable" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The module instance for method chaining</div>
  </div>
  <div class="line not-executable" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Tag a block of tests</div>
  </div>
  <div class="line not-executable" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- describe(&quot;Database operations&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   firmo.tags(&quot;integration&quot;, &quot;database&quot;)</div>
  </div>
  <div class="line not-executable" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;should connect to database&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- This test will have both &quot;integration&quot; and &quot;database&quot; tags</div>
  </div>
  <div class="line not-executable" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.tags(...)</div>
  </div>
  <div class="line not-covered" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local new_tags = {...}</div>
  </div>
  <div class="line not-covered" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  current_tags = new_tags</div>
  </div>
  <div class="line not-covered" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Set a filter pattern for test names</div>
  </div>
  <div class="line not-executable" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function specifies a Lua pattern that test names must match to be run.</div>
  </div>
  <div class="line not-executable" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Tests with names that don't match the pattern will be skipped.</div>
  </div>
  <div class="line not-executable" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This allows for focusing on specific types of tests without modifying the code.</div>
  </div>
  <div class="line not-executable" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param pattern string Pattern to filter test names</div>
  </div>
  <div class="line not-executable" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The module instance for method chaining</div>
  </div>
  <div class="line not-executable" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Only run tests with &quot;parse&quot; in their name</div>
  </div>
  <div class="line not-executable" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.filter_pattern(&quot;parse&quot;)</div>
  </div>
  <div class="line not-executable" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Only run tests that start with &quot;should&quot;</div>
  </div>
  <div class="line not-executable" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.filter_pattern(&quot;^should&quot;)</div>
  </div>
  <div class="line not-executable" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Run tests related to file operations</div>
  </div>
  <div class="line not-executable" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.filter_pattern(&quot;file&quot;)</div>
  </div>
  <div class="line not-covered" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.filter_pattern(pattern)</div>
  </div>
  <div class="line not-covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  filter_pattern = pattern</div>
  </div>
  <div class="line not-covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Mark a test as pending</div>
  </div>
  <div class="line not-executable" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function is used within test cases to indicate that the test is not yet</div>
  </div>
  <div class="line not-executable" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- implemented or is temporarily disabled. Pending tests will be reported differently</div>
  </div>
  <div class="line not-executable" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- than failures, making it clear they are intentionally incomplete.</div>
  </div>
  <div class="line not-executable" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message? string Optional message explaining why the test is pending</div>
  </div>
  <div class="line not-executable" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string The pending message</div>
  </div>
  <div class="line not-executable" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Mark a test as pending without a message</div>
  </div>
  <div class="line not-executable" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- it(&quot;should handle edge cases&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return firmo.pending()</div>
  </div>
  <div class="line not-executable" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Mark a test as pending with an explanation</div>
  </div>
  <div class="line not-executable" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- it(&quot;should optimize for large datasets&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return firmo.pending(&quot;Waiting for optimization strategy decision&quot;)</div>
  </div>
  <div class="line not-executable" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.pending(message)</div>
  </div>
  <div class="line not-covered" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  message = message or &quot;Test not yet implemented&quot;</div>
  </div>
  <div class="line not-covered" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return message</div>
  </div>
  <div class="line not-covered" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a test group</div>
  </div>
  <div class="line not-executable" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function creates a block of related tests, providing hierarchical organization.</div>
  </div>
  <div class="line not-executable" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Describe blocks can be nested to create a tree-like structure of tests, with each</div>
  </div>
  <div class="line not-executable" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- level having its own setup (before) and teardown (after) hooks. The callback</div>
  </div>
  <div class="line not-executable" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- function contains test definitions and possibly nested describe blocks.</div>
  </div>
  <div class="line not-executable" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param name string Name of the test group</div>
  </div>
  <div class="line not-executable" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param fn function Function containing the test group</div>
  </div>
  <div class="line not-executable" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param options? {focused?: boolean, excluded?: boolean, _parent_focused?: boolean} Options for the test group</div>
  </div>
  <div class="line not-executable" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Basic describe block</div>
  </div>
  <div class="line not-executable" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- describe(&quot;User authentication&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;should allow valid users to log in&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- test implementation</div>
  </div>
  <div class="line not-executable" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;should reject invalid credentials&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- test implementation</div>
  </div>
  <div class="line not-executable" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Nested describe blocks</div>
  </div>
  <div class="line not-executable" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- describe(&quot;File operations&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   describe(&quot;Reading files&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     it(&quot;should read text files&quot;, function() end)</div>
  </div>
  <div class="line not-executable" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     it(&quot;should read binary files&quot;, function() end)</div>
  </div>
  <div class="line not-executable" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   describe(&quot;Writing files&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     it(&quot;should write text files&quot;, function() end)</div>
  </div>
  <div class="line not-executable" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     it(&quot;should write binary files&quot;, function() end)</div>
  </div>
  <div class="line not-executable" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.describe(name, fn, options)</div>
  </div>
  <div class="line not-covered" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  options = options or {}</div>
  </div>
  <div class="line not-covered" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local parent_focused = options._parent_focused or false</div>
  </div>
  <div class="line not-covered" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local focused = options.focused or false</div>
  </div>
  <div class="line not-covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local excluded = options.excluded or false</div>
  </div>
  <div class="line not-executable" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update focus mode if this is a focused describe</div>
  </div>
  <div class="line not-covered" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if focused and not excluded then</div>
  </div>
  <div class="line not-covered" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    focus_mode = true</div>
  </div>
  <div class="line not-covered" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Save previous tags and level</div>
  </div>
  <div class="line not-covered" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local previous_level = level</div>
  </div>
  <div class="line not-covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local previous_tags = {}</div>
  </div>
  <div class="line not-covered" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i, v in ipairs(current_tags) do</div>
  </div>
  <div class="line not-covered" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    previous_tags[i] = v</div>
  </div>
  <div class="line not-covered" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a new describe block</div>
  </div>
  <div class="line not-covered" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local block = {</div>
  </div>
  <div class="line not-covered" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    name = name,</div>
  </div>
  <div class="line not-covered" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    parent = current_describe_block,</div>
  </div>
  <div class="line not-covered" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    focused = focused,</div>
  </div>
  <div class="line not-covered" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    excluded = excluded,</div>
  </div>
  <div class="line not-covered" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    parent_focused = parent_focused,</div>
  </div>
  <div class="line not-covered" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    tags = {},</div>
  </div>
  <div class="line not-covered" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Copy current tags to the block</div>
  </div>
  <div class="line not-covered" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i, v in ipairs(current_tags) do</div>
  </div>
  <div class="line not-covered" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    block.tags[i] = v</div>
  </div>
  <div class="line not-covered" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if block should be skipped based on tags</div>
  </div>
  <div class="line not-covered" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local should_skip_block = not has_required_tags(block.tags)</div>
  </div>
  <div class="line not-executable" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Save previous describe block and set current</div>
  </div>
  <div class="line not-covered" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local previous_describe_block = current_describe_block</div>
  </div>
  <div class="line not-covered" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  current_describe_block = block</div>
  </div>
  <div class="line not-executable" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Insert block into test_blocks</div>
  </div>
  <div class="line not-covered" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(test_blocks, block)</div>
  </div>
  <div class="line not-executable" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Increase level and ensure hooks tables exist</div>
  </div>
  <div class="line not-covered" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  level = level + 1</div>
  </div>
  <div class="line not-covered" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  befores[level] = befores[level] or {}</div>
  </div>
  <div class="line not-covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  afters[level] = afters[level] or {}</div>
  </div>
  <div class="line not-executable" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not should_skip_block then</div>
  </div>
  <div class="line not-executable" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Execute the test group function to register its tests</div>
  </div>
  <div class="line not-covered" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, err = error_handler.try(fn)</div>
  </div>
  <div class="line not-covered" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line not-executable" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Handle errors in describe blocks</div>
  </div>
  <div class="line not-covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Error in describe block: &quot; .. error_handler.format_error(err), {</div>
  </div>
  <div class="line not-covered" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        block_name = name,</div>
  </div>
  <div class="line not-covered" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        level = level,</div>
  </div>
  <div class="line not-covered" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      errors = errors + 1</div>
  </div>
  <div class="line not-covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Restore previous state</div>
  </div>
  <div class="line not-covered" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  level = previous_level</div>
  </div>
  <div class="line not-covered" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  current_tags = previous_tags</div>
  </div>
  <div class="line not-covered" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  current_describe_block = previous_describe_block</div>
  </div>
  <div class="line not-covered" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a focused test group</div>
  </div>
  <div class="line not-executable" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function creates a test group that will be executed exclusively, along with</div>
  </div>
  <div class="line not-executable" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- any other focused tests. All non-focused tests will be skipped when focus mode</div>
  </div>
  <div class="line not-executable" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- is active. This is useful for temporarily focusing on a specific area of the</div>
  </div>
  <div class="line not-executable" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- test suite during development or debugging.</div>
  </div>
  <div class="line not-executable" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param name string Name of the test group</div>
  </div>
  <div class="line not-executable" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param fn function Function containing the test group</div>
  </div>
  <div class="line not-executable" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Only this test group and its tests will run</div>
  </div>
  <div class="line not-executable" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fdescribe(&quot;Authentication module&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;should authenticate valid users&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- Test implementation</div>
  </div>
  <div class="line not-executable" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;should reject invalid credentials&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- Test implementation</div>
  </div>
  <div class="line not-executable" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- These tests will be skipped when focus mode is active</div>
  </div>
  <div class="line not-executable" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- describe(&quot;Other module&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;will be skipped when focus mode is active&quot;, function() end)</div>
  </div>
  <div class="line not-executable" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.fdescribe(name, fn)</div>
  </div>
  <div class="line not-covered" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M.describe(name, fn, {focused = true})</div>
  </div>
  <div class="line not-covered" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a skipped test group</div>
  </div>
  <div class="line not-executable" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function creates a test group that will be skipped during execution.</div>
  </div>
  <div class="line not-executable" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This is useful for temporarily disabling a group of tests that might be</div>
  </div>
  <div class="line not-executable" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- broken, incomplete, or not relevant to the current development focus.</div>
  </div>
  <div class="line not-executable" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param name string Name of the test group</div>
  </div>
  <div class="line not-executable" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param fn function Function containing the test group</div>
  </div>
  <div class="line not-executable" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- This entire group of tests will be skipped</div>
  </div>
  <div class="line not-executable" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- xdescribe(&quot;Work in progress module&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;has tests that aren't ready yet&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- Incomplete test</div>
  </div>
  <div class="line not-executable" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;contains features under development&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- Incomplete test</div>
  </div>
  <div class="line not-executable" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Normal tests continue to run</div>
  </div>
  <div class="line not-executable" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- describe(&quot;Stable module&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;runs normally&quot;, function() end)</div>
  </div>
  <div class="line not-executable" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.xdescribe(name, fn)</div>
  </div>
  <div class="line not-covered" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M.describe(name, fn, {excluded = true})</div>
  </div>
  <div class="line not-covered" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a test case</div>
  </div>
  <div class="line not-executable" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function defines an individual test case within a describe block.</div>
  </div>
  <div class="line not-executable" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Each test contains assertions that verify specific behaviors of the code</div>
  </div>
  <div class="line not-executable" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- being tested. Tests can have options for controlling execution,</div>
  </div>
  <div class="line not-executable" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- such as focusing, skipping, or expecting errors.</div>
  </div>
  <div class="line not-executable" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param name string Name of the test case</div>
  </div>
  <div class="line not-executable" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param options_or_fn table|function Options table or test function</div>
  </div>
  <div class="line not-executable" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param fn? function Test function if options were provided</div>
  </div>
  <div class="line not-executable" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Basic test case</div>
  </div>
  <div class="line not-executable" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- it(&quot;should add two numbers correctly&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   expect(1 + 2).to.equal(3)</div>
  </div>
  <div class="line not-executable" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Test with options</div>
  </div>
  <div class="line not-executable" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- it(&quot;should throw an error for invalid input&quot;, {</div>
  </div>
  <div class="line not-executable" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   expect_error = true,</div>
  </div>
  <div class="line not-executable" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   tags = {&quot;validation&quot;, &quot;error-handling&quot;}</div>
  </div>
  <div class="line not-executable" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }, function()</div>
  </div>
  <div class="line not-executable" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local result = validate_input(nil)</div>
  </div>
  <div class="line not-executable" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- This test passes if an error is thrown</div>
  </div>
  <div class="line not-executable" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Test with timeout</div>
  </div>
  <div class="line not-executable" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- it(&quot;should complete within time limit&quot;, {</div>
  </div>
  <div class="line not-executable" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   timeout = 1000 -- milliseconds</div>
  </div>
  <div class="line not-executable" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }, function()</div>
  </div>
  <div class="line not-executable" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   perform_operation()</div>
  </div>
  <div class="line not-executable" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   expect(operation_completed).to.be_truthy()</div>
  </div>
  <div class="line not-executable" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.it(name, options_or_fn, fn)</div>
  </div>
  <div class="line not-executable" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Determine if first argument is options or function</div>
  </div>
  <div class="line not-covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local options = {}</div>
  </div>
  <div class="line not-covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(options_or_fn) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    options = options_or_fn</div>
  </div>
  <div class="line not-covered" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    fn = options_or_fn</div>
  </div>
  <div class="line not-covered" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Apply defaults to options</div>
  </div>
  <div class="line not-covered" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  options = merge_options(options, {</div>
  </div>
  <div class="line not-covered" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    focused = false,</div>
  </div>
  <div class="line not-covered" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    excluded = false,</div>
  </div>
  <div class="line not-covered" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    expect_error = false,</div>
  </div>
  <div class="line not-covered" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    tags = {},</div>
  </div>
  <div class="line not-covered" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    timeout = nil,</div>
  </div>
  <div class="line not-covered" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  })</div>
  </div>
  <div class="line not-executable" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Determine if test should be skipped based on focus mode</div>
  </div>
  <div class="line not-covered" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local should_skip = false</div>
  </div>
  <div class="line not-executable" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Skip if exclude flag is set</div>
  </div>
  <div class="line not-covered" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.excluded then</div>
  </div>
  <div class="line not-covered" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    should_skip = true</div>
  </div>
  <div class="line not-covered" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Skip if there are focused tests and this one isn't focused</div>
  </div>
  <div class="line not-covered" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if focus_mode and not options.focused and not (current_describe_block and current_describe_block.focused) then</div>
  </div>
  <div class="line not-covered" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    should_skip = true</div>
  </div>
  <div class="line not-covered" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Skip if tags don't match</div>
  </div>
  <div class="line not-covered" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local test_tags = {}</div>
  </div>
  <div class="line not-executable" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add tags from current describe block</div>
  </div>
  <div class="line not-covered" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if current_describe_block and current_describe_block.tags then</div>
  </div>
  <div class="line not-covered" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, tag in ipairs(current_describe_block.tags) do</div>
  </div>
  <div class="line not-covered" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      table.insert(test_tags, tag)</div>
  </div>
  <div class="line not-covered" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add tags from options</div>
  </div>
  <div class="line not-covered" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, tag in ipairs(options.tags) do</div>
  </div>
  <div class="line not-covered" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(test_tags, tag)</div>
  </div>
  <div class="line not-covered" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add tags from current context</div>
  </div>
  <div class="line not-covered" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, tag in ipairs(current_tags) do</div>
  </div>
  <div class="line not-covered" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(test_tags, tag)</div>
  </div>
  <div class="line not-covered" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Skip if test doesn't have required tags</div>
  </div>
  <div class="line not-covered" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not has_required_tags(test_tags) then</div>
  </div>
  <div class="line not-covered" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    should_skip = true</div>
  </div>
  <div class="line not-covered" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Skip if name doesn't match pattern</div>
  </div>
  <div class="line not-covered" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if filter_pattern and name:match(filter_pattern) == nil then</div>
  </div>
  <div class="line not-covered" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    should_skip = true</div>
  </div>
  <div class="line not-covered" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Record test path</div>
  </div>
  <div class="line not-covered" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local path = {}</div>
  </div>
  <div class="line not-covered" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local current = current_describe_block</div>
  </div>
  <div class="line not-covered" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  while current do</div>
  </div>
  <div class="line not-covered" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(path, 1, current.name)</div>
  </div>
  <div class="line not-covered" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    current = current.parent</div>
  </div>
  <div class="line not-covered" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(path, name)</div>
  </div>
  <div class="line not-executable" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Store full test path</div>
  </div>
  <div class="line not-covered" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(test_paths, path)</div>
  </div>
  <div class="line not-executable" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if should_skip then</div>
  </div>
  <div class="line not-executable" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Record this test as skipped with structured data</div>
  </div>
  <div class="line not-covered" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = M.add_test_result({</div>
  </div>
  <div class="line not-covered" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      status = TEST_STATUS.SKIP,</div>
  </div>
  <div class="line not-covered" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      name = name,</div>
  </div>
  <div class="line not-covered" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line not-covered" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path_string = table.concat(path, &quot; / &quot;),</div>
  </div>
  <div class="line not-covered" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      timestamp = os.time(),</div>
  </div>
  <div class="line not-covered" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      options = options,</div>
  </div>
  <div class="line not-covered" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      reason = &quot;Test skipped due to filtering or tagging&quot;</div>
  </div>
  <div class="line not-covered" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Log as skipped with proper structure</div>
  </div>
  <div class="line not-covered" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Test skipped: &quot; .. name, {</div>
  </div>
  <div class="line not-covered" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      test_name = name,</div>
  </div>
  <div class="line not-covered" id="L478">
    <div class="line-number"><a href="#L478">478</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      test_path = table.concat(path, &quot; / &quot;),</div>
  </div>
  <div class="line not-covered" id="L479">
    <div class="line-number"><a href="#L479">479</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      test_result = result</div>
  </div>
  <div class="line not-covered" id="L480">
    <div class="line-number"><a href="#L480">480</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L481">
    <div class="line-number"><a href="#L481">481</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L482">
    <div class="line-number"><a href="#L482">482</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return</div>
  </div>
  <div class="line not-covered" id="L483">
    <div class="line-number"><a href="#L483">483</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L484">
    <div class="line-number"><a href="#L484">484</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L485">
    <div class="line-number"><a href="#L485">485</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Run test with proper error handling</div>
  </div>
  <div class="line not-covered" id="L486">
    <div class="line-number"><a href="#L486">486</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local test_start_time = os.clock()</div>
  </div>
  <div class="line not-covered" id="L487">
    <div class="line-number"><a href="#L487">487</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, err = error_handler.try(function()</div>
  </div>
  <div class="line not-executable" id="L488">
    <div class="line-number"><a href="#L488">488</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Set temporary file context if available</div>
  </div>
  <div class="line not-covered" id="L489">
    <div class="line-number"><a href="#L489">489</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if temp_file and temp_file.set_current_test_context then</div>
  </div>
  <div class="line not-covered" id="L490">
    <div class="line-number"><a href="#L490">490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      temp_file.set_current_test_context({</div>
  </div>
  <div class="line not-covered" id="L491">
    <div class="line-number"><a href="#L491">491</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        type = &quot;test&quot;,</div>
  </div>
  <div class="line not-covered" id="L492">
    <div class="line-number"><a href="#L492">492</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        name = name,</div>
  </div>
  <div class="line not-covered" id="L493">
    <div class="line-number"><a href="#L493">493</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path = table.concat(path, &quot; / &quot;),</div>
  </div>
  <div class="line not-covered" id="L494">
    <div class="line-number"><a href="#L494">494</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L495">
    <div class="line-number"><a href="#L495">495</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L496">
    <div class="line-number"><a href="#L496">496</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L497">
    <div class="line-number"><a href="#L497">497</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Run before hooks for each level</div>
  </div>
  <div class="line not-covered" id="L498">
    <div class="line-number"><a href="#L498">498</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i = 1, level do</div>
  </div>
  <div class="line not-covered" id="L499">
    <div class="line-number"><a href="#L499">499</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, hook in ipairs(befores[i] or {}) do</div>
  </div>
  <div class="line not-covered" id="L500">
    <div class="line-number"><a href="#L500">500</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        hook()</div>
  </div>
  <div class="line not-covered" id="L501">
    <div class="line-number"><a href="#L501">501</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L502">
    <div class="line-number"><a href="#L502">502</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L503">
    <div class="line-number"><a href="#L503">503</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L504">
    <div class="line-number"><a href="#L504">504</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Run the test</div>
  </div>
  <div class="line not-covered" id="L505">
    <div class="line-number"><a href="#L505">505</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    fn()</div>
  </div>
  <div class="line not-executable" id="L506">
    <div class="line-number"><a href="#L506">506</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L507">
    <div class="line-number"><a href="#L507">507</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Run after hooks in reverse order</div>
  </div>
  <div class="line not-covered" id="L508">
    <div class="line-number"><a href="#L508">508</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i = level, 1, -1 do</div>
  </div>
  <div class="line not-covered" id="L509">
    <div class="line-number"><a href="#L509">509</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for _, hook in ipairs(afters[i] or {}) do</div>
  </div>
  <div class="line not-covered" id="L510">
    <div class="line-number"><a href="#L510">510</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        hook()</div>
  </div>
  <div class="line not-covered" id="L511">
    <div class="line-number"><a href="#L511">511</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L512">
    <div class="line-number"><a href="#L512">512</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L513">
    <div class="line-number"><a href="#L513">513</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L514">
    <div class="line-number"><a href="#L514">514</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Clean up test context</div>
  </div>
  <div class="line not-covered" id="L515">
    <div class="line-number"><a href="#L515">515</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if temp_file and temp_file.set_current_test_context then</div>
  </div>
  <div class="line not-covered" id="L516">
    <div class="line-number"><a href="#L516">516</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      temp_file.set_current_test_context(nil)</div>
  </div>
  <div class="line covered" id="L517">
    <div class="line-number"><a href="#L517">517</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L518">
    <div class="line-number"><a href="#L518">518</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L519">
    <div class="line-number"><a href="#L519">519</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Create a test pass result</div>
  </div>
  <div class="line covered" id="L520">
    <div class="line-number"><a href="#L520">520</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local result = M.add_test_result({</div>
  </div>
  <div class="line not-covered" id="L521">
    <div class="line-number"><a href="#L521">521</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      status = TEST_STATUS.PASS,</div>
  </div>
  <div class="line not-covered" id="L522">
    <div class="line-number"><a href="#L522">522</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      name = name,</div>
  </div>
  <div class="line not-covered" id="L523">
    <div class="line-number"><a href="#L523">523</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      path = path,</div>
  </div>
  <div class="line covered" id="L524">
    <div class="line-number"><a href="#L524">524</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      path_string = table.concat(path, &quot; / &quot;),</div>
  </div>
  <div class="line not-covered" id="L525">
    <div class="line-number"><a href="#L525">525</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      execution_time = os.clock() - test_start_time,</div>
  </div>
  <div class="line not-covered" id="L526">
    <div class="line-number"><a href="#L526">526</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      timestamp = os.time(),</div>
  </div>
  <div class="line covered" id="L527">
    <div class="line-number"><a href="#L527">527</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      options = options</div>
  </div>
  <div class="line covered" id="L528">
    <div class="line-number"><a href="#L528">528</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L529">
    <div class="line-number"><a href="#L529">529</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L530">
    <div class="line-number"><a href="#L530">530</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Log pass with proper structure</div>
  </div>
  <div class="line not-covered" id="L531">
    <div class="line-number"><a href="#L531">531</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(&quot;Test passed: &quot; .. name, {</div>
  </div>
  <div class="line not-covered" id="L532">
    <div class="line-number"><a href="#L532">532</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      test_name = name,</div>
  </div>
  <div class="line not-covered" id="L533">
    <div class="line-number"><a href="#L533">533</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      test_path = table.concat(path, &quot; / &quot;),</div>
  </div>
  <div class="line not-covered" id="L534">
    <div class="line-number"><a href="#L534">534</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      test_result = result</div>
  </div>
  <div class="line not-covered" id="L535">
    <div class="line-number"><a href="#L535">535</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L536">
    <div class="line-number"><a href="#L536">536</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end)</div>
  </div>
  <div class="line not-executable" id="L537">
    <div class="line-number"><a href="#L537">537</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L538">
    <div class="line-number"><a href="#L538">538</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Handle test errors</div>
  </div>
  <div class="line not-covered" id="L539">
    <div class="line-number"><a href="#L539">539</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line not-covered" id="L540">
    <div class="line-number"><a href="#L540">540</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local execution_time = os.clock() - test_start_time</div>
  </div>
  <div class="line not-executable" id="L541">
    <div class="line-number"><a href="#L541">541</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L542">
    <div class="line-number"><a href="#L542">542</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if options.expect_error then</div>
  </div>
  <div class="line not-executable" id="L543">
    <div class="line-number"><a href="#L543">543</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Test expects an error, so this is a pass</div>
  </div>
  <div class="line not-covered" id="L544">
    <div class="line-number"><a href="#L544">544</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local result = M.add_test_result({</div>
  </div>
  <div class="line not-covered" id="L545">
    <div class="line-number"><a href="#L545">545</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        status = TEST_STATUS.PASS,</div>
  </div>
  <div class="line not-covered" id="L546">
    <div class="line-number"><a href="#L546">546</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        name = name,</div>
  </div>
  <div class="line not-covered" id="L547">
    <div class="line-number"><a href="#L547">547</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path = path,</div>
  </div>
  <div class="line not-covered" id="L548">
    <div class="line-number"><a href="#L548">548</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path_string = table.concat(path, &quot; / &quot;),</div>
  </div>
  <div class="line not-covered" id="L549">
    <div class="line-number"><a href="#L549">549</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        execution_time = execution_time,</div>
  </div>
  <div class="line not-covered" id="L550">
    <div class="line-number"><a href="#L550">550</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        timestamp = os.time(),</div>
  </div>
  <div class="line not-covered" id="L551">
    <div class="line-number"><a href="#L551">551</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        options = options,</div>
  </div>
  <div class="line not-covered" id="L552">
    <div class="line-number"><a href="#L552">552</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        expect_error = true,</div>
  </div>
  <div class="line not-covered" id="L553">
    <div class="line-number"><a href="#L553">553</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = err, -- Store the error for inspection</div>
  </div>
  <div class="line not-covered" id="L554">
    <div class="line-number"><a href="#L554">554</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-executable" id="L555">
    <div class="line-number"><a href="#L555">555</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L556">
    <div class="line-number"><a href="#L556">556</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Log pass with proper structure for expected errors</div>
  </div>
  <div class="line not-covered" id="L557">
    <div class="line-number"><a href="#L557">557</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.info(&quot;Test passed with expected error: &quot; .. name, {</div>
  </div>
  <div class="line not-covered" id="L558">
    <div class="line-number"><a href="#L558">558</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_name = name,</div>
  </div>
  <div class="line not-covered" id="L559">
    <div class="line-number"><a href="#L559">559</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_path = table.concat(path, &quot; / &quot;),</div>
  </div>
  <div class="line not-covered" id="L560">
    <div class="line-number"><a href="#L560">560</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_result = result,</div>
  </div>
  <div class="line not-covered" id="L561">
    <div class="line-number"><a href="#L561">561</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        expect_error = true</div>
  </div>
  <div class="line not-covered" id="L562">
    <div class="line-number"><a href="#L562">562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L563">
    <div class="line-number"><a href="#L563">563</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-executable" id="L564">
    <div class="line-number"><a href="#L564">564</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Unexpected error, test fails</div>
  </div>
  <div class="line not-covered" id="L565">
    <div class="line-number"><a href="#L565">565</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local result = M.add_test_result({</div>
  </div>
  <div class="line not-covered" id="L566">
    <div class="line-number"><a href="#L566">566</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        status = TEST_STATUS.FAIL,</div>
  </div>
  <div class="line not-covered" id="L567">
    <div class="line-number"><a href="#L567">567</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        name = name,</div>
  </div>
  <div class="line not-covered" id="L568">
    <div class="line-number"><a href="#L568">568</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path = path,</div>
  </div>
  <div class="line not-covered" id="L569">
    <div class="line-number"><a href="#L569">569</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        path_string = table.concat(path, &quot; / &quot;),</div>
  </div>
  <div class="line not-covered" id="L570">
    <div class="line-number"><a href="#L570">570</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        execution_time = execution_time,</div>
  </div>
  <div class="line not-covered" id="L571">
    <div class="line-number"><a href="#L571">571</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        timestamp = os.time(),</div>
  </div>
  <div class="line not-covered" id="L572">
    <div class="line-number"><a href="#L572">572</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        options = options,</div>
  </div>
  <div class="line not-covered" id="L573">
    <div class="line-number"><a href="#L573">573</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error = err,</div>
  </div>
  <div class="line not-covered" id="L574">
    <div class="line-number"><a href="#L574">574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error_message = error_handler.format_error(err)</div>
  </div>
  <div class="line not-covered" id="L575">
    <div class="line-number"><a href="#L575">575</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-executable" id="L576">
    <div class="line-number"><a href="#L576">576</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L577">
    <div class="line-number"><a href="#L577">577</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Log error details with the structured result</div>
  </div>
  <div class="line not-covered" id="L578">
    <div class="line-number"><a href="#L578">578</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      logger.error(&quot;Test failed: &quot; .. error_handler.format_error(err), {</div>
  </div>
  <div class="line not-covered" id="L579">
    <div class="line-number"><a href="#L579">579</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_name = name,</div>
  </div>
  <div class="line not-covered" id="L580">
    <div class="line-number"><a href="#L580">580</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_path = table.concat(path, &quot; / &quot;),</div>
  </div>
  <div class="line not-covered" id="L581">
    <div class="line-number"><a href="#L581">581</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        test_result = result,</div>
  </div>
  <div class="line not-covered" id="L582">
    <div class="line-number"><a href="#L582">582</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error_message = error_handler.format_error(err)</div>
  </div>
  <div class="line not-covered" id="L583">
    <div class="line-number"><a href="#L583">583</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      })</div>
  </div>
  <div class="line not-covered" id="L584">
    <div class="line-number"><a href="#L584">584</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L585">
    <div class="line-number"><a href="#L585">585</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L586">
    <div class="line-number"><a href="#L586">586</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L587">
    <div class="line-number"><a href="#L587">587</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a focused test case</div>
  </div>
  <div class="line not-executable" id="L588">
    <div class="line-number"><a href="#L588">588</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function creates a test case that will run exclusively, along with any other</div>
  </div>
  <div class="line not-executable" id="L589">
    <div class="line-number"><a href="#L589">589</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- focused tests. When any test is focused, all non-focused tests are skipped.</div>
  </div>
  <div class="line not-executable" id="L590">
    <div class="line-number"><a href="#L590">590</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This is useful for temporarily focusing on a specific test during development</div>
  </div>
  <div class="line not-executable" id="L591">
    <div class="line-number"><a href="#L591">591</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- or debugging without having to run the entire test suite.</div>
  </div>
  <div class="line not-executable" id="L592">
    <div class="line-number"><a href="#L592">592</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L593">
    <div class="line-number"><a href="#L593">593</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param name string Name of the test case</div>
  </div>
  <div class="line not-executable" id="L594">
    <div class="line-number"><a href="#L594">594</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param options_or_fn table|function Options table or test function</div>
  </div>
  <div class="line not-executable" id="L595">
    <div class="line-number"><a href="#L595">595</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param fn? function Test function if options were provided</div>
  </div>
  <div class="line not-executable" id="L596">
    <div class="line-number"><a href="#L596">596</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L597">
    <div class="line-number"><a href="#L597">597</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L598">
    <div class="line-number"><a href="#L598">598</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Only this test will run (and any other focused tests)</div>
  </div>
  <div class="line not-executable" id="L599">
    <div class="line-number"><a href="#L599">599</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fit(&quot;should properly handle the edge case&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L600">
    <div class="line-number"><a href="#L600">600</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Test implementation</div>
  </div>
  <div class="line not-executable" id="L601">
    <div class="line-number"><a href="#L601">601</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   expect(edge_case_function()).to.be_truthy()</div>
  </div>
  <div class="line not-executable" id="L602">
    <div class="line-number"><a href="#L602">602</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L603">
    <div class="line-number"><a href="#L603">603</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L604">
    <div class="line-number"><a href="#L604">604</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- This test will be skipped when any test is focused</div>
  </div>
  <div class="line not-executable" id="L605">
    <div class="line-number"><a href="#L605">605</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- it(&quot;regular test that will be skipped&quot;, function() end)</div>
  </div>
  <div class="line not-executable" id="L606">
    <div class="line-number"><a href="#L606">606</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L607">
    <div class="line-number"><a href="#L607">607</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- You can also provide options</div>
  </div>
  <div class="line not-executable" id="L608">
    <div class="line-number"><a href="#L608">608</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fit(&quot;focused test with options&quot;, {</div>
  </div>
  <div class="line not-executable" id="L609">
    <div class="line-number"><a href="#L609">609</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   timeout = 2000,</div>
  </div>
  <div class="line not-executable" id="L610">
    <div class="line-number"><a href="#L610">610</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   tags = {&quot;important&quot;, &quot;edge-case&quot;}</div>
  </div>
  <div class="line not-executable" id="L611">
    <div class="line-number"><a href="#L611">611</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }, function()</div>
  </div>
  <div class="line not-executable" id="L612">
    <div class="line-number"><a href="#L612">612</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   expect(complex_operation()).to.be_truthy()</div>
  </div>
  <div class="line not-executable" id="L613">
    <div class="line-number"><a href="#L613">613</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L614">
    <div class="line-number"><a href="#L614">614</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.fit(name, options_or_fn, fn)</div>
  </div>
  <div class="line not-executable" id="L615">
    <div class="line-number"><a href="#L615">615</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Set focus mode</div>
  </div>
  <div class="line not-covered" id="L616">
    <div class="line-number"><a href="#L616">616</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  focus_mode = true</div>
  </div>
  <div class="line not-executable" id="L617">
    <div class="line-number"><a href="#L617">617</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L618">
    <div class="line-number"><a href="#L618">618</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Determine if first argument is options or function</div>
  </div>
  <div class="line not-covered" id="L619">
    <div class="line-number"><a href="#L619">619</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local options = {}</div>
  </div>
  <div class="line not-covered" id="L620">
    <div class="line-number"><a href="#L620">620</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(options_or_fn) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L621">
    <div class="line-number"><a href="#L621">621</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    options = options_or_fn</div>
  </div>
  <div class="line not-covered" id="L622">
    <div class="line-number"><a href="#L622">622</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    options.focused = true</div>
  </div>
  <div class="line not-covered" id="L623">
    <div class="line-number"><a href="#L623">623</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L624">
    <div class="line-number"><a href="#L624">624</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    fn = options_or_fn</div>
  </div>
  <div class="line not-covered" id="L625">
    <div class="line-number"><a href="#L625">625</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    options = {focused = true}</div>
  </div>
  <div class="line not-covered" id="L626">
    <div class="line-number"><a href="#L626">626</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L627">
    <div class="line-number"><a href="#L627">627</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L628">
    <div class="line-number"><a href="#L628">628</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M.it(name, options, fn)</div>
  </div>
  <div class="line not-covered" id="L629">
    <div class="line-number"><a href="#L629">629</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L630">
    <div class="line-number"><a href="#L630">630</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a skipped test case</div>
  </div>
  <div class="line not-executable" id="L631">
    <div class="line-number"><a href="#L631">631</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function creates a test case that will be skipped during execution.</div>
  </div>
  <div class="line not-executable" id="L632">
    <div class="line-number"><a href="#L632">632</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This is useful for temporarily disabling specific tests that may be</div>
  </div>
  <div class="line not-executable" id="L633">
    <div class="line-number"><a href="#L633">633</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- broken, incomplete, or not relevant to the current development focus.</div>
  </div>
  <div class="line not-executable" id="L634">
    <div class="line-number"><a href="#L634">634</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L635">
    <div class="line-number"><a href="#L635">635</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param name string Name of the test case</div>
  </div>
  <div class="line not-executable" id="L636">
    <div class="line-number"><a href="#L636">636</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param options_or_fn table|function Options table or test function</div>
  </div>
  <div class="line not-executable" id="L637">
    <div class="line-number"><a href="#L637">637</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param fn? function Test function if options were provided</div>
  </div>
  <div class="line not-executable" id="L638">
    <div class="line-number"><a href="#L638">638</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L639">
    <div class="line-number"><a href="#L639">639</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L640">
    <div class="line-number"><a href="#L640">640</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- This test will be skipped</div>
  </div>
  <div class="line not-executable" id="L641">
    <div class="line-number"><a href="#L641">641</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- xit(&quot;incomplete feature&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L642">
    <div class="line-number"><a href="#L642">642</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Incomplete or broken test</div>
  </div>
  <div class="line not-executable" id="L643">
    <div class="line-number"><a href="#L643">643</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   expect(unfinished_feature()).to.work()</div>
  </div>
  <div class="line not-executable" id="L644">
    <div class="line-number"><a href="#L644">644</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L645">
    <div class="line-number"><a href="#L645">645</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L646">
    <div class="line-number"><a href="#L646">646</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- You can still provide options for future reference</div>
  </div>
  <div class="line not-executable" id="L647">
    <div class="line-number"><a href="#L647">647</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- xit(&quot;test requiring additional setup&quot;, {</div>
  </div>
  <div class="line not-executable" id="L648">
    <div class="line-number"><a href="#L648">648</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   timeout = 5000,</div>
  </div>
  <div class="line not-executable" id="L649">
    <div class="line-number"><a href="#L649">649</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   tags = {&quot;integration&quot;, &quot;database&quot;}</div>
  </div>
  <div class="line not-executable" id="L650">
    <div class="line-number"><a href="#L650">650</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- }, function()</div>
  </div>
  <div class="line not-executable" id="L651">
    <div class="line-number"><a href="#L651">651</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Test that will be skipped</div>
  </div>
  <div class="line not-executable" id="L652">
    <div class="line-number"><a href="#L652">652</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L653">
    <div class="line-number"><a href="#L653">653</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L654">
    <div class="line-number"><a href="#L654">654</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Regular tests continue to run</div>
  </div>
  <div class="line not-executable" id="L655">
    <div class="line-number"><a href="#L655">655</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- it(&quot;working feature&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L656">
    <div class="line-number"><a href="#L656">656</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   expect(1 + 1).to.equal(2)</div>
  </div>
  <div class="line not-executable" id="L657">
    <div class="line-number"><a href="#L657">657</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L658">
    <div class="line-number"><a href="#L658">658</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.xit(name, options_or_fn, fn)</div>
  </div>
  <div class="line not-executable" id="L659">
    <div class="line-number"><a href="#L659">659</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Determine if first argument is options or function</div>
  </div>
  <div class="line not-covered" id="L660">
    <div class="line-number"><a href="#L660">660</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local options = {}</div>
  </div>
  <div class="line not-covered" id="L661">
    <div class="line-number"><a href="#L661">661</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(options_or_fn) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L662">
    <div class="line-number"><a href="#L662">662</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    options = options_or_fn</div>
  </div>
  <div class="line not-covered" id="L663">
    <div class="line-number"><a href="#L663">663</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    options.excluded = true</div>
  </div>
  <div class="line not-covered" id="L664">
    <div class="line-number"><a href="#L664">664</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L665">
    <div class="line-number"><a href="#L665">665</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    fn = options_or_fn</div>
  </div>
  <div class="line not-covered" id="L666">
    <div class="line-number"><a href="#L666">666</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    options = {excluded = true}</div>
  </div>
  <div class="line not-covered" id="L667">
    <div class="line-number"><a href="#L667">667</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L668">
    <div class="line-number"><a href="#L668">668</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L669">
    <div class="line-number"><a href="#L669">669</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M.it(name, options, fn)</div>
  </div>
  <div class="line not-covered" id="L670">
    <div class="line-number"><a href="#L670">670</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L671">
    <div class="line-number"><a href="#L671">671</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Add a setup hook for the current block</div>
  </div>
  <div class="line not-executable" id="L672">
    <div class="line-number"><a href="#L672">672</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function registers a setup function that will be executed before each test</div>
  </div>
  <div class="line not-executable" id="L673">
    <div class="line-number"><a href="#L673">673</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- within the current describe block, including tests in nested describe blocks.</div>
  </div>
  <div class="line not-executable" id="L674">
    <div class="line-number"><a href="#L674">674</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Setup hooks run in hierarchical order, with parent block hooks running before</div>
  </div>
  <div class="line not-executable" id="L675">
    <div class="line-number"><a href="#L675">675</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- child block hooks, providing a way to establish test prerequisites.</div>
  </div>
  <div class="line not-executable" id="L676">
    <div class="line-number"><a href="#L676">676</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L677">
    <div class="line-number"><a href="#L677">677</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param fn function Hook function to execute before each test</div>
  </div>
  <div class="line not-executable" id="L678">
    <div class="line-number"><a href="#L678">678</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L679">
    <div class="line-number"><a href="#L679">679</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L680">
    <div class="line-number"><a href="#L680">680</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Basic setup hook</div>
  </div>
  <div class="line not-executable" id="L681">
    <div class="line-number"><a href="#L681">681</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- describe(&quot;Database operations&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L682">
    <div class="line-number"><a href="#L682">682</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   before(function()</div>
  </div>
  <div class="line not-executable" id="L683">
    <div class="line-number"><a href="#L683">683</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- Setup code that runs before each test in this block</div>
  </div>
  <div class="line not-executable" id="L684">
    <div class="line-number"><a href="#L684">684</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     db.connect()</div>
  </div>
  <div class="line not-executable" id="L685">
    <div class="line-number"><a href="#L685">685</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     db.clear_test_data()</div>
  </div>
  <div class="line not-executable" id="L686">
    <div class="line-number"><a href="#L686">686</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L687">
    <div class="line-number"><a href="#L687">687</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L688">
    <div class="line-number"><a href="#L688">688</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;should insert records&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L689">
    <div class="line-number"><a href="#L689">689</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- db is already connected and cleared due to before hook</div>
  </div>
  <div class="line not-executable" id="L690">
    <div class="line-number"><a href="#L690">690</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     db.insert({id = 1, name = &quot;Test&quot;})</div>
  </div>
  <div class="line not-executable" id="L691">
    <div class="line-number"><a href="#L691">691</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     expect(db.count()).to.equal(1)</div>
  </div>
  <div class="line not-executable" id="L692">
    <div class="line-number"><a href="#L692">692</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L693">
    <div class="line-number"><a href="#L693">693</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L694">
    <div class="line-number"><a href="#L694">694</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L695">
    <div class="line-number"><a href="#L695">695</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Nested hooks demonstration</div>
  </div>
  <div class="line not-executable" id="L696">
    <div class="line-number"><a href="#L696">696</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- describe(&quot;Parent suite&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L697">
    <div class="line-number"><a href="#L697">697</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   before(function()</div>
  </div>
  <div class="line not-executable" id="L698">
    <div class="line-number"><a href="#L698">698</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- This runs first for all tests in this and nested blocks</div>
  </div>
  <div class="line not-executable" id="L699">
    <div class="line-number"><a href="#L699">699</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     setup_parent_resources()</div>
  </div>
  <div class="line not-executable" id="L700">
    <div class="line-number"><a href="#L700">700</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L701">
    <div class="line-number"><a href="#L701">701</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L702">
    <div class="line-number"><a href="#L702">702</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   describe(&quot;Child suite&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L703">
    <div class="line-number"><a href="#L703">703</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     before(function()</div>
  </div>
  <div class="line not-executable" id="L704">
    <div class="line-number"><a href="#L704">704</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       -- This runs after parent's before but before the test</div>
  </div>
  <div class="line not-executable" id="L705">
    <div class="line-number"><a href="#L705">705</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       setup_child_resources()</div>
  </div>
  <div class="line not-executable" id="L706">
    <div class="line-number"><a href="#L706">706</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     end)</div>
  </div>
  <div class="line not-executable" id="L707">
    <div class="line-number"><a href="#L707">707</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     </div>
  </div>
  <div class="line not-executable" id="L708">
    <div class="line-number"><a href="#L708">708</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     it(&quot;test in child suite&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L709">
    <div class="line-number"><a href="#L709">709</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       -- Both parent and child setup have run</div>
  </div>
  <div class="line not-executable" id="L710">
    <div class="line-number"><a href="#L710">710</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     end)</div>
  </div>
  <div class="line not-executable" id="L711">
    <div class="line-number"><a href="#L711">711</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L712">
    <div class="line-number"><a href="#L712">712</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L713">
    <div class="line-number"><a href="#L713">713</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.before(fn)</div>
  </div>
  <div class="line not-covered" id="L714">
    <div class="line-number"><a href="#L714">714</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  befores[level] = befores[level] or {}</div>
  </div>
  <div class="line not-covered" id="L715">
    <div class="line-number"><a href="#L715">715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(befores[level], fn)</div>
  </div>
  <div class="line not-covered" id="L716">
    <div class="line-number"><a href="#L716">716</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L717">
    <div class="line-number"><a href="#L717">717</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Add a teardown hook for the current block</div>
  </div>
  <div class="line not-executable" id="L718">
    <div class="line-number"><a href="#L718">718</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function registers a teardown function that will be executed after each test</div>
  </div>
  <div class="line not-executable" id="L719">
    <div class="line-number"><a href="#L719">719</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- within the current describe block, including tests in nested describe blocks.</div>
  </div>
  <div class="line not-executable" id="L720">
    <div class="line-number"><a href="#L720">720</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Teardown hooks run in reverse hierarchical order, with child block hooks running before</div>
  </div>
  <div class="line not-executable" id="L721">
    <div class="line-number"><a href="#L721">721</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- parent block hooks, providing a way to clean up test resources.</div>
  </div>
  <div class="line not-executable" id="L722">
    <div class="line-number"><a href="#L722">722</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L723">
    <div class="line-number"><a href="#L723">723</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param fn function Hook function to execute after each test</div>
  </div>
  <div class="line not-executable" id="L724">
    <div class="line-number"><a href="#L724">724</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L725">
    <div class="line-number"><a href="#L725">725</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L726">
    <div class="line-number"><a href="#L726">726</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Basic teardown hook</div>
  </div>
  <div class="line not-executable" id="L727">
    <div class="line-number"><a href="#L727">727</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- describe(&quot;File operations&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L728">
    <div class="line-number"><a href="#L728">728</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local temp_file</div>
  </div>
  <div class="line not-executable" id="L729">
    <div class="line-number"><a href="#L729">729</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L730">
    <div class="line-number"><a href="#L730">730</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   before(function()</div>
  </div>
  <div class="line not-executable" id="L731">
    <div class="line-number"><a href="#L731">731</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     temp_file = create_temp_file()</div>
  </div>
  <div class="line not-executable" id="L732">
    <div class="line-number"><a href="#L732">732</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L733">
    <div class="line-number"><a href="#L733">733</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L734">
    <div class="line-number"><a href="#L734">734</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   after(function()</div>
  </div>
  <div class="line not-executable" id="L735">
    <div class="line-number"><a href="#L735">735</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     -- Cleanup after each test</div>
  </div>
  <div class="line not-executable" id="L736">
    <div class="line-number"><a href="#L736">736</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     delete_file(temp_file)</div>
  </div>
  <div class="line not-executable" id="L737">
    <div class="line-number"><a href="#L737">737</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L738">
    <div class="line-number"><a href="#L738">738</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L739">
    <div class="line-number"><a href="#L739">739</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;should write to file&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L740">
    <div class="line-number"><a href="#L740">740</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     write_to_file(temp_file, &quot;content&quot;)</div>
  </div>
  <div class="line not-executable" id="L741">
    <div class="line-number"><a href="#L741">741</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     expect(read_file(temp_file)).to.equal(&quot;content&quot;)</div>
  </div>
  <div class="line not-executable" id="L742">
    <div class="line-number"><a href="#L742">742</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L743">
    <div class="line-number"><a href="#L743">743</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L744">
    <div class="line-number"><a href="#L744">744</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L745">
    <div class="line-number"><a href="#L745">745</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Error handling in teardown</div>
  </div>
  <div class="line not-executable" id="L746">
    <div class="line-number"><a href="#L746">746</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- after(function()</div>
  </div>
  <div class="line not-executable" id="L747">
    <div class="line-number"><a href="#L747">747</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Always perform cleanup even if the test fails</div>
  </div>
  <div class="line not-executable" id="L748">
    <div class="line-number"><a href="#L748">748</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local success, err = pcall(function()</div>
  </div>
  <div class="line not-executable" id="L749">
    <div class="line-number"><a href="#L749">749</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     if connection then connection:close() end</div>
  </div>
  <div class="line not-executable" id="L750">
    <div class="line-number"><a href="#L750">750</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     if temp_files then</div>
  </div>
  <div class="line not-executable" id="L751">
    <div class="line-number"><a href="#L751">751</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       for _, file in ipairs(temp_files) do</div>
  </div>
  <div class="line not-executable" id="L752">
    <div class="line-number"><a href="#L752">752</a></div>
    <div class="execution-count"></div>    <div class="line-content">---         os.remove(file)</div>
  </div>
  <div class="line not-executable" id="L753">
    <div class="line-number"><a href="#L753">753</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       end</div>
  </div>
  <div class="line not-executable" id="L754">
    <div class="line-number"><a href="#L754">754</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     end</div>
  </div>
  <div class="line not-executable" id="L755">
    <div class="line-number"><a href="#L755">755</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L756">
    <div class="line-number"><a href="#L756">756</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   </div>
  </div>
  <div class="line not-executable" id="L757">
    <div class="line-number"><a href="#L757">757</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if not success then</div>
  </div>
  <div class="line not-executable" id="L758">
    <div class="line-number"><a href="#L758">758</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     print(&quot;Warning: Cleanup failed - &quot; .. tostring(err))</div>
  </div>
  <div class="line not-executable" id="L759">
    <div class="line-number"><a href="#L759">759</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L760">
    <div class="line-number"><a href="#L760">760</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L761">
    <div class="line-number"><a href="#L761">761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.after(fn)</div>
  </div>
  <div class="line not-covered" id="L762">
    <div class="line-number"><a href="#L762">762</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  afters[level] = afters[level] or {}</div>
  </div>
  <div class="line not-covered" id="L763">
    <div class="line-number"><a href="#L763">763</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(afters[level], fn)</div>
  </div>
  <div class="line not-covered" id="L764">
    <div class="line-number"><a href="#L764">764</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L765">
    <div class="line-number"><a href="#L765">765</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Reset the test state</div>
  </div>
  <div class="line not-executable" id="L766">
    <div class="line-number"><a href="#L766">766</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function completely resets the internal state of the test system,</div>
  </div>
  <div class="line not-executable" id="L767">
    <div class="line-number"><a href="#L767">767</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- clearing all test definitions, hooks, results, and configuration.</div>
  </div>
  <div class="line not-executable" id="L768">
    <div class="line-number"><a href="#L768">768</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It's typically called between test suite runs to ensure a clean slate</div>
  </div>
  <div class="line not-executable" id="L769">
    <div class="line-number"><a href="#L769">769</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and prevent state from leaking between test executions.</div>
  </div>
  <div class="line not-executable" id="L770">
    <div class="line-number"><a href="#L770">770</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L771">
    <div class="line-number"><a href="#L771">771</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L772">
    <div class="line-number"><a href="#L772">772</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Reset before running a new test suite</div>
  </div>
  <div class="line not-executable" id="L773">
    <div class="line-number"><a href="#L773">773</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.reset()</div>
  </div>
  <div class="line not-executable" id="L774">
    <div class="line-number"><a href="#L774">774</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- require(&quot;my_test_suite&quot;)</div>
  </div>
  <div class="line not-executable" id="L775">
    <div class="line-number"><a href="#L775">775</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L776">
    <div class="line-number"><a href="#L776">776</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Reset between individual test files</div>
  </div>
  <div class="line not-executable" id="L777">
    <div class="line-number"><a href="#L777">777</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, file in ipairs(test_files) do</div>
  </div>
  <div class="line not-executable" id="L778">
    <div class="line-number"><a href="#L778">778</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   firmo.reset()</div>
  </div>
  <div class="line not-executable" id="L779">
    <div class="line-number"><a href="#L779">779</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   dofile(file)</div>
  </div>
  <div class="line not-executable" id="L780">
    <div class="line-number"><a href="#L780">780</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L781">
    <div class="line-number"><a href="#L781">781</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L782">
    <div class="line-number"><a href="#L782">782</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Reset with custom configuration</div>
  </div>
  <div class="line not-executable" id="L783">
    <div class="line-number"><a href="#L783">783</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.reset()</div>
  </div>
  <div class="line not-executable" id="L784">
    <div class="line-number"><a href="#L784">784</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.only_tags(&quot;unit&quot;) -- Only run unit tests after reset</div>
  </div>
  <div class="line not-executable" id="L785">
    <div class="line-number"><a href="#L785">785</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.run()</div>
  </div>
  <div class="line not-covered" id="L786">
    <div class="line-number"><a href="#L786">786</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.reset()</div>
  </div>
  <div class="line not-covered" id="L787">
    <div class="line-number"><a href="#L787">787</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  level = 0</div>
  </div>
  <div class="line not-covered" id="L788">
    <div class="line-number"><a href="#L788">788</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  befores = {}</div>
  </div>
  <div class="line not-covered" id="L789">
    <div class="line-number"><a href="#L789">789</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  afters = {}</div>
  </div>
  <div class="line not-covered" id="L790">
    <div class="line-number"><a href="#L790">790</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  current_tags = {}</div>
  </div>
  <div class="line not-covered" id="L791">
    <div class="line-number"><a href="#L791">791</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  active_tags = {}</div>
  </div>
  <div class="line not-covered" id="L792">
    <div class="line-number"><a href="#L792">792</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  filter_pattern = nil</div>
  </div>
  <div class="line not-covered" id="L793">
    <div class="line-number"><a href="#L793">793</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  focus_mode = false</div>
  </div>
  <div class="line not-covered" id="L794">
    <div class="line-number"><a href="#L794">794</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  current_describe_block = nil</div>
  </div>
  <div class="line not-covered" id="L795">
    <div class="line-number"><a href="#L795">795</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  passes = 0</div>
  </div>
  <div class="line not-covered" id="L796">
    <div class="line-number"><a href="#L796">796</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  errors = 0</div>
  </div>
  <div class="line not-covered" id="L797">
    <div class="line-number"><a href="#L797">797</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  skipped = 0</div>
  </div>
  <div class="line not-covered" id="L798">
    <div class="line-number"><a href="#L798">798</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test_blocks = {}</div>
  </div>
  <div class="line not-covered" id="L799">
    <div class="line-number"><a href="#L799">799</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test_paths = {}</div>
  </div>
  <div class="line not-covered" id="L800">
    <div class="line-number"><a href="#L800">800</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  test_results = {} -- Clear all test results</div>
  </div>
  <div class="line not-covered" id="L801">
    <div class="line-number"><a href="#L801">801</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L802">
    <div class="line-number"><a href="#L802">802</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the current state of the test system</div>
  </div>
  <div class="line not-executable" id="L803">
    <div class="line-number"><a href="#L803">803</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function returns the current internal state of the test system, including</div>
  </div>
  <div class="line not-executable" id="L804">
    <div class="line-number"><a href="#L804">804</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- test counts, focus mode status, and test results. This is useful for generating</div>
  </div>
  <div class="line not-executable" id="L805">
    <div class="line-number"><a href="#L805">805</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- reports, monitoring test progress, and debugging test execution.</div>
  </div>
  <div class="line not-executable" id="L806">
    <div class="line-number"><a href="#L806">806</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L807">
    <div class="line-number"><a href="#L807">807</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return {level: number, passes: number, errors: number, skipped: number, focus_mode: boolean, test_results: TestResult[]} Current test system state</div>
  </div>
  <div class="line not-executable" id="L808">
    <div class="line-number"><a href="#L808">808</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L809">
    <div class="line-number"><a href="#L809">809</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L810">
    <div class="line-number"><a href="#L810">810</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Get test statistics</div>
  </div>
  <div class="line not-executable" id="L811">
    <div class="line-number"><a href="#L811">811</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local state = firmo.get_state()</div>
  </div>
  <div class="line not-executable" id="L812">
    <div class="line-number"><a href="#L812">812</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(string.format(&quot;Tests: %d passed, %d failed, %d skipped&quot;, </div>
  </div>
  <div class="line not-executable" id="L813">
    <div class="line-number"><a href="#L813">813</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   state.passes, state.errors, state.skipped))</div>
  </div>
  <div class="line not-executable" id="L814">
    <div class="line-number"><a href="#L814">814</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L815">
    <div class="line-number"><a href="#L815">815</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check if focus mode is active</div>
  </div>
  <div class="line not-executable" id="L816">
    <div class="line-number"><a href="#L816">816</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if state.focus_mode then</div>
  </div>
  <div class="line not-executable" id="L817">
    <div class="line-number"><a href="#L817">817</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Warning: Focus mode is active - some tests are being skipped&quot;)</div>
  </div>
  <div class="line not-executable" id="L818">
    <div class="line-number"><a href="#L818">818</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L819">
    <div class="line-number"><a href="#L819">819</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L820">
    <div class="line-number"><a href="#L820">820</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Inspect test results</div>
  </div>
  <div class="line not-executable" id="L821">
    <div class="line-number"><a href="#L821">821</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, result in ipairs(state.test_results) do</div>
  </div>
  <div class="line not-executable" id="L822">
    <div class="line-number"><a href="#L822">822</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   if result.status == &quot;fail&quot; then</div>
  </div>
  <div class="line not-executable" id="L823">
    <div class="line-number"><a href="#L823">823</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     print(string.format(&quot;FAILURE: %s - %s&quot;, </div>
  </div>
  <div class="line not-executable" id="L824">
    <div class="line-number"><a href="#L824">824</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       result.path_string, result.error_message or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L825">
    <div class="line-number"><a href="#L825">825</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L826">
    <div class="line-number"><a href="#L826">826</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L827">
    <div class="line-number"><a href="#L827">827</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_state()</div>
  </div>
  <div class="line not-covered" id="L828">
    <div class="line-number"><a href="#L828">828</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return {</div>
  </div>
  <div class="line not-covered" id="L829">
    <div class="line-number"><a href="#L829">829</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    level = level,</div>
  </div>
  <div class="line not-covered" id="L830">
    <div class="line-number"><a href="#L830">830</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    passes = passes,</div>
  </div>
  <div class="line not-covered" id="L831">
    <div class="line-number"><a href="#L831">831</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    errors = errors,</div>
  </div>
  <div class="line not-covered" id="L832">
    <div class="line-number"><a href="#L832">832</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    skipped = skipped,</div>
  </div>
  <div class="line not-covered" id="L833">
    <div class="line-number"><a href="#L833">833</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    focus_mode = focus_mode,</div>
  </div>
  <div class="line not-covered" id="L834">
    <div class="line-number"><a href="#L834">834</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    test_results = test_results,</div>
  </div>
  <div class="line not-covered" id="L835">
    <div class="line-number"><a href="#L835">835</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-covered" id="L836">
    <div class="line-number"><a href="#L836">836</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L837">
    <div class="line-number"><a href="#L837">837</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Export test status constants</div>
  </div>
  <div class="line not-covered" id="L838">
    <div class="line-number"><a href="#L838">838</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.STATUS = TEST_STATUS</div>
  </div>
  <div class="line not-executable" id="L839">
    <div class="line-number"><a href="#L839">839</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Add debug flag to test_definition module</div>
  </div>
  <div class="line not-covered" id="L840">
    <div class="line-number"><a href="#L840">840</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local debug_mode = false</div>
  </div>
  <div class="line not-executable" id="L841">
    <div class="line-number"><a href="#L841">841</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Set debug mode for test_definition module</div>
  </div>
  <div class="line not-executable" id="L842">
    <div class="line-number"><a href="#L842">842</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function enables or disables detailed debug output during test execution.</div>
  </div>
  <div class="line not-executable" id="L843">
    <div class="line-number"><a href="#L843">843</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- When debug mode is enabled, the system will print detailed information about</div>
  </div>
  <div class="line not-executable" id="L844">
    <div class="line-number"><a href="#L844">844</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- test execution, results, and internal state to help troubleshoot issues with</div>
  </div>
  <div class="line not-executable" id="L845">
    <div class="line-number"><a href="#L845">845</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- tests or the test framework itself.</div>
  </div>
  <div class="line not-executable" id="L846">
    <div class="line-number"><a href="#L846">846</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L847">
    <div class="line-number"><a href="#L847">847</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param value boolean Whether to enable debug output</div>
  </div>
  <div class="line not-executable" id="L848">
    <div class="line-number"><a href="#L848">848</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The module instance for chaining</div>
  </div>
  <div class="line not-executable" id="L849">
    <div class="line-number"><a href="#L849">849</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L850">
    <div class="line-number"><a href="#L850">850</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L851">
    <div class="line-number"><a href="#L851">851</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Enable debug mode to see detailed output</div>
  </div>
  <div class="line not-executable" id="L852">
    <div class="line-number"><a href="#L852">852</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.set_debug_mode(true)</div>
  </div>
  <div class="line not-executable" id="L853">
    <div class="line-number"><a href="#L853">853</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L854">
    <div class="line-number"><a href="#L854">854</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Run tests with detailed debug information</div>
  </div>
  <div class="line not-executable" id="L855">
    <div class="line-number"><a href="#L855">855</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- describe(&quot;Debugging test suite&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L856">
    <div class="line-number"><a href="#L856">856</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   it(&quot;shows detailed output in debug mode&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L857">
    <div class="line-number"><a href="#L857">857</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     expect(true).to.be_truthy()</div>
  </div>
  <div class="line not-executable" id="L858">
    <div class="line-number"><a href="#L858">858</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end)</div>
  </div>
  <div class="line not-executable" id="L859">
    <div class="line-number"><a href="#L859">859</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L860">
    <div class="line-number"><a href="#L860">860</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L861">
    <div class="line-number"><a href="#L861">861</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Disable debug mode when done troubleshooting</div>
  </div>
  <div class="line not-executable" id="L862">
    <div class="line-number"><a href="#L862">862</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- firmo.set_debug_mode(false)</div>
  </div>
  <div class="line not-covered" id="L863">
    <div class="line-number"><a href="#L863">863</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.set_debug_mode(value)</div>
  </div>
  <div class="line not-covered" id="L864">
    <div class="line-number"><a href="#L864">864</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  debug_mode = value == true</div>
  </div>
  <div class="line not-covered" id="L865">
    <div class="line-number"><a href="#L865">865</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L866">
    <div class="line-number"><a href="#L866">866</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L867">
    <div class="line-number"><a href="#L867">867</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Add a test result to the collection</div>
  </div>
  <div class="line not-executable" id="L868">
    <div class="line-number"><a href="#L868">868</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function adds a structured test result to the internal results collection</div>
  </div>
  <div class="line not-executable" id="L869">
    <div class="line-number"><a href="#L869">869</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and updates the test counters. It's primarily used internally by the test system</div>
  </div>
  <div class="line not-executable" id="L870">
    <div class="line-number"><a href="#L870">870</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- but can also be used by test reporters or extensions to record custom test results.</div>
  </div>
  <div class="line not-executable" id="L871">
    <div class="line-number"><a href="#L871">871</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L872">
    <div class="line-number"><a href="#L872">872</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param result TestResult The test result object to add</div>
  </div>
  <div class="line not-executable" id="L873">
    <div class="line-number"><a href="#L873">873</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return TestResult|nil The added test result or nil if invalid</div>
  </div>
  <div class="line not-executable" id="L874">
    <div class="line-number"><a href="#L874">874</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L875">
    <div class="line-number"><a href="#L875">875</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@usage</div>
  </div>
  <div class="line not-executable" id="L876">
    <div class="line-number"><a href="#L876">876</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Custom test reporter</div>
  </div>
  <div class="line not-executable" id="L877">
    <div class="line-number"><a href="#L877">877</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local function my_reporter(results)</div>
  </div>
  <div class="line not-executable" id="L878">
    <div class="line-number"><a href="#L878">878</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   for _, result in ipairs(results) do</div>
  </div>
  <div class="line not-executable" id="L879">
    <div class="line-number"><a href="#L879">879</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     if result.status == &quot;pass&quot; then</div>
  </div>
  <div class="line not-executable" id="L880">
    <div class="line-number"><a href="#L880">880</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       print(string.format(&quot;✓ %s (%.3fs)&quot;, result.name, result.execution_time or 0))</div>
  </div>
  <div class="line not-executable" id="L881">
    <div class="line-number"><a href="#L881">881</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     elseif result.status == &quot;fail&quot; then</div>
  </div>
  <div class="line not-executable" id="L882">
    <div class="line-number"><a href="#L882">882</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       print(string.format(&quot;✗ %s\n  %s&quot;, result.name, result.error_message or &quot;Unknown error&quot;))</div>
  </div>
  <div class="line not-executable" id="L883">
    <div class="line-number"><a href="#L883">883</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     else</div>
  </div>
  <div class="line not-executable" id="L884">
    <div class="line-number"><a href="#L884">884</a></div>
    <div class="execution-count"></div>    <div class="line-content">---       print(string.format(&quot;- %s (%s)&quot;, result.name, result.status))</div>
  </div>
  <div class="line not-executable" id="L885">
    <div class="line-number"><a href="#L885">885</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     end</div>
  </div>
  <div class="line not-executable" id="L886">
    <div class="line-number"><a href="#L886">886</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end</div>
  </div>
  <div class="line not-executable" id="L887">
    <div class="line-number"><a href="#L887">887</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L888">
    <div class="line-number"><a href="#L888">888</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L889">
    <div class="line-number"><a href="#L889">889</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- For custom test systems or extensions</div>
  </div>
  <div class="line not-executable" id="L890">
    <div class="line-number"><a href="#L890">890</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local result = firmo.add_test_result({</div>
  </div>
  <div class="line not-executable" id="L891">
    <div class="line-number"><a href="#L891">891</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   status = &quot;pass&quot;,</div>
  </div>
  <div class="line not-executable" id="L892">
    <div class="line-number"><a href="#L892">892</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   name = &quot;External test&quot;,</div>
  </div>
  <div class="line not-executable" id="L893">
    <div class="line-number"><a href="#L893">893</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   path = {&quot;External&quot;, &quot;Integration&quot;, &quot;API Test&quot;},</div>
  </div>
  <div class="line not-executable" id="L894">
    <div class="line-number"><a href="#L894">894</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   path_string = &quot;External / Integration / API Test&quot;,</div>
  </div>
  <div class="line not-executable" id="L895">
    <div class="line-number"><a href="#L895">895</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   execution_time = 0.125,</div>
  </div>
  <div class="line not-executable" id="L896">
    <div class="line-number"><a href="#L896">896</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   timestamp = os.time()</div>
  </div>
  <div class="line not-executable" id="L897">
    <div class="line-number"><a href="#L897">897</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L898">
    <div class="line-number"><a href="#L898">898</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.add_test_result(result)</div>
  </div>
  <div class="line not-covered" id="L899">
    <div class="line-number"><a href="#L899">899</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not result or type(result) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L900">
    <div class="line-number"><a href="#L900">900</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L901">
    <div class="line-number"><a href="#L901">901</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L902">
    <div class="line-number"><a href="#L902">902</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L903">
    <div class="line-number"><a href="#L903">903</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Ensure required fields</div>
  </div>
  <div class="line not-covered" id="L904">
    <div class="line-number"><a href="#L904">904</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  result.status = result.status or TEST_STATUS.FAIL</div>
  </div>
  <div class="line not-covered" id="L905">
    <div class="line-number"><a href="#L905">905</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  result.name = result.name or &quot;unknown test&quot;</div>
  </div>
  <div class="line not-covered" id="L906">
    <div class="line-number"><a href="#L906">906</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  result.timestamp = result.timestamp or os.time()</div>
  </div>
  <div class="line not-executable" id="L907">
    <div class="line-number"><a href="#L907">907</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L908">
    <div class="line-number"><a href="#L908">908</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add result to collection</div>
  </div>
  <div class="line not-covered" id="L909">
    <div class="line-number"><a href="#L909">909</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(test_results, result)</div>
  </div>
  <div class="line not-executable" id="L910">
    <div class="line-number"><a href="#L910">910</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L911">
    <div class="line-number"><a href="#L911">911</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Print debug output if enabled</div>
  </div>
  <div class="line not-covered" id="L912">
    <div class="line-number"><a href="#L912">912</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if debug_mode then</div>
  </div>
  <div class="line not-covered" id="L913">
    <div class="line-number"><a href="#L913">913</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local status_color = &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L914">
    <div class="line-number"><a href="#L914">914</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if result.status == TEST_STATUS.PASS then</div>
  </div>
  <div class="line not-covered" id="L915">
    <div class="line-number"><a href="#L915">915</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      status_color = &quot;\27[32m&quot; -- green</div>
  </div>
  <div class="line not-covered" id="L916">
    <div class="line-number"><a href="#L916">916</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif result.status == TEST_STATUS.FAIL then</div>
  </div>
  <div class="line not-covered" id="L917">
    <div class="line-number"><a href="#L917">917</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      status_color = &quot;\27[31m&quot; -- red</div>
  </div>
  <div class="line not-covered" id="L918">
    <div class="line-number"><a href="#L918">918</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L919">
    <div class="line-number"><a href="#L919">919</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      status_color = &quot;\27[33m&quot; -- yellow</div>
  </div>
  <div class="line not-covered" id="L920">
    <div class="line-number"><a href="#L920">920</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L921">
    <div class="line-number"><a href="#L921">921</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-covered" id="L922">
    <div class="line-number"><a href="#L922">922</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    print(string.format(&quot;ADD RESULT: %s[%s]\27[0m %s (%s) %s&quot;, </div>
  </div>
  <div class="line not-covered" id="L923">
    <div class="line-number"><a href="#L923">923</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      status_color,</div>
  </div>
  <div class="line not-covered" id="L924">
    <div class="line-number"><a href="#L924">924</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      result.status:upper(),</div>
  </div>
  <div class="line not-covered" id="L925">
    <div class="line-number"><a href="#L925">925</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      result.name,</div>
  </div>
  <div class="line not-covered" id="L926">
    <div class="line-number"><a href="#L926">926</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      result.path_string or &quot;&quot;,</div>
  </div>
  <div class="line not-covered" id="L927">
    <div class="line-number"><a href="#L927">927</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      result.expect_error and &quot;[expects error]&quot; or &quot;&quot;))</div>
  </div>
  <div class="line not-covered" id="L928">
    <div class="line-number"><a href="#L928">928</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L929">
    <div class="line-number"><a href="#L929">929</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L930">
    <div class="line-number"><a href="#L930">930</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update counters based on status</div>
  </div>
  <div class="line not-covered" id="L931">
    <div class="line-number"><a href="#L931">931</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if result.status == TEST_STATUS.PASS then</div>
  </div>
  <div class="line not-covered" id="L932">
    <div class="line-number"><a href="#L932">932</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    passes = passes + 1</div>
  </div>
  <div class="line not-covered" id="L933">
    <div class="line-number"><a href="#L933">933</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif result.status == TEST_STATUS.FAIL then</div>
  </div>
  <div class="line not-covered" id="L934">
    <div class="line-number"><a href="#L934">934</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    errors = errors + 1</div>
  </div>
  <div class="line not-covered" id="L935">
    <div class="line-number"><a href="#L935">935</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif result.status == TEST_STATUS.SKIP or result.status == TEST_STATUS.PENDING then</div>
  </div>
  <div class="line not-covered" id="L936">
    <div class="line-number"><a href="#L936">936</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    skipped = skipped + 1</div>
  </div>
  <div class="line not-covered" id="L937">
    <div class="line-number"><a href="#L937">937</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L938">
    <div class="line-number"><a href="#L938">938</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L939">
    <div class="line-number"><a href="#L939">939</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return result</div>
  </div>
  <div class="line not-covered" id="L940">
    <div class="line-number"><a href="#L940">940</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L941">
    <div class="line-number"><a href="#L941">941</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Initialize and return the module</div>
  </div>
  <div class="line not-covered" id="L942">
    <div class="line-number"><a href="#L942">942</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return M</div>
  </div>
</div>
<div class="source-code" id="file---lib-tools-logging-lua">
  <h3>./lib/tools/logging.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">282 / 859 (32%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 32%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">12 / 12 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 1872      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 859      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 12      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 12      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-tools-logging-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-tools-logging-lua" value="all" checked>
        All <span class="function-count">12</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-tools-logging-lua" value="executed">
        Executed <span class="function-count badge-success">12</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-tools-logging-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-tools-logging-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-tools-logging-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-tools-logging-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-tools-logging-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">0</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-tools-logging-lua" value="closure">
        Closure <span class="function-count function-type-closure">12</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-tools-logging-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>get_fs <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L88">88-93</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>10</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>get_timestamp <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L226">226-228</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>10</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>is_enabled <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L234">234-316</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>30</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>format_log <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L324">324-373</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>10</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>json_encode_value <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L463">463-541</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>31</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>format_json <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L555">555-584</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>10</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>log <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L763">763-896</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>30</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>get_logger <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L1044">1044-1159</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>debug <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L1083">1083-1085</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>trace <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L1091">1091-1093</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>20</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>info <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L1228">1228-1230</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>3</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>debug <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L1246">1246-1248</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>6</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for logging.lua    const tableId = 'functions---lib-tools-logging-lua';
    const searchId = 'func-search---lib-tools-logging-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-tools-logging-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-tools-logging-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-tools-logging-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-tools-logging-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">--[[</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">    Centralized Logging System for the Firmo Framework</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">    This module provides a comprehensive, structured logging system with support</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">    for multiple output formats, log levels, and context-enriched messages. It</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">    integrates with the central configuration system and supports both global</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">    and per-module logging configuration.</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count"></div>    <div class="line-content">    Features:</div>
  </div>
  <div class="line not-executable" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Named logger instances with independent configuration</div>
  </div>
  <div class="line not-executable" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Hierarchical log levels (DEBUG, INFO, WARN, ERROR, FATAL)</div>
  </div>
  <div class="line not-executable" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Structured logging with context objects</div>
  </div>
  <div class="line not-executable" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Configurable output formats and destinations</div>
  </div>
  <div class="line not-executable" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Color-coded console output</div>
  </div>
  <div class="line not-executable" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - File logging with rotation</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Log search and filtering capabilities</div>
  </div>
  <div class="line not-executable" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Integration with external logging systems</div>
  </div>
  <div class="line not-executable" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Context inheritance and enrichment</div>
  </div>
  <div class="line not-executable" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Source location tracking</div>
  </div>
  <div class="line not-executable" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Performance-optimized logging</div>
  </div>
  <div class="line not-executable" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Test-aware log suppression</div>
  </div>
  <div class="line not-executable" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count"></div>    <div class="line-content">    The logging system serves as a foundation for debugging, monitoring, and</div>
  </div>
  <div class="line not-executable" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count"></div>    <div class="line-content">    diagnostics throughout the framework, providing consistent log formatting</div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">    and centralized control over verbosity.</div>
  </div>
  <div class="line not-executable" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @module logging</div>
  </div>
  <div class="line not-executable" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @author Firmo Team</div>
  </div>
  <div class="line not-executable" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @license MIT</div>
  </div>
  <div class="line not-executable" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @copyright 2023-2025</div>
  </div>
  <div class="line not-executable" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @version 1.0.0</div>
  </div>
  <div class="line not-executable" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count"></div>    <div class="line-content">]]</div>
  </div>
  <div class="line not-executable" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class logging</div>
  </div>
  <div class="line not-executable" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field _VERSION string Module version</div>
  </div>
  <div class="line not-executable" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field DEBUG number Debug log level (most verbose)</div>
  </div>
  <div class="line not-executable" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field INFO number Info log level</div>
  </div>
  <div class="line not-executable" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field WARN number Warning log level</div>
  </div>
  <div class="line not-executable" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field ERROR number Error log level (least verbose)</div>
  </div>
  <div class="line not-executable" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_logger fun(name: string): logger_instance Create a named logger instance</div>
  </div>
  <div class="line not-executable" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field configure fun(options: {level?: number|string, file?: string, format?: string, console?: boolean, max_file_size?: number, include_source?: boolean, include_timestamp?: boolean, include_level?: boolean, include_colors?: boolean, colors?: table&lt;string, string&gt;}): logging Configure the logging system</div>
  </div>
  <div class="line not-executable" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field configure_from_config fun(config_key: string): logging Configure logging from central config</div>
  </div>
  <div class="line not-executable" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field set_level fun(level: number|string): logging Set global log level</div>
  </div>
  <div class="line not-executable" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field reset fun(): logging Reset logging to defaults</div>
  </div>
  <div class="line not-executable" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field disable fun(): logging Disable all logging</div>
  </div>
  <div class="line not-executable" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field enable fun(): logging Re-enable logging</div>
  </div>
  <div class="line not-executable" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_enabled fun(): boolean Check if logging is enabled</div>
  </div>
  <div class="line not-executable" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_level fun(): number Get current log level</div>
  </div>
  <div class="line not-executable" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_current_config fun(): table Get current logging configuration</div>
  </div>
  <div class="line not-executable" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field formats table&lt;string, string&gt; Built-in formatting patterns</div>
  </div>
  <div class="line not-executable" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field register_formatter fun(name: string, formatter: fun(log_entry: table): string): boolean Register a custom formatter</div>
  </div>
  <div class="line not-executable" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field log fun(level: number, message: string, context?: table, source?: string): boolean Log a message with level</div>
  </div>
  <div class="line not-executable" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field debug fun(message: string, context?: table, source?: string): boolean Log a debug message</div>
  </div>
  <div class="line not-executable" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field info fun(message: string, context?: table, source?: string): boolean Log an info message</div>
  </div>
  <div class="line not-executable" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field warn fun(message: string, context?: table, source?: string): boolean Log a warning message</div>
  </div>
  <div class="line not-executable" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field error fun(message: string, context?: table, source?: string): boolean Log an error message</div>
  </div>
  <div class="line not-executable" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field search_logs fun(pattern: string, options?: table): table Search logs for a pattern</div>
  </div>
  <div class="line not-executable" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field flush fun(): boolean Flush pending log messages</div>
  </div>
  <div class="line not-executable" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class logger_instance</div>
  </div>
  <div class="line not-executable" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field debug fun(message: string, context?: table): boolean Log a debug message</div>
  </div>
  <div class="line not-executable" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field info fun(message: string, context?: table): boolean Log an info message</div>
  </div>
  <div class="line not-executable" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field warn fun(message: string, context?: table): boolean Log a warning message</div>
  </div>
  <div class="line not-executable" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field error fun(message: string, context?: table): boolean Log an error message</div>
  </div>
  <div class="line not-executable" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_debug_enabled fun(): boolean Check if debug logging is enabled</div>
  </div>
  <div class="line not-executable" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_info_enabled fun(): boolean Check if info logging is enabled</div>
  </div>
  <div class="line not-executable" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_warn_enabled fun(): boolean Check if warning logging is enabled</div>
  </div>
  <div class="line not-executable" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field is_error_enabled fun(): boolean Check if error logging is enabled</div>
  </div>
  <div class="line not-executable" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field set_level fun(level: number|string): logger_instance Set log level for this logger instance</div>
  </div>
  <div class="line not-executable" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_level fun(): number Get log level for this logger instance</div>
  </div>
  <div class="line not-executable" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_name fun(): string Get logger name</div>
  </div>
  <div class="line not-executable" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field configure fun(options: table): logger_instance Configure this logger instance</div>
  </div>
  <div class="line not-executable" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field log fun(level: number, message: string, context?: table): boolean Log a message with level</div>
  </div>
  <div class="line not-executable" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field with_context fun(context: table): logger_instance Create a logger with predefined context</div>
  </div>
  <div class="line not-covered" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local M = {}</div>
  </div>
  <div class="line not-executable" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Try to import filesystem module (might not be available during first load)</div>
  </div>
  <div class="line not-covered" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local fs</div>
  </div>
  <div class="line not-executable" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the filesystem module using lazy loading</div>
  </div>
  <div class="line not-executable" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function implements lazy loading for the filesystem module,</div>
  </div>
  <div class="line not-executable" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- which is needed for all file operations like writing logs, creating</div>
  </div>
  <div class="line not-executable" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- directories, and rotating log files. Lazy loading helps avoid circular</div>
  </div>
  <div class="line not-executable" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- dependencies and improves module initialization time.</div>
  </div>
  <div class="line not-executable" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The filesystem module</div>
  </div>
  <div class="line not-covered" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_fs()</div>
  </div>
  <div class="line not-covered" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not fs then</div>
  </div>
  <div class="line not-covered" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    fs = require(&quot;lib.tools.filesystem&quot;)</div>
  </div>
  <div class="line not-covered" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return fs</div>
  </div>
  <div class="line covered" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count">10</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Load optional components (lazy loading to avoid circular dependencies)</div>
  </div>
  <div class="line covered" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local search_module, export_module, formatter_integration_module</div>
  </div>
  <div class="line not-executable" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the search module for log searching functionality using lazy loading</div>
  </div>
  <div class="line not-executable" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function lazily loads the log search module, which provides</div>
  </div>
  <div class="line not-executable" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- functionality for searching through log files based on patterns, levels,</div>
  </div>
  <div class="line not-executable" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and time ranges. It's loaded on-demand to avoid circular dependencies.</div>
  </div>
  <div class="line not-executable" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil The search module or nil if not available</div>
  </div>
  <div class="line not-covered" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_search()</div>
  </div>
  <div class="line not-covered" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not search_module then</div>
  </div>
  <div class="line not-covered" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, module = pcall(require, &quot;lib.tools.logging.search&quot;)</div>
  </div>
  <div class="line not-covered" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      search_module = module</div>
  </div>
  <div class="line not-covered" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return search_module</div>
  </div>
  <div class="line not-covered" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the export module for log exporting functionality using lazy loading</div>
  </div>
  <div class="line not-executable" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function lazily loads the log export module, which provides</div>
  </div>
  <div class="line not-executable" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- functionality for exporting logs to different formats (CSV, JSON, etc.)</div>
  </div>
  <div class="line not-executable" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for integration with external systems. It's loaded on-demand to avoid</div>
  </div>
  <div class="line not-executable" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- circular dependencies.</div>
  </div>
  <div class="line not-executable" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil The export module or nil if not available</div>
  </div>
  <div class="line not-covered" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_export()</div>
  </div>
  <div class="line not-covered" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not export_module then</div>
  </div>
  <div class="line not-covered" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, module = pcall(require, &quot;lib.tools.logging.export&quot;)</div>
  </div>
  <div class="line not-covered" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      export_module = module</div>
  </div>
  <div class="line not-covered" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return export_module</div>
  </div>
  <div class="line not-covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the formatter integration module for custom log formatting using lazy loading</div>
  </div>
  <div class="line not-executable" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function lazily loads the formatter integration module, which</div>
  </div>
  <div class="line not-executable" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- provides functionality for registering and using custom log formatters.</div>
  </div>
  <div class="line not-executable" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It's loaded on-demand to avoid circular dependencies during module initialization.</div>
  </div>
  <div class="line not-executable" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil The formatter integration module or nil if not available</div>
  </div>
  <div class="line not-covered" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_formatter_integration()</div>
  </div>
  <div class="line not-covered" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not formatter_integration_module then</div>
  </div>
  <div class="line not-covered" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, module = pcall(require, &quot;lib.tools.logging.formatter_integration&quot;)</div>
  </div>
  <div class="line not-covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      formatter_integration_module = module</div>
  </div>
  <div class="line not-covered" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return formatter_integration_module</div>
  </div>
  <div class="line not-covered" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Log levels</div>
  </div>
  <div class="line not-covered" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.LEVELS = {</div>
  </div>
  <div class="line not-covered" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  FATAL = 0,</div>
  </div>
  <div class="line not-covered" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  ERROR = 1,</div>
  </div>
  <div class="line not-covered" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  WARN = 2,</div>
  </div>
  <div class="line not-covered" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  INFO = 3,</div>
  </div>
  <div class="line not-covered" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  DEBUG = 4,</div>
  </div>
  <div class="line not-covered" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  TRACE = 5,</div>
  </div>
  <div class="line not-covered" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  VERBOSE = 5  -- for backward compatibility</div>
  </div>
  <div class="line not-covered" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Default configuration</div>
  </div>
  <div class="line not-covered" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local config = {</div>
  </div>
  <div class="line not-covered" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  global_level = M.LEVELS.INFO,  -- Default global level</div>
  </div>
  <div class="line not-covered" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  module_levels = {},            -- Per-module log levels</div>
  </div>
  <div class="line not-covered" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  timestamps = true,             -- Enable/disable timestamps</div>
  </div>
  <div class="line not-covered" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  use_colors = true,             -- Enable/disable colors</div>
  </div>
  <div class="line not-covered" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  output_file = nil,             -- Log to file (nil = console only)</div>
  </div>
  <div class="line not-covered" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log_dir = &quot;logs&quot;,              -- Directory to store log files</div>
  </div>
  <div class="line not-covered" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  silent = false,                -- Suppress all output when true</div>
  </div>
  <div class="line not-covered" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  max_file_size = 50 * 1024,     -- 50KB default size limit per log file (small for testing)</div>
  </div>
  <div class="line not-covered" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  max_log_files = 5,             -- Number of rotated log files to keep</div>
  </div>
  <div class="line not-covered" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  date_pattern = &quot;%Y-%m-%d&quot;,     -- Date pattern for log filenames</div>
  </div>
  <div class="line not-covered" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  format = &quot;text&quot;,               -- Default log format: &quot;text&quot; or &quot;json&quot;</div>
  </div>
  <div class="line not-covered" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  json_file = nil,               -- Separate JSON structured log file</div>
  </div>
  <div class="line not-covered" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  module_filter = nil,           -- Filter logs to specific modules (nil = all)</div>
  </div>
  <div class="line not-covered" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  module_blacklist = {},         -- List of modules to exclude from logging</div>
  </div>
  <div class="line not-covered" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  buffer_size = 0,               -- Buffer size (0 = no buffering)</div>
  </div>
  <div class="line not-covered" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  buffer_flush_interval = 5,     -- Seconds between auto-flush (if buffering)</div>
  </div>
  <div class="line not-covered" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  standard_metadata = {},        -- Standard metadata fields to include in all logs</div>
  </div>
  <div class="line not-covered" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- ANSI color codes</div>
  </div>
  <div class="line not-covered" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local COLORS = {</div>
  </div>
  <div class="line not-covered" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  RESET = &quot;\27[0m&quot;,</div>
  </div>
  <div class="line not-covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  RED = &quot;\27[31m&quot;,</div>
  </div>
  <div class="line not-covered" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  BRIGHT_RED = &quot;\27[91m&quot;,  </div>
  </div>
  <div class="line not-covered" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  GREEN = &quot;\27[32m&quot;,</div>
  </div>
  <div class="line not-covered" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  YELLOW = &quot;\27[33m&quot;,</div>
  </div>
  <div class="line not-covered" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  BLUE = &quot;\27[34m&quot;,</div>
  </div>
  <div class="line not-covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  MAGENTA = &quot;\27[35m&quot;,</div>
  </div>
  <div class="line not-covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  CYAN = &quot;\27[36m&quot;,</div>
  </div>
  <div class="line not-covered" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  WHITE = &quot;\27[37m&quot;,</div>
  </div>
  <div class="line not-covered" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Color mapping for log levels</div>
  </div>
  <div class="line not-covered" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local LEVEL_COLORS = {</div>
  </div>
  <div class="line not-covered" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.FATAL] = COLORS.BRIGHT_RED,</div>
  </div>
  <div class="line not-covered" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.ERROR] = COLORS.RED,</div>
  </div>
  <div class="line not-covered" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.WARN] = COLORS.YELLOW,</div>
  </div>
  <div class="line not-covered" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.INFO] = COLORS.BLUE,</div>
  </div>
  <div class="line not-covered" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.DEBUG] = COLORS.CYAN,</div>
  </div>
  <div class="line not-covered" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.TRACE] = COLORS.MAGENTA,</div>
  </div>
  <div class="line not-covered" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.VERBOSE] = COLORS.MAGENTA, -- For backward compatibility</div>
  </div>
  <div class="line not-covered" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Level names for display</div>
  </div>
  <div class="line not-covered" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local LEVEL_NAMES = {</div>
  </div>
  <div class="line not-covered" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.FATAL] = &quot;FATAL&quot;,</div>
  </div>
  <div class="line not-covered" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.ERROR] = &quot;ERROR&quot;,</div>
  </div>
  <div class="line not-covered" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.WARN] = &quot;WARN&quot;,</div>
  </div>
  <div class="line not-covered" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.INFO] = &quot;INFO&quot;,</div>
  </div>
  <div class="line not-covered" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.DEBUG] = &quot;DEBUG&quot;,</div>
  </div>
  <div class="line not-covered" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.TRACE] = &quot;TRACE&quot;,</div>
  </div>
  <div class="line not-covered" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  [M.LEVELS.VERBOSE] = &quot;VERBOSE&quot;, -- For backward compatibility</div>
  </div>
  <div class="line not-covered" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Message buffer</div>
  </div>
  <div class="line not-covered" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local buffer = {</div>
  </div>
  <div class="line not-covered" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  entries = {},</div>
  </div>
  <div class="line not-covered" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  count = 0,</div>
  </div>
  <div class="line not-covered" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  last_flush_time = os.time(),</div>
  </div>
  <div class="line not-covered" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get current timestamp formatted for logs</div>
  </div>
  <div class="line not-executable" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string The formatted timestamp</div>
  </div>
  <div class="line not-covered" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_timestamp()</div>
  </div>
  <div class="line not-covered" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return os.date(&quot;%Y-%m-%d %H:%M:%S&quot;)</div>
  </div>
  <div class="line not-covered" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if logging is enabled for a specific level and module</div>
  </div>
  <div class="line not-executable" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param level number The log level to check</div>
  </div>
  <div class="line not-executable" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param module_name? string The module name to check</div>
  </div>
  <div class="line not-executable" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean Whether logging is enabled for this level and module</div>
  </div>
  <div class="line not-covered" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function is_enabled(level, module_name)</div>
  </div>
  <div class="line not-covered" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.silent then</div>
  </div>
  <div class="line not-covered" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Ensure level is a number</div>
  </div>
  <div class="line not-covered" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(level) ~= &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check module filter/blacklist</div>
  </div>
  <div class="line not-covered" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if module_name then</div>
  </div>
  <div class="line not-executable" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Skip if module is blacklisted</div>
  </div>
  <div class="line not-covered" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, blacklisted in ipairs(config.module_blacklist) do</div>
  </div>
  <div class="line not-covered" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if module_name == blacklisted then</div>
  </div>
  <div class="line not-covered" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return false</div>
  </div>
  <div class="line covered" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Support wildcard patterns at the end</div>
  </div>
  <div class="line covered" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if type(blacklisted) == &quot;string&quot; and blacklisted:match(&quot;%*$&quot;) then</div>
  </div>
  <div class="line covered" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        local prefix = blacklisted:gsub(&quot;%*$&quot;, &quot;&quot;)</div>
  </div>
  <div class="line covered" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if module_name:sub(1, #prefix) == prefix then</div>
  </div>
  <div class="line covered" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count">30</div>    <div class="line-content">          return false</div>
  </div>
  <div class="line covered" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If a module filter is specified, only allow matching modules</div>
  </div>
  <div class="line covered" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if config.module_filter then</div>
  </div>
  <div class="line covered" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count">22</div>    <div class="line-content">      local match = false</div>
  </div>
  <div class="line not-executable" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Handle array of filters</div>
  </div>
  <div class="line covered" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if type(config.module_filter) == &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        for _, filter in ipairs(config.module_filter) do</div>
  </div>
  <div class="line not-executable" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Support exact matches</div>
  </div>
  <div class="line covered" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          if module_name == filter then</div>
  </div>
  <div class="line covered" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            match = true</div>
  </div>
  <div class="line covered" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            break</div>
  </div>
  <div class="line covered" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line not-executable" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count"></div>    <div class="line-content">          </div>
  </div>
  <div class="line not-executable" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count"></div>    <div class="line-content">          -- Support wildcard patterns at the end</div>
  </div>
  <div class="line covered" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count">22</div>    <div class="line-content">          if type(filter) == &quot;string&quot; and filter:match(&quot;%*$&quot;) then</div>
  </div>
  <div class="line covered" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            local prefix = filter:gsub(&quot;%*$&quot;, &quot;&quot;)</div>
  </div>
  <div class="line covered" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            if module_name:sub(1, #prefix) == prefix then</div>
  </div>
  <div class="line covered" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count">22</div>    <div class="line-content">              match = true</div>
  </div>
  <div class="line covered" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count">1</div>    <div class="line-content">              break</div>
  </div>
  <div class="line covered" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            end</div>
  </div>
  <div class="line covered" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line covered" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Handle string filter (single module or pattern)</div>
  </div>
  <div class="line covered" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      elseif type(config.module_filter) == &quot;string&quot; then</div>
  </div>
  <div class="line not-executable" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Support exact match</div>
  </div>
  <div class="line covered" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if module_name == config.module_filter then</div>
  </div>
  <div class="line covered" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          match = true</div>
  </div>
  <div class="line covered" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line not-executable" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Support wildcard pattern at the end</div>
  </div>
  <div class="line covered" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if config.module_filter:match(&quot;%*$&quot;) then</div>
  </div>
  <div class="line covered" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          local prefix = config.module_filter:gsub(&quot;%*$&quot;, &quot;&quot;)</div>
  </div>
  <div class="line covered" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          if module_name:sub(1, #prefix) == prefix then</div>
  </div>
  <div class="line covered" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count">1</div>    <div class="line-content">            match = true</div>
  </div>
  <div class="line covered" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          end</div>
  </div>
  <div class="line covered" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line covered" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if not match then</div>
  </div>
  <div class="line covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        return false</div>
  </div>
  <div class="line covered" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check module-specific level</div>
  </div>
  <div class="line covered" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if module_name and config.module_levels[module_name] then</div>
  </div>
  <div class="line covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local module_level = config.module_levels[module_name]</div>
  </div>
  <div class="line not-executable" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Ensure module_level is a number</div>
  </div>
  <div class="line covered" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if type(module_level) == &quot;number&quot; then</div>
  </div>
  <div class="line covered" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return level &lt;= module_level</div>
  </div>
  <div class="line covered" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Fall back to global level</div>
  </div>
  <div class="line covered" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return level &lt;= config.global_level</div>
  </div>
  <div class="line covered" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Format a log message for text output</div>
  </div>
  <div class="line not-executable" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param level number The log level</div>
  </div>
  <div class="line not-executable" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param module_name? string The module name</div>
  </div>
  <div class="line not-executable" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The log message</div>
  </div>
  <div class="line not-executable" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param params? table Additional parameters to include in the log</div>
  </div>
  <div class="line not-executable" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string The formatted log message</div>
  </div>
  <div class="line covered" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local function format_log(level, module_name, message, params)</div>
  </div>
  <div class="line covered" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local parts = {}</div>
  </div>
  <div class="line not-executable" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add timestamp if enabled</div>
  </div>
  <div class="line covered" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if config.timestamps then</div>
  </div>
  <div class="line covered" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    table.insert(parts, get_timestamp())</div>
  </div>
  <div class="line covered" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add level with color if enabled</div>
  </div>
  <div class="line covered" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local level_str = LEVEL_NAMES[level] or &quot;UNKNOWN&quot;</div>
  </div>
  <div class="line not-covered" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.use_colors then</div>
  </div>
  <div class="line not-covered" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    level_str = (LEVEL_COLORS[level] or &quot;&quot;) .. level_str .. COLORS.RESET</div>
  </div>
  <div class="line not-covered" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(parts, level_str)</div>
  </div>
  <div class="line not-executable" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add module name if provided</div>
  </div>
  <div class="line not-covered" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if module_name then</div>
  </div>
  <div class="line covered" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if config.use_colors then</div>
  </div>
  <div class="line covered" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count">10</div>    <div class="line-content">      table.insert(parts, COLORS.GREEN .. module_name .. COLORS.RESET)</div>
  </div>
  <div class="line covered" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    else</div>
  </div>
  <div class="line covered" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      table.insert(parts, module_name)</div>
  </div>
  <div class="line covered" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add the message</div>
  </div>
  <div class="line covered" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  table.insert(parts, message or &quot;&quot;)</div>
  </div>
  <div class="line not-executable" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add parameters as a formatted string if provided</div>
  </div>
  <div class="line covered" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  if params and type(params) == &quot;table&quot; and next(params) ~= nil then</div>
  </div>
  <div class="line covered" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local param_parts = {}</div>
  </div>
  <div class="line covered" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    for k, v in pairs(params) do</div>
  </div>
  <div class="line covered" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local val_str</div>
  </div>
  <div class="line covered" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if type(v) == &quot;table&quot; then</div>
  </div>
  <div class="line covered" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count">10</div>    <div class="line-content">        val_str = &quot;{...}&quot;  -- Simplify table display in text format</div>
  </div>
  <div class="line covered" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count">2</div>    <div class="line-content">      else</div>
  </div>
  <div class="line covered" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count">2</div>    <div class="line-content">        val_str = tostring(v)</div>
  </div>
  <div class="line covered" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      table.insert(param_parts, k .. &quot;=&quot; .. val_str)</div>
  </div>
  <div class="line covered" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local param_str = table.concat(param_parts, &quot;, &quot;)</div>
  </div>
  <div class="line covered" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if config.use_colors then</div>
  </div>
  <div class="line covered" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count">10</div>    <div class="line-content">      param_str = COLORS.CYAN .. param_str .. COLORS.RESET</div>
  </div>
  <div class="line covered" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    table.insert(parts, &quot;(&quot; .. param_str .. &quot;)&quot;)</div>
  </div>
  <div class="line covered" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Join all parts with separators</div>
  </div>
  <div class="line covered" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count">31</div>    <div class="line-content">  return table.concat(parts, &quot; | &quot;)</div>
  </div>
  <div class="line covered" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count">31</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Ensure the log directory exists before writing log files</div>
  </div>
  <div class="line not-executable" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function checks if the configured log directory exists</div>
  </div>
  <div class="line not-executable" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and creates it if necessary. It handles any errors that might occur</div>
  </div>
  <div class="line not-executable" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- during directory creation by printing a warning to the console.</div>
  </div>
  <div class="line not-executable" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the directory exists or was successfully created</div>
  </div>
  <div class="line covered" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count">7</div>    <div class="line-content">local function ensure_log_dir()</div>
  </div>
  <div class="line covered" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count">7</div>    <div class="line-content">  local fs = get_fs()</div>
  </div>
  <div class="line covered" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count">7</div>    <div class="line-content">  if config.log_dir then</div>
  </div>
  <div class="line covered" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local success, err = fs.ensure_directory_exists(config.log_dir)</div>
  </div>
  <div class="line covered" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count">7</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line covered" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      print(&quot;Warning: Failed to create log directory: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line covered" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line covered" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true -- No directory configured means no need to create</div>
  </div>
  <div class="line not-covered" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the full path to the log file, considering absolute and relative paths</div>
  </div>
  <div class="line not-executable" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function resolves the configured log file path, handling both</div>
  </div>
  <div class="line not-executable" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- absolute paths and paths relative to the log directory. It ensures consistent</div>
  </div>
  <div class="line not-executable" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- path handling throughout the logging system.</div>
  </div>
  <div class="line not-executable" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil The full path to the log file or nil if not configured</div>
  </div>
  <div class="line not-covered" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_log_file_path()</div>
  </div>
  <div class="line not-covered" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not config.output_file then return nil end</div>
  </div>
  <div class="line not-executable" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If output_file is an absolute path, use it directly</div>
  </div>
  <div class="line not-covered" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.output_file:sub(1, 1) == &quot;/&quot; then</div>
  </div>
  <div class="line not-covered" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return config.output_file</div>
  </div>
  <div class="line not-covered" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Otherwise, construct path within log directory</div>
  </div>
  <div class="line not-covered" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return config.log_dir .. &quot;/&quot; .. config.output_file</div>
  </div>
  <div class="line not-covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Rotate log files when they exceed the configured maximum size</div>
  </div>
  <div class="line not-executable" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function implements log rotation, which prevents log files from</div>
  </div>
  <div class="line not-executable" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- growing too large. When a log file exceeds the configured maximum size,</div>
  </div>
  <div class="line not-executable" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- this function:</div>
  </div>
  <div class="line not-executable" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- 1. Renames existing rotated logs to make room for the new rotation</div>
  </div>
  <div class="line not-executable" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- 2. Moves the current log file to the first rotation position</div>
  </div>
  <div class="line not-executable" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- 3. Creates a new empty log file for future logging</div>
  </div>
  <div class="line not-executable" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- The rotation pattern is:</div>
  </div>
  <div class="line not-executable" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Current log: logfile.log</div>
  </div>
  <div class="line not-executable" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Previous logs: logfile.log.1, logfile.log.2, etc.</div>
  </div>
  <div class="line not-executable" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- - Oldest logs are deleted when rotation count exceeds max_log_files</div>
  </div>
  <div class="line not-executable" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether rotation was successful</div>
  </div>
  <div class="line not-covered" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function rotate_log_files()</div>
  </div>
  <div class="line not-covered" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local fs = get_fs()</div>
  </div>
  <div class="line not-covered" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local log_path = get_log_file_path()</div>
  </div>
  <div class="line not-covered" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not log_path then return false end</div>
  </div>
  <div class="line not-executable" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if we need to rotate</div>
  </div>
  <div class="line not-covered" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not fs.file_exists(log_path) then return false end</div>
  </div>
  <div class="line not-executable" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local size = fs.get_file_size(log_path)</div>
  </div>
  <div class="line not-covered" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not size or size &lt; config.max_file_size then return false end</div>
  </div>
  <div class="line not-executable" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Rotate files (move existing rotated logs)</div>
  </div>
  <div class="line not-covered" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i = config.max_log_files - 1, 1, -1 do</div>
  </div>
  <div class="line not-covered" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local old_file = log_path .. &quot;.&quot; .. i</div>
  </div>
  <div class="line not-covered" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local new_file = log_path .. &quot;.&quot; .. (i + 1)</div>
  </div>
  <div class="line not-covered" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if fs.file_exists(old_file) then</div>
  </div>
  <div class="line not-covered" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      fs.move_file(old_file, new_file)</div>
  </div>
  <div class="line not-covered" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Move current log to .1</div>
  </div>
  <div class="line not-covered" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return fs.move_file(log_path, log_path .. &quot;.1&quot;)</div>
  </div>
  <div class="line not-covered" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Encode a Lua value as a JSON string</div>
  </div>
  <div class="line not-executable" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function implements a lightweight JSON encoder that converts</div>
  </div>
  <div class="line not-executable" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Lua values (strings, numbers, booleans, tables) to their JSON representation.</div>
  </div>
  <div class="line not-executable" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- It handles special cases like NaN and Infinity, and truncates large tables</div>
  </div>
  <div class="line not-executable" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- to prevent excessive output. This function is used for structured logging</div>
  </div>
  <div class="line not-executable" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- to generate JSON-formatted log entries.</div>
  </div>
  <div class="line not-executable" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param val any The Lua value to encode as JSON</div>
  </div>
  <div class="line not-executable" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string The JSON string representation of the value</div>
  </div>
  <div class="line not-covered" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function json_encode_value(val)</div>
  </div>
  <div class="line not-covered" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local json_type = type(val)</div>
  </div>
  <div class="line not-covered" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if json_type == &quot;string&quot; then</div>
  </div>
  <div class="line not-executable" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Escape special characters in strings</div>
  </div>
  <div class="line not-covered" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return '&quot;' .. val:gsub('\\', '\\\\')</div>
  </div>
  <div class="line not-covered" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  :gsub('&quot;', '\\&quot;')</div>
  </div>
  <div class="line not-covered" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  :gsub('\n', '\\n')</div>
  </div>
  <div class="line not-covered" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  :gsub('\r', '\\r')</div>
  </div>
  <div class="line not-covered" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  :gsub('\t', '\\t')</div>
  </div>
  <div class="line not-covered" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  :gsub('\b', '\\b')</div>
  </div>
  <div class="line not-covered" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                  :gsub('\f', '\\f') .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif json_type == &quot;number&quot; then</div>
  </div>
  <div class="line not-executable" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Handle NaN and infinity which have no direct JSON representation</div>
  </div>
  <div class="line not-covered" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if val ~= val then</div>
  </div>
  <div class="line not-covered" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return '&quot;NaN&quot;'</div>
  </div>
  <div class="line not-covered" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif val == 1/0 then</div>
  </div>
  <div class="line not-covered" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return '&quot;Infinity&quot;'</div>
  </div>
  <div class="line not-covered" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif val == -1/0 then</div>
  </div>
  <div class="line not-covered" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return '&quot;-Infinity&quot;'</div>
  </div>
  <div class="line not-covered" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return tostring(val)</div>
  </div>
  <div class="line covered" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count">31</div>    <div class="line-content">  elseif json_type == &quot;boolean&quot; then</div>
  </div>
  <div class="line covered" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count">31</div>    <div class="line-content">    return tostring(val)</div>
  </div>
  <div class="line covered" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  elseif json_type == &quot;table&quot; then</div>
  </div>
  <div class="line not-executable" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Determine if table is an array or object</div>
  </div>
  <div class="line covered" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count">11</div>    <div class="line-content">    local is_array = true</div>
  </div>
  <div class="line covered" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count">11</div>    <div class="line-content">    local n = 0</div>
  </div>
  <div class="line covered" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count">11</div>    <div class="line-content">    for k, _ in pairs(val) do</div>
  </div>
  <div class="line covered" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count">11</div>    <div class="line-content">      n = n + 1</div>
  </div>
  <div class="line covered" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count">11</div>    <div class="line-content">      if type(k) ~= &quot;number&quot; or k ~= n then</div>
  </div>
  <div class="line covered" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count">11</div>    <div class="line-content">        is_array = false</div>
  </div>
  <div class="line covered" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count">21</div>    <div class="line-content">        break</div>
  </div>
  <div class="line covered" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count">21</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L478">
    <div class="line-number"><a href="#L478">478</a></div>
    <div class="execution-count">21</div>    <div class="line-content">    local result = is_array and &quot;[&quot; or &quot;{&quot;</div>
  </div>
  <div class="line covered" id="L479">
    <div class="line-number"><a href="#L479">479</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local first = true</div>
  </div>
  <div class="line not-executable" id="L480">
    <div class="line-number"><a href="#L480">480</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L481">
    <div class="line-number"><a href="#L481">481</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Avoid processing tables that are too large</div>
  </div>
  <div class="line covered" id="L482">
    <div class="line-number"><a href="#L482">482</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local count = 0</div>
  </div>
  <div class="line covered" id="L483">
    <div class="line-number"><a href="#L483">483</a></div>
    <div class="execution-count">21</div>    <div class="line-content">    local max_items = 100</div>
  </div>
  <div class="line not-executable" id="L484">
    <div class="line-number"><a href="#L484">484</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L485">
    <div class="line-number"><a href="#L485">485</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if is_array then</div>
  </div>
  <div class="line covered" id="L486">
    <div class="line-number"><a href="#L486">486</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      for _, v in ipairs(val) do</div>
  </div>
  <div class="line covered" id="L487">
    <div class="line-number"><a href="#L487">487</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        count = count + 1</div>
  </div>
  <div class="line covered" id="L488">
    <div class="line-number"><a href="#L488">488</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if count &gt; max_items then</div>
  </div>
  <div class="line covered" id="L489">
    <div class="line-number"><a href="#L489">489</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          result = result .. (first and &quot;&quot; or &quot;,&quot;) .. '&quot;...&quot;'</div>
  </div>
  <div class="line covered" id="L490">
    <div class="line-number"><a href="#L490">490</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          break</div>
  </div>
  <div class="line covered" id="L491">
    <div class="line-number"><a href="#L491">491</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L492">
    <div class="line-number"><a href="#L492">492</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line covered" id="L493">
    <div class="line-number"><a href="#L493">493</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if not first then result = result .. &quot;,&quot; end</div>
  </div>
  <div class="line covered" id="L494">
    <div class="line-number"><a href="#L494">494</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        result = result .. json_encode_value(v)</div>
  </div>
  <div class="line covered" id="L495">
    <div class="line-number"><a href="#L495">495</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        first = false</div>
  </div>
  <div class="line covered" id="L496">
    <div class="line-number"><a href="#L496">496</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L497">
    <div class="line-number"><a href="#L497">497</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      result = result .. &quot;]&quot;</div>
  </div>
  <div class="line covered" id="L498">
    <div class="line-number"><a href="#L498">498</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    else</div>
  </div>
  <div class="line covered" id="L499">
    <div class="line-number"><a href="#L499">499</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      for k, v in pairs(val) do</div>
  </div>
  <div class="line covered" id="L500">
    <div class="line-number"><a href="#L500">500</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        count = count + 1</div>
  </div>
  <div class="line covered" id="L501">
    <div class="line-number"><a href="#L501">501</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if count &gt; max_items then</div>
  </div>
  <div class="line covered" id="L502">
    <div class="line-number"><a href="#L502">502</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          result = result .. (first and &quot;&quot; or &quot;,&quot;) .. '&quot;...&quot;:&quot;...&quot;'</div>
  </div>
  <div class="line covered" id="L503">
    <div class="line-number"><a href="#L503">503</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          break</div>
  </div>
  <div class="line covered" id="L504">
    <div class="line-number"><a href="#L504">504</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line not-executable" id="L505">
    <div class="line-number"><a href="#L505">505</a></div>
    <div class="execution-count"></div>    <div class="line-content">        </div>
  </div>
  <div class="line covered" id="L506">
    <div class="line-number"><a href="#L506">506</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if not first then result = result .. &quot;,&quot; end</div>
  </div>
  <div class="line covered" id="L507">
    <div class="line-number"><a href="#L507">507</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        result = result .. '&quot;' .. tostring(k):gsub('&quot;', '\\&quot;') .. '&quot;:' .. json_encode_value(v)</div>
  </div>
  <div class="line covered" id="L508">
    <div class="line-number"><a href="#L508">508</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        first = false</div>
  </div>
  <div class="line covered" id="L509">
    <div class="line-number"><a href="#L509">509</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L510">
    <div class="line-number"><a href="#L510">510</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      result = result .. &quot;}&quot;</div>
  </div>
  <div class="line covered" id="L511">
    <div class="line-number"><a href="#L511">511</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L512">
    <div class="line-number"><a href="#L512">512</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L513">
    <div class="line-number"><a href="#L513">513</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line covered" id="L514">
    <div class="line-number"><a href="#L514">514</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  elseif json_type == &quot;nil&quot; then</div>
  </div>
  <div class="line covered" id="L515">
    <div class="line-number"><a href="#L515">515</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return &quot;null&quot;</div>
  </div>
  <div class="line covered" id="L516">
    <div class="line-number"><a href="#L516">516</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-executable" id="L517">
    <div class="line-number"><a href="#L517">517</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Function, userdata, thread, etc. can't be directly represented in JSON</div>
  </div>
  <div class="line covered" id="L518">
    <div class="line-number"><a href="#L518">518</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return '&quot;' .. tostring(val):gsub('&quot;', '\\&quot;') .. '&quot;'</div>
  </div>
  <div class="line covered" id="L519">
    <div class="line-number"><a href="#L519">519</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L520">
    <div class="line-number"><a href="#L520">520</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L521">
    <div class="line-number"><a href="#L521">521</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Format a log entry as a JSON string for structured logging</div>
  </div>
  <div class="line not-executable" id="L522">
    <div class="line-number"><a href="#L522">522</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function creates a JSON representation of a log entry, including</div>
  </div>
  <div class="line not-executable" id="L523">
    <div class="line-number"><a href="#L523">523</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- standard fields (timestamp, level, module, message) and any additional</div>
  </div>
  <div class="line not-executable" id="L524">
    <div class="line-number"><a href="#L524">524</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- context parameters. The resulting JSON string can be written to log files</div>
  </div>
  <div class="line not-executable" id="L525">
    <div class="line-number"><a href="#L525">525</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- or sent to external logging systems that consume structured logs.</div>
  </div>
  <div class="line not-executable" id="L526">
    <div class="line-number"><a href="#L526">526</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L527">
    <div class="line-number"><a href="#L527">527</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L528">
    <div class="line-number"><a href="#L528">528</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param level number The numeric log level</div>
  </div>
  <div class="line not-executable" id="L529">
    <div class="line-number"><a href="#L529">529</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name? string The module name that generated the log</div>
  </div>
  <div class="line not-executable" id="L530">
    <div class="line-number"><a href="#L530">530</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The log message text</div>
  </div>
  <div class="line not-executable" id="L531">
    <div class="line-number"><a href="#L531">531</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L532">
    <div class="line-number"><a href="#L532">532</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string The JSON string representation of the log entry</div>
  </div>
  <div class="line covered" id="L533">
    <div class="line-number"><a href="#L533">533</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local function format_json(level, module_name, message, params)</div>
  </div>
  <div class="line not-executable" id="L534">
    <div class="line-number"><a href="#L534">534</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Use ISO8601-like timestamp format for JSON logs</div>
  </div>
  <div class="line covered" id="L535">
    <div class="line-number"><a href="#L535">535</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local timestamp = os.date(&quot;%Y-%m-%dT%H:%M:%S&quot;)</div>
  </div>
  <div class="line covered" id="L536">
    <div class="line-number"><a href="#L536">536</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local level_name = LEVEL_NAMES[level] or &quot;UNKNOWN&quot;</div>
  </div>
  <div class="line not-executable" id="L537">
    <div class="line-number"><a href="#L537">537</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L538">
    <div class="line-number"><a href="#L538">538</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Start with standard fields</div>
  </div>
  <div class="line covered" id="L539">
    <div class="line-number"><a href="#L539">539</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local json_parts = {</div>
  </div>
  <div class="line covered" id="L540">
    <div class="line-number"><a href="#L540">540</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    '&quot;timestamp&quot;:&quot;' .. timestamp .. '&quot;',</div>
  </div>
  <div class="line covered" id="L541">
    <div class="line-number"><a href="#L541">541</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    '&quot;level&quot;:&quot;' .. level_name .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L542">
    <div class="line-number"><a href="#L542">542</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    '&quot;module&quot;:&quot;' .. (module_name or &quot;&quot;):gsub('&quot;', '\\&quot;') .. '&quot;',</div>
  </div>
  <div class="line not-covered" id="L543">
    <div class="line-number"><a href="#L543">543</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    '&quot;message&quot;:&quot;' .. (message or &quot;&quot;):gsub('&quot;', '\\&quot;') .. '&quot;'</div>
  </div>
  <div class="line not-covered" id="L544">
    <div class="line-number"><a href="#L544">544</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L545">
    <div class="line-number"><a href="#L545">545</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L546">
    <div class="line-number"><a href="#L546">546</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add standard metadata fields from configuration</div>
  </div>
  <div class="line not-covered" id="L547">
    <div class="line-number"><a href="#L547">547</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for key, value in pairs(config.standard_metadata) do</div>
  </div>
  <div class="line not-covered" id="L548">
    <div class="line-number"><a href="#L548">548</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(json_parts, '&quot;' .. key .. '&quot;:' .. json_encode_value(value))</div>
  </div>
  <div class="line not-covered" id="L549">
    <div class="line-number"><a href="#L549">549</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L550">
    <div class="line-number"><a href="#L550">550</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L551">
    <div class="line-number"><a href="#L551">551</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add parameters if provided</div>
  </div>
  <div class="line not-covered" id="L552">
    <div class="line-number"><a href="#L552">552</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if params and type(params) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L553">
    <div class="line-number"><a href="#L553">553</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for key, value in pairs(params) do</div>
  </div>
  <div class="line not-executable" id="L554">
    <div class="line-number"><a href="#L554">554</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Skip reserved keys to prevent overwriting standard fields</div>
  </div>
  <div class="line covered" id="L555">
    <div class="line-number"><a href="#L555">555</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if key ~= &quot;timestamp&quot; and key ~= &quot;level&quot; and key ~= &quot;module&quot; and key ~= &quot;message&quot; then</div>
  </div>
  <div class="line covered" id="L556">
    <div class="line-number"><a href="#L556">556</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        table.insert(json_parts, '&quot;' .. key .. '&quot;:' .. json_encode_value(value))</div>
  </div>
  <div class="line covered" id="L557">
    <div class="line-number"><a href="#L557">557</a></div>
    <div class="execution-count">10</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L558">
    <div class="line-number"><a href="#L558">558</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L559">
    <div class="line-number"><a href="#L559">559</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L560">
    <div class="line-number"><a href="#L560">560</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L561">
    <div class="line-number"><a href="#L561">561</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  return &quot;{&quot; .. table.concat(json_parts, &quot;,&quot;) .. &quot;}&quot;</div>
  </div>
  <div class="line covered" id="L562">
    <div class="line-number"><a href="#L562">562</a></div>
    <div class="execution-count">10</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L563">
    <div class="line-number"><a href="#L563">563</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the full path to the JSON log file</div>
  </div>
  <div class="line not-executable" id="L564">
    <div class="line-number"><a href="#L564">564</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function resolves the configured JSON log file path, handling</div>
  </div>
  <div class="line not-executable" id="L565">
    <div class="line-number"><a href="#L565">565</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- both absolute paths and paths relative to the log directory. It works</div>
  </div>
  <div class="line not-executable" id="L566">
    <div class="line-number"><a href="#L566">566</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- similarly to get_log_file_path() but for the structured JSON logs.</div>
  </div>
  <div class="line not-executable" id="L567">
    <div class="line-number"><a href="#L567">567</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L568">
    <div class="line-number"><a href="#L568">568</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L569">
    <div class="line-number"><a href="#L569">569</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return string|nil The full path to the JSON log file or nil if not configured</div>
  </div>
  <div class="line covered" id="L570">
    <div class="line-number"><a href="#L570">570</a></div>
    <div class="execution-count">1</div>    <div class="line-content">local function get_json_log_file_path()</div>
  </div>
  <div class="line covered" id="L571">
    <div class="line-number"><a href="#L571">571</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  if not config.json_file then return nil end</div>
  </div>
  <div class="line not-executable" id="L572">
    <div class="line-number"><a href="#L572">572</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L573">
    <div class="line-number"><a href="#L573">573</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If json_file is an absolute path, use it directly</div>
  </div>
  <div class="line covered" id="L574">
    <div class="line-number"><a href="#L574">574</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  if config.json_file:sub(1, 1) == &quot;/&quot; then</div>
  </div>
  <div class="line covered" id="L575">
    <div class="line-number"><a href="#L575">575</a></div>
    <div class="execution-count">38</div>    <div class="line-content">    return config.json_file</div>
  </div>
  <div class="line covered" id="L576">
    <div class="line-number"><a href="#L576">576</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L577">
    <div class="line-number"><a href="#L577">577</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L578">
    <div class="line-number"><a href="#L578">578</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Otherwise, construct path within log directory</div>
  </div>
  <div class="line covered" id="L579">
    <div class="line-number"><a href="#L579">579</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return config.log_dir .. &quot;/&quot; .. config.json_file</div>
  </div>
  <div class="line covered" id="L580">
    <div class="line-number"><a href="#L580">580</a></div>
    <div class="execution-count">7</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L581">
    <div class="line-number"><a href="#L581">581</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Rotate JSON log files when they exceed the configured maximum size</div>
  </div>
  <div class="line not-executable" id="L582">
    <div class="line-number"><a href="#L582">582</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function implements log rotation for JSON-formatted log files,</div>
  </div>
  <div class="line not-executable" id="L583">
    <div class="line-number"><a href="#L583">583</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- which prevents them from growing too large. It works similarly to </div>
  </div>
  <div class="line not-executable" id="L584">
    <div class="line-number"><a href="#L584">584</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- rotate_log_files() but specifically for structured JSON logs.</div>
  </div>
  <div class="line not-executable" id="L585">
    <div class="line-number"><a href="#L585">585</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L586">
    <div class="line-number"><a href="#L586">586</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L587">
    <div class="line-number"><a href="#L587">587</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether rotation was successful</div>
  </div>
  <div class="line not-covered" id="L588">
    <div class="line-number"><a href="#L588">588</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function rotate_json_log_files()</div>
  </div>
  <div class="line not-covered" id="L589">
    <div class="line-number"><a href="#L589">589</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local fs = get_fs()</div>
  </div>
  <div class="line not-covered" id="L590">
    <div class="line-number"><a href="#L590">590</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local log_path = get_json_log_file_path()</div>
  </div>
  <div class="line not-covered" id="L591">
    <div class="line-number"><a href="#L591">591</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not log_path then return false end</div>
  </div>
  <div class="line not-executable" id="L592">
    <div class="line-number"><a href="#L592">592</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L593">
    <div class="line-number"><a href="#L593">593</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if we need to rotate</div>
  </div>
  <div class="line not-covered" id="L594">
    <div class="line-number"><a href="#L594">594</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not fs.file_exists(log_path) then return false end</div>
  </div>
  <div class="line not-executable" id="L595">
    <div class="line-number"><a href="#L595">595</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L596">
    <div class="line-number"><a href="#L596">596</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local size = fs.get_file_size(log_path)</div>
  </div>
  <div class="line not-covered" id="L597">
    <div class="line-number"><a href="#L597">597</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not size or size &lt; config.max_file_size then return false end</div>
  </div>
  <div class="line not-executable" id="L598">
    <div class="line-number"><a href="#L598">598</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L599">
    <div class="line-number"><a href="#L599">599</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Rotate files</div>
  </div>
  <div class="line not-covered" id="L600">
    <div class="line-number"><a href="#L600">600</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for i = config.max_log_files - 1, 1, -1 do</div>
  </div>
  <div class="line not-covered" id="L601">
    <div class="line-number"><a href="#L601">601</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local old_file = log_path .. &quot;.&quot; .. i</div>
  </div>
  <div class="line not-covered" id="L602">
    <div class="line-number"><a href="#L602">602</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local new_file = log_path .. &quot;.&quot; .. (i + 1)</div>
  </div>
  <div class="line not-covered" id="L603">
    <div class="line-number"><a href="#L603">603</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if fs.file_exists(old_file) then</div>
  </div>
  <div class="line not-covered" id="L604">
    <div class="line-number"><a href="#L604">604</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      fs.move_file(old_file, new_file)</div>
  </div>
  <div class="line not-covered" id="L605">
    <div class="line-number"><a href="#L605">605</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L606">
    <div class="line-number"><a href="#L606">606</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L607">
    <div class="line-number"><a href="#L607">607</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L608">
    <div class="line-number"><a href="#L608">608</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Move current log to .1</div>
  </div>
  <div class="line not-covered" id="L609">
    <div class="line-number"><a href="#L609">609</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return fs.move_file(log_path, log_path .. &quot;.1&quot;)</div>
  </div>
  <div class="line not-covered" id="L610">
    <div class="line-number"><a href="#L610">610</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L611">
    <div class="line-number"><a href="#L611">611</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Flush buffered log messages to disk</div>
  </div>
  <div class="line not-executable" id="L612">
    <div class="line-number"><a href="#L612">612</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function writes all buffered log messages to the configured</div>
  </div>
  <div class="line not-executable" id="L613">
    <div class="line-number"><a href="#L613">613</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- output files. It's called automatically when the buffer fills up or after</div>
  </div>
  <div class="line not-executable" id="L614">
    <div class="line-number"><a href="#L614">614</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- the flush interval elapses, and can also be called manually via the flush()</div>
  </div>
  <div class="line not-executable" id="L615">
    <div class="line-number"><a href="#L615">615</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- public method. Buffering improves performance by reducing I/O operations.</div>
  </div>
  <div class="line not-executable" id="L616">
    <div class="line-number"><a href="#L616">616</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L617">
    <div class="line-number"><a href="#L617">617</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L618">
    <div class="line-number"><a href="#L618">618</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the flush operation was successful</div>
  </div>
  <div class="line not-covered" id="L619">
    <div class="line-number"><a href="#L619">619</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function flush_buffer()</div>
  </div>
  <div class="line not-covered" id="L620">
    <div class="line-number"><a href="#L620">620</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if buffer.count == 0 then</div>
  </div>
  <div class="line not-covered" id="L621">
    <div class="line-number"><a href="#L621">621</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true  -- Nothing to flush is considered successful</div>
  </div>
  <div class="line not-covered" id="L622">
    <div class="line-number"><a href="#L622">622</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L623">
    <div class="line-number"><a href="#L623">623</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L624">
    <div class="line-number"><a href="#L624">624</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local fs = get_fs()</div>
  </div>
  <div class="line not-covered" id="L625">
    <div class="line-number"><a href="#L625">625</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success = true</div>
  </div>
  <div class="line not-executable" id="L626">
    <div class="line-number"><a href="#L626">626</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L627">
    <div class="line-number"><a href="#L627">627</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Regular log file</div>
  </div>
  <div class="line not-covered" id="L628">
    <div class="line-number"><a href="#L628">628</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.output_file then</div>
  </div>
  <div class="line not-covered" id="L629">
    <div class="line-number"><a href="#L629">629</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local log_path = get_log_file_path()</div>
  </div>
  <div class="line not-executable" id="L630">
    <div class="line-number"><a href="#L630">630</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L631">
    <div class="line-number"><a href="#L631">631</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Build content string</div>
  </div>
  <div class="line not-covered" id="L632">
    <div class="line-number"><a href="#L632">632</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local content = &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L633">
    <div class="line-number"><a href="#L633">633</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, entry in ipairs(buffer.entries) do</div>
  </div>
  <div class="line not-covered" id="L634">
    <div class="line-number"><a href="#L634">634</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      content = content .. entry.text .. &quot;\n&quot;</div>
  </div>
  <div class="line not-covered" id="L635">
    <div class="line-number"><a href="#L635">635</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L636">
    <div class="line-number"><a href="#L636">636</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L637">
    <div class="line-number"><a href="#L637">637</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Append to log file</div>
  </div>
  <div class="line not-covered" id="L638">
    <div class="line-number"><a href="#L638">638</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local file_success, err = fs.append_file(log_path, content)</div>
  </div>
  <div class="line not-covered" id="L639">
    <div class="line-number"><a href="#L639">639</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not file_success then</div>
  </div>
  <div class="line not-covered" id="L640">
    <div class="line-number"><a href="#L640">640</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;Warning: Failed to write to log file: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-covered" id="L641">
    <div class="line-number"><a href="#L641">641</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      success = false</div>
  </div>
  <div class="line not-covered" id="L642">
    <div class="line-number"><a href="#L642">642</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L643">
    <div class="line-number"><a href="#L643">643</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L644">
    <div class="line-number"><a href="#L644">644</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L645">
    <div class="line-number"><a href="#L645">645</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- JSON log file</div>
  </div>
  <div class="line not-covered" id="L646">
    <div class="line-number"><a href="#L646">646</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.json_file then</div>
  </div>
  <div class="line not-covered" id="L647">
    <div class="line-number"><a href="#L647">647</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local json_log_path = get_json_log_file_path()</div>
  </div>
  <div class="line not-executable" id="L648">
    <div class="line-number"><a href="#L648">648</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L649">
    <div class="line-number"><a href="#L649">649</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Build JSON content string</div>
  </div>
  <div class="line not-covered" id="L650">
    <div class="line-number"><a href="#L650">650</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local json_content = &quot;&quot;</div>
  </div>
  <div class="line not-covered" id="L651">
    <div class="line-number"><a href="#L651">651</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, entry in ipairs(buffer.entries) do</div>
  </div>
  <div class="line not-covered" id="L652">
    <div class="line-number"><a href="#L652">652</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      json_content = json_content .. entry.json .. &quot;\n&quot;</div>
  </div>
  <div class="line not-covered" id="L653">
    <div class="line-number"><a href="#L653">653</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L654">
    <div class="line-number"><a href="#L654">654</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L655">
    <div class="line-number"><a href="#L655">655</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Append to JSON log file</div>
  </div>
  <div class="line not-covered" id="L656">
    <div class="line-number"><a href="#L656">656</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local json_success, err = fs.append_file(json_log_path, json_content)</div>
  </div>
  <div class="line not-covered" id="L657">
    <div class="line-number"><a href="#L657">657</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not json_success then</div>
  </div>
  <div class="line not-covered" id="L658">
    <div class="line-number"><a href="#L658">658</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;Warning: Failed to write to JSON log file: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line not-covered" id="L659">
    <div class="line-number"><a href="#L659">659</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      success = false</div>
  </div>
  <div class="line not-covered" id="L660">
    <div class="line-number"><a href="#L660">660</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L661">
    <div class="line-number"><a href="#L661">661</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L662">
    <div class="line-number"><a href="#L662">662</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L663">
    <div class="line-number"><a href="#L663">663</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Reset buffer</div>
  </div>
  <div class="line not-covered" id="L664">
    <div class="line-number"><a href="#L664">664</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  buffer.entries = {}</div>
  </div>
  <div class="line not-covered" id="L665">
    <div class="line-number"><a href="#L665">665</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  buffer.count = 0</div>
  </div>
  <div class="line not-covered" id="L666">
    <div class="line-number"><a href="#L666">666</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  buffer.last_flush_time = os.time()</div>
  </div>
  <div class="line not-executable" id="L667">
    <div class="line-number"><a href="#L667">667</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L668">
    <div class="line-number"><a href="#L668">668</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return success</div>
  </div>
  <div class="line not-covered" id="L669">
    <div class="line-number"><a href="#L669">669</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L670">
    <div class="line-number"><a href="#L670">670</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Lazy-load the error_handler module to avoid circular dependencies</div>
  </div>
  <div class="line not-executable" id="L671">
    <div class="line-number"><a href="#L671">671</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function implements lazy loading for the error_handler module,</div>
  </div>
  <div class="line not-executable" id="L672">
    <div class="line-number"><a href="#L672">672</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- which helps prevent circular dependencies that can occur during module</div>
  </div>
  <div class="line not-executable" id="L673">
    <div class="line-number"><a href="#L673">673</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- initialization. It attempts to load the module only when needed and</div>
  </div>
  <div class="line not-executable" id="L674">
    <div class="line-number"><a href="#L674">674</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- caches the result to avoid repeated require attempts.</div>
  </div>
  <div class="line not-executable" id="L675">
    <div class="line-number"><a href="#L675">675</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L676">
    <div class="line-number"><a href="#L676">676</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L677">
    <div class="line-number"><a href="#L677">677</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil The error_handler module or nil if it couldn't be loaded</div>
  </div>
  <div class="line not-covered" id="L678">
    <div class="line-number"><a href="#L678">678</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local _error_handler</div>
  </div>
  <div class="line not-covered" id="L679">
    <div class="line-number"><a href="#L679">679</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_error_handler()</div>
  </div>
  <div class="line not-covered" id="L680">
    <div class="line-number"><a href="#L680">680</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not _error_handler then</div>
  </div>
  <div class="line not-covered" id="L681">
    <div class="line-number"><a href="#L681">681</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, module = pcall(require, &quot;lib.tools.error_handler&quot;)</div>
  </div>
  <div class="line not-covered" id="L682">
    <div class="line-number"><a href="#L682">682</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if success then</div>
  </div>
  <div class="line not-covered" id="L683">
    <div class="line-number"><a href="#L683">683</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      _error_handler = module</div>
  </div>
  <div class="line not-covered" id="L684">
    <div class="line-number"><a href="#L684">684</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L685">
    <div class="line-number"><a href="#L685">685</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L686">
    <div class="line-number"><a href="#L686">686</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return _error_handler</div>
  </div>
  <div class="line not-covered" id="L687">
    <div class="line-number"><a href="#L687">687</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L688">
    <div class="line-number"><a href="#L688">688</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if the current test is designed to expect errors</div>
  </div>
  <div class="line not-executable" id="L689">
    <div class="line-number"><a href="#L689">689</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This helper function integrates with the error_handler module to determine</div>
  </div>
  <div class="line not-executable" id="L690">
    <div class="line-number"><a href="#L690">690</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if the current running test is marked as expecting errors. This allows the</div>
  </div>
  <div class="line not-executable" id="L691">
    <div class="line-number"><a href="#L691">691</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging system to handle error logs differently during tests that are</div>
  </div>
  <div class="line not-executable" id="L692">
    <div class="line-number"><a href="#L692">692</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- deliberately testing error conditions.</div>
  </div>
  <div class="line not-executable" id="L693">
    <div class="line-number"><a href="#L693">693</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L694">
    <div class="line-number"><a href="#L694">694</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L695">
    <div class="line-number"><a href="#L695">695</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the current test expects errors</div>
  </div>
  <div class="line not-covered" id="L696">
    <div class="line-number"><a href="#L696">696</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function current_test_expects_errors()</div>
  </div>
  <div class="line not-covered" id="L697">
    <div class="line-number"><a href="#L697">697</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local error_handler = get_error_handler()</div>
  </div>
  <div class="line not-executable" id="L698">
    <div class="line-number"><a href="#L698">698</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L699">
    <div class="line-number"><a href="#L699">699</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If error_handler is loaded and has the function, call it</div>
  </div>
  <div class="line not-covered" id="L700">
    <div class="line-number"><a href="#L700">700</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if error_handler and error_handler.current_test_expects_errors then</div>
  </div>
  <div class="line not-covered" id="L701">
    <div class="line-number"><a href="#L701">701</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return error_handler.current_test_expects_errors()</div>
  </div>
  <div class="line not-covered" id="L702">
    <div class="line-number"><a href="#L702">702</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L703">
    <div class="line-number"><a href="#L703">703</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L704">
    <div class="line-number"><a href="#L704">704</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Default to false if we couldn't determine</div>
  </div>
  <div class="line not-covered" id="L705">
    <div class="line-number"><a href="#L705">705</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return false</div>
  </div>
  <div class="line not-covered" id="L706">
    <div class="line-number"><a href="#L706">706</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L707">
    <div class="line-number"><a href="#L707">707</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Set a global debug flag if the --debug argument is present</div>
  </div>
  <div class="line not-executable" id="L708">
    <div class="line-number"><a href="#L708">708</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- This is only done once when the module loads</div>
  </div>
  <div class="line not-covered" id="L709">
    <div class="line-number"><a href="#L709">709</a></div>
    <div class="execution-count">0</div>    <div class="line-content">if not _G._firmo_debug_mode then</div>
  </div>
  <div class="line not-covered" id="L710">
    <div class="line-number"><a href="#L710">710</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  _G._firmo_debug_mode = false</div>
  </div>
  <div class="line not-executable" id="L711">
    <div class="line-number"><a href="#L711">711</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L712">
    <div class="line-number"><a href="#L712">712</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Detect debug mode from command line arguments</div>
  </div>
  <div class="line not-covered" id="L713">
    <div class="line-number"><a href="#L713">713</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if arg then</div>
  </div>
  <div class="line not-covered" id="L714">
    <div class="line-number"><a href="#L714">714</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for _, v in ipairs(arg) do</div>
  </div>
  <div class="line not-covered" id="L715">
    <div class="line-number"><a href="#L715">715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if v == &quot;--debug&quot; then</div>
  </div>
  <div class="line not-covered" id="L716">
    <div class="line-number"><a href="#L716">716</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        _G._firmo_debug_mode = true</div>
  </div>
  <div class="line not-covered" id="L717">
    <div class="line-number"><a href="#L717">717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        break</div>
  </div>
  <div class="line not-covered" id="L718">
    <div class="line-number"><a href="#L718">718</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L719">
    <div class="line-number"><a href="#L719">719</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L720">
    <div class="line-number"><a href="#L720">720</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L721">
    <div class="line-number"><a href="#L721">721</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L722">
    <div class="line-number"><a href="#L722">722</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Core logging function that handles all log operations</div>
  </div>
  <div class="line not-executable" id="L723">
    <div class="line-number"><a href="#L723">723</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This internal function implements the actual logging logic, including</div>
  </div>
  <div class="line not-executable" id="L724">
    <div class="line-number"><a href="#L724">724</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- level filtering, formatting, test error handling, output to console and files,</div>
  </div>
  <div class="line not-executable" id="L725">
    <div class="line-number"><a href="#L725">725</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- buffering, and rotation. All public logging methods ultimately call this</div>
  </div>
  <div class="line not-executable" id="L726">
    <div class="line-number"><a href="#L726">726</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- function to perform the actual logging operation.</div>
  </div>
  <div class="line not-executable" id="L727">
    <div class="line-number"><a href="#L727">727</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L728">
    <div class="line-number"><a href="#L728">728</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @private</div>
  </div>
  <div class="line not-executable" id="L729">
    <div class="line-number"><a href="#L729">729</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param level number The numeric log level for this message</div>
  </div>
  <div class="line not-executable" id="L730">
    <div class="line-number"><a href="#L730">730</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name? string The module name (source) of the log message</div>
  </div>
  <div class="line not-executable" id="L731">
    <div class="line-number"><a href="#L731">731</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The log message text</div>
  </div>
  <div class="line not-executable" id="L732">
    <div class="line-number"><a href="#L732">732</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param params? table Additional context parameters to include with the log</div>
  </div>
  <div class="line not-executable" id="L733">
    <div class="line-number"><a href="#L733">733</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the log message was output</div>
  </div>
  <div class="line not-covered" id="L734">
    <div class="line-number"><a href="#L734">734</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function log(level, module_name, message, params)</div>
  </div>
  <div class="line not-executable" id="L735">
    <div class="line-number"><a href="#L735">735</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- For expected errors in tests, either filter or log expected errors</div>
  </div>
  <div class="line not-covered" id="L736">
    <div class="line-number"><a href="#L736">736</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if level &lt;= M.LEVELS.WARN then</div>
  </div>
  <div class="line not-covered" id="L737">
    <div class="line-number"><a href="#L737">737</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if current_test_expects_errors() then</div>
  </div>
  <div class="line not-executable" id="L738">
    <div class="line-number"><a href="#L738">738</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Prefix message to indicate this is an expected error</div>
  </div>
  <div class="line not-covered" id="L739">
    <div class="line-number"><a href="#L739">739</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      message = &quot;[EXPECTED] &quot; .. message</div>
  </div>
  <div class="line not-executable" id="L740">
    <div class="line-number"><a href="#L740">740</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L741">
    <div class="line-number"><a href="#L741">741</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Store the error in the global error repository for potential debugging</div>
  </div>
  <div class="line not-covered" id="L742">
    <div class="line-number"><a href="#L742">742</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      local error_handler = get_error_handler()</div>
  </div>
  <div class="line not-covered" id="L743">
    <div class="line-number"><a href="#L743">743</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if error_handler then</div>
  </div>
  <div class="line not-covered" id="L744">
    <div class="line-number"><a href="#L744">744</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        _G._firmo_test_expected_errors = _G._firmo_test_expected_errors or {}</div>
  </div>
  <div class="line not-covered" id="L745">
    <div class="line-number"><a href="#L745">745</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.insert(_G._firmo_test_expected_errors, {</div>
  </div>
  <div class="line not-covered" id="L746">
    <div class="line-number"><a href="#L746">746</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          level = level,</div>
  </div>
  <div class="line not-covered" id="L747">
    <div class="line-number"><a href="#L747">747</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          module = module_name,</div>
  </div>
  <div class="line not-covered" id="L748">
    <div class="line-number"><a href="#L748">748</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          message = message,</div>
  </div>
  <div class="line not-covered" id="L749">
    <div class="line-number"><a href="#L749">749</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          params = params,</div>
  </div>
  <div class="line not-covered" id="L750">
    <div class="line-number"><a href="#L750">750</a></div>
    <div class="execution-count">0</div>    <div class="line-content">          timestamp = os.time()</div>
  </div>
  <div class="line not-covered" id="L751">
    <div class="line-number"><a href="#L751">751</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        })</div>
  </div>
  <div class="line not-covered" id="L752">
    <div class="line-number"><a href="#L752">752</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L753">
    <div class="line-number"><a href="#L753">753</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L754">
    <div class="line-number"><a href="#L754">754</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- In debug mode (--debug flag), make all expected errors visible regardless of module</div>
  </div>
  <div class="line not-covered" id="L755">
    <div class="line-number"><a href="#L755">755</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if _G._firmo_debug_mode then</div>
  </div>
  <div class="line not-executable" id="L756">
    <div class="line-number"><a href="#L756">756</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Override the level check below for expected errors</div>
  </div>
  <div class="line not-executable" id="L757">
    <div class="line-number"><a href="#L757">757</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Force immediate logging - we do this by keeping the original level (ERROR or WARN)</div>
  </div>
  <div class="line not-executable" id="L758">
    <div class="line-number"><a href="#L758">758</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- but setting a special flag that skips the is_enabled() check</div>
  </div>
  <div class="line not-covered" id="L759">
    <div class="line-number"><a href="#L759">759</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        params = params or {}</div>
  </div>
  <div class="line not-covered" id="L760">
    <div class="line-number"><a href="#L760">760</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        params._expected_debug_override = true</div>
  </div>
  <div class="line not-covered" id="L761">
    <div class="line-number"><a href="#L761">761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      else</div>
  </div>
  <div class="line not-executable" id="L762">
    <div class="line-number"><a href="#L762">762</a></div>
    <div class="execution-count"></div>    <div class="line-content">        -- Downgrade to DEBUG level - which may or may not be visible depending on module config</div>
  </div>
  <div class="line covered" id="L763">
    <div class="line-number"><a href="#L763">763</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        level = M.LEVELS.DEBUG</div>
  </div>
  <div class="line covered" id="L764">
    <div class="line-number"><a href="#L764">764</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L765">
    <div class="line-number"><a href="#L765">765</a></div>
    <div class="execution-count">30</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L766">
    <div class="line-number"><a href="#L766">766</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L767">
    <div class="line-number"><a href="#L767">767</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L768">
    <div class="line-number"><a href="#L768">768</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if this log should be shown (unless it's an expected error with debug override)</div>
  </div>
  <div class="line covered" id="L769">
    <div class="line-number"><a href="#L769">769</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local has_debug_override = params and params._expected_debug_override</div>
  </div>
  <div class="line covered" id="L770">
    <div class="line-number"><a href="#L770">770</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if not has_debug_override and not is_enabled(level, module_name) then</div>
  </div>
  <div class="line covered" id="L771">
    <div class="line-number"><a href="#L771">771</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L772">
    <div class="line-number"><a href="#L772">772</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L773">
    <div class="line-number"><a href="#L773">773</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L774">
    <div class="line-number"><a href="#L774">774</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Remove internal flag from params if it exists</div>
  </div>
  <div class="line covered" id="L775">
    <div class="line-number"><a href="#L775">775</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if params and params._expected_debug_override then</div>
  </div>
  <div class="line covered" id="L776">
    <div class="line-number"><a href="#L776">776</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    params._expected_debug_override = nil</div>
  </div>
  <div class="line covered" id="L777">
    <div class="line-number"><a href="#L777">777</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L778">
    <div class="line-number"><a href="#L778">778</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L779">
    <div class="line-number"><a href="#L779">779</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- In silent mode, don't output anything</div>
  </div>
  <div class="line covered" id="L780">
    <div class="line-number"><a href="#L780">780</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if config.silent then</div>
  </div>
  <div class="line covered" id="L781">
    <div class="line-number"><a href="#L781">781</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line covered" id="L782">
    <div class="line-number"><a href="#L782">782</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L783">
    <div class="line-number"><a href="#L783">783</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L784">
    <div class="line-number"><a href="#L784">784</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Format as text for console and regular log file</div>
  </div>
  <div class="line covered" id="L785">
    <div class="line-number"><a href="#L785">785</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local formatted_text = format_log(level, module_name, message, params)</div>
  </div>
  <div class="line not-executable" id="L786">
    <div class="line-number"><a href="#L786">786</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L787">
    <div class="line-number"><a href="#L787">787</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Format as JSON for structured logging</div>
  </div>
  <div class="line covered" id="L788">
    <div class="line-number"><a href="#L788">788</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local formatted_json = format_json(level, module_name, message, params)</div>
  </div>
  <div class="line not-executable" id="L789">
    <div class="line-number"><a href="#L789">789</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L790">
    <div class="line-number"><a href="#L790">790</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Output to console </div>
  </div>
  <div class="line covered" id="L791">
    <div class="line-number"><a href="#L791">791</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  print(formatted_text)</div>
  </div>
  <div class="line not-executable" id="L792">
    <div class="line-number"><a href="#L792">792</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L793">
    <div class="line-number"><a href="#L793">793</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If we're buffering, add to buffer</div>
  </div>
  <div class="line covered" id="L794">
    <div class="line-number"><a href="#L794">794</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if config.buffer_size &gt; 0 then</div>
  </div>
  <div class="line not-executable" id="L795">
    <div class="line-number"><a href="#L795">795</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if we need to auto-flush due to time</div>
  </div>
  <div class="line covered" id="L796">
    <div class="line-number"><a href="#L796">796</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if os.time() - buffer.last_flush_time &gt;= config.buffer_flush_interval then</div>
  </div>
  <div class="line covered" id="L797">
    <div class="line-number"><a href="#L797">797</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      flush_buffer()</div>
  </div>
  <div class="line covered" id="L798">
    <div class="line-number"><a href="#L798">798</a></div>
    <div class="execution-count">30</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L799">
    <div class="line-number"><a href="#L799">799</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L800">
    <div class="line-number"><a href="#L800">800</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Add to buffer</div>
  </div>
  <div class="line covered" id="L801">
    <div class="line-number"><a href="#L801">801</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    table.insert(buffer.entries, { </div>
  </div>
  <div class="line covered" id="L802">
    <div class="line-number"><a href="#L802">802</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      text = formatted_text, </div>
  </div>
  <div class="line covered" id="L803">
    <div class="line-number"><a href="#L803">803</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      json = formatted_json,</div>
  </div>
  <div class="line covered" id="L804">
    <div class="line-number"><a href="#L804">804</a></div>
    <div class="execution-count">10</div>    <div class="line-content">      level = level,</div>
  </div>
  <div class="line covered" id="L805">
    <div class="line-number"><a href="#L805">805</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      module = module_name,</div>
  </div>
  <div class="line covered" id="L806">
    <div class="line-number"><a href="#L806">806</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      message = message,</div>
  </div>
  <div class="line covered" id="L807">
    <div class="line-number"><a href="#L807">807</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      params = params</div>
  </div>
  <div class="line covered" id="L808">
    <div class="line-number"><a href="#L808">808</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    })</div>
  </div>
  <div class="line covered" id="L809">
    <div class="line-number"><a href="#L809">809</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    buffer.count = buffer.count + 1</div>
  </div>
  <div class="line not-executable" id="L810">
    <div class="line-number"><a href="#L810">810</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L811">
    <div class="line-number"><a href="#L811">811</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Flush if buffer is full</div>
  </div>
  <div class="line covered" id="L812">
    <div class="line-number"><a href="#L812">812</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if buffer.count &gt;= config.buffer_size then</div>
  </div>
  <div class="line covered" id="L813">
    <div class="line-number"><a href="#L813">813</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      flush_buffer()</div>
  </div>
  <div class="line covered" id="L814">
    <div class="line-number"><a href="#L814">814</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L815">
    <div class="line-number"><a href="#L815">815</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line covered" id="L816">
    <div class="line-number"><a href="#L816">816</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line covered" id="L817">
    <div class="line-number"><a href="#L817">817</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L818">
    <div class="line-number"><a href="#L818">818</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L819">
    <div class="line-number"><a href="#L819">819</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Direct file output (no buffering)</div>
  </div>
  <div class="line covered" id="L820">
    <div class="line-number"><a href="#L820">820</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  local fs = get_fs()</div>
  </div>
  <div class="line not-executable" id="L821">
    <div class="line-number"><a href="#L821">821</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L822">
    <div class="line-number"><a href="#L822">822</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Output to regular text log file if configured</div>
  </div>
  <div class="line covered" id="L823">
    <div class="line-number"><a href="#L823">823</a></div>
    <div class="execution-count">10</div>    <div class="line-content">  if config.output_file then</div>
  </div>
  <div class="line covered" id="L824">
    <div class="line-number"><a href="#L824">824</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local log_path = get_log_file_path()</div>
  </div>
  <div class="line not-executable" id="L825">
    <div class="line-number"><a href="#L825">825</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L826">
    <div class="line-number"><a href="#L826">826</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Ensure log directory exists</div>
  </div>
  <div class="line covered" id="L827">
    <div class="line-number"><a href="#L827">827</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    ensure_log_dir()</div>
  </div>
  <div class="line not-executable" id="L828">
    <div class="line-number"><a href="#L828">828</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L829">
    <div class="line-number"><a href="#L829">829</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if we need to rotate the log file</div>
  </div>
  <div class="line covered" id="L830">
    <div class="line-number"><a href="#L830">830</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if config.max_file_size and config.max_file_size &gt; 0 then</div>
  </div>
  <div class="line covered" id="L831">
    <div class="line-number"><a href="#L831">831</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local size = fs.file_exists(log_path) and fs.get_file_size(log_path) or 0</div>
  </div>
  <div class="line covered" id="L832">
    <div class="line-number"><a href="#L832">832</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if size &gt;= config.max_file_size then</div>
  </div>
  <div class="line covered" id="L833">
    <div class="line-number"><a href="#L833">833</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        rotate_log_files()</div>
  </div>
  <div class="line covered" id="L834">
    <div class="line-number"><a href="#L834">834</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L835">
    <div class="line-number"><a href="#L835">835</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L836">
    <div class="line-number"><a href="#L836">836</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L837">
    <div class="line-number"><a href="#L837">837</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Append to the log file</div>
  </div>
  <div class="line covered" id="L838">
    <div class="line-number"><a href="#L838">838</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local success, err = fs.append_file(log_path, formatted_text .. &quot;\n&quot;)</div>
  </div>
  <div class="line covered" id="L839">
    <div class="line-number"><a href="#L839">839</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line covered" id="L840">
    <div class="line-number"><a href="#L840">840</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      print(&quot;Warning: Failed to write to log file: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line covered" id="L841">
    <div class="line-number"><a href="#L841">841</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L842">
    <div class="line-number"><a href="#L842">842</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L843">
    <div class="line-number"><a href="#L843">843</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L844">
    <div class="line-number"><a href="#L844">844</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Output to JSON log file if configured</div>
  </div>
  <div class="line covered" id="L845">
    <div class="line-number"><a href="#L845">845</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if config.json_file then</div>
  </div>
  <div class="line covered" id="L846">
    <div class="line-number"><a href="#L846">846</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local json_log_path = get_json_log_file_path()</div>
  </div>
  <div class="line not-executable" id="L847">
    <div class="line-number"><a href="#L847">847</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L848">
    <div class="line-number"><a href="#L848">848</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Ensure log directory exists</div>
  </div>
  <div class="line covered" id="L849">
    <div class="line-number"><a href="#L849">849</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    ensure_log_dir()</div>
  </div>
  <div class="line not-executable" id="L850">
    <div class="line-number"><a href="#L850">850</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L851">
    <div class="line-number"><a href="#L851">851</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if we need to rotate the JSON log file</div>
  </div>
  <div class="line covered" id="L852">
    <div class="line-number"><a href="#L852">852</a></div>
    <div class="execution-count">10</div>    <div class="line-content">    if config.max_file_size and config.max_file_size &gt; 0 then</div>
  </div>
  <div class="line covered" id="L853">
    <div class="line-number"><a href="#L853">853</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local size = fs.file_exists(json_log_path) and fs.get_file_size(json_log_path) or 0</div>
  </div>
  <div class="line covered" id="L854">
    <div class="line-number"><a href="#L854">854</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      if size &gt;= config.max_file_size then</div>
  </div>
  <div class="line covered" id="L855">
    <div class="line-number"><a href="#L855">855</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        rotate_json_log_files()</div>
  </div>
  <div class="line covered" id="L856">
    <div class="line-number"><a href="#L856">856</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L857">
    <div class="line-number"><a href="#L857">857</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L858">
    <div class="line-number"><a href="#L858">858</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L859">
    <div class="line-number"><a href="#L859">859</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Append to the JSON log file</div>
  </div>
  <div class="line covered" id="L860">
    <div class="line-number"><a href="#L860">860</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local success, err = fs.append_file(json_log_path, formatted_json .. &quot;\n&quot;)</div>
  </div>
  <div class="line covered" id="L861">
    <div class="line-number"><a href="#L861">861</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if not success then</div>
  </div>
  <div class="line covered" id="L862">
    <div class="line-number"><a href="#L862">862</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      print(&quot;Warning: Failed to write to JSON log file: &quot; .. (err or &quot;unknown error&quot;))</div>
  </div>
  <div class="line covered" id="L863">
    <div class="line-number"><a href="#L863">863</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L864">
    <div class="line-number"><a href="#L864">864</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L865">
    <div class="line-number"><a href="#L865">865</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L866">
    <div class="line-number"><a href="#L866">866</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line covered" id="L867">
    <div class="line-number"><a href="#L867">867</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L868">
    <div class="line-number"><a href="#L868">868</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Configure the logging module with comprehensive options</div>
  </div>
  <div class="line not-executable" id="L869">
    <div class="line-number"><a href="#L869">869</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Sets up the global logging configuration including output destinations,</div>
  </div>
  <div class="line not-executable" id="L870">
    <div class="line-number"><a href="#L870">870</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- formatting options, log levels, and filtering. This is typically called</div>
  </div>
  <div class="line not-executable" id="L871">
    <div class="line-number"><a href="#L871">871</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- once at application startup to establish logging behavior.</div>
  </div>
  <div class="line not-executable" id="L872">
    <div class="line-number"><a href="#L872">872</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L873">
    <div class="line-number"><a href="#L873">873</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param options? {level?: number|string, file?: string, format?: string, console?: boolean, </div>
  </div>
  <div class="line not-executable" id="L874">
    <div class="line-number"><a href="#L874">874</a></div>
    <div class="execution-count"></div>    <div class="line-content">---                  max_file_size?: number, include_source?: boolean, include_timestamp?: boolean, </div>
  </div>
  <div class="line not-executable" id="L875">
    <div class="line-number"><a href="#L875">875</a></div>
    <div class="execution-count"></div>    <div class="line-content">---                  include_level?: boolean, include_colors?: boolean, colors?: table&lt;string, string&gt;,</div>
  </div>
  <div class="line not-executable" id="L876">
    <div class="line-number"><a href="#L876">876</a></div>
    <div class="execution-count"></div>    <div class="line-content">---                  module_levels?: table&lt;string, number&gt;, module_filter?: string|string[],</div>
  </div>
  <div class="line not-executable" id="L877">
    <div class="line-number"><a href="#L877">877</a></div>
    <div class="execution-count"></div>    <div class="line-content">---                  silent?: boolean, buffer_size?: number, json_logs?: boolean} Configuration options</div>
  </div>
  <div class="line not-executable" id="L878">
    <div class="line-number"><a href="#L878">878</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return logging The logging module for method chaining</div>
  </div>
  <div class="line not-executable" id="L879">
    <div class="line-number"><a href="#L879">879</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L880">
    <div class="line-number"><a href="#L880">880</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L881">
    <div class="line-number"><a href="#L881">881</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Configure basic logging</div>
  </div>
  <div class="line not-executable" id="L882">
    <div class="line-number"><a href="#L882">882</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.configure({</div>
  </div>
  <div class="line not-executable" id="L883">
    <div class="line-number"><a href="#L883">883</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   level = logging.DEBUG,        -- Set global log level</div>
  </div>
  <div class="line not-executable" id="L884">
    <div class="line-number"><a href="#L884">884</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   console = true,               -- Enable console output</div>
  </div>
  <div class="line not-executable" id="L885">
    <div class="line-number"><a href="#L885">885</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   file = &quot;logs/application.log&quot; -- Also log to file</div>
  </div>
  <div class="line not-executable" id="L886">
    <div class="line-number"><a href="#L886">886</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-executable" id="L887">
    <div class="line-number"><a href="#L887">887</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L888">
    <div class="line-number"><a href="#L888">888</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Advanced configuration</div>
  </div>
  <div class="line not-executable" id="L889">
    <div class="line-number"><a href="#L889">889</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.configure({</div>
  </div>
  <div class="line not-executable" id="L890">
    <div class="line-number"><a href="#L890">890</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   level = &quot;DEBUG&quot;,              -- Level as string</div>
  </div>
  <div class="line not-executable" id="L891">
    <div class="line-number"><a href="#L891">891</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   include_colors = true,        -- Enable colored output</div>
  </div>
  <div class="line not-executable" id="L892">
    <div class="line-number"><a href="#L892">892</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   include_source = true,        -- Include source file and line</div>
  </div>
  <div class="line not-executable" id="L893">
    <div class="line-number"><a href="#L893">893</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   module_levels = {             -- Module-specific levels</div>
  </div>
  <div class="line not-executable" id="L894">
    <div class="line-number"><a href="#L894">894</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     Database = logging.INFO,</div>
  </div>
  <div class="line not-executable" id="L895">
    <div class="line-number"><a href="#L895">895</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     Network = logging.DEBUG</div>
  </div>
  <div class="line not-executable" id="L896">
    <div class="line-number"><a href="#L896">896</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   },</div>
  </div>
  <div class="line not-executable" id="L897">
    <div class="line-number"><a href="#L897">897</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   module_filter = {&quot;UI*&quot;, &quot;Network&quot;}, -- Only log from these modules</div>
  </div>
  <div class="line not-executable" id="L898">
    <div class="line-number"><a href="#L898">898</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   json_logs = true              -- Also output structured JSON logs</div>
  </div>
  <div class="line not-executable" id="L899">
    <div class="line-number"><a href="#L899">899</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L900">
    <div class="line-number"><a href="#L900">900</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.configure(options)</div>
  </div>
  <div class="line not-covered" id="L901">
    <div class="line-number"><a href="#L901">901</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  options = options or {}</div>
  </div>
  <div class="line not-executable" id="L902">
    <div class="line-number"><a href="#L902">902</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L903">
    <div class="line-number"><a href="#L903">903</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Apply configuration options</div>
  </div>
  <div class="line not-covered" id="L904">
    <div class="line-number"><a href="#L904">904</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.level ~= nil then</div>
  </div>
  <div class="line not-covered" id="L905">
    <div class="line-number"><a href="#L905">905</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.global_level = options.level</div>
  </div>
  <div class="line not-covered" id="L906">
    <div class="line-number"><a href="#L906">906</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L907">
    <div class="line-number"><a href="#L907">907</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L908">
    <div class="line-number"><a href="#L908">908</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.module_levels then</div>
  </div>
  <div class="line not-covered" id="L909">
    <div class="line-number"><a href="#L909">909</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for module, level in pairs(options.module_levels) do</div>
  </div>
  <div class="line not-covered" id="L910">
    <div class="line-number"><a href="#L910">910</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      config.module_levels[module] = level</div>
  </div>
  <div class="line not-covered" id="L911">
    <div class="line-number"><a href="#L911">911</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L912">
    <div class="line-number"><a href="#L912">912</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L913">
    <div class="line-number"><a href="#L913">913</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L914">
    <div class="line-number"><a href="#L914">914</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.timestamps ~= nil then</div>
  </div>
  <div class="line not-covered" id="L915">
    <div class="line-number"><a href="#L915">915</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.timestamps = options.timestamps</div>
  </div>
  <div class="line not-covered" id="L916">
    <div class="line-number"><a href="#L916">916</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L917">
    <div class="line-number"><a href="#L917">917</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L918">
    <div class="line-number"><a href="#L918">918</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.use_colors ~= nil then</div>
  </div>
  <div class="line not-covered" id="L919">
    <div class="line-number"><a href="#L919">919</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.use_colors = options.use_colors</div>
  </div>
  <div class="line not-covered" id="L920">
    <div class="line-number"><a href="#L920">920</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L921">
    <div class="line-number"><a href="#L921">921</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L922">
    <div class="line-number"><a href="#L922">922</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.output_file ~= nil then</div>
  </div>
  <div class="line not-covered" id="L923">
    <div class="line-number"><a href="#L923">923</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.output_file = options.output_file</div>
  </div>
  <div class="line not-covered" id="L924">
    <div class="line-number"><a href="#L924">924</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L925">
    <div class="line-number"><a href="#L925">925</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L926">
    <div class="line-number"><a href="#L926">926</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.log_dir ~= nil then</div>
  </div>
  <div class="line not-covered" id="L927">
    <div class="line-number"><a href="#L927">927</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.log_dir = options.log_dir</div>
  </div>
  <div class="line not-covered" id="L928">
    <div class="line-number"><a href="#L928">928</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L929">
    <div class="line-number"><a href="#L929">929</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L930">
    <div class="line-number"><a href="#L930">930</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.silent ~= nil then</div>
  </div>
  <div class="line not-covered" id="L931">
    <div class="line-number"><a href="#L931">931</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.silent = options.silent</div>
  </div>
  <div class="line not-covered" id="L932">
    <div class="line-number"><a href="#L932">932</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L933">
    <div class="line-number"><a href="#L933">933</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L934">
    <div class="line-number"><a href="#L934">934</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.max_file_size ~= nil then</div>
  </div>
  <div class="line not-covered" id="L935">
    <div class="line-number"><a href="#L935">935</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.max_file_size = options.max_file_size</div>
  </div>
  <div class="line not-covered" id="L936">
    <div class="line-number"><a href="#L936">936</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L937">
    <div class="line-number"><a href="#L937">937</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L938">
    <div class="line-number"><a href="#L938">938</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.max_log_files ~= nil then</div>
  </div>
  <div class="line not-covered" id="L939">
    <div class="line-number"><a href="#L939">939</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.max_log_files = options.max_log_files</div>
  </div>
  <div class="line not-covered" id="L940">
    <div class="line-number"><a href="#L940">940</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L941">
    <div class="line-number"><a href="#L941">941</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L942">
    <div class="line-number"><a href="#L942">942</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.date_pattern ~= nil then</div>
  </div>
  <div class="line not-covered" id="L943">
    <div class="line-number"><a href="#L943">943</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.date_pattern = options.date_pattern</div>
  </div>
  <div class="line not-covered" id="L944">
    <div class="line-number"><a href="#L944">944</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L945">
    <div class="line-number"><a href="#L945">945</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L946">
    <div class="line-number"><a href="#L946">946</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- JSON format options</div>
  </div>
  <div class="line not-covered" id="L947">
    <div class="line-number"><a href="#L947">947</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.format ~= nil then</div>
  </div>
  <div class="line not-covered" id="L948">
    <div class="line-number"><a href="#L948">948</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.format = options.format</div>
  </div>
  <div class="line not-covered" id="L949">
    <div class="line-number"><a href="#L949">949</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L950">
    <div class="line-number"><a href="#L950">950</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L951">
    <div class="line-number"><a href="#L951">951</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.json_file ~= nil then</div>
  </div>
  <div class="line not-covered" id="L952">
    <div class="line-number"><a href="#L952">952</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.json_file = options.json_file</div>
  </div>
  <div class="line not-covered" id="L953">
    <div class="line-number"><a href="#L953">953</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L954">
    <div class="line-number"><a href="#L954">954</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L955">
    <div class="line-number"><a href="#L955">955</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Module filtering options</div>
  </div>
  <div class="line not-covered" id="L956">
    <div class="line-number"><a href="#L956">956</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.module_filter ~= nil then</div>
  </div>
  <div class="line not-covered" id="L957">
    <div class="line-number"><a href="#L957">957</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.module_filter = options.module_filter</div>
  </div>
  <div class="line not-covered" id="L958">
    <div class="line-number"><a href="#L958">958</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L959">
    <div class="line-number"><a href="#L959">959</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L960">
    <div class="line-number"><a href="#L960">960</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.module_blacklist ~= nil then</div>
  </div>
  <div class="line not-covered" id="L961">
    <div class="line-number"><a href="#L961">961</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.module_blacklist = options.module_blacklist</div>
  </div>
  <div class="line not-covered" id="L962">
    <div class="line-number"><a href="#L962">962</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L963">
    <div class="line-number"><a href="#L963">963</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L964">
    <div class="line-number"><a href="#L964">964</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Buffering options</div>
  </div>
  <div class="line not-covered" id="L965">
    <div class="line-number"><a href="#L965">965</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.buffer_size ~= nil then</div>
  </div>
  <div class="line not-covered" id="L966">
    <div class="line-number"><a href="#L966">966</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.buffer_size = options.buffer_size</div>
  </div>
  <div class="line not-executable" id="L967">
    <div class="line-number"><a href="#L967">967</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Reset buffer when size changes</div>
  </div>
  <div class="line not-covered" id="L968">
    <div class="line-number"><a href="#L968">968</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    buffer.entries = {}</div>
  </div>
  <div class="line not-covered" id="L969">
    <div class="line-number"><a href="#L969">969</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    buffer.count = 0</div>
  </div>
  <div class="line not-covered" id="L970">
    <div class="line-number"><a href="#L970">970</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    buffer.last_flush_time = os.time()</div>
  </div>
  <div class="line not-covered" id="L971">
    <div class="line-number"><a href="#L971">971</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L972">
    <div class="line-number"><a href="#L972">972</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L973">
    <div class="line-number"><a href="#L973">973</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.buffer_flush_interval ~= nil then</div>
  </div>
  <div class="line not-covered" id="L974">
    <div class="line-number"><a href="#L974">974</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.buffer_flush_interval = options.buffer_flush_interval</div>
  </div>
  <div class="line not-covered" id="L975">
    <div class="line-number"><a href="#L975">975</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L976">
    <div class="line-number"><a href="#L976">976</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L977">
    <div class="line-number"><a href="#L977">977</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Standard metadata</div>
  </div>
  <div class="line not-covered" id="L978">
    <div class="line-number"><a href="#L978">978</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.standard_metadata ~= nil then</div>
  </div>
  <div class="line not-covered" id="L979">
    <div class="line-number"><a href="#L979">979</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.standard_metadata = options.standard_metadata</div>
  </div>
  <div class="line not-covered" id="L980">
    <div class="line-number"><a href="#L980">980</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L981">
    <div class="line-number"><a href="#L981">981</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L982">
    <div class="line-number"><a href="#L982">982</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If log file is configured, ensure the directory exists</div>
  </div>
  <div class="line not-covered" id="L983">
    <div class="line-number"><a href="#L983">983</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.output_file or config.json_file then</div>
  </div>
  <div class="line not-covered" id="L984">
    <div class="line-number"><a href="#L984">984</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    ensure_log_dir()</div>
  </div>
  <div class="line not-covered" id="L985">
    <div class="line-number"><a href="#L985">985</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L986">
    <div class="line-number"><a href="#L986">986</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L987">
    <div class="line-number"><a href="#L987">987</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L988">
    <div class="line-number"><a href="#L988">988</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L989">
    <div class="line-number"><a href="#L989">989</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Creates a new logger instance for a specific module</div>
  </div>
  <div class="line not-executable" id="L990">
    <div class="line-number"><a href="#L990">990</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This is the primary method for obtaining a logger that is bound to a specific module.</div>
  </div>
  <div class="line not-executable" id="L991">
    <div class="line-number"><a href="#L991">991</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Each logger instance encapsulates the module name and provides level-specific logging</div>
  </div>
  <div class="line not-executable" id="L992">
    <div class="line-number"><a href="#L992">992</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- methods as well as utility methods for checking log levels and configuration.</div>
  </div>
  <div class="line not-executable" id="L993">
    <div class="line-number"><a href="#L993">993</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L994">
    <div class="line-number"><a href="#L994">994</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name string The name of the module this logger is for</div>
  </div>
  <div class="line not-executable" id="L995">
    <div class="line-number"><a href="#L995">995</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return logger_instance A logger instance bound to the specified module</div>
  </div>
  <div class="line not-executable" id="L996">
    <div class="line-number"><a href="#L996">996</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L997">
    <div class="line-number"><a href="#L997">997</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L998">
    <div class="line-number"><a href="#L998">998</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Create a logger for a specific module</div>
  </div>
  <div class="line not-executable" id="L999">
    <div class="line-number"><a href="#L999">999</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local logger = logging.get_logger(&quot;Database&quot;)</div>
  </div>
  <div class="line not-executable" id="L1000">
    <div class="line-number"><a href="#L1000">1000</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L1001">
    <div class="line-number"><a href="#L1001">1001</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Use the logger with different log levels</div>
  </div>
  <div class="line not-executable" id="L1002">
    <div class="line-number"><a href="#L1002">1002</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logger.debug(&quot;Connection established&quot;, {host = &quot;localhost&quot;, port = 5432})</div>
  </div>
  <div class="line not-executable" id="L1003">
    <div class="line-number"><a href="#L1003">1003</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logger.info(&quot;Query executed successfully&quot;)</div>
  </div>
  <div class="line not-executable" id="L1004">
    <div class="line-number"><a href="#L1004">1004</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logger.warn(&quot;Slow query detected&quot;, {execution_time = 1.5, query_id = &quot;SELECT001&quot;})</div>
  </div>
  <div class="line not-executable" id="L1005">
    <div class="line-number"><a href="#L1005">1005</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logger.error(&quot;Database connection failed&quot;, {error_code = 1045})</div>
  </div>
  <div class="line not-executable" id="L1006">
    <div class="line-number"><a href="#L1006">1006</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1007">
    <div class="line-number"><a href="#L1007">1007</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check if certain log levels are enabled before expensive operations</div>
  </div>
  <div class="line not-executable" id="L1008">
    <div class="line-number"><a href="#L1008">1008</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if logger.is_debug_enabled() then</div>
  </div>
  <div class="line not-executable" id="L1009">
    <div class="line-number"><a href="#L1009">1009</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Only execute this expensive debug code if debug logging is enabled</div>
  </div>
  <div class="line not-executable" id="L1010">
    <div class="line-number"><a href="#L1010">1010</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local stats = generate_detailed_statistics()</div>
  </div>
  <div class="line not-executable" id="L1011">
    <div class="line-number"><a href="#L1011">1011</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logger.debug(&quot;Performance statistics&quot;, stats)</div>
  </div>
  <div class="line not-executable" id="L1012">
    <div class="line-number"><a href="#L1012">1012</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1013">
    <div class="line-number"><a href="#L1013">1013</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_logger(module_name)</div>
  </div>
  <div class="line not-covered" id="L1014">
    <div class="line-number"><a href="#L1014">1014</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local logger = {}</div>
  </div>
  <div class="line not-executable" id="L1015">
    <div class="line-number"><a href="#L1015">1015</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1016">
    <div class="line-number"><a href="#L1016">1016</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Log a fatal level message through this logger</div>
  </div>
  <div class="line not-executable" id="L1017">
    <div class="line-number"><a href="#L1017">1017</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1018">
    <div class="line-number"><a href="#L1018">1018</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1019">
    <div class="line-number"><a href="#L1019">1019</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-covered" id="L1020">
    <div class="line-number"><a href="#L1020">1020</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.fatal = function(message, params)</div>
  </div>
  <div class="line not-covered" id="L1021">
    <div class="line-number"><a href="#L1021">1021</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(M.LEVELS.FATAL, module_name, message, params)</div>
  </div>
  <div class="line not-covered" id="L1022">
    <div class="line-number"><a href="#L1022">1022</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1023">
    <div class="line-number"><a href="#L1023">1023</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1024">
    <div class="line-number"><a href="#L1024">1024</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Log an error level message through this logger</div>
  </div>
  <div class="line not-executable" id="L1025">
    <div class="line-number"><a href="#L1025">1025</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1026">
    <div class="line-number"><a href="#L1026">1026</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1027">
    <div class="line-number"><a href="#L1027">1027</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-covered" id="L1028">
    <div class="line-number"><a href="#L1028">1028</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.error = function(message, params)</div>
  </div>
  <div class="line not-covered" id="L1029">
    <div class="line-number"><a href="#L1029">1029</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(M.LEVELS.ERROR, module_name, message, params)</div>
  </div>
  <div class="line not-covered" id="L1030">
    <div class="line-number"><a href="#L1030">1030</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1031">
    <div class="line-number"><a href="#L1031">1031</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1032">
    <div class="line-number"><a href="#L1032">1032</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Log a warning level message through this logger</div>
  </div>
  <div class="line not-executable" id="L1033">
    <div class="line-number"><a href="#L1033">1033</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1034">
    <div class="line-number"><a href="#L1034">1034</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1035">
    <div class="line-number"><a href="#L1035">1035</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-covered" id="L1036">
    <div class="line-number"><a href="#L1036">1036</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.warn = function(message, params)</div>
  </div>
  <div class="line not-covered" id="L1037">
    <div class="line-number"><a href="#L1037">1037</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log(M.LEVELS.WARN, module_name, message, params)</div>
  </div>
  <div class="line not-covered" id="L1038">
    <div class="line-number"><a href="#L1038">1038</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1039">
    <div class="line-number"><a href="#L1039">1039</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1040">
    <div class="line-number"><a href="#L1040">1040</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Log an info level message through this logger</div>
  </div>
  <div class="line not-executable" id="L1041">
    <div class="line-number"><a href="#L1041">1041</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1042">
    <div class="line-number"><a href="#L1042">1042</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1043">
    <div class="line-number"><a href="#L1043">1043</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether the message was logged</div>
  </div>
  <div class="line covered" id="L1044">
    <div class="line-number"><a href="#L1044">1044</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.info = function(message, params)</div>
  </div>
  <div class="line covered" id="L1045">
    <div class="line-number"><a href="#L1045">1045</a></div>
    <div class="execution-count">11</div>    <div class="line-content">    log(M.LEVELS.INFO, module_name, message, params)</div>
  </div>
  <div class="line covered" id="L1046">
    <div class="line-number"><a href="#L1046">1046</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1047">
    <div class="line-number"><a href="#L1047">1047</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1048">
    <div class="line-number"><a href="#L1048">1048</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Log a debug level message through this logger</div>
  </div>
  <div class="line not-executable" id="L1049">
    <div class="line-number"><a href="#L1049">1049</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1050">
    <div class="line-number"><a href="#L1050">1050</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1051">
    <div class="line-number"><a href="#L1051">1051</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether the message was logged</div>
  </div>
  <div class="line covered" id="L1052">
    <div class="line-number"><a href="#L1052">1052</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.debug = function(message, params)</div>
  </div>
  <div class="line covered" id="L1053">
    <div class="line-number"><a href="#L1053">1053</a></div>
    <div class="execution-count">11</div>    <div class="line-content">    log(M.LEVELS.DEBUG, module_name, message, params)</div>
  </div>
  <div class="line covered" id="L1054">
    <div class="line-number"><a href="#L1054">1054</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1055">
    <div class="line-number"><a href="#L1055">1055</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1056">
    <div class="line-number"><a href="#L1056">1056</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Log a trace level message through this logger</div>
  </div>
  <div class="line not-executable" id="L1057">
    <div class="line-number"><a href="#L1057">1057</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1058">
    <div class="line-number"><a href="#L1058">1058</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1059">
    <div class="line-number"><a href="#L1059">1059</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether the message was logged</div>
  </div>
  <div class="line covered" id="L1060">
    <div class="line-number"><a href="#L1060">1060</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.trace = function(message, params)</div>
  </div>
  <div class="line covered" id="L1061">
    <div class="line-number"><a href="#L1061">1061</a></div>
    <div class="execution-count">11</div>    <div class="line-content">    log(M.LEVELS.TRACE, module_name, message, params)</div>
  </div>
  <div class="line covered" id="L1062">
    <div class="line-number"><a href="#L1062">1062</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1063">
    <div class="line-number"><a href="#L1063">1063</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1064">
    <div class="line-number"><a href="#L1064">1064</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Log a verbose level message through this logger (for backward compatibility)</div>
  </div>
  <div class="line not-executable" id="L1065">
    <div class="line-number"><a href="#L1065">1065</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1066">
    <div class="line-number"><a href="#L1066">1066</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1067">
    <div class="line-number"><a href="#L1067">1067</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether the message was logged</div>
  </div>
  <div class="line covered" id="L1068">
    <div class="line-number"><a href="#L1068">1068</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.verbose = function(message, params)</div>
  </div>
  <div class="line covered" id="L1069">
    <div class="line-number"><a href="#L1069">1069</a></div>
    <div class="execution-count">11</div>    <div class="line-content">    log(M.LEVELS.VERBOSE, module_name, message, params)</div>
  </div>
  <div class="line covered" id="L1070">
    <div class="line-number"><a href="#L1070">1070</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1071">
    <div class="line-number"><a href="#L1071">1071</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1072">
    <div class="line-number"><a href="#L1072">1072</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Log a message with a specific level through this logger</div>
  </div>
  <div class="line not-executable" id="L1073">
    <div class="line-number"><a href="#L1073">1073</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param level number The log level to use</div>
  </div>
  <div class="line not-executable" id="L1074">
    <div class="line-number"><a href="#L1074">1074</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1075">
    <div class="line-number"><a href="#L1075">1075</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1076">
    <div class="line-number"><a href="#L1076">1076</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether the message was logged</div>
  </div>
  <div class="line covered" id="L1077">
    <div class="line-number"><a href="#L1077">1077</a></div>
    <div class="execution-count">11</div>    <div class="line-content">  logger.log = function(level, message, params)</div>
  </div>
  <div class="line covered" id="L1078">
    <div class="line-number"><a href="#L1078">1078</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    log(level, module_name, message, params)</div>
  </div>
  <div class="line covered" id="L1079">
    <div class="line-number"><a href="#L1079">1079</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1080">
    <div class="line-number"><a href="#L1080">1080</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1081">
    <div class="line-number"><a href="#L1081">1081</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Check if a message at the specified level would be logged</div>
  </div>
  <div class="line not-executable" id="L1082">
    <div class="line-number"><a href="#L1082">1082</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @param level string|number The log level to check (can be name or number)</div>
  </div>
  <div class="line not-executable" id="L1083">
    <div class="line-number"><a href="#L1083">1083</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether logging is enabled for this level and module</div>
  </div>
  <div class="line covered" id="L1084">
    <div class="line-number"><a href="#L1084">1084</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.would_log = function(level)</div>
  </div>
  <div class="line covered" id="L1085">
    <div class="line-number"><a href="#L1085">1085</a></div>
    <div class="execution-count">12</div>    <div class="line-content">    if type(level) == &quot;string&quot; then</div>
  </div>
  <div class="line covered" id="L1086">
    <div class="line-number"><a href="#L1086">1086</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      local level_name = level:upper()</div>
  </div>
  <div class="line covered" id="L1087">
    <div class="line-number"><a href="#L1087">1087</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      for k, v in pairs(M.LEVELS) do</div>
  </div>
  <div class="line covered" id="L1088">
    <div class="line-number"><a href="#L1088">1088</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        if k == level_name then</div>
  </div>
  <div class="line covered" id="L1089">
    <div class="line-number"><a href="#L1089">1089</a></div>
    <div class="execution-count">1</div>    <div class="line-content">          return is_enabled(v, module_name)</div>
  </div>
  <div class="line covered" id="L1090">
    <div class="line-number"><a href="#L1090">1090</a></div>
    <div class="execution-count">1</div>    <div class="line-content">        end</div>
  </div>
  <div class="line covered" id="L1091">
    <div class="line-number"><a href="#L1091">1091</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      end</div>
  </div>
  <div class="line covered" id="L1092">
    <div class="line-number"><a href="#L1092">1092</a></div>
    <div class="execution-count">20</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line covered" id="L1093">
    <div class="line-number"><a href="#L1093">1093</a></div>
    <div class="execution-count">31</div>    <div class="line-content">    elseif type(level) == &quot;number&quot; then</div>
  </div>
  <div class="line covered" id="L1094">
    <div class="line-number"><a href="#L1094">1094</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return is_enabled(level, module_name)</div>
  </div>
  <div class="line covered" id="L1095">
    <div class="line-number"><a href="#L1095">1095</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    else</div>
  </div>
  <div class="line covered" id="L1096">
    <div class="line-number"><a href="#L1096">1096</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return false</div>
  </div>
  <div class="line covered" id="L1097">
    <div class="line-number"><a href="#L1097">1097</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L1098">
    <div class="line-number"><a href="#L1098">1098</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1099">
    <div class="line-number"><a href="#L1099">1099</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1100">
    <div class="line-number"><a href="#L1100">1100</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Check if debug level logging is enabled for this module</div>
  </div>
  <div class="line not-executable" id="L1101">
    <div class="line-number"><a href="#L1101">1101</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether debug logging is enabled</div>
  </div>
  <div class="line covered" id="L1102">
    <div class="line-number"><a href="#L1102">1102</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.is_debug_enabled = function()</div>
  </div>
  <div class="line covered" id="L1103">
    <div class="line-number"><a href="#L1103">1103</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return is_enabled(M.LEVELS.DEBUG, module_name)</div>
  </div>
  <div class="line covered" id="L1104">
    <div class="line-number"><a href="#L1104">1104</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1105">
    <div class="line-number"><a href="#L1105">1105</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1106">
    <div class="line-number"><a href="#L1106">1106</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Check if trace level logging is enabled for this module</div>
  </div>
  <div class="line not-executable" id="L1107">
    <div class="line-number"><a href="#L1107">1107</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether trace logging is enabled</div>
  </div>
  <div class="line covered" id="L1108">
    <div class="line-number"><a href="#L1108">1108</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.is_trace_enabled = function()</div>
  </div>
  <div class="line covered" id="L1109">
    <div class="line-number"><a href="#L1109">1109</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return is_enabled(M.LEVELS.TRACE, module_name)</div>
  </div>
  <div class="line covered" id="L1110">
    <div class="line-number"><a href="#L1110">1110</a></div>
    <div class="execution-count">11</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1111">
    <div class="line-number"><a href="#L1111">1111</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1112">
    <div class="line-number"><a href="#L1112">1112</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Check if verbose level logging is enabled for this module (for backward compatibility)</div>
  </div>
  <div class="line not-executable" id="L1113">
    <div class="line-number"><a href="#L1113">1113</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return boolean Whether verbose logging is enabled</div>
  </div>
  <div class="line covered" id="L1114">
    <div class="line-number"><a href="#L1114">1114</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.is_verbose_enabled = function()</div>
  </div>
  <div class="line covered" id="L1115">
    <div class="line-number"><a href="#L1115">1115</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return is_enabled(M.LEVELS.VERBOSE, module_name)</div>
  </div>
  <div class="line covered" id="L1116">
    <div class="line-number"><a href="#L1116">1116</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1117">
    <div class="line-number"><a href="#L1117">1117</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1118">
    <div class="line-number"><a href="#L1118">1118</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- Get the current log level for this module</div>
  </div>
  <div class="line not-executable" id="L1119">
    <div class="line-number"><a href="#L1119">1119</a></div>
    <div class="execution-count"></div>    <div class="line-content">  --- @return number The current log level</div>
  </div>
  <div class="line covered" id="L1120">
    <div class="line-number"><a href="#L1120">1120</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  logger.get_level = function()</div>
  </div>
  <div class="line covered" id="L1121">
    <div class="line-number"><a href="#L1121">1121</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if config.module_levels[module_name] then</div>
  </div>
  <div class="line covered" id="L1122">
    <div class="line-number"><a href="#L1122">1122</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      return config.module_levels[module_name]</div>
  </div>
  <div class="line covered" id="L1123">
    <div class="line-number"><a href="#L1123">1123</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L1124">
    <div class="line-number"><a href="#L1124">1124</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return config.global_level</div>
  </div>
  <div class="line covered" id="L1125">
    <div class="line-number"><a href="#L1125">1125</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1126">
    <div class="line-number"><a href="#L1126">1126</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line covered" id="L1127">
    <div class="line-number"><a href="#L1127">1127</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return logger</div>
  </div>
  <div class="line covered" id="L1128">
    <div class="line-number"><a href="#L1128">1128</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1129">
    <div class="line-number"><a href="#L1129">1129</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Direct module-level logging functions</div>
  </div>
  <div class="line not-executable" id="L1130">
    <div class="line-number"><a href="#L1130">1130</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- These functions provide a convenient way to log messages without</div>
  </div>
  <div class="line not-executable" id="L1131">
    <div class="line-number"><a href="#L1131">1131</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- needing to create a logger instance first. They're useful for global</div>
  </div>
  <div class="line not-executable" id="L1132">
    <div class="line-number"><a href="#L1132">1132</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging or for quick/temporary logs.</div>
  </div>
  <div class="line not-executable" id="L1133">
    <div class="line-number"><a href="#L1133">1133</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Log a fatal level message globally without module association</div>
  </div>
  <div class="line not-executable" id="L1134">
    <div class="line-number"><a href="#L1134">1134</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Fatal messages indicate a critical error that prevents the application</div>
  </div>
  <div class="line not-executable" id="L1135">
    <div class="line-number"><a href="#L1135">1135</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- from continuing operation. Fatal logs are always recorded regardless of</div>
  </div>
  <div class="line not-executable" id="L1136">
    <div class="line-number"><a href="#L1136">1136</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- log level settings.</div>
  </div>
  <div class="line not-executable" id="L1137">
    <div class="line-number"><a href="#L1137">1137</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1138">
    <div class="line-number"><a href="#L1138">1138</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1139">
    <div class="line-number"><a href="#L1139">1139</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1140">
    <div class="line-number"><a href="#L1140">1140</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-executable" id="L1141">
    <div class="line-number"><a href="#L1141">1141</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1142">
    <div class="line-number"><a href="#L1142">1142</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1143">
    <div class="line-number"><a href="#L1143">1143</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.fatal(&quot;Application initialization failed&quot;, {error_code = 500})</div>
  </div>
  <div class="line covered" id="L1144">
    <div class="line-number"><a href="#L1144">1144</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.fatal(message, params)</div>
  </div>
  <div class="line covered" id="L1145">
    <div class="line-number"><a href="#L1145">1145</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  log(M.LEVELS.FATAL, nil, message, params)</div>
  </div>
  <div class="line covered" id="L1146">
    <div class="line-number"><a href="#L1146">1146</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1147">
    <div class="line-number"><a href="#L1147">1147</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Log an error level message globally without module association</div>
  </div>
  <div class="line not-executable" id="L1148">
    <div class="line-number"><a href="#L1148">1148</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Error messages indicate a serious problem that prevents normal operation</div>
  </div>
  <div class="line not-executable" id="L1149">
    <div class="line-number"><a href="#L1149">1149</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- of a component or subsystem, but may not crash the entire application.</div>
  </div>
  <div class="line not-executable" id="L1150">
    <div class="line-number"><a href="#L1150">1150</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1151">
    <div class="line-number"><a href="#L1151">1151</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1152">
    <div class="line-number"><a href="#L1152">1152</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1153">
    <div class="line-number"><a href="#L1153">1153</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-executable" id="L1154">
    <div class="line-number"><a href="#L1154">1154</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1155">
    <div class="line-number"><a href="#L1155">1155</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1156">
    <div class="line-number"><a href="#L1156">1156</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.error(&quot;Failed to open configuration file&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1157">
    <div class="line-number"><a href="#L1157">1157</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   file_path = &quot;/etc/app/config.json&quot;,</div>
  </div>
  <div class="line not-executable" id="L1158">
    <div class="line-number"><a href="#L1158">1158</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   error = &quot;Permission denied&quot;</div>
  </div>
  <div class="line not-executable" id="L1159">
    <div class="line-number"><a href="#L1159">1159</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L1160">
    <div class="line-number"><a href="#L1160">1160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.error(message, params)</div>
  </div>
  <div class="line not-covered" id="L1161">
    <div class="line-number"><a href="#L1161">1161</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(M.LEVELS.ERROR, nil, message, params)</div>
  </div>
  <div class="line not-covered" id="L1162">
    <div class="line-number"><a href="#L1162">1162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1163">
    <div class="line-number"><a href="#L1163">1163</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Log a warning level message globally without module association</div>
  </div>
  <div class="line not-executable" id="L1164">
    <div class="line-number"><a href="#L1164">1164</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Warning messages indicate potential issues or unexpected states that</div>
  </div>
  <div class="line not-executable" id="L1165">
    <div class="line-number"><a href="#L1165">1165</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- don't prevent normal operation but may lead to problems in the future.</div>
  </div>
  <div class="line not-executable" id="L1166">
    <div class="line-number"><a href="#L1166">1166</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1167">
    <div class="line-number"><a href="#L1167">1167</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1168">
    <div class="line-number"><a href="#L1168">1168</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1169">
    <div class="line-number"><a href="#L1169">1169</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-executable" id="L1170">
    <div class="line-number"><a href="#L1170">1170</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1171">
    <div class="line-number"><a href="#L1171">1171</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1172">
    <div class="line-number"><a href="#L1172">1172</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.warn(&quot;Configuration using default values&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1173">
    <div class="line-number"><a href="#L1173">1173</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   reason = &quot;Config file not found&quot;,</div>
  </div>
  <div class="line not-executable" id="L1174">
    <div class="line-number"><a href="#L1174">1174</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   config_path = &quot;/etc/app/config.json&quot;</div>
  </div>
  <div class="line not-executable" id="L1175">
    <div class="line-number"><a href="#L1175">1175</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L1176">
    <div class="line-number"><a href="#L1176">1176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.warn(message, params)</div>
  </div>
  <div class="line not-covered" id="L1177">
    <div class="line-number"><a href="#L1177">1177</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(M.LEVELS.WARN, nil, message, params)</div>
  </div>
  <div class="line not-covered" id="L1178">
    <div class="line-number"><a href="#L1178">1178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1179">
    <div class="line-number"><a href="#L1179">1179</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Log an info level message globally without module association</div>
  </div>
  <div class="line not-executable" id="L1180">
    <div class="line-number"><a href="#L1180">1180</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Info messages provide normal operational information about the application's</div>
  </div>
  <div class="line not-executable" id="L1181">
    <div class="line-number"><a href="#L1181">1181</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- state and significant events during normal execution.</div>
  </div>
  <div class="line not-executable" id="L1182">
    <div class="line-number"><a href="#L1182">1182</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1183">
    <div class="line-number"><a href="#L1183">1183</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1184">
    <div class="line-number"><a href="#L1184">1184</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1185">
    <div class="line-number"><a href="#L1185">1185</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-executable" id="L1186">
    <div class="line-number"><a href="#L1186">1186</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1187">
    <div class="line-number"><a href="#L1187">1187</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1188">
    <div class="line-number"><a href="#L1188">1188</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.info(&quot;Application started successfully&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1189">
    <div class="line-number"><a href="#L1189">1189</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   version = &quot;1.2.3&quot;,</div>
  </div>
  <div class="line not-executable" id="L1190">
    <div class="line-number"><a href="#L1190">1190</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   environment = &quot;production&quot;</div>
  </div>
  <div class="line not-executable" id="L1191">
    <div class="line-number"><a href="#L1191">1191</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L1192">
    <div class="line-number"><a href="#L1192">1192</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.info(message, params)</div>
  </div>
  <div class="line not-covered" id="L1193">
    <div class="line-number"><a href="#L1193">1193</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(M.LEVELS.INFO, nil, message, params)</div>
  </div>
  <div class="line not-covered" id="L1194">
    <div class="line-number"><a href="#L1194">1194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1195">
    <div class="line-number"><a href="#L1195">1195</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Log a debug level message globally without module association</div>
  </div>
  <div class="line not-executable" id="L1196">
    <div class="line-number"><a href="#L1196">1196</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Debug messages provide detailed information useful during development</div>
  </div>
  <div class="line not-executable" id="L1197">
    <div class="line-number"><a href="#L1197">1197</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and troubleshooting, but typically too verbose for production use.</div>
  </div>
  <div class="line not-executable" id="L1198">
    <div class="line-number"><a href="#L1198">1198</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1199">
    <div class="line-number"><a href="#L1199">1199</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1200">
    <div class="line-number"><a href="#L1200">1200</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1201">
    <div class="line-number"><a href="#L1201">1201</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-executable" id="L1202">
    <div class="line-number"><a href="#L1202">1202</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1203">
    <div class="line-number"><a href="#L1203">1203</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1204">
    <div class="line-number"><a href="#L1204">1204</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.debug(&quot;Processing user request&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1205">
    <div class="line-number"><a href="#L1205">1205</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   user_id = 12345,</div>
  </div>
  <div class="line not-executable" id="L1206">
    <div class="line-number"><a href="#L1206">1206</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   request_path = &quot;/api/data&quot;,</div>
  </div>
  <div class="line not-executable" id="L1207">
    <div class="line-number"><a href="#L1207">1207</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   request_method = &quot;GET&quot;</div>
  </div>
  <div class="line not-executable" id="L1208">
    <div class="line-number"><a href="#L1208">1208</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L1209">
    <div class="line-number"><a href="#L1209">1209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.debug(message, params)</div>
  </div>
  <div class="line not-covered" id="L1210">
    <div class="line-number"><a href="#L1210">1210</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(M.LEVELS.DEBUG, nil, message, params)</div>
  </div>
  <div class="line not-covered" id="L1211">
    <div class="line-number"><a href="#L1211">1211</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1212">
    <div class="line-number"><a href="#L1212">1212</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Log a trace level message globally without module association</div>
  </div>
  <div class="line not-executable" id="L1213">
    <div class="line-number"><a href="#L1213">1213</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Trace messages provide highly detailed diagnostic information, typically</div>
  </div>
  <div class="line not-executable" id="L1214">
    <div class="line-number"><a href="#L1214">1214</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- used for step-by-step tracing of program execution or algorithm internals.</div>
  </div>
  <div class="line not-executable" id="L1215">
    <div class="line-number"><a href="#L1215">1215</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1216">
    <div class="line-number"><a href="#L1216">1216</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1217">
    <div class="line-number"><a href="#L1217">1217</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1218">
    <div class="line-number"><a href="#L1218">1218</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-executable" id="L1219">
    <div class="line-number"><a href="#L1219">1219</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1220">
    <div class="line-number"><a href="#L1220">1220</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1221">
    <div class="line-number"><a href="#L1221">1221</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.trace(&quot;Function enter&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1222">
    <div class="line-number"><a href="#L1222">1222</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   function_name = &quot;process_data&quot;,</div>
  </div>
  <div class="line not-executable" id="L1223">
    <div class="line-number"><a href="#L1223">1223</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   arguments = {id = 123, options = {validate = true}}</div>
  </div>
  <div class="line not-executable" id="L1224">
    <div class="line-number"><a href="#L1224">1224</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L1225">
    <div class="line-number"><a href="#L1225">1225</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.trace(message, params)</div>
  </div>
  <div class="line not-covered" id="L1226">
    <div class="line-number"><a href="#L1226">1226</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(M.LEVELS.TRACE, nil, message, params)</div>
  </div>
  <div class="line not-covered" id="L1227">
    <div class="line-number"><a href="#L1227">1227</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1228">
    <div class="line-number"><a href="#L1228">1228</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Log a verbose level message globally without module association (for backward compatibility)</div>
  </div>
  <div class="line not-executable" id="L1229">
    <div class="line-number"><a href="#L1229">1229</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- The verbose level is an alias for TRACE level in this implementation,</div>
  </div>
  <div class="line not-executable" id="L1230">
    <div class="line-number"><a href="#L1230">1230</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- maintained for backward compatibility with older code.</div>
  </div>
  <div class="line not-executable" id="L1231">
    <div class="line-number"><a href="#L1231">1231</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1232">
    <div class="line-number"><a href="#L1232">1232</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1233">
    <div class="line-number"><a href="#L1233">1233</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param params? table Additional context parameters to include</div>
  </div>
  <div class="line not-executable" id="L1234">
    <div class="line-number"><a href="#L1234">1234</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-executable" id="L1235">
    <div class="line-number"><a href="#L1235">1235</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1236">
    <div class="line-number"><a href="#L1236">1236</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1237">
    <div class="line-number"><a href="#L1237">1237</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.verbose(&quot;Detailed execution information&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1238">
    <div class="line-number"><a href="#L1238">1238</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   context = &quot;initialization&quot;,</div>
  </div>
  <div class="line not-executable" id="L1239">
    <div class="line-number"><a href="#L1239">1239</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   modules_loaded = {&quot;core&quot;, &quot;ui&quot;, &quot;network&quot;}</div>
  </div>
  <div class="line not-executable" id="L1240">
    <div class="line-number"><a href="#L1240">1240</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L1241">
    <div class="line-number"><a href="#L1241">1241</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.verbose(message, params)</div>
  </div>
  <div class="line not-covered" id="L1242">
    <div class="line-number"><a href="#L1242">1242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(M.LEVELS.VERBOSE, nil, message, params)</div>
  </div>
  <div class="line not-covered" id="L1243">
    <div class="line-number"><a href="#L1243">1243</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1244">
    <div class="line-number"><a href="#L1244">1244</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Flush buffered logs to output</div>
  </div>
  <div class="line not-executable" id="L1245">
    <div class="line-number"><a href="#L1245">1245</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The logging module for chaining</div>
  </div>
  <div class="line covered" id="L1246">
    <div class="line-number"><a href="#L1246">1246</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.flush()</div>
  </div>
  <div class="line covered" id="L1247">
    <div class="line-number"><a href="#L1247">1247</a></div>
    <div class="execution-count">6</div>    <div class="line-content">  flush_buffer()</div>
  </div>
  <div class="line covered" id="L1248">
    <div class="line-number"><a href="#L1248">1248</a></div>
    <div class="execution-count">6</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1249">
    <div class="line-number"><a href="#L1249">1249</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1250">
    <div class="line-number"><a href="#L1250">1250</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if a log at the specified level would be output for a given module</div>
  </div>
  <div class="line not-executable" id="L1251">
    <div class="line-number"><a href="#L1251">1251</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function checks if a log with the specified level for the given module</div>
  </div>
  <div class="line not-executable" id="L1252">
    <div class="line-number"><a href="#L1252">1252</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- would actually be output based on current level settings, module filters,</div>
  </div>
  <div class="line not-executable" id="L1253">
    <div class="line-number"><a href="#L1253">1253</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and blacklist. It's useful for avoiding expensive log preparation when</div>
  </div>
  <div class="line not-executable" id="L1254">
    <div class="line-number"><a href="#L1254">1254</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- the message would be filtered out anyway.</div>
  </div>
  <div class="line not-executable" id="L1255">
    <div class="line-number"><a href="#L1255">1255</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1256">
    <div class="line-number"><a href="#L1256">1256</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param level string|number The log level to check (can be level name or number)</div>
  </div>
  <div class="line not-executable" id="L1257">
    <div class="line-number"><a href="#L1257">1257</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name? string The module name to check (optional)</div>
  </div>
  <div class="line not-executable" id="L1258">
    <div class="line-number"><a href="#L1258">1258</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether logging is enabled for this level and module</div>
  </div>
  <div class="line not-executable" id="L1259">
    <div class="line-number"><a href="#L1259">1259</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1260">
    <div class="line-number"><a href="#L1260">1260</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1261">
    <div class="line-number"><a href="#L1261">1261</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check before executing expensive log preparation</div>
  </div>
  <div class="line not-executable" id="L1262">
    <div class="line-number"><a href="#L1262">1262</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if logging.would_log(&quot;DEBUG&quot;, &quot;Database&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1263">
    <div class="line-number"><a href="#L1263">1263</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Only compute expensive diagnostic info if it will actually be logged</div>
  </div>
  <div class="line not-executable" id="L1264">
    <div class="line-number"><a href="#L1264">1264</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   local stats = calculate_detailed_database_statistics()</div>
  </div>
  <div class="line not-executable" id="L1265">
    <div class="line-number"><a href="#L1265">1265</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logging.debug(&quot;Database statistics&quot;, stats)</div>
  </div>
  <div class="line not-executable" id="L1266">
    <div class="line-number"><a href="#L1266">1266</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L1267">
    <div class="line-number"><a href="#L1267">1267</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1268">
    <div class="line-number"><a href="#L1268">1268</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check using numeric level</div>
  </div>
  <div class="line not-executable" id="L1269">
    <div class="line-number"><a href="#L1269">1269</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if logging.would_log(logging.LEVELS.TRACE, &quot;Network&quot;) then</div>
  </div>
  <div class="line not-executable" id="L1270">
    <div class="line-number"><a href="#L1270">1270</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logging.trace(&quot;Network packet details&quot;, capture_packet_details())</div>
  </div>
  <div class="line not-executable" id="L1271">
    <div class="line-number"><a href="#L1271">1271</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1272">
    <div class="line-number"><a href="#L1272">1272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.would_log(level, module_name)</div>
  </div>
  <div class="line not-covered" id="L1273">
    <div class="line-number"><a href="#L1273">1273</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(level) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1274">
    <div class="line-number"><a href="#L1274">1274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local level_name = level:upper()</div>
  </div>
  <div class="line not-covered" id="L1275">
    <div class="line-number"><a href="#L1275">1275</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for k, v in pairs(M.LEVELS) do</div>
  </div>
  <div class="line not-covered" id="L1276">
    <div class="line-number"><a href="#L1276">1276</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if k == level_name then</div>
  </div>
  <div class="line not-covered" id="L1277">
    <div class="line-number"><a href="#L1277">1277</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return is_enabled(v, module_name)</div>
  </div>
  <div class="line not-covered" id="L1278">
    <div class="line-number"><a href="#L1278">1278</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1279">
    <div class="line-number"><a href="#L1279">1279</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1280">
    <div class="line-number"><a href="#L1280">1280</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1281">
    <div class="line-number"><a href="#L1281">1281</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif type(level) == &quot;number&quot; then</div>
  </div>
  <div class="line not-covered" id="L1282">
    <div class="line-number"><a href="#L1282">1282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return is_enabled(level, module_name)</div>
  </div>
  <div class="line not-covered" id="L1283">
    <div class="line-number"><a href="#L1283">1283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L1284">
    <div class="line-number"><a href="#L1284">1284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L1285">
    <div class="line-number"><a href="#L1285">1285</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1286">
    <div class="line-number"><a href="#L1286">1286</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1287">
    <div class="line-number"><a href="#L1287">1287</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Temporarily change log level for a module while executing a function</div>
  </div>
  <div class="line not-executable" id="L1288">
    <div class="line-number"><a href="#L1288">1288</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function allows you to temporarily override a module's log level</div>
  </div>
  <div class="line not-executable" id="L1289">
    <div class="line-number"><a href="#L1289">1289</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- while executing a function, then automatically restore the original</div>
  </div>
  <div class="line not-executable" id="L1290">
    <div class="line-number"><a href="#L1290">1290</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- level afterward. This is useful for diagnostics or for operations</div>
  </div>
  <div class="line not-executable" id="L1291">
    <div class="line-number"><a href="#L1291">1291</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- that need more detailed logging temporarily.</div>
  </div>
  <div class="line not-executable" id="L1292">
    <div class="line-number"><a href="#L1292">1292</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1293">
    <div class="line-number"><a href="#L1293">1293</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name string The module name to change the level for</div>
  </div>
  <div class="line not-executable" id="L1294">
    <div class="line-number"><a href="#L1294">1294</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param level string|number The log level to use temporarily</div>
  </div>
  <div class="line not-executable" id="L1295">
    <div class="line-number"><a href="#L1295">1295</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param func function The function to execute with the temporary log level</div>
  </div>
  <div class="line not-executable" id="L1296">
    <div class="line-number"><a href="#L1296">1296</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return any The result from the executed function</div>
  </div>
  <div class="line not-executable" id="L1297">
    <div class="line-number"><a href="#L1297">1297</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @error Any error raised by the executed function</div>
  </div>
  <div class="line not-executable" id="L1298">
    <div class="line-number"><a href="#L1298">1298</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1299">
    <div class="line-number"><a href="#L1299">1299</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1300">
    <div class="line-number"><a href="#L1300">1300</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Temporarily increase log level for a section of code</div>
  </div>
  <div class="line not-executable" id="L1301">
    <div class="line-number"><a href="#L1301">1301</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local result = logging.with_level(&quot;Database&quot;, &quot;DEBUG&quot;, function()</div>
  </div>
  <div class="line not-executable" id="L1302">
    <div class="line-number"><a href="#L1302">1302</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- This code block will have Database logging at DEBUG level</div>
  </div>
  <div class="line not-executable" id="L1303">
    <div class="line-number"><a href="#L1303">1303</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   db.execute_query(&quot;SELECT * FROM users&quot;)</div>
  </div>
  <div class="line not-executable" id="L1304">
    <div class="line-number"><a href="#L1304">1304</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return &quot;query completed&quot;</div>
  </div>
  <div class="line not-executable" id="L1305">
    <div class="line-number"><a href="#L1305">1305</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L1306">
    <div class="line-number"><a href="#L1306">1306</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1307">
    <div class="line-number"><a href="#L1307">1307</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- The module's original log level is automatically restored after</div>
  </div>
  <div class="line not-executable" id="L1308">
    <div class="line-number"><a href="#L1308">1308</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- the function completes, even if the function raises an error</div>
  </div>
  <div class="line not-executable" id="L1309">
    <div class="line-number"><a href="#L1309">1309</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1310">
    <div class="line-number"><a href="#L1310">1310</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Can also use with numeric levels</div>
  </div>
  <div class="line not-executable" id="L1311">
    <div class="line-number"><a href="#L1311">1311</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.with_level(&quot;Network&quot;, logging.LEVELS.TRACE, function()</div>
  </div>
  <div class="line not-executable" id="L1312">
    <div class="line-number"><a href="#L1312">1312</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   network.send_request(&quot;https://api.example.com/data&quot;)</div>
  </div>
  <div class="line not-executable" id="L1313">
    <div class="line-number"><a href="#L1313">1313</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-covered" id="L1314">
    <div class="line-number"><a href="#L1314">1314</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.with_level(module_name, level, func)</div>
  </div>
  <div class="line not-covered" id="L1315">
    <div class="line-number"><a href="#L1315">1315</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local original_level = config.module_levels[module_name]</div>
  </div>
  <div class="line not-executable" id="L1316">
    <div class="line-number"><a href="#L1316">1316</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1317">
    <div class="line-number"><a href="#L1317">1317</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Set temporary level</div>
  </div>
  <div class="line not-covered" id="L1318">
    <div class="line-number"><a href="#L1318">1318</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(level) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L1319">
    <div class="line-number"><a href="#L1319">1319</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local level_name = level:upper()</div>
  </div>
  <div class="line not-covered" id="L1320">
    <div class="line-number"><a href="#L1320">1320</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for k, v in pairs(M.LEVELS) do</div>
  </div>
  <div class="line not-covered" id="L1321">
    <div class="line-number"><a href="#L1321">1321</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if k == level_name then</div>
  </div>
  <div class="line not-covered" id="L1322">
    <div class="line-number"><a href="#L1322">1322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        M.set_module_level(module_name, v)</div>
  </div>
  <div class="line not-covered" id="L1323">
    <div class="line-number"><a href="#L1323">1323</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        break</div>
  </div>
  <div class="line not-covered" id="L1324">
    <div class="line-number"><a href="#L1324">1324</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1325">
    <div class="line-number"><a href="#L1325">1325</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1326">
    <div class="line-number"><a href="#L1326">1326</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L1327">
    <div class="line-number"><a href="#L1327">1327</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    M.set_module_level(module_name, level)</div>
  </div>
  <div class="line not-covered" id="L1328">
    <div class="line-number"><a href="#L1328">1328</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1329">
    <div class="line-number"><a href="#L1329">1329</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1330">
    <div class="line-number"><a href="#L1330">1330</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Run the function</div>
  </div>
  <div class="line not-covered" id="L1331">
    <div class="line-number"><a href="#L1331">1331</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, result = pcall(func)</div>
  </div>
  <div class="line not-executable" id="L1332">
    <div class="line-number"><a href="#L1332">1332</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1333">
    <div class="line-number"><a href="#L1333">1333</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Restore original level</div>
  </div>
  <div class="line not-covered" id="L1334">
    <div class="line-number"><a href="#L1334">1334</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if original_level then</div>
  </div>
  <div class="line not-covered" id="L1335">
    <div class="line-number"><a href="#L1335">1335</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    M.set_module_level(module_name, original_level)</div>
  </div>
  <div class="line not-covered" id="L1336">
    <div class="line-number"><a href="#L1336">1336</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L1337">
    <div class="line-number"><a href="#L1337">1337</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.module_levels[module_name] = nil</div>
  </div>
  <div class="line not-covered" id="L1338">
    <div class="line-number"><a href="#L1338">1338</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1339">
    <div class="line-number"><a href="#L1339">1339</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1340">
    <div class="line-number"><a href="#L1340">1340</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Handle errors</div>
  </div>
  <div class="line not-covered" id="L1341">
    <div class="line-number"><a href="#L1341">1341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not success then</div>
  </div>
  <div class="line not-covered" id="L1342">
    <div class="line-number"><a href="#L1342">1342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error(result)</div>
  </div>
  <div class="line not-covered" id="L1343">
    <div class="line-number"><a href="#L1343">1343</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1344">
    <div class="line-number"><a href="#L1344">1344</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1345">
    <div class="line-number"><a href="#L1345">1345</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return result</div>
  </div>
  <div class="line not-covered" id="L1346">
    <div class="line-number"><a href="#L1346">1346</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1347">
    <div class="line-number"><a href="#L1347">1347</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Set the log level for a specific module</div>
  </div>
  <div class="line not-executable" id="L1348">
    <div class="line-number"><a href="#L1348">1348</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function configures the log level for a specific module, allowing</div>
  </div>
  <div class="line not-executable" id="L1349">
    <div class="line-number"><a href="#L1349">1349</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- different modules to have different verbosity levels. Module-specific</div>
  </div>
  <div class="line not-executable" id="L1350">
    <div class="line-number"><a href="#L1350">1350</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- levels override the global log level.</div>
  </div>
  <div class="line not-executable" id="L1351">
    <div class="line-number"><a href="#L1351">1351</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1352">
    <div class="line-number"><a href="#L1352">1352</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name string The name of the module to configure</div>
  </div>
  <div class="line not-executable" id="L1353">
    <div class="line-number"><a href="#L1353">1353</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param level number The log level to set for the module</div>
  </div>
  <div class="line not-executable" id="L1354">
    <div class="line-number"><a href="#L1354">1354</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The logging module for chaining</div>
  </div>
  <div class="line not-executable" id="L1355">
    <div class="line-number"><a href="#L1355">1355</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1356">
    <div class="line-number"><a href="#L1356">1356</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1357">
    <div class="line-number"><a href="#L1357">1357</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Set the Database module to show only ERROR and above</div>
  </div>
  <div class="line not-executable" id="L1358">
    <div class="line-number"><a href="#L1358">1358</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.set_module_level(&quot;Database&quot;, logging.LEVELS.ERROR)</div>
  </div>
  <div class="line not-executable" id="L1359">
    <div class="line-number"><a href="#L1359">1359</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1360">
    <div class="line-number"><a href="#L1360">1360</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Set the AuthService to show detailed DEBUG logs</div>
  </div>
  <div class="line not-executable" id="L1361">
    <div class="line-number"><a href="#L1361">1361</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.set_module_level(&quot;AuthService&quot;, logging.LEVELS.DEBUG)</div>
  </div>
  <div class="line not-executable" id="L1362">
    <div class="line-number"><a href="#L1362">1362</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1363">
    <div class="line-number"><a href="#L1363">1363</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Use method chaining to configure multiple modules</div>
  </div>
  <div class="line not-executable" id="L1364">
    <div class="line-number"><a href="#L1364">1364</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.set_module_level(&quot;API&quot;, logging.LEVELS.WARN)</div>
  </div>
  <div class="line not-executable" id="L1365">
    <div class="line-number"><a href="#L1365">1365</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .set_module_level(&quot;UI&quot;, logging.LEVELS.INFO)</div>
  </div>
  <div class="line not-executable" id="L1366">
    <div class="line-number"><a href="#L1366">1366</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .set_module_level(&quot;Storage&quot;, logging.LEVELS.ERROR)</div>
  </div>
  <div class="line not-covered" id="L1367">
    <div class="line-number"><a href="#L1367">1367</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.set_module_level(module_name, level)</div>
  </div>
  <div class="line not-covered" id="L1368">
    <div class="line-number"><a href="#L1368">1368</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.module_levels[module_name] = level</div>
  </div>
  <div class="line not-covered" id="L1369">
    <div class="line-number"><a href="#L1369">1369</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1370">
    <div class="line-number"><a href="#L1370">1370</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1371">
    <div class="line-number"><a href="#L1371">1371</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Set the global log level for all modules</div>
  </div>
  <div class="line not-executable" id="L1372">
    <div class="line-number"><a href="#L1372">1372</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function sets the default log level that applies to all modules</div>
  </div>
  <div class="line not-executable" id="L1373">
    <div class="line-number"><a href="#L1373">1373</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- that don't have a specific level set via set_module_level(). This</div>
  </div>
  <div class="line not-executable" id="L1374">
    <div class="line-number"><a href="#L1374">1374</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- provides a simple way to control overall logging verbosity.</div>
  </div>
  <div class="line not-executable" id="L1375">
    <div class="line-number"><a href="#L1375">1375</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1376">
    <div class="line-number"><a href="#L1376">1376</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param level number The log level to set globally</div>
  </div>
  <div class="line not-executable" id="L1377">
    <div class="line-number"><a href="#L1377">1377</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The logging module for chaining</div>
  </div>
  <div class="line not-executable" id="L1378">
    <div class="line-number"><a href="#L1378">1378</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1379">
    <div class="line-number"><a href="#L1379">1379</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1380">
    <div class="line-number"><a href="#L1380">1380</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Reduce global verbosity to just warnings and errors</div>
  </div>
  <div class="line not-executable" id="L1381">
    <div class="line-number"><a href="#L1381">1381</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.set_level(logging.LEVELS.WARN)</div>
  </div>
  <div class="line not-executable" id="L1382">
    <div class="line-number"><a href="#L1382">1382</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1383">
    <div class="line-number"><a href="#L1383">1383</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Show all logs including debug</div>
  </div>
  <div class="line not-executable" id="L1384">
    <div class="line-number"><a href="#L1384">1384</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.set_level(logging.LEVELS.DEBUG)</div>
  </div>
  <div class="line not-executable" id="L1385">
    <div class="line-number"><a href="#L1385">1385</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1386">
    <div class="line-number"><a href="#L1386">1386</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- In production, show only errors</div>
  </div>
  <div class="line not-executable" id="L1387">
    <div class="line-number"><a href="#L1387">1387</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if env == &quot;production&quot; then</div>
  </div>
  <div class="line not-executable" id="L1388">
    <div class="line-number"><a href="#L1388">1388</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logging.set_level(logging.LEVELS.ERROR)</div>
  </div>
  <div class="line not-executable" id="L1389">
    <div class="line-number"><a href="#L1389">1389</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- else</div>
  </div>
  <div class="line not-executable" id="L1390">
    <div class="line-number"><a href="#L1390">1390</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   logging.set_level(logging.LEVELS.INFO)</div>
  </div>
  <div class="line not-executable" id="L1391">
    <div class="line-number"><a href="#L1391">1391</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1392">
    <div class="line-number"><a href="#L1392">1392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.set_level(level)</div>
  </div>
  <div class="line not-covered" id="L1393">
    <div class="line-number"><a href="#L1393">1393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.global_level = level</div>
  </div>
  <div class="line not-covered" id="L1394">
    <div class="line-number"><a href="#L1394">1394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1395">
    <div class="line-number"><a href="#L1395">1395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1396">
    <div class="line-number"><a href="#L1396">1396</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Configure module log level based on debug/verbose settings from an options object</div>
  </div>
  <div class="line not-executable" id="L1397">
    <div class="line-number"><a href="#L1397">1397</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function provides a convenient way to configure a module's log level</div>
  </div>
  <div class="line not-executable" id="L1398">
    <div class="line-number"><a href="#L1398">1398</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- based on standard debug/verbose flags commonly used in command-line options</div>
  </div>
  <div class="line not-executable" id="L1399">
    <div class="line-number"><a href="#L1399">1399</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- or configuration objects.</div>
  </div>
  <div class="line not-executable" id="L1400">
    <div class="line-number"><a href="#L1400">1400</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1401">
    <div class="line-number"><a href="#L1401">1401</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name string The module name to configure</div>
  </div>
  <div class="line not-executable" id="L1402">
    <div class="line-number"><a href="#L1402">1402</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param options table The options object with debug/verbose flags</div>
  </div>
  <div class="line not-executable" id="L1403">
    <div class="line-number"><a href="#L1403">1403</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return number The configured log level</div>
  </div>
  <div class="line not-executable" id="L1404">
    <div class="line-number"><a href="#L1404">1404</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1405">
    <div class="line-number"><a href="#L1405">1405</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1406">
    <div class="line-number"><a href="#L1406">1406</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Configure log level from command-line args</div>
  </div>
  <div class="line not-executable" id="L1407">
    <div class="line-number"><a href="#L1407">1407</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local args = {debug = true, verbose = false}</div>
  </div>
  <div class="line not-executable" id="L1408">
    <div class="line-number"><a href="#L1408">1408</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.configure_from_options(&quot;MyModule&quot;, args)</div>
  </div>
  <div class="line not-executable" id="L1409">
    <div class="line-number"><a href="#L1409">1409</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1410">
    <div class="line-number"><a href="#L1410">1410</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Configure based on options object</div>
  </div>
  <div class="line not-executable" id="L1411">
    <div class="line-number"><a href="#L1411">1411</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local options = {debug = false, verbose = true, other_option = &quot;value&quot;}</div>
  </div>
  <div class="line not-executable" id="L1412">
    <div class="line-number"><a href="#L1412">1412</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local level = logging.configure_from_options(&quot;DataProcessor&quot;, options)</div>
  </div>
  <div class="line not-executable" id="L1413">
    <div class="line-number"><a href="#L1413">1413</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(&quot;Configured log level: &quot; .. level)  -- Will be VERBOSE level</div>
  </div>
  <div class="line not-covered" id="L1414">
    <div class="line-number"><a href="#L1414">1414</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.configure_from_options(module_name, options)</div>
  </div>
  <div class="line not-covered" id="L1415">
    <div class="line-number"><a href="#L1415">1415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local log_level = M.LEVELS.INFO</div>
  </div>
  <div class="line not-covered" id="L1416">
    <div class="line-number"><a href="#L1416">1416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.debug then</div>
  </div>
  <div class="line not-covered" id="L1417">
    <div class="line-number"><a href="#L1417">1417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log_level = M.LEVELS.DEBUG</div>
  </div>
  <div class="line not-covered" id="L1418">
    <div class="line-number"><a href="#L1418">1418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif options.verbose then</div>
  </div>
  <div class="line not-covered" id="L1419">
    <div class="line-number"><a href="#L1419">1419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log_level = M.LEVELS.VERBOSE</div>
  </div>
  <div class="line not-covered" id="L1420">
    <div class="line-number"><a href="#L1420">1420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1421">
    <div class="line-number"><a href="#L1421">1421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  M.set_module_level(module_name, log_level)</div>
  </div>
  <div class="line not-covered" id="L1422">
    <div class="line-number"><a href="#L1422">1422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return log_level</div>
  </div>
  <div class="line not-covered" id="L1423">
    <div class="line-number"><a href="#L1423">1423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1424">
    <div class="line-number"><a href="#L1424">1424</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Configure logging for a module using the global configuration system</div>
  </div>
  <div class="line not-executable" id="L1425">
    <div class="line-number"><a href="#L1425">1425</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function integrates with the central configuration system to apply</div>
  </div>
  <div class="line not-executable" id="L1426">
    <div class="line-number"><a href="#L1426">1426</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging settings from a centralized configuration store. It automatically</div>
  </div>
  <div class="line not-executable" id="L1427">
    <div class="line-number"><a href="#L1427">1427</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- discovers and applies module-specific settings as well as global logging</div>
  </div>
  <div class="line not-executable" id="L1428">
    <div class="line-number"><a href="#L1428">1428</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- preferences.</div>
  </div>
  <div class="line not-executable" id="L1429">
    <div class="line-number"><a href="#L1429">1429</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1430">
    <div class="line-number"><a href="#L1430">1430</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name string The module name to configure</div>
  </div>
  <div class="line not-executable" id="L1431">
    <div class="line-number"><a href="#L1431">1431</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return number The configured log level</div>
  </div>
  <div class="line not-executable" id="L1432">
    <div class="line-number"><a href="#L1432">1432</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1433">
    <div class="line-number"><a href="#L1433">1433</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1434">
    <div class="line-number"><a href="#L1434">1434</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Configure logging for a module from central config</div>
  </div>
  <div class="line not-executable" id="L1435">
    <div class="line-number"><a href="#L1435">1435</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local level = logging.configure_from_config(&quot;Database&quot;)</div>
  </div>
  <div class="line not-executable" id="L1436">
    <div class="line-number"><a href="#L1436">1436</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1437">
    <div class="line-number"><a href="#L1437">1437</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- central_config.json might contain:</div>
  </div>
  <div class="line not-executable" id="L1438">
    <div class="line-number"><a href="#L1438">1438</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- {</div>
  </div>
  <div class="line not-executable" id="L1439">
    <div class="line-number"><a href="#L1439">1439</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --   &quot;logging&quot;: {</div>
  </div>
  <div class="line not-executable" id="L1440">
    <div class="line-number"><a href="#L1440">1440</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --     &quot;level&quot;: &quot;INFO&quot;,</div>
  </div>
  <div class="line not-executable" id="L1441">
    <div class="line-number"><a href="#L1441">1441</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --     &quot;modules&quot;: {</div>
  </div>
  <div class="line not-executable" id="L1442">
    <div class="line-number"><a href="#L1442">1442</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --       &quot;Database&quot;: &quot;DEBUG&quot;</div>
  </div>
  <div class="line not-executable" id="L1443">
    <div class="line-number"><a href="#L1443">1443</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --     },</div>
  </div>
  <div class="line not-executable" id="L1444">
    <div class="line-number"><a href="#L1444">1444</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --     &quot;output_file&quot;: &quot;app.log&quot;,</div>
  </div>
  <div class="line not-executable" id="L1445">
    <div class="line-number"><a href="#L1445">1445</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --     &quot;use_colors&quot;: true</div>
  </div>
  <div class="line not-executable" id="L1446">
    <div class="line-number"><a href="#L1446">1446</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- --   }</div>
  </div>
  <div class="line not-executable" id="L1447">
    <div class="line-number"><a href="#L1447">1447</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- }</div>
  </div>
  <div class="line not-covered" id="L1448">
    <div class="line-number"><a href="#L1448">1448</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.configure_from_config(module_name)</div>
  </div>
  <div class="line not-executable" id="L1449">
    <div class="line-number"><a href="#L1449">1449</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- First try to load the global config</div>
  </div>
  <div class="line not-covered" id="L1450">
    <div class="line-number"><a href="#L1450">1450</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local log_level = M.LEVELS.INFO</div>
  </div>
  <div class="line not-covered" id="L1451">
    <div class="line-number"><a href="#L1451">1451</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local config_obj</div>
  </div>
  <div class="line not-executable" id="L1452">
    <div class="line-number"><a href="#L1452">1452</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1453">
    <div class="line-number"><a href="#L1453">1453</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try to load central_config module and get config</div>
  </div>
  <div class="line not-covered" id="L1454">
    <div class="line-number"><a href="#L1454">1454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local success, central_config = pcall(require, &quot;lib.core.central_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L1455">
    <div class="line-number"><a href="#L1455">1455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if success and central_config then</div>
  </div>
  <div class="line not-covered" id="L1456">
    <div class="line-number"><a href="#L1456">1456</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config_obj = central_config.get()</div>
  </div>
  <div class="line not-executable" id="L1457">
    <div class="line-number"><a href="#L1457">1457</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1458">
    <div class="line-number"><a href="#L1458">1458</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Set log level based on global debug/verbose settings</div>
  </div>
  <div class="line not-covered" id="L1459">
    <div class="line-number"><a href="#L1459">1459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if config_obj and config_obj.debug then</div>
  </div>
  <div class="line not-covered" id="L1460">
    <div class="line-number"><a href="#L1460">1460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log_level = M.LEVELS.DEBUG</div>
  </div>
  <div class="line not-covered" id="L1461">
    <div class="line-number"><a href="#L1461">1461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif config_obj and config_obj.verbose then</div>
  </div>
  <div class="line not-covered" id="L1462">
    <div class="line-number"><a href="#L1462">1462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log_level = M.LEVELS.VERBOSE</div>
  </div>
  <div class="line not-covered" id="L1463">
    <div class="line-number"><a href="#L1463">1463</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L1464">
    <div class="line-number"><a href="#L1464">1464</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L1465">
    <div class="line-number"><a href="#L1465">1465</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check for logging configuration</div>
  </div>
  <div class="line not-covered" id="L1466">
    <div class="line-number"><a href="#L1466">1466</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if config_obj and config_obj.logging then</div>
  </div>
  <div class="line not-executable" id="L1467">
    <div class="line-number"><a href="#L1467">1467</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Global logging configuration</div>
  </div>
  <div class="line not-covered" id="L1468">
    <div class="line-number"><a href="#L1468">1468</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.level then</div>
  </div>
  <div class="line not-covered" id="L1469">
    <div class="line-number"><a href="#L1469">1469</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.global_level = config_obj.logging.level</div>
  </div>
  <div class="line not-covered" id="L1470">
    <div class="line-number"><a href="#L1470">1470</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1471">
    <div class="line-number"><a href="#L1471">1471</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1472">
    <div class="line-number"><a href="#L1472">1472</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Module-specific log levels</div>
  </div>
  <div class="line not-covered" id="L1473">
    <div class="line-number"><a href="#L1473">1473</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.modules and config_obj.logging.modules[module_name] then</div>
  </div>
  <div class="line not-covered" id="L1474">
    <div class="line-number"><a href="#L1474">1474</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log_level = config_obj.logging.modules[module_name]</div>
  </div>
  <div class="line not-covered" id="L1475">
    <div class="line-number"><a href="#L1475">1475</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1476">
    <div class="line-number"><a href="#L1476">1476</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1477">
    <div class="line-number"><a href="#L1477">1477</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Configure logging output options</div>
  </div>
  <div class="line not-covered" id="L1478">
    <div class="line-number"><a href="#L1478">1478</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.output_file then</div>
  </div>
  <div class="line not-covered" id="L1479">
    <div class="line-number"><a href="#L1479">1479</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.output_file = config_obj.logging.output_file</div>
  </div>
  <div class="line not-covered" id="L1480">
    <div class="line-number"><a href="#L1480">1480</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1481">
    <div class="line-number"><a href="#L1481">1481</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1482">
    <div class="line-number"><a href="#L1482">1482</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.log_dir then</div>
  </div>
  <div class="line not-covered" id="L1483">
    <div class="line-number"><a href="#L1483">1483</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.log_dir = config_obj.logging.log_dir</div>
  </div>
  <div class="line not-covered" id="L1484">
    <div class="line-number"><a href="#L1484">1484</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1485">
    <div class="line-number"><a href="#L1485">1485</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1486">
    <div class="line-number"><a href="#L1486">1486</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.timestamps ~= nil then</div>
  </div>
  <div class="line not-covered" id="L1487">
    <div class="line-number"><a href="#L1487">1487</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.timestamps = config_obj.logging.timestamps</div>
  </div>
  <div class="line not-covered" id="L1488">
    <div class="line-number"><a href="#L1488">1488</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1489">
    <div class="line-number"><a href="#L1489">1489</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1490">
    <div class="line-number"><a href="#L1490">1490</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.use_colors ~= nil then</div>
  </div>
  <div class="line not-covered" id="L1491">
    <div class="line-number"><a href="#L1491">1491</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.use_colors = config_obj.logging.use_colors</div>
  </div>
  <div class="line not-covered" id="L1492">
    <div class="line-number"><a href="#L1492">1492</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1493">
    <div class="line-number"><a href="#L1493">1493</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1494">
    <div class="line-number"><a href="#L1494">1494</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Configure log rotation options</div>
  </div>
  <div class="line not-covered" id="L1495">
    <div class="line-number"><a href="#L1495">1495</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.max_file_size then</div>
  </div>
  <div class="line not-covered" id="L1496">
    <div class="line-number"><a href="#L1496">1496</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.max_file_size = config_obj.logging.max_file_size</div>
  </div>
  <div class="line not-covered" id="L1497">
    <div class="line-number"><a href="#L1497">1497</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1498">
    <div class="line-number"><a href="#L1498">1498</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1499">
    <div class="line-number"><a href="#L1499">1499</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.max_log_files then</div>
  </div>
  <div class="line not-covered" id="L1500">
    <div class="line-number"><a href="#L1500">1500</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.max_log_files = config_obj.logging.max_log_files</div>
  </div>
  <div class="line not-covered" id="L1501">
    <div class="line-number"><a href="#L1501">1501</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1502">
    <div class="line-number"><a href="#L1502">1502</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1503">
    <div class="line-number"><a href="#L1503">1503</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.date_pattern then</div>
  </div>
  <div class="line not-covered" id="L1504">
    <div class="line-number"><a href="#L1504">1504</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.date_pattern = config_obj.logging.date_pattern</div>
  </div>
  <div class="line not-covered" id="L1505">
    <div class="line-number"><a href="#L1505">1505</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1506">
    <div class="line-number"><a href="#L1506">1506</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1507">
    <div class="line-number"><a href="#L1507">1507</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- JSON format options</div>
  </div>
  <div class="line not-covered" id="L1508">
    <div class="line-number"><a href="#L1508">1508</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.format then</div>
  </div>
  <div class="line not-covered" id="L1509">
    <div class="line-number"><a href="#L1509">1509</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.format = config_obj.logging.format</div>
  </div>
  <div class="line not-covered" id="L1510">
    <div class="line-number"><a href="#L1510">1510</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1511">
    <div class="line-number"><a href="#L1511">1511</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1512">
    <div class="line-number"><a href="#L1512">1512</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.json_file then</div>
  </div>
  <div class="line not-covered" id="L1513">
    <div class="line-number"><a href="#L1513">1513</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.json_file = config_obj.logging.json_file</div>
  </div>
  <div class="line not-covered" id="L1514">
    <div class="line-number"><a href="#L1514">1514</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1515">
    <div class="line-number"><a href="#L1515">1515</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1516">
    <div class="line-number"><a href="#L1516">1516</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Module filtering options</div>
  </div>
  <div class="line not-covered" id="L1517">
    <div class="line-number"><a href="#L1517">1517</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.module_filter then</div>
  </div>
  <div class="line not-covered" id="L1518">
    <div class="line-number"><a href="#L1518">1518</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.module_filter = config_obj.logging.module_filter</div>
  </div>
  <div class="line not-covered" id="L1519">
    <div class="line-number"><a href="#L1519">1519</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1520">
    <div class="line-number"><a href="#L1520">1520</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-covered" id="L1521">
    <div class="line-number"><a href="#L1521">1521</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config_obj.logging.module_blacklist then</div>
  </div>
  <div class="line not-covered" id="L1522">
    <div class="line-number"><a href="#L1522">1522</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config.module_blacklist = config_obj.logging.module_blacklist</div>
  </div>
  <div class="line not-covered" id="L1523">
    <div class="line-number"><a href="#L1523">1523</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-executable" id="L1524">
    <div class="line-number"><a href="#L1524">1524</a></div>
    <div class="execution-count"></div>    <div class="line-content">      </div>
  </div>
  <div class="line not-executable" id="L1525">
    <div class="line-number"><a href="#L1525">1525</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Ensure log directory exists if output file is configured</div>
  </div>
  <div class="line not-covered" id="L1526">
    <div class="line-number"><a href="#L1526">1526</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if config.output_file or config.json_file then</div>
  </div>
  <div class="line not-covered" id="L1527">
    <div class="line-number"><a href="#L1527">1527</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        ensure_log_dir()</div>
  </div>
  <div class="line not-covered" id="L1528">
    <div class="line-number"><a href="#L1528">1528</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1529">
    <div class="line-number"><a href="#L1529">1529</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1530">
    <div class="line-number"><a href="#L1530">1530</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1531">
    <div class="line-number"><a href="#L1531">1531</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1532">
    <div class="line-number"><a href="#L1532">1532</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Apply the log level</div>
  </div>
  <div class="line not-covered" id="L1533">
    <div class="line-number"><a href="#L1533">1533</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  M.set_module_level(module_name, log_level)</div>
  </div>
  <div class="line not-covered" id="L1534">
    <div class="line-number"><a href="#L1534">1534</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return log_level</div>
  </div>
  <div class="line not-covered" id="L1535">
    <div class="line-number"><a href="#L1535">1535</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1536">
    <div class="line-number"><a href="#L1536">1536</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Add a module pattern to the module filter whitelist</div>
  </div>
  <div class="line not-executable" id="L1537">
    <div class="line-number"><a href="#L1537">1537</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function adds a module name pattern to the filter, which controls</div>
  </div>
  <div class="line not-executable" id="L1538">
    <div class="line-number"><a href="#L1538">1538</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- which modules' logs will be shown. When a filter is active, only logs</div>
  </div>
  <div class="line not-executable" id="L1539">
    <div class="line-number"><a href="#L1539">1539</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- from modules matching the filter will be displayed. This is useful for</div>
  </div>
  <div class="line not-executable" id="L1540">
    <div class="line-number"><a href="#L1540">1540</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- focusing on specific components during debugging.</div>
  </div>
  <div class="line not-executable" id="L1541">
    <div class="line-number"><a href="#L1541">1541</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1542">
    <div class="line-number"><a href="#L1542">1542</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_pattern string The module pattern to add to the filter (supports &quot;*&quot; wildcard suffix)</div>
  </div>
  <div class="line not-executable" id="L1543">
    <div class="line-number"><a href="#L1543">1543</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The logging module for chaining</div>
  </div>
  <div class="line not-executable" id="L1544">
    <div class="line-number"><a href="#L1544">1544</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1545">
    <div class="line-number"><a href="#L1545">1545</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1546">
    <div class="line-number"><a href="#L1546">1546</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Show logs only from the Database module</div>
  </div>
  <div class="line not-executable" id="L1547">
    <div class="line-number"><a href="#L1547">1547</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.filter_module(&quot;Database&quot;)</div>
  </div>
  <div class="line not-executable" id="L1548">
    <div class="line-number"><a href="#L1548">1548</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1549">
    <div class="line-number"><a href="#L1549">1549</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Show logs from all UI-related modules</div>
  </div>
  <div class="line not-executable" id="L1550">
    <div class="line-number"><a href="#L1550">1550</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.filter_module(&quot;UI*&quot;)</div>
  </div>
  <div class="line not-executable" id="L1551">
    <div class="line-number"><a href="#L1551">1551</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1552">
    <div class="line-number"><a href="#L1552">1552</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Add multiple filters</div>
  </div>
  <div class="line not-executable" id="L1553">
    <div class="line-number"><a href="#L1553">1553</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.filter_module(&quot;Network&quot;)</div>
  </div>
  <div class="line not-executable" id="L1554">
    <div class="line-number"><a href="#L1554">1554</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .filter_module(&quot;Security*&quot;)</div>
  </div>
  <div class="line not-covered" id="L1555">
    <div class="line-number"><a href="#L1555">1555</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.filter_module(module_pattern)</div>
  </div>
  <div class="line not-covered" id="L1556">
    <div class="line-number"><a href="#L1556">1556</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not config.module_filter then</div>
  </div>
  <div class="line not-covered" id="L1557">
    <div class="line-number"><a href="#L1557">1557</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.module_filter = {}</div>
  </div>
  <div class="line not-covered" id="L1558">
    <div class="line-number"><a href="#L1558">1558</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1559">
    <div class="line-number"><a href="#L1559">1559</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1560">
    <div class="line-number"><a href="#L1560">1560</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(config.module_filter) == &quot;string&quot; then</div>
  </div>
  <div class="line not-executable" id="L1561">
    <div class="line-number"><a href="#L1561">1561</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Convert to table if currently a string</div>
  </div>
  <div class="line not-covered" id="L1562">
    <div class="line-number"><a href="#L1562">1562</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.module_filter = {config.module_filter}</div>
  </div>
  <div class="line not-covered" id="L1563">
    <div class="line-number"><a href="#L1563">1563</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1564">
    <div class="line-number"><a href="#L1564">1564</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1565">
    <div class="line-number"><a href="#L1565">1565</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add to filter if not already present</div>
  </div>
  <div class="line not-covered" id="L1566">
    <div class="line-number"><a href="#L1566">1566</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, pattern in ipairs(config.module_filter) do</div>
  </div>
  <div class="line not-covered" id="L1567">
    <div class="line-number"><a href="#L1567">1567</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if pattern == module_pattern then</div>
  </div>
  <div class="line not-covered" id="L1568">
    <div class="line-number"><a href="#L1568">1568</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return M -- Already filtered</div>
  </div>
  <div class="line not-covered" id="L1569">
    <div class="line-number"><a href="#L1569">1569</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1570">
    <div class="line-number"><a href="#L1570">1570</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1571">
    <div class="line-number"><a href="#L1571">1571</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1572">
    <div class="line-number"><a href="#L1572">1572</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(config.module_filter, module_pattern)</div>
  </div>
  <div class="line not-covered" id="L1573">
    <div class="line-number"><a href="#L1573">1573</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1574">
    <div class="line-number"><a href="#L1574">1574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1575">
    <div class="line-number"><a href="#L1575">1575</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Clear all module filters, allowing logs from all modules to be shown</div>
  </div>
  <div class="line not-executable" id="L1576">
    <div class="line-number"><a href="#L1576">1576</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function removes any previously set module filters, effectively</div>
  </div>
  <div class="line not-executable" id="L1577">
    <div class="line-number"><a href="#L1577">1577</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- enabling logs from all modules (subject to log level and blacklist settings).</div>
  </div>
  <div class="line not-executable" id="L1578">
    <div class="line-number"><a href="#L1578">1578</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1579">
    <div class="line-number"><a href="#L1579">1579</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The logging module for chaining</div>
  </div>
  <div class="line not-executable" id="L1580">
    <div class="line-number"><a href="#L1580">1580</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1581">
    <div class="line-number"><a href="#L1581">1581</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1582">
    <div class="line-number"><a href="#L1582">1582</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- First filter to specific modules</div>
  </div>
  <div class="line not-executable" id="L1583">
    <div class="line-number"><a href="#L1583">1583</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.filter_module(&quot;Database&quot;).filter_module(&quot;Auth&quot;)</div>
  </div>
  <div class="line not-executable" id="L1584">
    <div class="line-number"><a href="#L1584">1584</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1585">
    <div class="line-number"><a href="#L1585">1585</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Later, remove all filters to see all modules again</div>
  </div>
  <div class="line not-executable" id="L1586">
    <div class="line-number"><a href="#L1586">1586</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.clear_module_filters()</div>
  </div>
  <div class="line not-covered" id="L1587">
    <div class="line-number"><a href="#L1587">1587</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.clear_module_filters()</div>
  </div>
  <div class="line not-covered" id="L1588">
    <div class="line-number"><a href="#L1588">1588</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.module_filter = nil</div>
  </div>
  <div class="line not-covered" id="L1589">
    <div class="line-number"><a href="#L1589">1589</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1590">
    <div class="line-number"><a href="#L1590">1590</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1591">
    <div class="line-number"><a href="#L1591">1591</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Add a module pattern to the blacklist to prevent its logs from being shown</div>
  </div>
  <div class="line not-executable" id="L1592">
    <div class="line-number"><a href="#L1592">1592</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- The blacklist takes precedence over the whitelist filter. Modules matching</div>
  </div>
  <div class="line not-executable" id="L1593">
    <div class="line-number"><a href="#L1593">1593</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- any pattern in the blacklist will never log, regardless of log level or</div>
  </div>
  <div class="line not-executable" id="L1594">
    <div class="line-number"><a href="#L1594">1594</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- filter settings. This is useful for suppressing noisy modules.</div>
  </div>
  <div class="line not-executable" id="L1595">
    <div class="line-number"><a href="#L1595">1595</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1596">
    <div class="line-number"><a href="#L1596">1596</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_pattern string The module pattern to blacklist (supports &quot;*&quot; wildcard suffix)</div>
  </div>
  <div class="line not-executable" id="L1597">
    <div class="line-number"><a href="#L1597">1597</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The logging module for chaining</div>
  </div>
  <div class="line not-executable" id="L1598">
    <div class="line-number"><a href="#L1598">1598</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1599">
    <div class="line-number"><a href="#L1599">1599</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1600">
    <div class="line-number"><a href="#L1600">1600</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Prevent logs from a noisy HTTP client module</div>
  </div>
  <div class="line not-executable" id="L1601">
    <div class="line-number"><a href="#L1601">1601</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.blacklist_module(&quot;HTTPClient&quot;)</div>
  </div>
  <div class="line not-executable" id="L1602">
    <div class="line-number"><a href="#L1602">1602</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1603">
    <div class="line-number"><a href="#L1603">1603</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Silence all analytics-related modules</div>
  </div>
  <div class="line not-executable" id="L1604">
    <div class="line-number"><a href="#L1604">1604</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.blacklist_module(&quot;Analytics*&quot;)</div>
  </div>
  <div class="line not-covered" id="L1605">
    <div class="line-number"><a href="#L1605">1605</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.blacklist_module(module_pattern)</div>
  </div>
  <div class="line not-executable" id="L1606">
    <div class="line-number"><a href="#L1606">1606</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Make sure module_blacklist is initialized</div>
  </div>
  <div class="line not-covered" id="L1607">
    <div class="line-number"><a href="#L1607">1607</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not config.module_blacklist then</div>
  </div>
  <div class="line not-covered" id="L1608">
    <div class="line-number"><a href="#L1608">1608</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    config.module_blacklist = {}</div>
  </div>
  <div class="line not-covered" id="L1609">
    <div class="line-number"><a href="#L1609">1609</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1610">
    <div class="line-number"><a href="#L1610">1610</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1611">
    <div class="line-number"><a href="#L1611">1611</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add to blacklist if not already present</div>
  </div>
  <div class="line not-covered" id="L1612">
    <div class="line-number"><a href="#L1612">1612</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for _, pattern in ipairs(config.module_blacklist) do</div>
  </div>
  <div class="line not-covered" id="L1613">
    <div class="line-number"><a href="#L1613">1613</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if pattern == module_pattern then</div>
  </div>
  <div class="line not-covered" id="L1614">
    <div class="line-number"><a href="#L1614">1614</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return M -- Already blacklisted</div>
  </div>
  <div class="line not-covered" id="L1615">
    <div class="line-number"><a href="#L1615">1615</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1616">
    <div class="line-number"><a href="#L1616">1616</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1617">
    <div class="line-number"><a href="#L1617">1617</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1618">
    <div class="line-number"><a href="#L1618">1618</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(config.module_blacklist, module_pattern)</div>
  </div>
  <div class="line not-covered" id="L1619">
    <div class="line-number"><a href="#L1619">1619</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1620">
    <div class="line-number"><a href="#L1620">1620</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1621">
    <div class="line-number"><a href="#L1621">1621</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Remove a module pattern from the blacklist, allowing its logs to be shown again</div>
  </div>
  <div class="line not-executable" id="L1622">
    <div class="line-number"><a href="#L1622">1622</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function removes a specific pattern from the blacklist. If the pattern</div>
  </div>
  <div class="line not-executable" id="L1623">
    <div class="line-number"><a href="#L1623">1623</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- was previously added with blacklist_module(), it will be removed and logs</div>
  </div>
  <div class="line not-executable" id="L1624">
    <div class="line-number"><a href="#L1624">1624</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- from matching modules will be shown again (subject to normal filtering rules).</div>
  </div>
  <div class="line not-executable" id="L1625">
    <div class="line-number"><a href="#L1625">1625</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1626">
    <div class="line-number"><a href="#L1626">1626</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_pattern string The module pattern to remove from the blacklist</div>
  </div>
  <div class="line not-executable" id="L1627">
    <div class="line-number"><a href="#L1627">1627</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The logging module for chaining</div>
  </div>
  <div class="line not-executable" id="L1628">
    <div class="line-number"><a href="#L1628">1628</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1629">
    <div class="line-number"><a href="#L1629">1629</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1630">
    <div class="line-number"><a href="#L1630">1630</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- First blacklist a module</div>
  </div>
  <div class="line not-executable" id="L1631">
    <div class="line-number"><a href="#L1631">1631</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.blacklist_module(&quot;Metrics&quot;)</div>
  </div>
  <div class="line not-executable" id="L1632">
    <div class="line-number"><a href="#L1632">1632</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1633">
    <div class="line-number"><a href="#L1633">1633</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Later, remove it from the blacklist when you need to see its logs</div>
  </div>
  <div class="line not-executable" id="L1634">
    <div class="line-number"><a href="#L1634">1634</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.remove_from_blacklist(&quot;Metrics&quot;)</div>
  </div>
  <div class="line not-covered" id="L1635">
    <div class="line-number"><a href="#L1635">1635</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.remove_from_blacklist(module_pattern)</div>
  </div>
  <div class="line not-covered" id="L1636">
    <div class="line-number"><a href="#L1636">1636</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.module_blacklist then</div>
  </div>
  <div class="line not-covered" id="L1637">
    <div class="line-number"><a href="#L1637">1637</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for i, pattern in ipairs(config.module_blacklist) do</div>
  </div>
  <div class="line not-covered" id="L1638">
    <div class="line-number"><a href="#L1638">1638</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if pattern == module_pattern then</div>
  </div>
  <div class="line not-covered" id="L1639">
    <div class="line-number"><a href="#L1639">1639</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        table.remove(config.module_blacklist, i)</div>
  </div>
  <div class="line not-covered" id="L1640">
    <div class="line-number"><a href="#L1640">1640</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        return M</div>
  </div>
  <div class="line not-covered" id="L1641">
    <div class="line-number"><a href="#L1641">1641</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L1642">
    <div class="line-number"><a href="#L1642">1642</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L1643">
    <div class="line-number"><a href="#L1643">1643</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1644">
    <div class="line-number"><a href="#L1644">1644</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1645">
    <div class="line-number"><a href="#L1645">1645</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1646">
    <div class="line-number"><a href="#L1646">1646</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Clear all module blacklist entries, allowing all modules to log again</div>
  </div>
  <div class="line not-executable" id="L1647">
    <div class="line-number"><a href="#L1647">1647</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function removes all patterns from the blacklist, effectively enabling</div>
  </div>
  <div class="line not-executable" id="L1648">
    <div class="line-number"><a href="#L1648">1648</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logs from all previously blacklisted modules (subject to normal filter and</div>
  </div>
  <div class="line not-executable" id="L1649">
    <div class="line-number"><a href="#L1649">1649</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- log level settings).</div>
  </div>
  <div class="line not-executable" id="L1650">
    <div class="line-number"><a href="#L1650">1650</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1651">
    <div class="line-number"><a href="#L1651">1651</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The logging module for chaining</div>
  </div>
  <div class="line not-executable" id="L1652">
    <div class="line-number"><a href="#L1652">1652</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1653">
    <div class="line-number"><a href="#L1653">1653</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1654">
    <div class="line-number"><a href="#L1654">1654</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Set up multiple blacklist entries</div>
  </div>
  <div class="line not-executable" id="L1655">
    <div class="line-number"><a href="#L1655">1655</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.blacklist_module(&quot;Metrics&quot;)</div>
  </div>
  <div class="line not-executable" id="L1656">
    <div class="line-number"><a href="#L1656">1656</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .blacklist_module(&quot;Statistics*&quot;)</div>
  </div>
  <div class="line not-executable" id="L1657">
    <div class="line-number"><a href="#L1657">1657</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   .blacklist_module(&quot;Analytics&quot;)</div>
  </div>
  <div class="line not-executable" id="L1658">
    <div class="line-number"><a href="#L1658">1658</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1659">
    <div class="line-number"><a href="#L1659">1659</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Later, clear the entire blacklist when you need to see everything</div>
  </div>
  <div class="line not-executable" id="L1660">
    <div class="line-number"><a href="#L1660">1660</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.clear_blacklist()</div>
  </div>
  <div class="line not-covered" id="L1661">
    <div class="line-number"><a href="#L1661">1661</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.clear_blacklist()</div>
  </div>
  <div class="line not-covered" id="L1662">
    <div class="line-number"><a href="#L1662">1662</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.module_blacklist = {}</div>
  </div>
  <div class="line not-covered" id="L1663">
    <div class="line-number"><a href="#L1663">1663</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L1664">
    <div class="line-number"><a href="#L1664">1664</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1665">
    <div class="line-number"><a href="#L1665">1665</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the current logging configuration for debugging or diagnostics</div>
  </div>
  <div class="line not-executable" id="L1666">
    <div class="line-number"><a href="#L1666">1666</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function returns a copy of the current logging configuration,</div>
  </div>
  <div class="line not-executable" id="L1667">
    <div class="line-number"><a href="#L1667">1667</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- allowing inspection of all settings in effect. This is useful for</div>
  </div>
  <div class="line not-executable" id="L1668">
    <div class="line-number"><a href="#L1668">1668</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- diagnosing logging behavior or understanding the current system state.</div>
  </div>
  <div class="line not-executable" id="L1669">
    <div class="line-number"><a href="#L1669">1669</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1670">
    <div class="line-number"><a href="#L1670">1670</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table A copy of the current configuration settings</div>
  </div>
  <div class="line not-executable" id="L1671">
    <div class="line-number"><a href="#L1671">1671</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1672">
    <div class="line-number"><a href="#L1672">1672</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1673">
    <div class="line-number"><a href="#L1673">1673</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check current logging configuration</div>
  </div>
  <div class="line not-executable" id="L1674">
    <div class="line-number"><a href="#L1674">1674</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local config = logging.get_config()</div>
  </div>
  <div class="line not-executable" id="L1675">
    <div class="line-number"><a href="#L1675">1675</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(&quot;Current log level: &quot; .. config.global_level)</div>
  </div>
  <div class="line not-executable" id="L1676">
    <div class="line-number"><a href="#L1676">1676</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- print(&quot;Log to file: &quot; .. (config.output_file or &quot;disabled&quot;))</div>
  </div>
  <div class="line not-executable" id="L1677">
    <div class="line-number"><a href="#L1677">1677</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1678">
    <div class="line-number"><a href="#L1678">1678</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Check module-specific settings</div>
  </div>
  <div class="line not-executable" id="L1679">
    <div class="line-number"><a href="#L1679">1679</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for module, level in pairs(config.module_levels) do</div>
  </div>
  <div class="line not-executable" id="L1680">
    <div class="line-number"><a href="#L1680">1680</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Module &quot; .. module .. &quot; level: &quot; .. level)</div>
  </div>
  <div class="line not-executable" id="L1681">
    <div class="line-number"><a href="#L1681">1681</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1682">
    <div class="line-number"><a href="#L1682">1682</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_config()</div>
  </div>
  <div class="line not-executable" id="L1683">
    <div class="line-number"><a href="#L1683">1683</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return a copy to prevent modification</div>
  </div>
  <div class="line not-covered" id="L1684">
    <div class="line-number"><a href="#L1684">1684</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local copy = {}</div>
  </div>
  <div class="line not-covered" id="L1685">
    <div class="line-number"><a href="#L1685">1685</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  for k, v in pairs(config) do</div>
  </div>
  <div class="line not-covered" id="L1686">
    <div class="line-number"><a href="#L1686">1686</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    copy[k] = v</div>
  </div>
  <div class="line not-covered" id="L1687">
    <div class="line-number"><a href="#L1687">1687</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1688">
    <div class="line-number"><a href="#L1688">1688</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return copy</div>
  </div>
  <div class="line not-covered" id="L1689">
    <div class="line-number"><a href="#L1689">1689</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1690">
    <div class="line-number"><a href="#L1690">1690</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Log a debug message (compatibility with existing code)</div>
  </div>
  <div class="line not-executable" id="L1691">
    <div class="line-number"><a href="#L1691">1691</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This is a legacy compatibility function for code that uses the older</div>
  </div>
  <div class="line not-executable" id="L1692">
    <div class="line-number"><a href="#L1692">1692</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- log_debug() pattern instead of the current debug() pattern.</div>
  </div>
  <div class="line not-executable" id="L1693">
    <div class="line-number"><a href="#L1693">1693</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1694">
    <div class="line-number"><a href="#L1694">1694</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1695">
    <div class="line-number"><a href="#L1695">1695</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name? string The optional module name</div>
  </div>
  <div class="line not-executable" id="L1696">
    <div class="line-number"><a href="#L1696">1696</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-executable" id="L1697">
    <div class="line-number"><a href="#L1697">1697</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1698">
    <div class="line-number"><a href="#L1698">1698</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1699">
    <div class="line-number"><a href="#L1699">1699</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Old style logging with module name</div>
  </div>
  <div class="line not-executable" id="L1700">
    <div class="line-number"><a href="#L1700">1700</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.log_debug(&quot;Initializing component&quot;, &quot;Startup&quot;)</div>
  </div>
  <div class="line not-covered" id="L1701">
    <div class="line-number"><a href="#L1701">1701</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.log_debug(message, module_name)</div>
  </div>
  <div class="line not-covered" id="L1702">
    <div class="line-number"><a href="#L1702">1702</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(M.LEVELS.DEBUG, module_name, message)</div>
  </div>
  <div class="line not-covered" id="L1703">
    <div class="line-number"><a href="#L1703">1703</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1704">
    <div class="line-number"><a href="#L1704">1704</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Log a verbose message (compatibility with existing code)</div>
  </div>
  <div class="line not-executable" id="L1705">
    <div class="line-number"><a href="#L1705">1705</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This is a legacy compatibility function for code that uses the older</div>
  </div>
  <div class="line not-executable" id="L1706">
    <div class="line-number"><a href="#L1706">1706</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- log_verbose() pattern instead of the current verbose() pattern.</div>
  </div>
  <div class="line not-executable" id="L1707">
    <div class="line-number"><a href="#L1707">1707</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1708">
    <div class="line-number"><a href="#L1708">1708</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The message to log</div>
  </div>
  <div class="line not-executable" id="L1709">
    <div class="line-number"><a href="#L1709">1709</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name? string The optional module name</div>
  </div>
  <div class="line not-executable" id="L1710">
    <div class="line-number"><a href="#L1710">1710</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean Whether the message was logged</div>
  </div>
  <div class="line not-executable" id="L1711">
    <div class="line-number"><a href="#L1711">1711</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1712">
    <div class="line-number"><a href="#L1712">1712</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1713">
    <div class="line-number"><a href="#L1713">1713</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Old style verbose logging</div>
  </div>
  <div class="line not-executable" id="L1714">
    <div class="line-number"><a href="#L1714">1714</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.log_verbose(&quot;Processing item 42&quot;, &quot;DataProcessor&quot;)</div>
  </div>
  <div class="line not-covered" id="L1715">
    <div class="line-number"><a href="#L1715">1715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.log_verbose(message, module_name)</div>
  </div>
  <div class="line not-covered" id="L1716">
    <div class="line-number"><a href="#L1716">1716</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log(M.LEVELS.VERBOSE, module_name, message)</div>
  </div>
  <div class="line not-covered" id="L1717">
    <div class="line-number"><a href="#L1717">1717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1718">
    <div class="line-number"><a href="#L1718">1718</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the log search module for searching logs</div>
  </div>
  <div class="line not-executable" id="L1719">
    <div class="line-number"><a href="#L1719">1719</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function provides access to the log search functionality, allowing</div>
  </div>
  <div class="line not-executable" id="L1720">
    <div class="line-number"><a href="#L1720">1720</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- historical logs to be searched and analyzed. The search module provides</div>
  </div>
  <div class="line not-executable" id="L1721">
    <div class="line-number"><a href="#L1721">1721</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- pattern-based, level-based, and time-based search capabilities.</div>
  </div>
  <div class="line not-executable" id="L1722">
    <div class="line-number"><a href="#L1722">1722</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1723">
    <div class="line-number"><a href="#L1723">1723</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The log search module interface</div>
  </div>
  <div class="line not-executable" id="L1724">
    <div class="line-number"><a href="#L1724">1724</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @error If the search module couldn't be loaded</div>
  </div>
  <div class="line not-executable" id="L1725">
    <div class="line-number"><a href="#L1725">1725</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1726">
    <div class="line-number"><a href="#L1726">1726</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1727">
    <div class="line-number"><a href="#L1727">1727</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Search for all error logs containing &quot;database&quot;</div>
  </div>
  <div class="line not-executable" id="L1728">
    <div class="line-number"><a href="#L1728">1728</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local search = logging.search()</div>
  </div>
  <div class="line not-executable" id="L1729">
    <div class="line-number"><a href="#L1729">1729</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local results = search.find(&quot;database&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1730">
    <div class="line-number"><a href="#L1730">1730</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   level = logging.ERROR,</div>
  </div>
  <div class="line not-executable" id="L1731">
    <div class="line-number"><a href="#L1731">1731</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   case_sensitive = false,</div>
  </div>
  <div class="line not-executable" id="L1732">
    <div class="line-number"><a href="#L1732">1732</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   max_results = 100</div>
  </div>
  <div class="line not-executable" id="L1733">
    <div class="line-number"><a href="#L1733">1733</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-executable" id="L1734">
    <div class="line-number"><a href="#L1734">1734</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1735">
    <div class="line-number"><a href="#L1735">1735</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Process search results</div>
  </div>
  <div class="line not-executable" id="L1736">
    <div class="line-number"><a href="#L1736">1736</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- for _, entry in ipairs(results) do</div>
  </div>
  <div class="line not-executable" id="L1737">
    <div class="line-number"><a href="#L1737">1737</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(entry.timestamp, entry.module, entry.message)</div>
  </div>
  <div class="line not-executable" id="L1738">
    <div class="line-number"><a href="#L1738">1738</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L1739">
    <div class="line-number"><a href="#L1739">1739</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.search()</div>
  </div>
  <div class="line not-covered" id="L1740">
    <div class="line-number"><a href="#L1740">1740</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local search = get_search()</div>
  </div>
  <div class="line not-covered" id="L1741">
    <div class="line-number"><a href="#L1741">1741</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not search then</div>
  </div>
  <div class="line not-covered" id="L1742">
    <div class="line-number"><a href="#L1742">1742</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error(&quot;Log search module not available&quot;)</div>
  </div>
  <div class="line not-covered" id="L1743">
    <div class="line-number"><a href="#L1743">1743</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1744">
    <div class="line-number"><a href="#L1744">1744</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return search</div>
  </div>
  <div class="line not-covered" id="L1745">
    <div class="line-number"><a href="#L1745">1745</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1746">
    <div class="line-number"><a href="#L1746">1746</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the log export module for exporting logs to different formats</div>
  </div>
  <div class="line not-executable" id="L1747">
    <div class="line-number"><a href="#L1747">1747</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function provides access to the log export functionality, which can</div>
  </div>
  <div class="line not-executable" id="L1748">
    <div class="line-number"><a href="#L1748">1748</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- convert logs to various formats like CSV, JSON, or custom formats for</div>
  </div>
  <div class="line not-executable" id="L1749">
    <div class="line-number"><a href="#L1749">1749</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- integration with external systems.</div>
  </div>
  <div class="line not-executable" id="L1750">
    <div class="line-number"><a href="#L1750">1750</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1751">
    <div class="line-number"><a href="#L1751">1751</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The log export module interface</div>
  </div>
  <div class="line not-executable" id="L1752">
    <div class="line-number"><a href="#L1752">1752</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @error If the export module couldn't be loaded</div>
  </div>
  <div class="line not-executable" id="L1753">
    <div class="line-number"><a href="#L1753">1753</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1754">
    <div class="line-number"><a href="#L1754">1754</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1755">
    <div class="line-number"><a href="#L1755">1755</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Export today's logs to CSV</div>
  </div>
  <div class="line not-executable" id="L1756">
    <div class="line-number"><a href="#L1756">1756</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local export = logging.export()</div>
  </div>
  <div class="line not-executable" id="L1757">
    <div class="line-number"><a href="#L1757">1757</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local csv_content = export.to_csv({</div>
  </div>
  <div class="line not-executable" id="L1758">
    <div class="line-number"><a href="#L1758">1758</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   start_time = os.time() - 86400,  -- Last 24 hours</div>
  </div>
  <div class="line not-executable" id="L1759">
    <div class="line-number"><a href="#L1759">1759</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   end_time = os.time(),</div>
  </div>
  <div class="line not-executable" id="L1760">
    <div class="line-number"><a href="#L1760">1760</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   fields = {&quot;timestamp&quot;, &quot;level&quot;, &quot;module&quot;, &quot;message&quot;}</div>
  </div>
  <div class="line not-executable" id="L1761">
    <div class="line-number"><a href="#L1761">1761</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-executable" id="L1762">
    <div class="line-number"><a href="#L1762">1762</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1763">
    <div class="line-number"><a href="#L1763">1763</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Save to file</div>
  </div>
  <div class="line not-executable" id="L1764">
    <div class="line-number"><a href="#L1764">1764</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local file = io.open(&quot;logs_export.csv&quot;, &quot;w&quot;)</div>
  </div>
  <div class="line not-executable" id="L1765">
    <div class="line-number"><a href="#L1765">1765</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- file:write(csv_content)</div>
  </div>
  <div class="line not-executable" id="L1766">
    <div class="line-number"><a href="#L1766">1766</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- file:close()</div>
  </div>
  <div class="line not-covered" id="L1767">
    <div class="line-number"><a href="#L1767">1767</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.export()</div>
  </div>
  <div class="line not-covered" id="L1768">
    <div class="line-number"><a href="#L1768">1768</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local export = get_export()</div>
  </div>
  <div class="line not-covered" id="L1769">
    <div class="line-number"><a href="#L1769">1769</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not export then</div>
  </div>
  <div class="line not-covered" id="L1770">
    <div class="line-number"><a href="#L1770">1770</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error(&quot;Log export module not available&quot;)</div>
  </div>
  <div class="line not-covered" id="L1771">
    <div class="line-number"><a href="#L1771">1771</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1772">
    <div class="line-number"><a href="#L1772">1772</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return export</div>
  </div>
  <div class="line not-covered" id="L1773">
    <div class="line-number"><a href="#L1773">1773</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1774">
    <div class="line-number"><a href="#L1774">1774</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the formatter integration module for custom log formatting</div>
  </div>
  <div class="line not-executable" id="L1775">
    <div class="line-number"><a href="#L1775">1775</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function provides access to the formatter integration functionality,</div>
  </div>
  <div class="line not-executable" id="L1776">
    <div class="line-number"><a href="#L1776">1776</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- which allows custom log formatting patterns and output styles to be defined</div>
  </div>
  <div class="line not-executable" id="L1777">
    <div class="line-number"><a href="#L1777">1777</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- and used with the logging system.</div>
  </div>
  <div class="line not-executable" id="L1778">
    <div class="line-number"><a href="#L1778">1778</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1779">
    <div class="line-number"><a href="#L1779">1779</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The formatter integration module interface</div>
  </div>
  <div class="line not-executable" id="L1780">
    <div class="line-number"><a href="#L1780">1780</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @error If the formatter integration module couldn't be loaded</div>
  </div>
  <div class="line not-executable" id="L1781">
    <div class="line-number"><a href="#L1781">1781</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1782">
    <div class="line-number"><a href="#L1782">1782</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1783">
    <div class="line-number"><a href="#L1783">1783</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Register a custom formatter</div>
  </div>
  <div class="line not-executable" id="L1784">
    <div class="line-number"><a href="#L1784">1784</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local fi = logging.formatter_integration()</div>
  </div>
  <div class="line not-executable" id="L1785">
    <div class="line-number"><a href="#L1785">1785</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- fi.register(&quot;compact&quot;, function(entry)</div>
  </div>
  <div class="line not-executable" id="L1786">
    <div class="line-number"><a href="#L1786">1786</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return string.format(</div>
  </div>
  <div class="line not-executable" id="L1787">
    <div class="line-number"><a href="#L1787">1787</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     &quot;%s|%s|%s|%s&quot;,</div>
  </div>
  <div class="line not-executable" id="L1788">
    <div class="line-number"><a href="#L1788">1788</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     entry.timestamp:sub(12),  -- Just the time part</div>
  </div>
  <div class="line not-executable" id="L1789">
    <div class="line-number"><a href="#L1789">1789</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     entry.level:sub(1,1),     -- First letter of level (E, W, I, D)</div>
  </div>
  <div class="line not-executable" id="L1790">
    <div class="line-number"><a href="#L1790">1790</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     entry.module or &quot;-&quot;,</div>
  </div>
  <div class="line not-executable" id="L1791">
    <div class="line-number"><a href="#L1791">1791</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     entry.message</div>
  </div>
  <div class="line not-executable" id="L1792">
    <div class="line-number"><a href="#L1792">1792</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   )</div>
  </div>
  <div class="line not-executable" id="L1793">
    <div class="line-number"><a href="#L1793">1793</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L1794">
    <div class="line-number"><a href="#L1794">1794</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1795">
    <div class="line-number"><a href="#L1795">1795</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Configure logging to use the custom formatter</div>
  </div>
  <div class="line not-executable" id="L1796">
    <div class="line-number"><a href="#L1796">1796</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- logging.configure({</div>
  </div>
  <div class="line not-executable" id="L1797">
    <div class="line-number"><a href="#L1797">1797</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   format = &quot;compact&quot;</div>
  </div>
  <div class="line not-executable" id="L1798">
    <div class="line-number"><a href="#L1798">1798</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-covered" id="L1799">
    <div class="line-number"><a href="#L1799">1799</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.formatter_integration()</div>
  </div>
  <div class="line not-covered" id="L1800">
    <div class="line-number"><a href="#L1800">1800</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local formatter_integration = get_formatter_integration()</div>
  </div>
  <div class="line not-covered" id="L1801">
    <div class="line-number"><a href="#L1801">1801</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not formatter_integration then</div>
  </div>
  <div class="line not-covered" id="L1802">
    <div class="line-number"><a href="#L1802">1802</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error(&quot;Formatter integration module not available&quot;)</div>
  </div>
  <div class="line not-covered" id="L1803">
    <div class="line-number"><a href="#L1803">1803</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1804">
    <div class="line-number"><a href="#L1804">1804</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return formatter_integration</div>
  </div>
  <div class="line not-covered" id="L1805">
    <div class="line-number"><a href="#L1805">1805</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L1806">
    <div class="line-number"><a href="#L1806">1806</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a buffered logger for high-volume logging scenarios</div>
  </div>
  <div class="line not-executable" id="L1807">
    <div class="line-number"><a href="#L1807">1807</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This function creates a specialized logger instance that buffers log messages</div>
  </div>
  <div class="line not-executable" id="L1808">
    <div class="line-number"><a href="#L1808">1808</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- in memory and flushes them to disk periodically or when the buffer fills up.</div>
  </div>
  <div class="line not-executable" id="L1809">
    <div class="line-number"><a href="#L1809">1809</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This is useful for high-throughput logging scenarios where individual disk I/O</div>
  </div>
  <div class="line not-executable" id="L1810">
    <div class="line-number"><a href="#L1810">1810</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- operations for each log message would be too expensive.</div>
  </div>
  <div class="line not-executable" id="L1811">
    <div class="line-number"><a href="#L1811">1811</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1812">
    <div class="line-number"><a href="#L1812">1812</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param module_name string The module name for the logger</div>
  </div>
  <div class="line not-executable" id="L1813">
    <div class="line-number"><a href="#L1813">1813</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param options? {buffer_size?: number, flush_interval?: number, output_file?: string} Options for the buffered logger</div>
  </div>
  <div class="line not-executable" id="L1814">
    <div class="line-number"><a href="#L1814">1814</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return logger_instance The buffered logger instance with flush capability</div>
  </div>
  <div class="line not-executable" id="L1815">
    <div class="line-number"><a href="#L1815">1815</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1816">
    <div class="line-number"><a href="#L1816">1816</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L1817">
    <div class="line-number"><a href="#L1817">1817</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Create a buffered logger for high-volume metrics</div>
  </div>
  <div class="line not-executable" id="L1818">
    <div class="line-number"><a href="#L1818">1818</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local metrics_logger = logging.create_buffered_logger(&quot;Metrics&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1819">
    <div class="line-number"><a href="#L1819">1819</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   buffer_size = 1000,       -- Buffer up to 1000 messages</div>
  </div>
  <div class="line not-executable" id="L1820">
    <div class="line-number"><a href="#L1820">1820</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   flush_interval = 10,      -- Flush every 10 seconds</div>
  </div>
  <div class="line not-executable" id="L1821">
    <div class="line-number"><a href="#L1821">1821</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   output_file = &quot;metrics.log&quot;  -- Write to specific file</div>
  </div>
  <div class="line not-executable" id="L1822">
    <div class="line-number"><a href="#L1822">1822</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-executable" id="L1823">
    <div class="line-number"><a href="#L1823">1823</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1824">
    <div class="line-number"><a href="#L1824">1824</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Use like a normal logger</div>
  </div>
  <div class="line not-executable" id="L1825">
    <div class="line-number"><a href="#L1825">1825</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- metrics_logger.info(&quot;Request processed&quot;, {</div>
  </div>
  <div class="line not-executable" id="L1826">
    <div class="line-number"><a href="#L1826">1826</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   duration_ms = 42,</div>
  </div>
  <div class="line not-executable" id="L1827">
    <div class="line-number"><a href="#L1827">1827</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   endpoint = &quot;/api/data&quot;,</div>
  </div>
  <div class="line not-executable" id="L1828">
    <div class="line-number"><a href="#L1828">1828</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   status = 200</div>
  </div>
  <div class="line not-executable" id="L1829">
    <div class="line-number"><a href="#L1829">1829</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- })</div>
  </div>
  <div class="line not-executable" id="L1830">
    <div class="line-number"><a href="#L1830">1830</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L1831">
    <div class="line-number"><a href="#L1831">1831</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Force an immediate flush when needed</div>
  </div>
  <div class="line not-executable" id="L1832">
    <div class="line-number"><a href="#L1832">1832</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- metrics_logger.flush()</div>
  </div>
  <div class="line not-covered" id="L1833">
    <div class="line-number"><a href="#L1833">1833</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.create_buffered_logger(module_name, options)</div>
  </div>
  <div class="line not-covered" id="L1834">
    <div class="line-number"><a href="#L1834">1834</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  options = options or {}</div>
  </div>
  <div class="line not-executable" id="L1835">
    <div class="line-number"><a href="#L1835">1835</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1836">
    <div class="line-number"><a href="#L1836">1836</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Apply buffering configuration</div>
  </div>
  <div class="line not-covered" id="L1837">
    <div class="line-number"><a href="#L1837">1837</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local buffer_size = options.buffer_size or 100</div>
  </div>
  <div class="line not-covered" id="L1838">
    <div class="line-number"><a href="#L1838">1838</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local flush_interval = options.flush_interval or 5 -- seconds</div>
  </div>
  <div class="line not-executable" id="L1839">
    <div class="line-number"><a href="#L1839">1839</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1840">
    <div class="line-number"><a href="#L1840">1840</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Configure a buffered logger</div>
  </div>
  <div class="line not-covered" id="L1841">
    <div class="line-number"><a href="#L1841">1841</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local buffered_config = {</div>
  </div>
  <div class="line not-covered" id="L1842">
    <div class="line-number"><a href="#L1842">1842</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    buffer_size = buffer_size,</div>
  </div>
  <div class="line not-covered" id="L1843">
    <div class="line-number"><a href="#L1843">1843</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    buffer_flush_interval = flush_interval</div>
  </div>
  <div class="line not-covered" id="L1844">
    <div class="line-number"><a href="#L1844">1844</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L1845">
    <div class="line-number"><a href="#L1845">1845</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1846">
    <div class="line-number"><a href="#L1846">1846</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- If output_file specified, use it</div>
  </div>
  <div class="line not-covered" id="L1847">
    <div class="line-number"><a href="#L1847">1847</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options.output_file then</div>
  </div>
  <div class="line not-covered" id="L1848">
    <div class="line-number"><a href="#L1848">1848</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    buffered_config.output_file = options.output_file</div>
  </div>
  <div class="line not-covered" id="L1849">
    <div class="line-number"><a href="#L1849">1849</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1850">
    <div class="line-number"><a href="#L1850">1850</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1851">
    <div class="line-number"><a href="#L1851">1851</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Apply the configuration</div>
  </div>
  <div class="line not-covered" id="L1852">
    <div class="line-number"><a href="#L1852">1852</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  M.configure(buffered_config)</div>
  </div>
  <div class="line not-executable" id="L1853">
    <div class="line-number"><a href="#L1853">1853</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1854">
    <div class="line-number"><a href="#L1854">1854</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a logger with the specified module name</div>
  </div>
  <div class="line not-covered" id="L1855">
    <div class="line-number"><a href="#L1855">1855</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local logger = M.get_logger(module_name)</div>
  </div>
  <div class="line not-executable" id="L1856">
    <div class="line-number"><a href="#L1856">1856</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1857">
    <div class="line-number"><a href="#L1857">1857</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add flush method to this logger instance</div>
  </div>
  <div class="line not-covered" id="L1858">
    <div class="line-number"><a href="#L1858">1858</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  logger.flush = function()</div>
  </div>
  <div class="line not-covered" id="L1859">
    <div class="line-number"><a href="#L1859">1859</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    M.flush()</div>
  </div>
  <div class="line not-covered" id="L1860">
    <div class="line-number"><a href="#L1860">1860</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return logger</div>
  </div>
  <div class="line not-covered" id="L1861">
    <div class="line-number"><a href="#L1861">1861</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L1862">
    <div class="line-number"><a href="#L1862">1862</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L1863">
    <div class="line-number"><a href="#L1863">1863</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add auto-flush on shutdown</div>
  </div>
  <div class="line not-covered" id="L1864">
    <div class="line-number"><a href="#L1864">1864</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local mt = getmetatable(logger) or {}</div>
  </div>
  <div class="line not-covered" id="L1865">
    <div class="line-number"><a href="#L1865">1865</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  mt.__gc = function()</div>
  </div>
  <div class="line not-covered" id="L1866">
    <div class="line-number"><a href="#L1866">1866</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.flush()</div>
  </div>
  <div class="line not-covered" id="L1867">
    <div class="line-number"><a href="#L1867">1867</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L1868">
    <div class="line-number"><a href="#L1868">1868</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  setmetatable(logger, mt)</div>
  </div>
  <div class="line not-executable" id="L1869">
    <div class="line-number"><a href="#L1869">1869</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L1870">
    <div class="line-number"><a href="#L1870">1870</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return logger</div>
  </div>
  <div class="line not-covered" id="L1871">
    <div class="line-number"><a href="#L1871">1871</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L1872">
    <div class="line-number"><a href="#L1872">1872</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return M</div>
  </div>
</div>
<div class="source-code" id="file-lib-samples-calculator-lua">
  <h3>lib/samples/calculator.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">0 / 21 (0%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 0%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">0 / 0 (0%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 0%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 23      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 21      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 0      </div>
      <div style="background-color: #ffccbc; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 0      </div>
    </div>
  </div>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Simple Calculator Module</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Used for testing coverage functionality</div>
  </div>
  <div class="line not-covered" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local calculator = {}</div>
  </div>
  <div class="line not-covered" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function calculator.add(a, b)</div>
  </div>
  <div class="line not-covered" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = a + b</div>
  </div>
  <div class="line not-covered" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function calculator.subtract(a, b)</div>
  </div>
  <div class="line not-covered" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = a - b</div>
  </div>
  <div class="line not-covered" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function calculator.multiply(a, b)</div>
  </div>
  <div class="line not-covered" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = a * b</div>
  </div>
  <div class="line not-covered" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function calculator.divide(a, b)</div>
  </div>
  <div class="line not-covered" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if b == 0 then</div>
  </div>
  <div class="line not-covered" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error(&quot;Division by zero&quot;)</div>
  </div>
  <div class="line not-covered" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local result = a / b</div>
  </div>
  <div class="line not-covered" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return calculator</div>
  </div>
</div>
<div class="source-code" id="file---lib-tools-error-handler-lua">
  <h3>./lib/tools/error_handler.lua</h3>
  <div class="file-summary">
    <!-- Line Coverage -->
    <div class="summary-row">
      <span class="summary-label">Line Coverage:</span>
      <span class="summary-value">37 / 502 (7%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar low" style="width: 7%;"></div>
    </div>
    
    <!-- Function Coverage -->
    <div class="summary-row" style="margin-top: 10px;">
      <span class="summary-label">Function Coverage:</span>
      <span class="summary-value">3 / 3 (100%)</span>
    </div>
    <div class="progress" style="margin: 5px 0; height: 10px;">
      <div class="progress-bar high" style="width: 100%;"></div>
    </div>
    
    <!-- Summary counts -->
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Lines:</strong> 851      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Executable:</strong> 502      </div>
      <div style="background-color: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
        <strong>Functions:</strong> 3      </div>
      <div style="background-color: #c8e6c9; padding: 5px 10px; border-radius: 4px;">
        <strong>Executed Functions:</strong> 3      </div>
    </div>
  </div>
  <div class="function-list">
    <h4>Functions</h4>
    <input type="text" class="function-search" placeholder="Search functions..." id="func-search---lib-tools-error-handler-lua">
    
    <div class="function-filter">
      <label class="function-filter-item active" data-filter="all">
        <input type="radio" name="func-filter---lib-tools-error-handler-lua" value="all" checked>
        All <span class="function-count">3</span>
      </label>
      <label class="function-filter-item" data-filter="executed">
        <input type="radio" name="func-filter---lib-tools-error-handler-lua" value="executed">
        Executed <span class="function-count badge-success">3</span>
      </label>
      <label class="function-filter-item" data-filter="not-executed">
        <input type="radio" name="func-filter---lib-tools-error-handler-lua" value="not-executed">
        Not Executed <span class="function-count badge-danger">0</span>
      </label>
    </div>
    
    <div class="function-filter">
      <label class="function-filter-item" data-type="global">
        <input type="checkbox" name="func-type---lib-tools-error-handler-lua" value="global">
        Global <span class="function-count function-type-global">0</span>
      </label>
      <label class="function-filter-item" data-type="local">
        <input type="checkbox" name="func-type---lib-tools-error-handler-lua" value="local">
        Local <span class="function-count function-type-local">0</span>
      </label>
      <label class="function-filter-item" data-type="method">
        <input type="checkbox" name="func-type---lib-tools-error-handler-lua" value="method">
        Method <span class="function-count function-type-method">0</span>
      </label>
      <label class="function-filter-item" data-type="anonymous">
        <input type="checkbox" name="func-type---lib-tools-error-handler-lua" value="anonymous">
        Anonymous <span class="function-count function-type-anonymous">0</span>
      </label>
      <label class="function-filter-item" data-type="closure">
        <input type="checkbox" name="func-type---lib-tools-error-handler-lua" value="closure">
        Closure <span class="function-count function-type-closure">3</span>
      </label>
    </div>
    
    <table class="functions" id="functions---lib-tools-error-handler-lua">
      <thead>
        <tr>
          <th data-sort="name">Name</th>
          <th data-sort="type">Type</th>
          <th data-sort="lines">Lines</th>
          <th data-sort="executed">Status</th>
          <th data-sort="count">Execution Count</th>
        </tr>
      </thead>
      <tbody>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>assert <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L495">495-508</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>7</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>try <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L546">546-567</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>12</td>
        </tr>
        <tr class="executed covered" data-function-type="closure" data-executed="true">
          <td>safe_io_operation <span class="function-type-badge function-type-closure">closure</span></td>
          <td>closure</td>
          <td><a href="#L686">686-709</a></td>
          <td class="executed">
            <span class="badge badge-success">Executed</span>
          </td>
          <td>1</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script class="function-sort-script">
  (function() {
    // Function table sorting and filtering for error_handler.lua    const tableId = 'functions---lib-tools-error-handler-lua';
    const searchId = 'func-search---lib-tools-error-handler-lua';
    const table = document.getElementById(tableId);
    const search = document.getElementById(searchId);
    
    if (!table || !search) return;
    
    // Sort direction state
    let sortColumn = 'lines';
    let sortDirection = 'asc';
    
    // Initial sort by line number
    sortTable('lines', 'asc');
    
    // Add click handlers to table headers
    const headers = table.querySelectorAll('th');
    headers.forEach(header => {
      if (header.dataset.sort) {
        header.addEventListener('click', () => {
          const column = header.dataset.sort;
          // Toggle direction if same column
          const direction = (column === sortColumn) 
            ? (sortDirection === 'asc' ? 'desc' : 'asc')
            : 'asc';
          
          sortTable(column, direction);
        });
      }
    });
    
    // Search input handler
    search.addEventListener('input', filterTable);
    
    // Filter radio buttons
    const filterRadios = document.querySelectorAll('[name="func-filter---lib-tools-error-handler-lua"]');
    filterRadios.forEach(radio => {
      radio.addEventListener('change', filterTable);
    });
    
    // Type checkboxes
    const typeCheckboxes = document.querySelectorAll('[name="func-type---lib-tools-error-handler-lua"]');
    typeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', filterTable);
    });
    
    // Filter the table based on search text and filters
    function filterTable() {
      const searchText = search.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      
      // Get active execution filter
      const activeFilter = document.querySelector('[name="func-filter---lib-tools-error-handler-lua"]:checked').value;
      
      // Get active type filters
      const activeTypes = Array.from(document.querySelectorAll('[name="func-type---lib-tools-error-handler-lua"]:checked'))
        .map(cb => cb.value);
      
      // Show/hide rows based on filters
      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const type = row.dataset.functionType;
        const executed = row.dataset.executed === 'true';
        
        // Check search text
        const matchesSearch = searchText === '' || name.includes(searchText);
        
        // Check execution filter
        const matchesExecution = 
          activeFilter === 'all' || 
          (activeFilter === 'executed' && executed) ||
          (activeFilter === 'not-executed' && !executed);
        
        // Check type filter (if any are checked)
        const matchesType = activeTypes.length === 0 || activeTypes.includes(type);
        
        // Show/hide row
        row.style.display = (matchesSearch && matchesExecution && matchesType) ? '' : 'none';
      });
    }
    
    // Sort the table by column
    function sortTable(column, direction) {
      // Update state
      sortColumn = column;
      sortDirection = direction;
      
      // Update header classes
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === column) {
          header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Get table body and rows
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Sort rows
      rows.sort((a, b) => {
        let valueA, valueB;
        
        // Extract values based on column
        switch(column) {
          case 'name':
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
            break;
          case 'type':
            valueA = a.cells[1].textContent.toLowerCase();
            valueB = b.cells[1].textContent.toLowerCase();
            break;
          case 'lines':
            valueA = parseInt(a.cells[2].textContent.split('-')[0]);
            valueB = parseInt(b.cells[2].textContent.split('-')[0]);
            break;
          case 'executed':
            valueA = a.dataset.executed === 'true' ? 1 : 0;
            valueB = b.dataset.executed === 'true' ? 1 : 0;
            break;
          case 'count':
            valueA = parseInt(a.cells[4].textContent);
            valueB = parseInt(b.cells[4].textContent);
            break;
          default:
            valueA = a.cells[0].textContent.toLowerCase();
            valueB = b.cells[0].textContent.toLowerCase();
        }
        
        // Compare values
        if (valueA === valueB) return 0;
        
        let result = typeof valueA === 'string' 
          ? valueA.localeCompare(valueB) 
          : valueA - valueB;
          
        // Reverse for descending
        return direction === 'asc' ? result : -result;
      });
      
      // Reorder DOM
      rows.forEach(row => tbody.appendChild(row));
    }
  })();
  </script>
  <div class="line not-executable" id="L1">
    <div class="line-number"><a href="#L1">1</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@class ErrorHandler</div>
  </div>
  <div class="line not-executable" id="L2">
    <div class="line-number"><a href="#L2">2</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field CATEGORY table Error categories</div>
  </div>
  <div class="line not-executable" id="L3">
    <div class="line-number"><a href="#L3">3</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field LOG_LEVEL table Log levels for errors</div>
  </div>
  <div class="line not-executable" id="L4">
    <div class="line-number"><a href="#L4">4</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field create fun(message: string, category: string, severity?: string, context?: table, cause?: any): table Create a standardized error object</div>
  </div>
  <div class="line not-executable" id="L5">
    <div class="line-number"><a href="#L5">5</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field validation_error fun(message: string, context?: table): table Create a validation error</div>
  </div>
  <div class="line not-executable" id="L6">
    <div class="line-number"><a href="#L6">6</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field io_error fun(message: string, context?: table): table Create an I/O error</div>
  </div>
  <div class="line not-executable" id="L7">
    <div class="line-number"><a href="#L7">7</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field runtime_error fun(message: string, context?: table, original_error?: any): table Create a runtime error</div>
  </div>
  <div class="line not-executable" id="L8">
    <div class="line-number"><a href="#L8">8</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field parser_error fun(message: string, context?: table): table Create a parser error</div>
  </div>
  <div class="line not-executable" id="L9">
    <div class="line-number"><a href="#L9">9</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field test_expected_error fun(message: string, context?: table): table Create a test expected error</div>
  </div>
  <div class="line not-executable" id="L10">
    <div class="line-number"><a href="#L10">10</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field format_error fun(err: any, include_traceback?: boolean): string Format an error object for display</div>
  </div>
  <div class="line not-executable" id="L11">
    <div class="line-number"><a href="#L11">11</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field set_current_test_metadata fun(metadata: table|nil): table|nil Set metadata for the current test</div>
  </div>
  <div class="line not-executable" id="L12">
    <div class="line-number"><a href="#L12">12</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field get_current_test_metadata fun(): table|nil Get metadata for the current test</div>
  </div>
  <div class="line not-executable" id="L13">
    <div class="line-number"><a href="#L13">13</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field try fun(func: function, ...): boolean, any, any? Execute a function in protected mode</div>
  </div>
  <div class="line not-executable" id="L14">
    <div class="line-number"><a href="#L14">14</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field log_error fun(err: any) Log an error using the logging system</div>
  </div>
  <div class="line not-executable" id="L15">
    <div class="line-number"><a href="#L15">15</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field assert fun(condition: any, message: string, category?: string, context?: table): boolean Assert a condition</div>
  </div>
  <div class="line not-executable" id="L16">
    <div class="line-number"><a href="#L16">16</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field safe_io_operation fun(func: function, file_path: string, context?: table, transform_result?: function): any, any? Safely execute an I/O operation</div>
  </div>
  <div class="line not-executable" id="L17">
    <div class="line-number"><a href="#L17">17</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@field rethrow fun(err: table|string, context?: table): nil Rethrow an error with proper error level</div>
  </div>
  <div class="line not-executable" id="L18">
    <div class="line-number"><a href="#L18">18</a></div>
    <div class="execution-count"></div>    <div class="line-content">--[[</div>
  </div>
  <div class="line not-executable" id="L19">
    <div class="line-number"><a href="#L19">19</a></div>
    <div class="execution-count"></div>    <div class="line-content">    Structured Error Handling Module for the Firmo Framework</div>
  </div>
  <div class="line not-executable" id="L20">
    <div class="line-number"><a href="#L20">20</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L21">
    <div class="line-number"><a href="#L21">21</a></div>
    <div class="execution-count"></div>    <div class="line-content">    This module provides a comprehensive error handling system with standardized </div>
  </div>
  <div class="line not-executable" id="L22">
    <div class="line-number"><a href="#L22">22</a></div>
    <div class="execution-count"></div>    <div class="line-content">    error objects, contextual information, and integrated logging. It's designed </div>
  </div>
  <div class="line not-executable" id="L23">
    <div class="line-number"><a href="#L23">23</a></div>
    <div class="execution-count"></div>    <div class="line-content">    to create consistent, informative error handling throughout the codebase.</div>
  </div>
  <div class="line not-executable" id="L24">
    <div class="line-number"><a href="#L24">24</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L25">
    <div class="line-number"><a href="#L25">25</a></div>
    <div class="execution-count"></div>    <div class="line-content">    Features:</div>
  </div>
  <div class="line not-executable" id="L26">
    <div class="line-number"><a href="#L26">26</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Structured error objects with categories, severity, and context</div>
  </div>
  <div class="line not-executable" id="L27">
    <div class="line-number"><a href="#L27">27</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Specialized error creators for common error types (validation, IO, runtime)</div>
  </div>
  <div class="line not-executable" id="L28">
    <div class="line-number"><a href="#L28">28</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Protected function execution with try/catch pattern</div>
  </div>
  <div class="line not-executable" id="L29">
    <div class="line-number"><a href="#L29">29</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Safe IO operation wrappers with detailed error reporting</div>
  </div>
  <div class="line not-executable" id="L30">
    <div class="line-number"><a href="#L30">30</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Error logging integration with configurable verbosity</div>
  </div>
  <div class="line not-executable" id="L31">
    <div class="line-number"><a href="#L31">31</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Test-aware error handling with suppression capabilities</div>
  </div>
  <div class="line not-executable" id="L32">
    <div class="line-number"><a href="#L32">32</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Stack trace capture and formatting</div>
  </div>
  <div class="line not-executable" id="L33">
    <div class="line-number"><a href="#L33">33</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Error assertion mechanism with clean syntax</div>
  </div>
  <div class="line not-executable" id="L34">
    <div class="line-number"><a href="#L34">34</a></div>
    <div class="execution-count"></div>    <div class="line-content">    - Error rethrowing with context preservation</div>
  </div>
  <div class="line not-executable" id="L35">
    <div class="line-number"><a href="#L35">35</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L36">
    <div class="line-number"><a href="#L36">36</a></div>
    <div class="execution-count"></div>    <div class="line-content">    The module serves as the foundation for error handling across the Firmo</div>
  </div>
  <div class="line not-executable" id="L37">
    <div class="line-number"><a href="#L37">37</a></div>
    <div class="execution-count"></div>    <div class="line-content">    framework, ensuring that errors are consistently created, propagated,</div>
  </div>
  <div class="line not-executable" id="L38">
    <div class="line-number"><a href="#L38">38</a></div>
    <div class="execution-count"></div>    <div class="line-content">    and reported with appropriate context information.</div>
  </div>
  <div class="line not-executable" id="L39">
    <div class="line-number"><a href="#L39">39</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L40">
    <div class="line-number"><a href="#L40">40</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @module error_handler</div>
  </div>
  <div class="line not-executable" id="L41">
    <div class="line-number"><a href="#L41">41</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @author Firmo Team</div>
  </div>
  <div class="line not-executable" id="L42">
    <div class="line-number"><a href="#L42">42</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @license MIT</div>
  </div>
  <div class="line not-executable" id="L43">
    <div class="line-number"><a href="#L43">43</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @copyright 2023-2025</div>
  </div>
  <div class="line not-executable" id="L44">
    <div class="line-number"><a href="#L44">44</a></div>
    <div class="execution-count"></div>    <div class="line-content">    @version 1.0.0</div>
  </div>
  <div class="line not-executable" id="L45">
    <div class="line-number"><a href="#L45">45</a></div>
    <div class="execution-count"></div>    <div class="line-content">]]</div>
  </div>
  <div class="line not-covered" id="L46">
    <div class="line-number"><a href="#L46">46</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local M = {}</div>
  </div>
  <div class="line not-executable" id="L47">
    <div class="line-number"><a href="#L47">47</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Simple forward declarations for functions used before they're defined</div>
  </div>
  <div class="line not-covered" id="L48">
    <div class="line-number"><a href="#L48">48</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local create_error -- Forward declaration for create_error function</div>
  </div>
  <div class="line not-executable" id="L49">
    <div class="line-number"><a href="#L49">49</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Lazy-load dependencies to avoid circular dependencies</div>
  </div>
  <div class="line not-covered" id="L50">
    <div class="line-number"><a href="#L50">50</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local _logging, _fs</div>
  </div>
  <div class="line not-covered" id="L51">
    <div class="line-number"><a href="#L51">51</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_logging()</div>
  </div>
  <div class="line not-covered" id="L52">
    <div class="line-number"><a href="#L52">52</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not _logging then</div>
  </div>
  <div class="line not-covered" id="L53">
    <div class="line-number"><a href="#L53">53</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, logging = pcall(require, &quot;lib.tools.logging&quot;)</div>
  </div>
  <div class="line not-covered" id="L54">
    <div class="line-number"><a href="#L54">54</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    _logging = success and logging or nil</div>
  </div>
  <div class="line not-covered" id="L55">
    <div class="line-number"><a href="#L55">55</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L56">
    <div class="line-number"><a href="#L56">56</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return _logging</div>
  </div>
  <div class="line not-covered" id="L57">
    <div class="line-number"><a href="#L57">57</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L58">
    <div class="line-number"><a href="#L58">58</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the filesystem module lazily to avoid circular dependencies</div>
  </div>
  <div class="line not-executable" id="L59">
    <div class="line-number"><a href="#L59">59</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil The filesystem module if available</div>
  </div>
  <div class="line not-covered" id="L60">
    <div class="line-number"><a href="#L60">60</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_fs()</div>
  </div>
  <div class="line not-covered" id="L61">
    <div class="line-number"><a href="#L61">61</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not _fs then</div>
  </div>
  <div class="line not-covered" id="L62">
    <div class="line-number"><a href="#L62">62</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local success, fs = pcall(require, &quot;lib.tools.filesystem&quot;)</div>
  </div>
  <div class="line not-covered" id="L63">
    <div class="line-number"><a href="#L63">63</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    _fs = success and fs or nil</div>
  </div>
  <div class="line not-covered" id="L64">
    <div class="line-number"><a href="#L64">64</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L65">
    <div class="line-number"><a href="#L65">65</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return _fs</div>
  </div>
  <div class="line not-covered" id="L66">
    <div class="line-number"><a href="#L66">66</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L67">
    <div class="line-number"><a href="#L67">67</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Get a logger instance for this module</div>
  </div>
  <div class="line not-covered" id="L68">
    <div class="line-number"><a href="#L68">68</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_logger()</div>
  </div>
  <div class="line not-covered" id="L69">
    <div class="line-number"><a href="#L69">69</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local logging = get_logging()</div>
  </div>
  <div class="line not-covered" id="L70">
    <div class="line-number"><a href="#L70">70</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if logging then</div>
  </div>
  <div class="line not-covered" id="L71">
    <div class="line-number"><a href="#L71">71</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return logging.get_logger(&quot;ErrorHandler&quot;)</div>
  </div>
  <div class="line not-covered" id="L72">
    <div class="line-number"><a href="#L72">72</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L73">
    <div class="line-number"><a href="#L73">73</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return a stub logger if logging module isn't available</div>
  </div>
  <div class="line not-covered" id="L74">
    <div class="line-number"><a href="#L74">74</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return {</div>
  </div>
  <div class="line not-covered" id="L75">
    <div class="line-number"><a href="#L75">75</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error = function(msg)</div>
  </div>
  <div class="line not-covered" id="L76">
    <div class="line-number"><a href="#L76">76</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;[ERROR] &quot; .. msg)</div>
  </div>
  <div class="line not-covered" id="L77">
    <div class="line-number"><a href="#L77">77</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L78">
    <div class="line-number"><a href="#L78">78</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    warn = function(msg)</div>
  </div>
  <div class="line not-covered" id="L79">
    <div class="line-number"><a href="#L79">79</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;[WARN] &quot; .. msg)</div>
  </div>
  <div class="line not-covered" id="L80">
    <div class="line-number"><a href="#L80">80</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L81">
    <div class="line-number"><a href="#L81">81</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    info = function(msg)</div>
  </div>
  <div class="line not-covered" id="L82">
    <div class="line-number"><a href="#L82">82</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;[INFO] &quot; .. msg)</div>
  </div>
  <div class="line not-covered" id="L83">
    <div class="line-number"><a href="#L83">83</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L84">
    <div class="line-number"><a href="#L84">84</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    debug = function(msg)</div>
  </div>
  <div class="line not-covered" id="L85">
    <div class="line-number"><a href="#L85">85</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;[DEBUG] &quot; .. msg)</div>
  </div>
  <div class="line not-covered" id="L86">
    <div class="line-number"><a href="#L86">86</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L87">
    <div class="line-number"><a href="#L87">87</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    trace = function(msg)</div>
  </div>
  <div class="line not-covered" id="L88">
    <div class="line-number"><a href="#L88">88</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      print(&quot;[TRACE] &quot; .. msg)</div>
  </div>
  <div class="line not-covered" id="L89">
    <div class="line-number"><a href="#L89">89</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end,</div>
  </div>
  <div class="line not-covered" id="L90">
    <div class="line-number"><a href="#L90">90</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-covered" id="L91">
    <div class="line-number"><a href="#L91">91</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-covered" id="L92">
    <div class="line-number"><a href="#L92">92</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local logger = get_logger()</div>
  </div>
  <div class="line not-executable" id="L93">
    <div class="line-number"><a href="#L93">93</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Module configuration</div>
  </div>
  <div class="line not-covered" id="L94">
    <div class="line-number"><a href="#L94">94</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local config = {</div>
  </div>
  <div class="line not-covered" id="L95">
    <div class="line-number"><a href="#L95">95</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  use_assertions = true, -- Use Lua assertions for validation errors</div>
  </div>
  <div class="line not-covered" id="L96">
    <div class="line-number"><a href="#L96">96</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  verbose = false, -- Verbose error messages</div>
  </div>
  <div class="line not-covered" id="L97">
    <div class="line-number"><a href="#L97">97</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  trace_errors = true, -- Include traceback information</div>
  </div>
  <div class="line not-covered" id="L98">
    <div class="line-number"><a href="#L98">98</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log_all_errors = true, -- Log all errors through the logging system</div>
  </div>
  <div class="line not-covered" id="L99">
    <div class="line-number"><a href="#L99">99</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  exit_on_fatal = false, -- Exit the process on fatal errors</div>
  </div>
  <div class="line not-covered" id="L100">
    <div class="line-number"><a href="#L100">100</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  capture_backtraces = true, -- Capture stack traces for errors</div>
  </div>
  <div class="line not-covered" id="L101">
    <div class="line-number"><a href="#L101">101</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  in_test_run = false, -- Are we currently running tests? (Set by test runner)</div>
  </div>
  <div class="line not-covered" id="L102">
    <div class="line-number"><a href="#L102">102</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  suppress_test_assertions = true, -- Whether to suppress expected validation errors in tests</div>
  </div>
  <div class="line not-covered" id="L103">
    <div class="line-number"><a href="#L103">103</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  suppress_all_logging_in_tests = true, -- Whether to suppress ALL console output during tests</div>
  </div>
  <div class="line not-covered" id="L104">
    <div class="line-number"><a href="#L104">104</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  current_test_metadata = nil, -- Metadata for the currently running test (if any)</div>
  </div>
  <div class="line not-covered" id="L105">
    <div class="line-number"><a href="#L105">105</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L106">
    <div class="line-number"><a href="#L106">106</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- IMPORTANT: We DO NOT detect test mode automatically by pattern matching filenames.</div>
  </div>
  <div class="line not-executable" id="L107">
    <div class="line-number"><a href="#L107">107</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Instead, the test runner explicitly sets test mode via M.set_test_mode()</div>
  </div>
  <div class="line not-executable" id="L108">
    <div class="line-number"><a href="#L108">108</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- This ensures reliability across different environments and file structures.</div>
  </div>
  <div class="line not-executable" id="L109">
    <div class="line-number"><a href="#L109">109</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- See scripts/runner.lua for the proper implementation.</div>
  </div>
  <div class="line not-executable" id="L110">
    <div class="line-number"><a href="#L110">110</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Do NOT set test run mode here - it will be set explicitly by the test runner</div>
  </div>
  <div class="line not-executable" id="L111">
    <div class="line-number"><a href="#L111">111</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Error severity levels</div>
  </div>
  <div class="line not-covered" id="L112">
    <div class="line-number"><a href="#L112">112</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.SEVERITY = {</div>
  </div>
  <div class="line not-covered" id="L113">
    <div class="line-number"><a href="#L113">113</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  FATAL = &quot;FATAL&quot;, -- Unrecoverable errors that require process termination</div>
  </div>
  <div class="line not-covered" id="L114">
    <div class="line-number"><a href="#L114">114</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  ERROR = &quot;ERROR&quot;, -- Serious errors that might allow the process to continue</div>
  </div>
  <div class="line not-covered" id="L115">
    <div class="line-number"><a href="#L115">115</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  WARNING = &quot;WARNING&quot;, -- Warnings that need attention but don't stop execution</div>
  </div>
  <div class="line not-covered" id="L116">
    <div class="line-number"><a href="#L116">116</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  INFO = &quot;INFO&quot;, -- Informational messages about error conditions</div>
  </div>
  <div class="line not-covered" id="L117">
    <div class="line-number"><a href="#L117">117</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L118">
    <div class="line-number"><a href="#L118">118</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Error categories</div>
  </div>
  <div class="line not-covered" id="L119">
    <div class="line-number"><a href="#L119">119</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.CATEGORY = {</div>
  </div>
  <div class="line not-covered" id="L120">
    <div class="line-number"><a href="#L120">120</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  VALIDATION = &quot;VALIDATION&quot;, -- Input validation errors</div>
  </div>
  <div class="line not-covered" id="L121">
    <div class="line-number"><a href="#L121">121</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  IO = &quot;IO&quot;, -- File I/O errors</div>
  </div>
  <div class="line not-covered" id="L122">
    <div class="line-number"><a href="#L122">122</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  PARSE = &quot;PARSE&quot;, -- Parsing errors</div>
  </div>
  <div class="line not-covered" id="L123">
    <div class="line-number"><a href="#L123">123</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  RUNTIME = &quot;RUNTIME&quot;, -- Runtime errors</div>
  </div>
  <div class="line not-covered" id="L124">
    <div class="line-number"><a href="#L124">124</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  TIMEOUT = &quot;TIMEOUT&quot;, -- Timeout errors</div>
  </div>
  <div class="line not-covered" id="L125">
    <div class="line-number"><a href="#L125">125</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  MEMORY = &quot;MEMORY&quot;, -- Memory-related errors</div>
  </div>
  <div class="line not-covered" id="L126">
    <div class="line-number"><a href="#L126">126</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  CONFIGURATION = &quot;CONFIG&quot;, -- Configuration errors</div>
  </div>
  <div class="line not-covered" id="L127">
    <div class="line-number"><a href="#L127">127</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  UNKNOWN = &quot;UNKNOWN&quot;, -- Unknown errors</div>
  </div>
  <div class="line not-covered" id="L128">
    <div class="line-number"><a href="#L128">128</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  TEST_EXPECTED = &quot;TEST_EXPECTED&quot;, -- Errors that are expected during tests</div>
  </div>
  <div class="line not-covered" id="L129">
    <div class="line-number"><a href="#L129">129</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L130">
    <div class="line-number"><a href="#L130">130</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Internal helper to get a traceback</div>
  </div>
  <div class="line not-covered" id="L131">
    <div class="line-number"><a href="#L131">131</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function get_traceback(level)</div>
  </div>
  <div class="line not-covered" id="L132">
    <div class="line-number"><a href="#L132">132</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not config.capture_backtraces then</div>
  </div>
  <div class="line not-covered" id="L133">
    <div class="line-number"><a href="#L133">133</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return nil</div>
  </div>
  <div class="line not-covered" id="L134">
    <div class="line-number"><a href="#L134">134</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L135">
    <div class="line-number"><a href="#L135">135</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  level = level or 3 -- Skip this function and the caller</div>
  </div>
  <div class="line not-covered" id="L136">
    <div class="line-number"><a href="#L136">136</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return debug.traceback(&quot;&quot;, level)</div>
  </div>
  <div class="line not-covered" id="L137">
    <div class="line-number"><a href="#L137">137</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L138">
    <div class="line-number"><a href="#L138">138</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Internal helper to create an error object</div>
  </div>
  <div class="line not-covered" id="L139">
    <div class="line-number"><a href="#L139">139</a></div>
    <div class="execution-count">0</div>    <div class="line-content">create_error = function(message, category, severity, context, cause)</div>
  </div>
  <div class="line not-covered" id="L140">
    <div class="line-number"><a href="#L140">140</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local err = {</div>
  </div>
  <div class="line not-covered" id="L141">
    <div class="line-number"><a href="#L141">141</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    message = message or &quot;Unknown error&quot;,</div>
  </div>
  <div class="line not-covered" id="L142">
    <div class="line-number"><a href="#L142">142</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    category = category or M.CATEGORY.UNKNOWN,</div>
  </div>
  <div class="line not-covered" id="L143">
    <div class="line-number"><a href="#L143">143</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    severity = severity or M.SEVERITY.ERROR,</div>
  </div>
  <div class="line not-covered" id="L144">
    <div class="line-number"><a href="#L144">144</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    timestamp = os.time(),</div>
  </div>
  <div class="line not-covered" id="L145">
    <div class="line-number"><a href="#L145">145</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    traceback = get_traceback(),</div>
  </div>
  <div class="line not-covered" id="L146">
    <div class="line-number"><a href="#L146">146</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    context = context or {},</div>
  </div>
  <div class="line not-covered" id="L147">
    <div class="line-number"><a href="#L147">147</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    cause = cause, -- Original error that caused this one</div>
  </div>
  <div class="line not-covered" id="L148">
    <div class="line-number"><a href="#L148">148</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L149">
    <div class="line-number"><a href="#L149">149</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add file and line information if available</div>
  </div>
  <div class="line not-covered" id="L150">
    <div class="line-number"><a href="#L150">150</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local info = debug.getinfo(3, &quot;Sl&quot;)</div>
  </div>
  <div class="line not-covered" id="L151">
    <div class="line-number"><a href="#L151">151</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if info then</div>
  </div>
  <div class="line not-covered" id="L152">
    <div class="line-number"><a href="#L152">152</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    err.source_file = info.short_src</div>
  </div>
  <div class="line not-covered" id="L153">
    <div class="line-number"><a href="#L153">153</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    err.source_line = info.currentline</div>
  </div>
  <div class="line not-covered" id="L154">
    <div class="line-number"><a href="#L154">154</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L155">
    <div class="line-number"><a href="#L155">155</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return err</div>
  </div>
  <div class="line not-covered" id="L156">
    <div class="line-number"><a href="#L156">156</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L157">
    <div class="line-number"><a href="#L157">157</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Format an error object as a string</div>
  </div>
  <div class="line not-covered" id="L158">
    <div class="line-number"><a href="#L158">158</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function format_error(err)</div>
  </div>
  <div class="line not-covered" id="L159">
    <div class="line-number"><a href="#L159">159</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(err) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L160">
    <div class="line-number"><a href="#L160">160</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return err</div>
  </div>
  <div class="line not-covered" id="L161">
    <div class="line-number"><a href="#L161">161</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L162">
    <div class="line-number"><a href="#L162">162</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(err) ~= &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L163">
    <div class="line-number"><a href="#L163">163</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return tostring(err)</div>
  </div>
  <div class="line not-covered" id="L164">
    <div class="line-number"><a href="#L164">164</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L165">
    <div class="line-number"><a href="#L165">165</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not err.category and not err.message then</div>
  </div>
  <div class="line not-covered" id="L166">
    <div class="line-number"><a href="#L166">166</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return tostring(err)</div>
  </div>
  <div class="line not-covered" id="L167">
    <div class="line-number"><a href="#L167">167</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L168">
    <div class="line-number"><a href="#L168">168</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local parts = {}</div>
  </div>
  <div class="line not-covered" id="L169">
    <div class="line-number"><a href="#L169">169</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(parts, &quot;[&quot; .. (err.severity or &quot;ERROR&quot;) .. &quot;]&quot;)</div>
  </div>
  <div class="line not-covered" id="L170">
    <div class="line-number"><a href="#L170">170</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err.category then</div>
  </div>
  <div class="line not-covered" id="L171">
    <div class="line-number"><a href="#L171">171</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(parts, err.category .. &quot;:&quot;)</div>
  </div>
  <div class="line not-covered" id="L172">
    <div class="line-number"><a href="#L172">172</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L173">
    <div class="line-number"><a href="#L173">173</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  table.insert(parts, err.message or &quot;Unknown error&quot;)</div>
  </div>
  <div class="line not-covered" id="L174">
    <div class="line-number"><a href="#L174">174</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err.source_file and err.source_line then</div>
  </div>
  <div class="line not-covered" id="L175">
    <div class="line-number"><a href="#L175">175</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(parts, &quot;(at &quot; .. err.source_file .. &quot;:&quot; .. err.source_line .. &quot;)&quot;)</div>
  </div>
  <div class="line not-covered" id="L176">
    <div class="line-number"><a href="#L176">176</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L177">
    <div class="line-number"><a href="#L177">177</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local verbose = true -- Always be verbose for error handling</div>
  </div>
  <div class="line not-covered" id="L178">
    <div class="line-number"><a href="#L178">178</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if verbose and err.context and next(err.context) then</div>
  </div>
  <div class="line not-covered" id="L179">
    <div class="line-number"><a href="#L179">179</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(parts, &quot;\nContext: &quot;)</div>
  </div>
  <div class="line not-covered" id="L180">
    <div class="line-number"><a href="#L180">180</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for k, v in pairs(err.context) do</div>
  </div>
  <div class="line not-covered" id="L181">
    <div class="line-number"><a href="#L181">181</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      table.insert(parts, &quot; &quot; .. k .. &quot;: &quot; .. tostring(v))</div>
  </div>
  <div class="line not-covered" id="L182">
    <div class="line-number"><a href="#L182">182</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L183">
    <div class="line-number"><a href="#L183">183</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L184">
    <div class="line-number"><a href="#L184">184</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return table.concat(parts, &quot; &quot;)</div>
  </div>
  <div class="line not-covered" id="L185">
    <div class="line-number"><a href="#L185">185</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L186">
    <div class="line-number"><a href="#L186">186</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Add function to module</div>
  </div>
  <div class="line not-covered" id="L187">
    <div class="line-number"><a href="#L187">187</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.format_error = format_error</div>
  </div>
  <div class="line not-executable" id="L188">
    <div class="line-number"><a href="#L188">188</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Rethrow an error with proper error level</div>
  </div>
  <div class="line not-executable" id="L189">
    <div class="line-number"><a href="#L189">189</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param err table|string The error object or string to rethrow</div>
  </div>
  <div class="line not-executable" id="L190">
    <div class="line-number"><a href="#L190">190</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context to add to the error</div>
  </div>
  <div class="line not-executable" id="L191">
    <div class="line-number"><a href="#L191">191</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return nil Never returns, always throws an error</div>
  </div>
  <div class="line not-covered" id="L192">
    <div class="line-number"><a href="#L192">192</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.rethrow(err, context)</div>
  </div>
  <div class="line not-executable" id="L193">
    <div class="line-number"><a href="#L193">193</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create a copy of the error to avoid modifying the original</div>
  </div>
  <div class="line not-covered" id="L194">
    <div class="line-number"><a href="#L194">194</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local error_to_throw</div>
  </div>
  <div class="line not-executable" id="L195">
    <div class="line-number"><a href="#L195">195</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L196">
    <div class="line-number"><a href="#L196">196</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if type(err) == &quot;table&quot; and err.message then</div>
  </div>
  <div class="line not-executable" id="L197">
    <div class="line-number"><a href="#L197">197</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Make a shallow copy of the original error keeping all fields</div>
  </div>
  <div class="line not-covered" id="L198">
    <div class="line-number"><a href="#L198">198</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error_to_throw = {}</div>
  </div>
  <div class="line not-covered" id="L199">
    <div class="line-number"><a href="#L199">199</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for k, v in pairs(err) do</div>
  </div>
  <div class="line not-covered" id="L200">
    <div class="line-number"><a href="#L200">200</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_to_throw[k] = v</div>
  </div>
  <div class="line not-covered" id="L201">
    <div class="line-number"><a href="#L201">201</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L202">
    <div class="line-number"><a href="#L202">202</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L203">
    <div class="line-number"><a href="#L203">203</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If there's context in the original error and it's a table, make a copy of that too</div>
  </div>
  <div class="line not-covered" id="L204">
    <div class="line-number"><a href="#L204">204</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(err.context) == &quot;table&quot; then</div>
  </div>
  <div class="line not-covered" id="L205">
    <div class="line-number"><a href="#L205">205</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_to_throw.context = {}</div>
  </div>
  <div class="line not-covered" id="L206">
    <div class="line-number"><a href="#L206">206</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for k, v in pairs(err.context) do</div>
  </div>
  <div class="line not-covered" id="L207">
    <div class="line-number"><a href="#L207">207</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error_to_throw.context[k] = v</div>
  </div>
  <div class="line not-covered" id="L208">
    <div class="line-number"><a href="#L208">208</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L209">
    <div class="line-number"><a href="#L209">209</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L210">
    <div class="line-number"><a href="#L210">210</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L211">
    <div class="line-number"><a href="#L211">211</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- If additional context was provided, merge it</div>
  </div>
  <div class="line not-covered" id="L212">
    <div class="line-number"><a href="#L212">212</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if context and type(context) == &quot;table&quot; then</div>
  </div>
  <div class="line not-executable" id="L213">
    <div class="line-number"><a href="#L213">213</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Initialize context table if needed</div>
  </div>
  <div class="line not-covered" id="L214">
    <div class="line-number"><a href="#L214">214</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_to_throw.context = error_to_throw.context or {}</div>
  </div>
  <div class="line not-executable" id="L215">
    <div class="line-number"><a href="#L215">215</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Merge the additional context</div>
  </div>
  <div class="line not-covered" id="L216">
    <div class="line-number"><a href="#L216">216</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for k, v in pairs(context) do</div>
  </div>
  <div class="line not-covered" id="L217">
    <div class="line-number"><a href="#L217">217</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        error_to_throw.context[k] = v</div>
  </div>
  <div class="line not-covered" id="L218">
    <div class="line-number"><a href="#L218">218</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L219">
    <div class="line-number"><a href="#L219">219</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L220">
    <div class="line-number"><a href="#L220">220</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L221">
    <div class="line-number"><a href="#L221">221</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Log the enhanced error</div>
  </div>
  <div class="line not-covered" id="L222">
    <div class="line-number"><a href="#L222">222</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    M.log_error(error_to_throw)</div>
  </div>
  <div class="line not-executable" id="L223">
    <div class="line-number"><a href="#L223">223</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L224">
    <div class="line-number"><a href="#L224">224</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Then throw it</div>
  </div>
  <div class="line not-covered" id="L225">
    <div class="line-number"><a href="#L225">225</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error(error_to_throw.message, 2)</div>
  </div>
  <div class="line not-covered" id="L226">
    <div class="line-number"><a href="#L226">226</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif type(err) == &quot;string&quot; then</div>
  </div>
  <div class="line not-executable" id="L227">
    <div class="line-number"><a href="#L227">227</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- For string errors, create a new error object with the message and context</div>
  </div>
  <div class="line not-covered" id="L228">
    <div class="line-number"><a href="#L228">228</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error_to_throw = create_error(</div>
  </div>
  <div class="line not-covered" id="L229">
    <div class="line-number"><a href="#L229">229</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      err,</div>
  </div>
  <div class="line not-covered" id="L230">
    <div class="line-number"><a href="#L230">230</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      M.CATEGORY.RUNTIME,</div>
  </div>
  <div class="line not-covered" id="L231">
    <div class="line-number"><a href="#L231">231</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      M.SEVERITY.ERROR,</div>
  </div>
  <div class="line not-covered" id="L232">
    <div class="line-number"><a href="#L232">232</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      context</div>
  </div>
  <div class="line not-covered" id="L233">
    <div class="line-number"><a href="#L233">233</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    )</div>
  </div>
  <div class="line not-executable" id="L234">
    <div class="line-number"><a href="#L234">234</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L235">
    <div class="line-number"><a href="#L235">235</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Log the error</div>
  </div>
  <div class="line not-covered" id="L236">
    <div class="line-number"><a href="#L236">236</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    M.log_error(error_to_throw)</div>
  </div>
  <div class="line not-executable" id="L237">
    <div class="line-number"><a href="#L237">237</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L238">
    <div class="line-number"><a href="#L238">238</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Throw the error</div>
  </div>
  <div class="line not-covered" id="L239">
    <div class="line-number"><a href="#L239">239</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error(err, 2)</div>
  </div>
  <div class="line not-covered" id="L240">
    <div class="line-number"><a href="#L240">240</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-executable" id="L241">
    <div class="line-number"><a href="#L241">241</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fallback for other types</div>
  </div>
  <div class="line not-covered" id="L242">
    <div class="line-number"><a href="#L242">242</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err_str = tostring(err)</div>
  </div>
  <div class="line not-covered" id="L243">
    <div class="line-number"><a href="#L243">243</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error_to_throw = create_error(</div>
  </div>
  <div class="line not-covered" id="L244">
    <div class="line-number"><a href="#L244">244</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      err_str,</div>
  </div>
  <div class="line not-covered" id="L245">
    <div class="line-number"><a href="#L245">245</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      M.CATEGORY.UNKNOWN,</div>
  </div>
  <div class="line not-covered" id="L246">
    <div class="line-number"><a href="#L246">246</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      M.SEVERITY.ERROR,</div>
  </div>
  <div class="line not-covered" id="L247">
    <div class="line-number"><a href="#L247">247</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      context</div>
  </div>
  <div class="line not-covered" id="L248">
    <div class="line-number"><a href="#L248">248</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    )</div>
  </div>
  <div class="line not-executable" id="L249">
    <div class="line-number"><a href="#L249">249</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L250">
    <div class="line-number"><a href="#L250">250</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Log the error</div>
  </div>
  <div class="line not-covered" id="L251">
    <div class="line-number"><a href="#L251">251</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    M.log_error(error_to_throw)</div>
  </div>
  <div class="line not-executable" id="L252">
    <div class="line-number"><a href="#L252">252</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L253">
    <div class="line-number"><a href="#L253">253</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Throw it</div>
  </div>
  <div class="line not-covered" id="L254">
    <div class="line-number"><a href="#L254">254</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    error(err_str, 2)</div>
  </div>
  <div class="line not-covered" id="L255">
    <div class="line-number"><a href="#L255">255</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L256">
    <div class="line-number"><a href="#L256">256</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L257">
    <div class="line-number"><a href="#L257">257</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- REMOVED: Assert functions were moved to firmo.assert</div>
  </div>
  <div class="line not-executable" id="L258">
    <div class="line-number"><a href="#L258">258</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Internal helper to log an error</div>
  </div>
  <div class="line not-executable" id="L259">
    <div class="line-number"><a href="#L259">259</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param err table Error object to log</div>
  </div>
  <div class="line not-executable" id="L260">
    <div class="line-number"><a href="#L260">260</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return nil</div>
  </div>
  <div class="line not-covered" id="L261">
    <div class="line-number"><a href="#L261">261</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function log_error(err)</div>
  </div>
  <div class="line not-executable" id="L262">
    <div class="line-number"><a href="#L262">262</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Skip all error logging if config says not to log errors</div>
  </div>
  <div class="line not-covered" id="L263">
    <div class="line-number"><a href="#L263">263</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not config.log_all_errors then</div>
  </div>
  <div class="line not-covered" id="L264">
    <div class="line-number"><a href="#L264">264</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return</div>
  </div>
  <div class="line not-covered" id="L265">
    <div class="line-number"><a href="#L265">265</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L266">
    <div class="line-number"><a href="#L266">266</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- IMMEDIATELY RETURN if we're in test mode and suppressing all logging</div>
  </div>
  <div class="line not-covered" id="L267">
    <div class="line-number"><a href="#L267">267</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.in_test_run and config.suppress_all_logging_in_tests then</div>
  </div>
  <div class="line not-executable" id="L268">
    <div class="line-number"><a href="#L268">268</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Store the error in a global table for potential debugging if needed</div>
  </div>
  <div class="line not-covered" id="L269">
    <div class="line-number"><a href="#L269">269</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    _G._firmo_test_errors = _G._firmo_test_errors or {}</div>
  </div>
  <div class="line not-covered" id="L270">
    <div class="line-number"><a href="#L270">270</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(_G._firmo_test_errors, err)</div>
  </div>
  <div class="line not-covered" id="L271">
    <div class="line-number"><a href="#L271">271</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return</div>
  </div>
  <div class="line not-covered" id="L272">
    <div class="line-number"><a href="#L272">272</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L273">
    <div class="line-number"><a href="#L273">273</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local logging = get_logging()</div>
  </div>
  <div class="line not-covered" id="L274">
    <div class="line-number"><a href="#L274">274</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not logging then</div>
  </div>
  <div class="line not-executable" id="L275">
    <div class="line-number"><a href="#L275">275</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Fallback to print if logging isn't available</div>
  </div>
  <div class="line not-covered" id="L276">
    <div class="line-number"><a href="#L276">276</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    print(string.format(&quot;[%s] %s: %s&quot;, err.severity, err.category, err.message))</div>
  </div>
  <div class="line not-covered" id="L277">
    <div class="line-number"><a href="#L277">277</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return</div>
  </div>
  <div class="line not-covered" id="L278">
    <div class="line-number"><a href="#L278">278</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L279">
    <div class="line-number"><a href="#L279">279</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Convert to structured log</div>
  </div>
  <div class="line not-covered" id="L280">
    <div class="line-number"><a href="#L280">280</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local log_params = {</div>
  </div>
  <div class="line not-covered" id="L281">
    <div class="line-number"><a href="#L281">281</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    category = err.category,</div>
  </div>
  <div class="line not-covered" id="L282">
    <div class="line-number"><a href="#L282">282</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    context = err.context,</div>
  </div>
  <div class="line not-covered" id="L283">
    <div class="line-number"><a href="#L283">283</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    source_file = err.source_file,</div>
  </div>
  <div class="line not-covered" id="L284">
    <div class="line-number"><a href="#L284">284</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    source_line = err.source_line,</div>
  </div>
  <div class="line not-covered" id="L285">
    <div class="line-number"><a href="#L285">285</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L286">
    <div class="line-number"><a href="#L286">286</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add traceback in verbose mode</div>
  </div>
  <div class="line not-covered" id="L287">
    <div class="line-number"><a href="#L287">287</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.verbose and err.traceback then</div>
  </div>
  <div class="line not-covered" id="L288">
    <div class="line-number"><a href="#L288">288</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log_params.traceback = err.traceback</div>
  </div>
  <div class="line not-covered" id="L289">
    <div class="line-number"><a href="#L289">289</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L290">
    <div class="line-number"><a href="#L290">290</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add cause if available</div>
  </div>
  <div class="line not-covered" id="L291">
    <div class="line-number"><a href="#L291">291</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err.cause then</div>
  </div>
  <div class="line not-covered" id="L292">
    <div class="line-number"><a href="#L292">292</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(err.cause) == &quot;table&quot; and err.cause.message then</div>
  </div>
  <div class="line not-covered" id="L293">
    <div class="line-number"><a href="#L293">293</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log_params.cause = err.cause.message</div>
  </div>
  <div class="line not-covered" id="L294">
    <div class="line-number"><a href="#L294">294</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L295">
    <div class="line-number"><a href="#L295">295</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log_params.cause = tostring(err.cause)</div>
  </div>
  <div class="line not-covered" id="L296">
    <div class="line-number"><a href="#L296">296</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L297">
    <div class="line-number"><a href="#L297">297</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L298">
    <div class="line-number"><a href="#L298">298</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check if we should suppress logging in test environment</div>
  </div>
  <div class="line not-covered" id="L299">
    <div class="line-number"><a href="#L299">299</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local log_level = &quot;error&quot;</div>
  </div>
  <div class="line not-covered" id="L300">
    <div class="line-number"><a href="#L300">300</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local suppress_logging = false</div>
  </div>
  <div class="line not-covered" id="L301">
    <div class="line-number"><a href="#L301">301</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local completely_skip_logging = false</div>
  </div>
  <div class="line not-executable" id="L302">
    <div class="line-number"><a href="#L302">302</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L303">
    <div class="line-number"><a href="#L303">303</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- In test mode, we may suppress certain categories of errors</div>
  </div>
  <div class="line not-executable" id="L304">
    <div class="line-number"><a href="#L304">304</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- This is the proper approach instead of unreliable pattern matching</div>
  </div>
  <div class="line not-covered" id="L305">
    <div class="line-number"><a href="#L305">305</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.in_test_run then</div>
  </div>
  <div class="line not-executable" id="L306">
    <div class="line-number"><a href="#L306">306</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if this is a test that expects errors</div>
  </div>
  <div class="line not-covered" id="L307">
    <div class="line-number"><a href="#L307">307</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if config.current_test_metadata and config.current_test_metadata.expect_error then</div>
  </div>
  <div class="line not-executable" id="L308">
    <div class="line-number"><a href="#L308">308</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If the current test explicitly expects errors, completely skip logging</div>
  </div>
  <div class="line not-covered" id="L309">
    <div class="line-number"><a href="#L309">309</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      completely_skip_logging = true</div>
  </div>
  <div class="line not-covered" id="L310">
    <div class="line-number"><a href="#L310">310</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    elseif config.suppress_test_assertions then</div>
  </div>
  <div class="line not-executable" id="L311">
    <div class="line-number"><a href="#L311">311</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Otherwise, only suppress logging for validation and test_expected errors</div>
  </div>
  <div class="line not-covered" id="L312">
    <div class="line-number"><a href="#L312">312</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      if err.category == M.CATEGORY.VALIDATION or err.category == M.CATEGORY.TEST_EXPECTED then</div>
  </div>
  <div class="line not-covered" id="L313">
    <div class="line-number"><a href="#L313">313</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        suppress_logging = true</div>
  </div>
  <div class="line not-covered" id="L314">
    <div class="line-number"><a href="#L314">314</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L315">
    <div class="line-number"><a href="#L315">315</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L316">
    <div class="line-number"><a href="#L316">316</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L317">
    <div class="line-number"><a href="#L317">317</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L318">
    <div class="line-number"><a href="#L318">318</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- When in a test with expect_error flag, handle errors specially</div>
  </div>
  <div class="line not-covered" id="L319">
    <div class="line-number"><a href="#L319">319</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if completely_skip_logging then</div>
  </div>
  <div class="line not-executable" id="L320">
    <div class="line-number"><a href="#L320">320</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Store the error in a global table for potential debugging if needed</div>
  </div>
  <div class="line not-covered" id="L321">
    <div class="line-number"><a href="#L321">321</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    _G._firmo_test_errors = _G._firmo_test_errors or {}</div>
  </div>
  <div class="line not-covered" id="L322">
    <div class="line-number"><a href="#L322">322</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(_G._firmo_test_errors, err)</div>
  </div>
  <div class="line not-executable" id="L323">
    <div class="line-number"><a href="#L323">323</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L324">
    <div class="line-number"><a href="#L324">324</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Don't skip all logging - only downgrade ERROR and WARNING logs to DEBUG</div>
  </div>
  <div class="line not-executable" id="L325">
    <div class="line-number"><a href="#L325">325</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- This allows explicit debug logging to still work</div>
  </div>
  <div class="line not-covered" id="L326">
    <div class="line-number"><a href="#L326">326</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if err.severity == M.SEVERITY.ERROR or err.severity == M.SEVERITY.WARNING then</div>
  </div>
  <div class="line not-covered" id="L327">
    <div class="line-number"><a href="#L327">327</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log_level = &quot;debug&quot;</div>
  </div>
  <div class="line not-covered" id="L328">
    <div class="line-number"><a href="#L328">328</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L329">
    <div class="line-number"><a href="#L329">329</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L330">
    <div class="line-number"><a href="#L330">330</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Additionally check if debug logs are explicitly enabled</div>
  </div>
  <div class="line not-covered" id="L331">
    <div class="line-number"><a href="#L331">331</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local debug_enabled = logger.is_debug_enabled and logger.is_debug_enabled()</div>
  </div>
  <div class="line not-covered" id="L332">
    <div class="line-number"><a href="#L332">332</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if not debug_enabled then</div>
  </div>
  <div class="line not-executable" id="L333">
    <div class="line-number"><a href="#L333">333</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- If debug logs aren't enabled, skip logging entirely</div>
  </div>
  <div class="line not-covered" id="L334">
    <div class="line-number"><a href="#L334">334</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return</div>
  </div>
  <div class="line not-covered" id="L335">
    <div class="line-number"><a href="#L335">335</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L336">
    <div class="line-number"><a href="#L336">336</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Otherwise, continue with debug-level logging</div>
  </div>
  <div class="line not-covered" id="L337">
    <div class="line-number"><a href="#L337">337</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L338">
    <div class="line-number"><a href="#L338">338</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L339">
    <div class="line-number"><a href="#L339">339</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Choose appropriate log level</div>
  </div>
  <div class="line not-covered" id="L340">
    <div class="line-number"><a href="#L340">340</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err.severity == M.SEVERITY.FATAL then</div>
  </div>
  <div class="line not-covered" id="L341">
    <div class="line-number"><a href="#L341">341</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log_level = &quot;error&quot; -- Fatal errors are always logged at error level</div>
  </div>
  <div class="line not-covered" id="L342">
    <div class="line-number"><a href="#L342">342</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif err.severity == M.SEVERITY.ERROR then</div>
  </div>
  <div class="line not-covered" id="L343">
    <div class="line-number"><a href="#L343">343</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log_level = suppress_logging and &quot;debug&quot; or &quot;error&quot;</div>
  </div>
  <div class="line not-covered" id="L344">
    <div class="line-number"><a href="#L344">344</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif err.severity == M.SEVERITY.WARNING then</div>
  </div>
  <div class="line not-covered" id="L345">
    <div class="line-number"><a href="#L345">345</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log_level = suppress_logging and &quot;debug&quot; or &quot;warn&quot;</div>
  </div>
  <div class="line not-covered" id="L346">
    <div class="line-number"><a href="#L346">346</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L347">
    <div class="line-number"><a href="#L347">347</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log_level = suppress_logging and &quot;debug&quot; or &quot;info&quot;</div>
  </div>
  <div class="line not-covered" id="L348">
    <div class="line-number"><a href="#L348">348</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L349">
    <div class="line-number"><a href="#L349">349</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L350">
    <div class="line-number"><a href="#L350">350</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log at the appropriate level</div>
  </div>
  <div class="line not-covered" id="L351">
    <div class="line-number"><a href="#L351">351</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err.severity == M.SEVERITY.FATAL then</div>
  </div>
  <div class="line not-covered" id="L352">
    <div class="line-number"><a href="#L352">352</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(&quot;FATAL: &quot; .. err.message, log_params)</div>
  </div>
  <div class="line not-covered" id="L353">
    <div class="line-number"><a href="#L353">353</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif log_level == &quot;error&quot; then</div>
  </div>
  <div class="line not-covered" id="L354">
    <div class="line-number"><a href="#L354">354</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.error(err.message, log_params)</div>
  </div>
  <div class="line not-covered" id="L355">
    <div class="line-number"><a href="#L355">355</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif log_level == &quot;warn&quot; then</div>
  </div>
  <div class="line not-covered" id="L356">
    <div class="line-number"><a href="#L356">356</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.warn(err.message, log_params)</div>
  </div>
  <div class="line not-covered" id="L357">
    <div class="line-number"><a href="#L357">357</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  elseif log_level == &quot;info&quot; then</div>
  </div>
  <div class="line not-covered" id="L358">
    <div class="line-number"><a href="#L358">358</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.info(err.message, log_params)</div>
  </div>
  <div class="line not-covered" id="L359">
    <div class="line-number"><a href="#L359">359</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else -- debug</div>
  </div>
  <div class="line not-covered" id="L360">
    <div class="line-number"><a href="#L360">360</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(err.message, log_params)</div>
  </div>
  <div class="line not-covered" id="L361">
    <div class="line-number"><a href="#L361">361</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L362">
    <div class="line-number"><a href="#L362">362</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Handle fatal errors</div>
  </div>
  <div class="line not-covered" id="L363">
    <div class="line-number"><a href="#L363">363</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err.severity == M.SEVERITY.FATAL and config.exit_on_fatal then</div>
  </div>
  <div class="line not-covered" id="L364">
    <div class="line-number"><a href="#L364">364</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    os.exit(1)</div>
  </div>
  <div class="line not-covered" id="L365">
    <div class="line-number"><a href="#L365">365</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L366">
    <div class="line-number"><a href="#L366">366</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L367">
    <div class="line-number"><a href="#L367">367</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Internal helper to handle an error</div>
  </div>
  <div class="line not-executable" id="L368">
    <div class="line-number"><a href="#L368">368</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param err table Error object to handle</div>
  </div>
  <div class="line not-executable" id="L369">
    <div class="line-number"><a href="#L369">369</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return nil</div>
  </div>
  <div class="line not-executable" id="L370">
    <div class="line-number"><a href="#L370">370</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table err The error object</div>
  </div>
  <div class="line not-covered" id="L371">
    <div class="line-number"><a href="#L371">371</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local function handle_error(err)</div>
  </div>
  <div class="line not-executable" id="L372">
    <div class="line-number"><a href="#L372">372</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log the error</div>
  </div>
  <div class="line not-covered" id="L373">
    <div class="line-number"><a href="#L373">373</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log_error(err)</div>
  </div>
  <div class="line not-executable" id="L374">
    <div class="line-number"><a href="#L374">374</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Return the error as an object</div>
  </div>
  <div class="line not-covered" id="L375">
    <div class="line-number"><a href="#L375">375</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return nil, err</div>
  </div>
  <div class="line not-covered" id="L376">
    <div class="line-number"><a href="#L376">376</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L377">
    <div class="line-number"><a href="#L377">377</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Initialize the error handler with configuration</div>
  </div>
  <div class="line not-executable" id="L378">
    <div class="line-number"><a href="#L378">378</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param options? table Options to configure the error handler</div>
  </div>
  <div class="line not-executable" id="L379">
    <div class="line-number"><a href="#L379">379</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The error handler module (for chaining)</div>
  </div>
  <div class="line not-covered" id="L380">
    <div class="line-number"><a href="#L380">380</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.configure(options)</div>
  </div>
  <div class="line not-covered" id="L381">
    <div class="line-number"><a href="#L381">381</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if options then</div>
  </div>
  <div class="line not-covered" id="L382">
    <div class="line-number"><a href="#L382">382</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    for k, v in pairs(options) do</div>
  </div>
  <div class="line not-covered" id="L383">
    <div class="line-number"><a href="#L383">383</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      config[k] = v</div>
  </div>
  <div class="line not-covered" id="L384">
    <div class="line-number"><a href="#L384">384</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L385">
    <div class="line-number"><a href="#L385">385</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L386">
    <div class="line-number"><a href="#L386">386</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Configure from central_config if available</div>
  </div>
  <div class="line not-covered" id="L387">
    <div class="line-number"><a href="#L387">387</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local ok, central_config = pcall(require, &quot;lib.core.central_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L388">
    <div class="line-number"><a href="#L388">388</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if ok and central_config then</div>
  </div>
  <div class="line not-executable" id="L389">
    <div class="line-number"><a href="#L389">389</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Register our module with default configuration</div>
  </div>
  <div class="line not-covered" id="L390">
    <div class="line-number"><a href="#L390">390</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    central_config.register_module(&quot;error_handler&quot;, {</div>
  </div>
  <div class="line not-executable" id="L391">
    <div class="line-number"><a href="#L391">391</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Schema definition</div>
  </div>
  <div class="line not-covered" id="L392">
    <div class="line-number"><a href="#L392">392</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      field_types = {</div>
  </div>
  <div class="line not-covered" id="L393">
    <div class="line-number"><a href="#L393">393</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        use_assertions = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L394">
    <div class="line-number"><a href="#L394">394</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        verbose = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L395">
    <div class="line-number"><a href="#L395">395</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        trace_errors = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L396">
    <div class="line-number"><a href="#L396">396</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log_all_errors = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L397">
    <div class="line-number"><a href="#L397">397</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        exit_on_fatal = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L398">
    <div class="line-number"><a href="#L398">398</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        capture_backtraces = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L399">
    <div class="line-number"><a href="#L399">399</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        in_test_run = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L400">
    <div class="line-number"><a href="#L400">400</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        suppress_test_assertions = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L401">
    <div class="line-number"><a href="#L401">401</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-covered" id="L402">
    <div class="line-number"><a href="#L402">402</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    }, {</div>
  </div>
  <div class="line not-executable" id="L403">
    <div class="line-number"><a href="#L403">403</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Default values (matching our local config)</div>
  </div>
  <div class="line not-covered" id="L404">
    <div class="line-number"><a href="#L404">404</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      use_assertions = config.use_assertions,</div>
  </div>
  <div class="line not-covered" id="L405">
    <div class="line-number"><a href="#L405">405</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      verbose = config.verbose,</div>
  </div>
  <div class="line not-covered" id="L406">
    <div class="line-number"><a href="#L406">406</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      trace_errors = config.trace_errors,</div>
  </div>
  <div class="line not-covered" id="L407">
    <div class="line-number"><a href="#L407">407</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log_all_errors = config.log_all_errors,</div>
  </div>
  <div class="line not-covered" id="L408">
    <div class="line-number"><a href="#L408">408</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      exit_on_fatal = config.exit_on_fatal,</div>
  </div>
  <div class="line not-covered" id="L409">
    <div class="line-number"><a href="#L409">409</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      capture_backtraces = config.capture_backtraces,</div>
  </div>
  <div class="line not-covered" id="L410">
    <div class="line-number"><a href="#L410">410</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      in_test_run = config.in_test_run,</div>
  </div>
  <div class="line not-covered" id="L411">
    <div class="line-number"><a href="#L411">411</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      suppress_test_assertions = config.suppress_test_assertions,</div>
  </div>
  <div class="line not-covered" id="L412">
    <div class="line-number"><a href="#L412">412</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L413">
    <div class="line-number"><a href="#L413">413</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L414">
    <div class="line-number"><a href="#L414">414</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Now get configuration (will include our defaults if not yet set)</div>
  </div>
  <div class="line not-covered" id="L415">
    <div class="line-number"><a href="#L415">415</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local error_handler_config = central_config.get(&quot;error_handler&quot;)</div>
  </div>
  <div class="line not-covered" id="L416">
    <div class="line-number"><a href="#L416">416</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if error_handler_config then</div>
  </div>
  <div class="line not-covered" id="L417">
    <div class="line-number"><a href="#L417">417</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      for k, v in pairs(error_handler_config) do</div>
  </div>
  <div class="line not-covered" id="L418">
    <div class="line-number"><a href="#L418">418</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        config[k] = v</div>
  </div>
  <div class="line not-covered" id="L419">
    <div class="line-number"><a href="#L419">419</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      end</div>
  </div>
  <div class="line not-covered" id="L420">
    <div class="line-number"><a href="#L420">420</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L421">
    <div class="line-number"><a href="#L421">421</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L422">
    <div class="line-number"><a href="#L422">422</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L423">
    <div class="line-number"><a href="#L423">423</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L424">
    <div class="line-number"><a href="#L424">424</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create an error object</div>
  </div>
  <div class="line not-executable" id="L425">
    <div class="line-number"><a href="#L425">425</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message</div>
  </div>
  <div class="line not-executable" id="L426">
    <div class="line-number"><a href="#L426">426</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param category? string The error category (defaults to UNKNOWN)</div>
  </div>
  <div class="line not-executable" id="L427">
    <div class="line-number"><a href="#L427">427</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param severity? string The error severity (defaults to ERROR)</div>
  </div>
  <div class="line not-executable" id="L428">
    <div class="line-number"><a href="#L428">428</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L429">
    <div class="line-number"><a href="#L429">429</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param cause? table|string The cause of the error</div>
  </div>
  <div class="line not-executable" id="L430">
    <div class="line-number"><a href="#L430">430</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The error object</div>
  </div>
  <div class="line not-covered" id="L431">
    <div class="line-number"><a href="#L431">431</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.create(message, category, severity, context, cause)</div>
  </div>
  <div class="line not-covered" id="L432">
    <div class="line-number"><a href="#L432">432</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return create_error(message, category, severity, context, cause)</div>
  </div>
  <div class="line not-covered" id="L433">
    <div class="line-number"><a href="#L433">433</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L434">
    <div class="line-number"><a href="#L434">434</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Throw an error with proper logging</div>
  </div>
  <div class="line not-executable" id="L435">
    <div class="line-number"><a href="#L435">435</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message</div>
  </div>
  <div class="line not-executable" id="L436">
    <div class="line-number"><a href="#L436">436</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param category? string The error category (defaults to UNKNOWN)</div>
  </div>
  <div class="line not-executable" id="L437">
    <div class="line-number"><a href="#L437">437</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param severity? string The error severity (defaults to ERROR)</div>
  </div>
  <div class="line not-executable" id="L438">
    <div class="line-number"><a href="#L438">438</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L439">
    <div class="line-number"><a href="#L439">439</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param cause? table|string The cause of the error</div>
  </div>
  <div class="line not-executable" id="L440">
    <div class="line-number"><a href="#L440">440</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return nil Never returns, always throws an error</div>
  </div>
  <div class="line not-covered" id="L441">
    <div class="line-number"><a href="#L441">441</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.throw(message, category, severity, context, cause)</div>
  </div>
  <div class="line not-covered" id="L442">
    <div class="line-number"><a href="#L442">442</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local err = create_error(message, category, severity, context, cause)</div>
  </div>
  <div class="line not-covered" id="L443">
    <div class="line-number"><a href="#L443">443</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log_error(err)</div>
  </div>
  <div class="line not-covered" id="L444">
    <div class="line-number"><a href="#L444">444</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  error(err.message, 2) -- Level 2 to point to the caller</div>
  </div>
  <div class="line not-covered" id="L445">
    <div class="line-number"><a href="#L445">445</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L446">
    <div class="line-number"><a href="#L446">446</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Assert a condition or throw an error</div>
  </div>
  <div class="line not-executable" id="L447">
    <div class="line-number"><a href="#L447">447</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param condition boolean The condition to check</div>
  </div>
  <div class="line not-executable" id="L448">
    <div class="line-number"><a href="#L448">448</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message if condition is false</div>
  </div>
  <div class="line not-executable" id="L449">
    <div class="line-number"><a href="#L449">449</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param category? string The error category (defaults to UNKNOWN)</div>
  </div>
  <div class="line not-executable" id="L450">
    <div class="line-number"><a href="#L450">450</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L451">
    <div class="line-number"><a href="#L451">451</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param cause? table|string The cause of the error</div>
  </div>
  <div class="line not-executable" id="L452">
    <div class="line-number"><a href="#L452">452</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean The condition value (always true if no error)</div>
  </div>
  <div class="line not-covered" id="L453">
    <div class="line-number"><a href="#L453">453</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.assert(condition, message, category, context, cause)</div>
  </div>
  <div class="line not-covered" id="L454">
    <div class="line-number"><a href="#L454">454</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not condition then</div>
  </div>
  <div class="line not-covered" id="L455">
    <div class="line-number"><a href="#L455">455</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local severity = M.SEVERITY.ERROR</div>
  </div>
  <div class="line not-covered" id="L456">
    <div class="line-number"><a href="#L456">456</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = create_error(message, category, severity, context, cause)</div>
  </div>
  <div class="line not-covered" id="L457">
    <div class="line-number"><a href="#L457">457</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log_error(err)</div>
  </div>
  <div class="line not-covered" id="L458">
    <div class="line-number"><a href="#L458">458</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if config.use_assertions then</div>
  </div>
  <div class="line not-covered" id="L459">
    <div class="line-number"><a href="#L459">459</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      assert(false, err.message)</div>
  </div>
  <div class="line not-covered" id="L460">
    <div class="line-number"><a href="#L460">460</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L461">
    <div class="line-number"><a href="#L461">461</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error(err.message, 2) -- Level 2 to point to the caller</div>
  </div>
  <div class="line not-covered" id="L462">
    <div class="line-number"><a href="#L462">462</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L463">
    <div class="line-number"><a href="#L463">463</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L464">
    <div class="line-number"><a href="#L464">464</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return condition</div>
  </div>
  <div class="line not-covered" id="L465">
    <div class="line-number"><a href="#L465">465</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L466">
    <div class="line-number"><a href="#L466">466</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- REMOVED: Assert functions were moved to firmo.assert</div>
  </div>
  <div class="line not-executable" id="L467">
    <div class="line-number"><a href="#L467">467</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Compatibility function for table unpacking (works with both Lua 5.1 and 5.2+)</div>
  </div>
  <div class="line not-covered" id="L468">
    <div class="line-number"><a href="#L468">468</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local unpack_table = table.unpack or unpack</div>
  </div>
  <div class="line not-executable" id="L469">
    <div class="line-number"><a href="#L469">469</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Safely call a function and catch any errors (try/catch pattern)</div>
  </div>
  <div class="line not-executable" id="L470">
    <div class="line-number"><a href="#L470">470</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Executes a function in protected mode with proper error handling. This is the</div>
  </div>
  <div class="line not-executable" id="L471">
    <div class="line-number"><a href="#L471">471</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- primary error handling pattern throughout the Firmo framework, providing a</div>
  </div>
  <div class="line not-executable" id="L472">
    <div class="line-number"><a href="#L472">472</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- clean try/catch pattern with standardized error objects.</div>
  </div>
  <div class="line not-executable" id="L473">
    <div class="line-number"><a href="#L473">473</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L474">
    <div class="line-number"><a href="#L474">474</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param func function The function to execute safely</div>
  </div>
  <div class="line not-executable" id="L475">
    <div class="line-number"><a href="#L475">475</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param ... any Arguments to pass to the function</div>
  </div>
  <div class="line not-executable" id="L476">
    <div class="line-number"><a href="#L476">476</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return boolean success Whether the function execution succeeded</div>
  </div>
  <div class="line not-executable" id="L477">
    <div class="line-number"><a href="#L477">477</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return any result The function's return value(s) if successful, or an error object if failed</div>
  </div>
  <div class="line not-executable" id="L478">
    <div class="line-number"><a href="#L478">478</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return any additional_results Additional return values from the function (if successful)</div>
  </div>
  <div class="line not-executable" id="L479">
    <div class="line-number"><a href="#L479">479</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L480">
    <div class="line-number"><a href="#L480">480</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L481">
    <div class="line-number"><a href="#L481">481</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Basic usage:</div>
  </div>
  <div class="line not-executable" id="L482">
    <div class="line-number"><a href="#L482">482</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, result, err = error_handler.try(function()</div>
  </div>
  <div class="line not-executable" id="L483">
    <div class="line-number"><a href="#L483">483</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return potentially_failing_function()</div>
  </div>
  <div class="line not-executable" id="L484">
    <div class="line-number"><a href="#L484">484</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end)</div>
  </div>
  <div class="line not-executable" id="L485">
    <div class="line-number"><a href="#L485">485</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L486">
    <div class="line-number"><a href="#L486">486</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not success then</div>
  </div>
  <div class="line not-executable" id="L487">
    <div class="line-number"><a href="#L487">487</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Handle error (result contains the error object)</div>
  </div>
  <div class="line not-executable" id="L488">
    <div class="line-number"><a href="#L488">488</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Error:&quot;, result.message)</div>
  </div>
  <div class="line not-executable" id="L489">
    <div class="line-number"><a href="#L489">489</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return nil, result</div>
  </div>
  <div class="line not-executable" id="L490">
    <div class="line-number"><a href="#L490">490</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- else</div>
  </div>
  <div class="line not-executable" id="L491">
    <div class="line-number"><a href="#L491">491</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Use the result</div>
  </div>
  <div class="line not-executable" id="L492">
    <div class="line-number"><a href="#L492">492</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return result</div>
  </div>
  <div class="line not-executable" id="L493">
    <div class="line-number"><a href="#L493">493</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L494">
    <div class="line-number"><a href="#L494">494</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L495">
    <div class="line-number"><a href="#L495">495</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- With arguments:</div>
  </div>
  <div class="line not-executable" id="L496">
    <div class="line-number"><a href="#L496">496</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local success, result = error_handler.try(function(a, b)</div>
  </div>
  <div class="line not-executable" id="L497">
    <div class="line-number"><a href="#L497">497</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return a + b</div>
  </div>
  <div class="line not-executable" id="L498">
    <div class="line-number"><a href="#L498">498</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end, 5, 10)</div>
  </div>
  <div class="line not-executable" id="L499">
    <div class="line-number"><a href="#L499">499</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- result will be 15 if successful</div>
  </div>
  <div class="line covered" id="L500">
    <div class="line-number"><a href="#L500">500</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.try(func, ...)</div>
  </div>
  <div class="line covered" id="L501">
    <div class="line-number"><a href="#L501">501</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local result = { pcall(func, ...) }</div>
  </div>
  <div class="line covered" id="L502">
    <div class="line-number"><a href="#L502">502</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  local success = table.remove(result, 1)</div>
  </div>
  <div class="line covered" id="L503">
    <div class="line-number"><a href="#L503">503</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if success then</div>
  </div>
  <div class="line covered" id="L504">
    <div class="line-number"><a href="#L504">504</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    return true, unpack_table(result)</div>
  </div>
  <div class="line covered" id="L505">
    <div class="line-number"><a href="#L505">505</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  else</div>
  </div>
  <div class="line covered" id="L506">
    <div class="line-number"><a href="#L506">506</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    local err_message = result[1]</div>
  </div>
  <div class="line not-executable" id="L507">
    <div class="line-number"><a href="#L507">507</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Check if the error is already one of our error objects</div>
  </div>
  <div class="line covered" id="L508">
    <div class="line-number"><a href="#L508">508</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if type(err_message) == &quot;table&quot; and err_message.category then</div>
  </div>
  <div class="line not-covered" id="L509">
    <div class="line-number"><a href="#L509">509</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log_error(err_message)</div>
  </div>
  <div class="line not-covered" id="L510">
    <div class="line-number"><a href="#L510">510</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return false, err_message</div>
  </div>
  <div class="line not-covered" id="L511">
    <div class="line-number"><a href="#L511">511</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-executable" id="L512">
    <div class="line-number"><a href="#L512">512</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Create an error object</div>
  </div>
  <div class="line not-covered" id="L513">
    <div class="line-number"><a href="#L513">513</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local err = create_error(tostring(err_message), M.CATEGORY.RUNTIME, M.SEVERITY.ERROR, { args = { ... } })</div>
  </div>
  <div class="line not-covered" id="L514">
    <div class="line-number"><a href="#L514">514</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    log_error(err)</div>
  </div>
  <div class="line not-covered" id="L515">
    <div class="line-number"><a href="#L515">515</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false, err</div>
  </div>
  <div class="line not-covered" id="L516">
    <div class="line-number"><a href="#L516">516</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L517">
    <div class="line-number"><a href="#L517">517</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L518">
    <div class="line-number"><a href="#L518">518</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a validation error object</div>
  </div>
  <div class="line not-executable" id="L519">
    <div class="line-number"><a href="#L519">519</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Creates a standardized error object for validation failures, such as</div>
  </div>
  <div class="line not-executable" id="L520">
    <div class="line-number"><a href="#L520">520</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- invalid parameters, missing required values, or type mismatches.</div>
  </div>
  <div class="line not-executable" id="L521">
    <div class="line-number"><a href="#L521">521</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Validation errors are automatically recognized by the test system and</div>
  </div>
  <div class="line not-executable" id="L522">
    <div class="line-number"><a href="#L522">522</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- can be suppressed in test environments that expect them.</div>
  </div>
  <div class="line not-executable" id="L523">
    <div class="line-number"><a href="#L523">523</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L524">
    <div class="line-number"><a href="#L524">524</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param message string The human-readable error message</div>
  </div>
  <div class="line not-executable" id="L525">
    <div class="line-number"><a href="#L525">525</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param context? table Additional context information (key-value pairs)</div>
  </div>
  <div class="line not-executable" id="L526">
    <div class="line-number"><a href="#L526">526</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table The structured validation error object</div>
  </div>
  <div class="line not-executable" id="L527">
    <div class="line-number"><a href="#L527">527</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L528">
    <div class="line-number"><a href="#L528">528</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L529">
    <div class="line-number"><a href="#L529">529</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Basic validation error</div>
  </div>
  <div class="line not-executable" id="L530">
    <div class="line-number"><a href="#L530">530</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if type(filename) ~= &quot;string&quot; then</div>
  </div>
  <div class="line not-executable" id="L531">
    <div class="line-number"><a href="#L531">531</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return nil, error_handler.validation_error(</div>
  </div>
  <div class="line not-executable" id="L532">
    <div class="line-number"><a href="#L532">532</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     &quot;Filename must be a string&quot;, </div>
  </div>
  <div class="line not-executable" id="L533">
    <div class="line-number"><a href="#L533">533</a></div>
    <div class="execution-count"></div>    <div class="line-content">---     {parameter_name = &quot;filename&quot;, provided_type = type(filename)}</div>
  </div>
  <div class="line not-executable" id="L534">
    <div class="line-number"><a href="#L534">534</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   )</div>
  </div>
  <div class="line not-executable" id="L535">
    <div class="line-number"><a href="#L535">535</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-covered" id="L536">
    <div class="line-number"><a href="#L536">536</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.validation_error(message, context)</div>
  </div>
  <div class="line not-covered" id="L537">
    <div class="line-number"><a href="#L537">537</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return create_error(message, M.CATEGORY.VALIDATION, M.SEVERITY.ERROR, context)</div>
  </div>
  <div class="line not-covered" id="L538">
    <div class="line-number"><a href="#L538">538</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L539">
    <div class="line-number"><a href="#L539">539</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create an I/O error object</div>
  </div>
  <div class="line not-executable" id="L540">
    <div class="line-number"><a href="#L540">540</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message</div>
  </div>
  <div class="line not-executable" id="L541">
    <div class="line-number"><a href="#L541">541</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L542">
    <div class="line-number"><a href="#L542">542</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param cause? table|string The cause of the error</div>
  </div>
  <div class="line not-executable" id="L543">
    <div class="line-number"><a href="#L543">543</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The I/O error object</div>
  </div>
  <div class="line not-covered" id="L544">
    <div class="line-number"><a href="#L544">544</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.io_error(message, context, cause)</div>
  </div>
  <div class="line not-covered" id="L545">
    <div class="line-number"><a href="#L545">545</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return create_error(message, M.CATEGORY.IO, M.SEVERITY.ERROR, context, cause)</div>
  </div>
  <div class="line covered" id="L546">
    <div class="line-number"><a href="#L546">546</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L547">
    <div class="line-number"><a href="#L547">547</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a parse error object</div>
  </div>
  <div class="line not-executable" id="L548">
    <div class="line-number"><a href="#L548">548</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message</div>
  </div>
  <div class="line not-executable" id="L549">
    <div class="line-number"><a href="#L549">549</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L550">
    <div class="line-number"><a href="#L550">550</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param cause? table|string The cause of the error</div>
  </div>
  <div class="line not-executable" id="L551">
    <div class="line-number"><a href="#L551">551</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The parse error object</div>
  </div>
  <div class="line covered" id="L552">
    <div class="line-number"><a href="#L552">552</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.parse_error(message, context, cause)</div>
  </div>
  <div class="line covered" id="L553">
    <div class="line-number"><a href="#L553">553</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return create_error(message, M.CATEGORY.PARSE, M.SEVERITY.ERROR, context, cause)</div>
  </div>
  <div class="line covered" id="L554">
    <div class="line-number"><a href="#L554">554</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L555">
    <div class="line-number"><a href="#L555">555</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a timeout error object</div>
  </div>
  <div class="line not-executable" id="L556">
    <div class="line-number"><a href="#L556">556</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message</div>
  </div>
  <div class="line not-executable" id="L557">
    <div class="line-number"><a href="#L557">557</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L558">
    <div class="line-number"><a href="#L558">558</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The timeout error object</div>
  </div>
  <div class="line covered" id="L559">
    <div class="line-number"><a href="#L559">559</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.timeout_error(message, context)</div>
  </div>
  <div class="line covered" id="L560">
    <div class="line-number"><a href="#L560">560</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return create_error(message, M.CATEGORY.TIMEOUT, M.SEVERITY.ERROR, context)</div>
  </div>
  <div class="line covered" id="L561">
    <div class="line-number"><a href="#L561">561</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L562">
    <div class="line-number"><a href="#L562">562</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a configuration error object</div>
  </div>
  <div class="line not-executable" id="L563">
    <div class="line-number"><a href="#L563">563</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message</div>
  </div>
  <div class="line not-executable" id="L564">
    <div class="line-number"><a href="#L564">564</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L565">
    <div class="line-number"><a href="#L565">565</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The configuration error object</div>
  </div>
  <div class="line covered" id="L566">
    <div class="line-number"><a href="#L566">566</a></div>
    <div class="execution-count">1</div>    <div class="line-content">function M.config_error(message, context)</div>
  </div>
  <div class="line covered" id="L567">
    <div class="line-number"><a href="#L567">567</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return create_error(message, M.CATEGORY.CONFIGURATION, M.SEVERITY.ERROR, context)</div>
  </div>
  <div class="line not-covered" id="L568">
    <div class="line-number"><a href="#L568">568</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L569">
    <div class="line-number"><a href="#L569">569</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a runtime error object</div>
  </div>
  <div class="line not-executable" id="L570">
    <div class="line-number"><a href="#L570">570</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message</div>
  </div>
  <div class="line not-executable" id="L571">
    <div class="line-number"><a href="#L571">571</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L572">
    <div class="line-number"><a href="#L572">572</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param cause? table|string The cause of the error</div>
  </div>
  <div class="line not-executable" id="L573">
    <div class="line-number"><a href="#L573">573</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The runtime error object</div>
  </div>
  <div class="line not-covered" id="L574">
    <div class="line-number"><a href="#L574">574</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.runtime_error(message, context, cause)</div>
  </div>
  <div class="line not-covered" id="L575">
    <div class="line-number"><a href="#L575">575</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return create_error(message, M.CATEGORY.RUNTIME, M.SEVERITY.ERROR, context, cause)</div>
  </div>
  <div class="line not-covered" id="L576">
    <div class="line-number"><a href="#L576">576</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L577">
    <div class="line-number"><a href="#L577">577</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a fatal error object</div>
  </div>
  <div class="line not-executable" id="L578">
    <div class="line-number"><a href="#L578">578</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message</div>
  </div>
  <div class="line not-executable" id="L579">
    <div class="line-number"><a href="#L579">579</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param category? string The error category (defaults to UNKNOWN)</div>
  </div>
  <div class="line not-executable" id="L580">
    <div class="line-number"><a href="#L580">580</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L581">
    <div class="line-number"><a href="#L581">581</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param cause? table|string The cause of the error</div>
  </div>
  <div class="line not-executable" id="L582">
    <div class="line-number"><a href="#L582">582</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The fatal error object</div>
  </div>
  <div class="line not-covered" id="L583">
    <div class="line-number"><a href="#L583">583</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.fatal_error(message, category, context, cause)</div>
  </div>
  <div class="line not-covered" id="L584">
    <div class="line-number"><a href="#L584">584</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return create_error(message, category or M.CATEGORY.UNKNOWN, M.SEVERITY.FATAL, context, cause)</div>
  </div>
  <div class="line not-covered" id="L585">
    <div class="line-number"><a href="#L585">585</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L586">
    <div class="line-number"><a href="#L586">586</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Create a test expected error object (for use in test stubs, mocks, etc.)</div>
  </div>
  <div class="line not-executable" id="L587">
    <div class="line-number"><a href="#L587">587</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param message string The error message</div>
  </div>
  <div class="line not-executable" id="L588">
    <div class="line-number"><a href="#L588">588</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param context? table Additional context for the error</div>
  </div>
  <div class="line not-executable" id="L589">
    <div class="line-number"><a href="#L589">589</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param cause? table|string The cause of the error</div>
  </div>
  <div class="line not-executable" id="L590">
    <div class="line-number"><a href="#L590">590</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The test expected error object</div>
  </div>
  <div class="line not-covered" id="L591">
    <div class="line-number"><a href="#L591">591</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.test_expected_error(message, context, cause)</div>
  </div>
  <div class="line not-covered" id="L592">
    <div class="line-number"><a href="#L592">592</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return create_error(message, M.CATEGORY.TEST_EXPECTED, M.SEVERITY.ERROR, context, cause)</div>
  </div>
  <div class="line not-covered" id="L593">
    <div class="line-number"><a href="#L593">593</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L594">
    <div class="line-number"><a href="#L594">594</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Safely execute an I/O operation with proper error handling</div>
  </div>
  <div class="line not-executable" id="L595">
    <div class="line-number"><a href="#L595">595</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Wraps file system operations with standardized error handling, automatically</div>
  </div>
  <div class="line not-executable" id="L596">
    <div class="line-number"><a href="#L596">596</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- adding the file path to error context and creating detailed I/O error objects.</div>
  </div>
  <div class="line not-executable" id="L597">
    <div class="line-number"><a href="#L597">597</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- This is the preferred way to perform any file operations throughout the framework.</div>
  </div>
  <div class="line not-executable" id="L598">
    <div class="line-number"><a href="#L598">598</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L599">
    <div class="line-number"><a href="#L599">599</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param operation function The I/O operation function to execute (must return result, err pattern)</div>
  </div>
  <div class="line not-executable" id="L600">
    <div class="line-number"><a href="#L600">600</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param file_path string The file path being operated on</div>
  </div>
  <div class="line not-executable" id="L601">
    <div class="line-number"><a href="#L601">601</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param context? table Additional context information for error reporting</div>
  </div>
  <div class="line not-executable" id="L602">
    <div class="line-number"><a href="#L602">602</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @param transform_result? fun(result:any):any Optional function to transform the success result</div>
  </div>
  <div class="line not-executable" id="L603">
    <div class="line-number"><a href="#L603">603</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return any|nil result The result of the operation or nil on error</div>
  </div>
  <div class="line not-executable" id="L604">
    <div class="line-number"><a href="#L604">604</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @return table|nil error_obj The structured error object on failure</div>
  </div>
  <div class="line not-executable" id="L605">
    <div class="line-number"><a href="#L605">605</a></div>
    <div class="execution-count"></div>    <div class="line-content">---</div>
  </div>
  <div class="line not-executable" id="L606">
    <div class="line-number"><a href="#L606">606</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- @usage</div>
  </div>
  <div class="line not-executable" id="L607">
    <div class="line-number"><a href="#L607">607</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- Read a file safely</div>
  </div>
  <div class="line not-executable" id="L608">
    <div class="line-number"><a href="#L608">608</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local content, err = error_handler.safe_io_operation(</div>
  </div>
  <div class="line not-executable" id="L609">
    <div class="line-number"><a href="#L609">609</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   function() return fs.read_file(&quot;config.json&quot;) end,</div>
  </div>
  <div class="line not-executable" id="L610">
    <div class="line-number"><a href="#L610">610</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   &quot;config.json&quot;,</div>
  </div>
  <div class="line not-executable" id="L611">
    <div class="line-number"><a href="#L611">611</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   {operation = &quot;read_config&quot;}</div>
  </div>
  <div class="line not-executable" id="L612">
    <div class="line-number"><a href="#L612">612</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- )</div>
  </div>
  <div class="line not-executable" id="L613">
    <div class="line-number"><a href="#L613">613</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L614">
    <div class="line-number"><a href="#L614">614</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- if not content then</div>
  </div>
  <div class="line not-executable" id="L615">
    <div class="line-number"><a href="#L615">615</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   -- Handle error</div>
  </div>
  <div class="line not-executable" id="L616">
    <div class="line-number"><a href="#L616">616</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   print(&quot;Failed to read config: &quot; .. err.message)</div>
  </div>
  <div class="line not-executable" id="L617">
    <div class="line-number"><a href="#L617">617</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   return nil, err</div>
  </div>
  <div class="line not-executable" id="L618">
    <div class="line-number"><a href="#L618">618</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- end</div>
  </div>
  <div class="line not-executable" id="L619">
    <div class="line-number"><a href="#L619">619</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- </div>
  </div>
  <div class="line not-executable" id="L620">
    <div class="line-number"><a href="#L620">620</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- -- With result transformation</div>
  </div>
  <div class="line not-executable" id="L621">
    <div class="line-number"><a href="#L621">621</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- local data, err = error_handler.safe_io_operation(</div>
  </div>
  <div class="line not-executable" id="L622">
    <div class="line-number"><a href="#L622">622</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   function() return fs.read_file(&quot;config.json&quot;) end,</div>
  </div>
  <div class="line not-executable" id="L623">
    <div class="line-number"><a href="#L623">623</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   &quot;config.json&quot;,</div>
  </div>
  <div class="line not-executable" id="L624">
    <div class="line-number"><a href="#L624">624</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   {operation = &quot;parse_config&quot;},</div>
  </div>
  <div class="line not-executable" id="L625">
    <div class="line-number"><a href="#L625">625</a></div>
    <div class="execution-count"></div>    <div class="line-content">---   function(content) return json.decode(content) end</div>
  </div>
  <div class="line not-executable" id="L626">
    <div class="line-number"><a href="#L626">626</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- )</div>
  </div>
  <div class="line not-covered" id="L627">
    <div class="line-number"><a href="#L627">627</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.safe_io_operation(operation, file_path, context, transform_result)</div>
  </div>
  <div class="line not-covered" id="L628">
    <div class="line-number"><a href="#L628">628</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  transform_result = transform_result or function(result)</div>
  </div>
  <div class="line not-covered" id="L629">
    <div class="line-number"><a href="#L629">629</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return result</div>
  </div>
  <div class="line not-covered" id="L630">
    <div class="line-number"><a href="#L630">630</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L631">
    <div class="line-number"><a href="#L631">631</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local result, err = operation()</div>
  </div>
  <div class="line not-covered" id="L632">
    <div class="line-number"><a href="#L632">632</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if result ~= nil or err == nil then</div>
  </div>
  <div class="line not-executable" id="L633">
    <div class="line-number"><a href="#L633">633</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Either operation succeeded (result is not nil) or</div>
  </div>
  <div class="line not-executable" id="L634">
    <div class="line-number"><a href="#L634">634</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- operation returned nil, nil (no error, just negative result, e.g., file doesn't exist)</div>
  </div>
  <div class="line not-covered" id="L635">
    <div class="line-number"><a href="#L635">635</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return transform_result(result)</div>
  </div>
  <div class="line not-covered" id="L636">
    <div class="line-number"><a href="#L636">636</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L637">
    <div class="line-number"><a href="#L637">637</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add file path to context</div>
  </div>
  <div class="line not-covered" id="L638">
    <div class="line-number"><a href="#L638">638</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  context = context or {}</div>
  </div>
  <div class="line not-covered" id="L639">
    <div class="line-number"><a href="#L639">639</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  context.file_path = file_path</div>
  </div>
  <div class="line not-executable" id="L640">
    <div class="line-number"><a href="#L640">640</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Create an I/O error</div>
  </div>
  <div class="line not-covered" id="L641">
    <div class="line-number"><a href="#L641">641</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local error_obj = M.io_error((err or &quot;I/O operation failed: &quot;) .. tostring(file_path), context, err)</div>
  </div>
  <div class="line not-executable" id="L642">
    <div class="line-number"><a href="#L642">642</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log and return</div>
  </div>
  <div class="line not-covered" id="L643">
    <div class="line-number"><a href="#L643">643</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  log_error(error_obj)</div>
  </div>
  <div class="line not-covered" id="L644">
    <div class="line-number"><a href="#L644">644</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return nil, error_obj</div>
  </div>
  <div class="line not-covered" id="L645">
    <div class="line-number"><a href="#L645">645</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L646">
    <div class="line-number"><a href="#L646">646</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if a value is an error object</div>
  </div>
  <div class="line not-executable" id="L647">
    <div class="line-number"><a href="#L647">647</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param value any The value to check</div>
  </div>
  <div class="line not-executable" id="L648">
    <div class="line-number"><a href="#L648">648</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean Whether the value is an error object</div>
  </div>
  <div class="line not-covered" id="L649">
    <div class="line-number"><a href="#L649">649</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.is_error(value)</div>
  </div>
  <div class="line not-covered" id="L650">
    <div class="line-number"><a href="#L650">650</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return type(value) == &quot;table&quot; and value.message ~= nil and value.category ~= nil and value.severity ~= nil</div>
  </div>
  <div class="line not-covered" id="L651">
    <div class="line-number"><a href="#L651">651</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L652">
    <div class="line-number"><a href="#L652">652</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Add a metatable to error objects for better string conversion</div>
  </div>
  <div class="line not-covered" id="L653">
    <div class="line-number"><a href="#L653">653</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local mt = {</div>
  </div>
  <div class="line not-covered" id="L654">
    <div class="line-number"><a href="#L654">654</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  __tostring = function(err)</div>
  </div>
  <div class="line not-covered" id="L655">
    <div class="line-number"><a href="#L655">655</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(err) == &quot;table&quot; and err.message then</div>
  </div>
  <div class="line not-covered" id="L656">
    <div class="line-number"><a href="#L656">656</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return err.message</div>
  </div>
  <div class="line not-covered" id="L657">
    <div class="line-number"><a href="#L657">657</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L658">
    <div class="line-number"><a href="#L658">658</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return tostring(err)</div>
  </div>
  <div class="line not-covered" id="L659">
    <div class="line-number"><a href="#L659">659</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L660">
    <div class="line-number"><a href="#L660">660</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L661">
    <div class="line-number"><a href="#L661">661</a></div>
    <div class="execution-count">0</div>    <div class="line-content">}</div>
  </div>
  <div class="line not-executable" id="L662">
    <div class="line-number"><a href="#L662">662</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Update the create_error function to set metatable</div>
  </div>
  <div class="line not-covered" id="L663">
    <div class="line-number"><a href="#L663">663</a></div>
    <div class="execution-count">0</div>    <div class="line-content">local original_create_error = create_error</div>
  </div>
  <div class="line not-covered" id="L664">
    <div class="line-number"><a href="#L664">664</a></div>
    <div class="execution-count">0</div>    <div class="line-content">create_error = function(message, category, severity, context, cause)</div>
  </div>
  <div class="line not-covered" id="L665">
    <div class="line-number"><a href="#L665">665</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local err = original_create_error(message, category, severity, context, cause)</div>
  </div>
  <div class="line not-covered" id="L666">
    <div class="line-number"><a href="#L666">666</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return setmetatable(err, mt)</div>
  </div>
  <div class="line not-covered" id="L667">
    <div class="line-number"><a href="#L667">667</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L668">
    <div class="line-number"><a href="#L668">668</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Format an error object for display</div>
  </div>
  <div class="line not-executable" id="L669">
    <div class="line-number"><a href="#L669">669</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param err table|string The error object or string to format</div>
  </div>
  <div class="line not-executable" id="L670">
    <div class="line-number"><a href="#L670">670</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param include_traceback? boolean Whether to include the traceback in the output</div>
  </div>
  <div class="line not-executable" id="L671">
    <div class="line-number"><a href="#L671">671</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return string The formatted error string</div>
  </div>
  <div class="line not-covered" id="L672">
    <div class="line-number"><a href="#L672">672</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.format_error(err, include_traceback)</div>
  </div>
  <div class="line not-covered" id="L673">
    <div class="line-number"><a href="#L673">673</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not M.is_error(err) then</div>
  </div>
  <div class="line not-covered" id="L674">
    <div class="line-number"><a href="#L674">674</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if type(err) == &quot;string&quot; then</div>
  </div>
  <div class="line not-covered" id="L675">
    <div class="line-number"><a href="#L675">675</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return err</div>
  </div>
  <div class="line not-covered" id="L676">
    <div class="line-number"><a href="#L676">676</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    else</div>
  </div>
  <div class="line not-covered" id="L677">
    <div class="line-number"><a href="#L677">677</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      return tostring(err)</div>
  </div>
  <div class="line not-covered" id="L678">
    <div class="line-number"><a href="#L678">678</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L679">
    <div class="line-number"><a href="#L679">679</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L680">
    <div class="line-number"><a href="#L680">680</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local parts = {</div>
  </div>
  <div class="line not-covered" id="L681">
    <div class="line-number"><a href="#L681">681</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    string.format(&quot;[%s] %s: %s&quot;, err.severity, err.category, err.message),</div>
  </div>
  <div class="line not-covered" id="L682">
    <div class="line-number"><a href="#L682">682</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  }</div>
  </div>
  <div class="line not-executable" id="L683">
    <div class="line-number"><a href="#L683">683</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add source location if available</div>
  </div>
  <div class="line not-covered" id="L684">
    <div class="line-number"><a href="#L684">684</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if err.source_file and err.source_line then</div>
  </div>
  <div class="line not-covered" id="L685">
    <div class="line-number"><a href="#L685">685</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    table.insert(parts, string.format(&quot; (at %s:%d)&quot;, err.source_file, err.source_line))</div>
  </div>
  <div class="line covered" id="L686">
    <div class="line-number"><a href="#L686">686</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L687">
    <div class="line-number"><a href="#L687">687</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add context if available and not empty</div>
  </div>
  <div class="line covered" id="L688">
    <div class="line-number"><a href="#L688">688</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if err.context and next(err.context) then</div>
  </div>
  <div class="line covered" id="L689">
    <div class="line-number"><a href="#L689">689</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    table.insert(parts, &quot;\nContext:&quot;)</div>
  </div>
  <div class="line covered" id="L690">
    <div class="line-number"><a href="#L690">690</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    for k, v in pairs(err.context) do</div>
  </div>
  <div class="line covered" id="L691">
    <div class="line-number"><a href="#L691">691</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      table.insert(parts, string.format(&quot;  %s: %s&quot;, k, tostring(v)))</div>
  </div>
  <div class="line covered" id="L692">
    <div class="line-number"><a href="#L692">692</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L693">
    <div class="line-number"><a href="#L693">693</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L694">
    <div class="line-number"><a href="#L694">694</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add cause if available</div>
  </div>
  <div class="line covered" id="L695">
    <div class="line-number"><a href="#L695">695</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if err.cause then</div>
  </div>
  <div class="line covered" id="L696">
    <div class="line-number"><a href="#L696">696</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    if type(err.cause) == &quot;table&quot; and err.cause.message then</div>
  </div>
  <div class="line covered" id="L697">
    <div class="line-number"><a href="#L697">697</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      table.insert(parts, &quot;\nCaused by: &quot; .. err.cause.message)</div>
  </div>
  <div class="line covered" id="L698">
    <div class="line-number"><a href="#L698">698</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    else</div>
  </div>
  <div class="line covered" id="L699">
    <div class="line-number"><a href="#L699">699</a></div>
    <div class="execution-count">1</div>    <div class="line-content">      table.insert(parts, &quot;\nCaused by: &quot; .. tostring(err.cause))</div>
  </div>
  <div class="line covered" id="L700">
    <div class="line-number"><a href="#L700">700</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    end</div>
  </div>
  <div class="line covered" id="L701">
    <div class="line-number"><a href="#L701">701</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L702">
    <div class="line-number"><a href="#L702">702</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Add traceback if requested and available</div>
  </div>
  <div class="line covered" id="L703">
    <div class="line-number"><a href="#L703">703</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  if include_traceback and err.traceback then</div>
  </div>
  <div class="line covered" id="L704">
    <div class="line-number"><a href="#L704">704</a></div>
    <div class="execution-count">1</div>    <div class="line-content">    table.insert(parts, &quot;\nTraceback:&quot; .. err.traceback)</div>
  </div>
  <div class="line covered" id="L705">
    <div class="line-number"><a href="#L705">705</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  end</div>
  </div>
  <div class="line covered" id="L706">
    <div class="line-number"><a href="#L706">706</a></div>
    <div class="execution-count">1</div>    <div class="line-content">  return table.concat(parts, &quot;&quot;)</div>
  </div>
  <div class="line covered" id="L707">
    <div class="line-number"><a href="#L707">707</a></div>
    <div class="execution-count">1</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L708">
    <div class="line-number"><a href="#L708">708</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Export log_error function for internal use by other module functions</div>
  </div>
  <div class="line covered" id="L709">
    <div class="line-number"><a href="#L709">709</a></div>
    <div class="execution-count">1</div>    <div class="line-content">M.log_error = log_error</div>
  </div>
  <div class="line not-executable" id="L710">
    <div class="line-number"><a href="#L710">710</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Configure the error handler from global configuration</div>
  </div>
  <div class="line not-executable" id="L711">
    <div class="line-number"><a href="#L711">711</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table The error handler module (for chaining)</div>
  </div>
  <div class="line not-covered" id="L712">
    <div class="line-number"><a href="#L712">712</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.configure_from_config()</div>
  </div>
  <div class="line not-executable" id="L713">
    <div class="line-number"><a href="#L713">713</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Try to load central_config directly</div>
  </div>
  <div class="line not-covered" id="L714">
    <div class="line-number"><a href="#L714">714</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local ok, central_config = pcall(require, &quot;lib.core.central_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L715">
    <div class="line-number"><a href="#L715">715</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if ok and central_config then</div>
  </div>
  <div class="line not-executable" id="L716">
    <div class="line-number"><a href="#L716">716</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Register our module with central_config if not already done</div>
  </div>
  <div class="line not-covered" id="L717">
    <div class="line-number"><a href="#L717">717</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    central_config.register_module(&quot;error_handler&quot;, {</div>
  </div>
  <div class="line not-executable" id="L718">
    <div class="line-number"><a href="#L718">718</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Schema definition</div>
  </div>
  <div class="line not-covered" id="L719">
    <div class="line-number"><a href="#L719">719</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      field_types = {</div>
  </div>
  <div class="line not-covered" id="L720">
    <div class="line-number"><a href="#L720">720</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        use_assertions = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L721">
    <div class="line-number"><a href="#L721">721</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        verbose = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L722">
    <div class="line-number"><a href="#L722">722</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        trace_errors = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L723">
    <div class="line-number"><a href="#L723">723</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        log_all_errors = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L724">
    <div class="line-number"><a href="#L724">724</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        exit_on_fatal = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L725">
    <div class="line-number"><a href="#L725">725</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        capture_backtraces = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L726">
    <div class="line-number"><a href="#L726">726</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        in_test_run = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L727">
    <div class="line-number"><a href="#L727">727</a></div>
    <div class="execution-count">0</div>    <div class="line-content">        suppress_test_assertions = &quot;boolean&quot;,</div>
  </div>
  <div class="line not-covered" id="L728">
    <div class="line-number"><a href="#L728">728</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      }</div>
  </div>
  <div class="line not-covered" id="L729">
    <div class="line-number"><a href="#L729">729</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    }, {</div>
  </div>
  <div class="line not-executable" id="L730">
    <div class="line-number"><a href="#L730">730</a></div>
    <div class="execution-count"></div>    <div class="line-content">      -- Default values (matching our local config)</div>
  </div>
  <div class="line not-covered" id="L731">
    <div class="line-number"><a href="#L731">731</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      use_assertions = config.use_assertions,</div>
  </div>
  <div class="line not-covered" id="L732">
    <div class="line-number"><a href="#L732">732</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      verbose = config.verbose,</div>
  </div>
  <div class="line not-covered" id="L733">
    <div class="line-number"><a href="#L733">733</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      trace_errors = config.trace_errors,</div>
  </div>
  <div class="line not-covered" id="L734">
    <div class="line-number"><a href="#L734">734</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      log_all_errors = config.log_all_errors,</div>
  </div>
  <div class="line not-covered" id="L735">
    <div class="line-number"><a href="#L735">735</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      exit_on_fatal = config.exit_on_fatal,</div>
  </div>
  <div class="line not-covered" id="L736">
    <div class="line-number"><a href="#L736">736</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      capture_backtraces = config.capture_backtraces,</div>
  </div>
  <div class="line not-covered" id="L737">
    <div class="line-number"><a href="#L737">737</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      in_test_run = config.in_test_run,</div>
  </div>
  <div class="line not-covered" id="L738">
    <div class="line-number"><a href="#L738">738</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      suppress_test_assertions = config.suppress_test_assertions,</div>
  </div>
  <div class="line not-covered" id="L739">
    <div class="line-number"><a href="#L739">739</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-executable" id="L740">
    <div class="line-number"><a href="#L740">740</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L741">
    <div class="line-number"><a href="#L741">741</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- Get the centralized configuration</div>
  </div>
  <div class="line not-covered" id="L742">
    <div class="line-number"><a href="#L742">742</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    local error_handler_config = central_config.get(&quot;error_handler&quot;)</div>
  </div>
  <div class="line not-covered" id="L743">
    <div class="line-number"><a href="#L743">743</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    if error_handler_config then</div>
  </div>
  <div class="line not-covered" id="L744">
    <div class="line-number"><a href="#L744">744</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      M.configure(error_handler_config)</div>
  </div>
  <div class="line not-covered" id="L745">
    <div class="line-number"><a href="#L745">745</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    end</div>
  </div>
  <div class="line not-covered" id="L746">
    <div class="line-number"><a href="#L746">746</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-covered" id="L747">
    <div class="line-number"><a href="#L747">747</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return M</div>
  </div>
  <div class="line not-covered" id="L748">
    <div class="line-number"><a href="#L748">748</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L749">
    <div class="line-number"><a href="#L749">749</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Set whether the error handler is in test mode</div>
  </div>
  <div class="line not-executable" id="L750">
    <div class="line-number"><a href="#L750">750</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param enabled boolean Whether test mode is enabled</div>
  </div>
  <div class="line not-executable" id="L751">
    <div class="line-number"><a href="#L751">751</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean The current test mode state</div>
  </div>
  <div class="line not-covered" id="L752">
    <div class="line-number"><a href="#L752">752</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.set_test_mode(enabled)</div>
  </div>
  <div class="line not-covered" id="L753">
    <div class="line-number"><a href="#L753">753</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.in_test_run = enabled and true or false</div>
  </div>
  <div class="line not-executable" id="L754">
    <div class="line-number"><a href="#L754">754</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L755">
    <div class="line-number"><a href="#L755">755</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update central_config if available</div>
  </div>
  <div class="line not-covered" id="L756">
    <div class="line-number"><a href="#L756">756</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local ok, central_config = pcall(require, &quot;lib.core.central_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L757">
    <div class="line-number"><a href="#L757">757</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if ok and central_config then</div>
  </div>
  <div class="line not-covered" id="L758">
    <div class="line-number"><a href="#L758">758</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    central_config.set(&quot;error_handler.in_test_run&quot;, config.in_test_run)</div>
  </div>
  <div class="line not-executable" id="L759">
    <div class="line-number"><a href="#L759">759</a></div>
    <div class="execution-count"></div>    <div class="line-content">    </div>
  </div>
  <div class="line not-executable" id="L760">
    <div class="line-number"><a href="#L760">760</a></div>
    <div class="execution-count"></div>    <div class="line-content">    -- We'll handle logging suppression locally through our module</div>
  </div>
  <div class="line not-covered" id="L761">
    <div class="line-number"><a href="#L761">761</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L762">
    <div class="line-number"><a href="#L762">762</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L763">
    <div class="line-number"><a href="#L763">763</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Don't try to configure logging directly - use its own methods</div>
  </div>
  <div class="line not-executable" id="L764">
    <div class="line-number"><a href="#L764">764</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- This can cause circular dependencies and type issues</div>
  </div>
  <div class="line not-executable" id="L765">
    <div class="line-number"><a href="#L765">765</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L766">
    <div class="line-number"><a href="#L766">766</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return config.in_test_run</div>
  </div>
  <div class="line not-covered" id="L767">
    <div class="line-number"><a href="#L767">767</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L768">
    <div class="line-number"><a href="#L768">768</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if the error handler is in test mode</div>
  </div>
  <div class="line not-executable" id="L769">
    <div class="line-number"><a href="#L769">769</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean Whether test mode is enabled</div>
  </div>
  <div class="line not-covered" id="L770">
    <div class="line-number"><a href="#L770">770</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.is_test_mode()</div>
  </div>
  <div class="line not-covered" id="L771">
    <div class="line-number"><a href="#L771">771</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return config.in_test_run</div>
  </div>
  <div class="line not-covered" id="L772">
    <div class="line-number"><a href="#L772">772</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L773">
    <div class="line-number"><a href="#L773">773</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if we're suppressing all logging in tests</div>
  </div>
  <div class="line not-executable" id="L774">
    <div class="line-number"><a href="#L774">774</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean Whether test logs are being suppressed</div>
  </div>
  <div class="line not-covered" id="L775">
    <div class="line-number"><a href="#L775">775</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.is_suppressing_test_logs()</div>
  </div>
  <div class="line not-covered" id="L776">
    <div class="line-number"><a href="#L776">776</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return config.in_test_run and config.suppress_all_logging_in_tests</div>
  </div>
  <div class="line not-covered" id="L777">
    <div class="line-number"><a href="#L777">777</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L778">
    <div class="line-number"><a href="#L778">778</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Helper function to check if an error is an expected test error</div>
  </div>
  <div class="line not-executable" id="L779">
    <div class="line-number"><a href="#L779">779</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param err table The error object to check</div>
  </div>
  <div class="line not-executable" id="L780">
    <div class="line-number"><a href="#L780">780</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean Whether the error is an expected test error</div>
  </div>
  <div class="line not-covered" id="L781">
    <div class="line-number"><a href="#L781">781</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.is_expected_test_error(err)</div>
  </div>
  <div class="line not-covered" id="L782">
    <div class="line-number"><a href="#L782">782</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if not M.is_error(err) then</div>
  </div>
  <div class="line not-covered" id="L783">
    <div class="line-number"><a href="#L783">783</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return false</div>
  </div>
  <div class="line not-covered" id="L784">
    <div class="line-number"><a href="#L784">784</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L785">
    <div class="line-number"><a href="#L785">785</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L786">
    <div class="line-number"><a href="#L786">786</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Expected test errors are VALIDATION errors or explicitly marked TEST_EXPECTED errors</div>
  </div>
  <div class="line not-covered" id="L787">
    <div class="line-number"><a href="#L787">787</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local is_expected_category = err.category == M.CATEGORY.VALIDATION or </div>
  </div>
  <div class="line not-covered" id="L788">
    <div class="line-number"><a href="#L788">788</a></div>
    <div class="execution-count">0</div>    <div class="line-content">                              err.category == M.CATEGORY.TEST_EXPECTED</div>
  </div>
  <div class="line not-executable" id="L789">
    <div class="line-number"><a href="#L789">789</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L790">
    <div class="line-number"><a href="#L790">790</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Check for test metadata with expect_error flag</div>
  </div>
  <div class="line not-executable" id="L791">
    <div class="line-number"><a href="#L791">791</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Tests with { expect_error = true } flag have ALL error logging completely suppressed</div>
  </div>
  <div class="line not-executable" id="L792">
    <div class="line-number"><a href="#L792">792</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- This is different from tests that lack the flag, where only validation/test_expected errors are suppressed</div>
  </div>
  <div class="line not-covered" id="L793">
    <div class="line-number"><a href="#L793">793</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if config.current_test_metadata and config.current_test_metadata.expect_error then</div>
  </div>
  <div class="line not-covered" id="L794">
    <div class="line-number"><a href="#L794">794</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Expected test error detected via test metadata&quot;, {</div>
  </div>
  <div class="line not-covered" id="L795">
    <div class="line-number"><a href="#L795">795</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      error_category = err.category,</div>
  </div>
  <div class="line not-covered" id="L796">
    <div class="line-number"><a href="#L796">796</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      metadata_name = config.current_test_metadata.name,</div>
  </div>
  <div class="line not-covered" id="L797">
    <div class="line-number"><a href="#L797">797</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      expect_error = true</div>
  </div>
  <div class="line not-covered" id="L798">
    <div class="line-number"><a href="#L798">798</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L799">
    <div class="line-number"><a href="#L799">799</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    return true</div>
  </div>
  <div class="line not-covered" id="L800">
    <div class="line-number"><a href="#L800">800</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L801">
    <div class="line-number"><a href="#L801">801</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L802">
    <div class="line-number"><a href="#L802">802</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return is_expected_category</div>
  </div>
  <div class="line not-covered" id="L803">
    <div class="line-number"><a href="#L803">803</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L804">
    <div class="line-number"><a href="#L804">804</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Set metadata for the current test</div>
  </div>
  <div class="line not-executable" id="L805">
    <div class="line-number"><a href="#L805">805</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@param metadata table|nil The test metadata or nil to clear</div>
  </div>
  <div class="line not-executable" id="L806">
    <div class="line-number"><a href="#L806">806</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil The current test metadata</div>
  </div>
  <div class="line not-covered" id="L807">
    <div class="line-number"><a href="#L807">807</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.set_current_test_metadata(metadata)</div>
  </div>
  <div class="line not-executable" id="L808">
    <div class="line-number"><a href="#L808">808</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Log the metadata change</div>
  </div>
  <div class="line not-covered" id="L809">
    <div class="line-number"><a href="#L809">809</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if metadata then</div>
  </div>
  <div class="line not-covered" id="L810">
    <div class="line-number"><a href="#L810">810</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Setting test metadata&quot;, {</div>
  </div>
  <div class="line not-covered" id="L811">
    <div class="line-number"><a href="#L811">811</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      metadata_name = metadata.name,</div>
  </div>
  <div class="line not-covered" id="L812">
    <div class="line-number"><a href="#L812">812</a></div>
    <div class="execution-count">0</div>    <div class="line-content">      expect_error = metadata.expect_error or false,</div>
  </div>
  <div class="line not-covered" id="L813">
    <div class="line-number"><a href="#L813">813</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    })</div>
  </div>
  <div class="line not-covered" id="L814">
    <div class="line-number"><a href="#L814">814</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  else</div>
  </div>
  <div class="line not-covered" id="L815">
    <div class="line-number"><a href="#L815">815</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    logger.debug(&quot;Clearing test metadata&quot;)</div>
  </div>
  <div class="line not-covered" id="L816">
    <div class="line-number"><a href="#L816">816</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L817">
    <div class="line-number"><a href="#L817">817</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L818">
    <div class="line-number"><a href="#L818">818</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  config.current_test_metadata = metadata</div>
  </div>
  <div class="line not-executable" id="L819">
    <div class="line-number"><a href="#L819">819</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-executable" id="L820">
    <div class="line-number"><a href="#L820">820</a></div>
    <div class="execution-count"></div>    <div class="line-content">  -- Update central_config if available</div>
  </div>
  <div class="line not-covered" id="L821">
    <div class="line-number"><a href="#L821">821</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  local ok, central_config = pcall(require, &quot;lib.core.central_config&quot;)</div>
  </div>
  <div class="line not-covered" id="L822">
    <div class="line-number"><a href="#L822">822</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  if ok and central_config then</div>
  </div>
  <div class="line not-covered" id="L823">
    <div class="line-number"><a href="#L823">823</a></div>
    <div class="execution-count">0</div>    <div class="line-content">    central_config.set(&quot;error_handler.current_test_metadata&quot;, config.current_test_metadata)</div>
  </div>
  <div class="line not-covered" id="L824">
    <div class="line-number"><a href="#L824">824</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  end</div>
  </div>
  <div class="line not-executable" id="L825">
    <div class="line-number"><a href="#L825">825</a></div>
    <div class="execution-count"></div>    <div class="line-content">  </div>
  </div>
  <div class="line not-covered" id="L826">
    <div class="line-number"><a href="#L826">826</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return config.current_test_metadata</div>
  </div>
  <div class="line not-covered" id="L827">
    <div class="line-number"><a href="#L827">827</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L828">
    <div class="line-number"><a href="#L828">828</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Get the current test metadata</div>
  </div>
  <div class="line not-executable" id="L829">
    <div class="line-number"><a href="#L829">829</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table|nil The current test metadata</div>
  </div>
  <div class="line not-covered" id="L830">
    <div class="line-number"><a href="#L830">830</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_current_test_metadata()</div>
  </div>
  <div class="line not-covered" id="L831">
    <div class="line-number"><a href="#L831">831</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return config.current_test_metadata</div>
  </div>
  <div class="line not-covered" id="L832">
    <div class="line-number"><a href="#L832">832</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L833">
    <div class="line-number"><a href="#L833">833</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Check if current test expects errors</div>
  </div>
  <div class="line not-executable" id="L834">
    <div class="line-number"><a href="#L834">834</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean Whether the current test expects errors</div>
  </div>
  <div class="line not-covered" id="L835">
    <div class="line-number"><a href="#L835">835</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.current_test_expects_errors()</div>
  </div>
  <div class="line not-covered" id="L836">
    <div class="line-number"><a href="#L836">836</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return config.current_test_metadata and config.current_test_metadata.expect_error == true</div>
  </div>
  <div class="line not-covered" id="L837">
    <div class="line-number"><a href="#L837">837</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L838">
    <div class="line-number"><a href="#L838">838</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Retrieve expected errors captured during tests</div>
  </div>
  <div class="line not-executable" id="L839">
    <div class="line-number"><a href="#L839">839</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return table Array of expected test errors</div>
  </div>
  <div class="line not-covered" id="L840">
    <div class="line-number"><a href="#L840">840</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.get_expected_test_errors()</div>
  </div>
  <div class="line not-covered" id="L841">
    <div class="line-number"><a href="#L841">841</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return _G._firmo_test_expected_errors or {}</div>
  </div>
  <div class="line not-covered" id="L842">
    <div class="line-number"><a href="#L842">842</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L843">
    <div class="line-number"><a href="#L843">843</a></div>
    <div class="execution-count"></div>    <div class="line-content">--- Clear the collection of expected errors</div>
  </div>
  <div class="line not-executable" id="L844">
    <div class="line-number"><a href="#L844">844</a></div>
    <div class="execution-count"></div>    <div class="line-content">---@return boolean Always returns true</div>
  </div>
  <div class="line not-covered" id="L845">
    <div class="line-number"><a href="#L845">845</a></div>
    <div class="execution-count">0</div>    <div class="line-content">function M.clear_expected_test_errors()</div>
  </div>
  <div class="line not-covered" id="L846">
    <div class="line-number"><a href="#L846">846</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  _G._firmo_test_expected_errors = {}</div>
  </div>
  <div class="line not-covered" id="L847">
    <div class="line-number"><a href="#L847">847</a></div>
    <div class="execution-count">0</div>    <div class="line-content">  return true</div>
  </div>
  <div class="line not-covered" id="L848">
    <div class="line-number"><a href="#L848">848</a></div>
    <div class="execution-count">0</div>    <div class="line-content">end</div>
  </div>
  <div class="line not-executable" id="L849">
    <div class="line-number"><a href="#L849">849</a></div>
    <div class="execution-count"></div>    <div class="line-content">-- Automatically configure from global config if available</div>
  </div>
  <div class="line not-covered" id="L850">
    <div class="line-number"><a href="#L850">850</a></div>
    <div class="execution-count">0</div>    <div class="line-content">M.configure_from_config()</div>
  </div>
  <div class="line not-covered" id="L851">
    <div class="line-number"><a href="#L851">851</a></div>
    <div class="execution-count">0</div>    <div class="line-content">return M</div>
  </div>
</div>
</body>
</html>
